!function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}n(165),n(167),n(166),n(164);var o=n(93),a=r(o),i=n(81),l=r(i);a["default"].render(React.createElement(l["default"],null),document.getElementById("main"))},function(e,t){function n(){d=!1,i.length?s=i.concat(s):c=-1,s.length&&r()}function r(){if(!d){var e=setTimeout(n);d=!0;for(var t=s.length;t;){for(i=s,s=[];++c<t;)i&&i[c].run();c=-1,t=s.length}i=null,d=!1,clearTimeout(e)}}function o(e,t){this.fun=e,this.array=t}function a(){}var i,l=e.exports={},s=[],d=!1,c=-1;l.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];s.push(new o(e,t)),1!==s.length||d||setTimeout(r,0)},o.prototype.run=function(){this.fun.apply(null,this.array)},l.title="browser",l.browser=!0,l.env={},l.argv=[],l.version="",l.versions={},l.on=a,l.addListener=a,l.once=a,l.off=a,l.removeListener=a,l.removeAllListeners=a,l.emit=a,l.binding=function(e){throw new Error("process.binding is not supported")},l.cwd=function(){return"/"},l.chdir=function(e){throw new Error("process.chdir is not supported")},l.umask=function(){return 0}},function(e,t,n){(function(t){"use strict";function n(e,n,r,o,a,i,l,s){if("production"!==t.env.NODE_ENV&&void 0===n)throw new Error("invariant requires an error message argument");if(!e){var d;if(void 0===n)d=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,o,a,i,l,s],u=0;d=new Error(n.replace(/%s/g,function(){return c[u++]})),d.name="Invariant Violation"}throw d.framesToPop=1,d}}e.exports=n}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(10),o=r;"production"!==t.env.NODE_ENV&&(o=function(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;n>o;o++)r[o-2]=arguments[o];if(void 0===t)throw new Error("`warning(condition, format, ...args)` requires a warning message argument");if(0!==t.indexOf("Failed Composite propType: ")&&!e){var a=0,i="Warning: "+t.replace(/%s/g,function(){return r[a++]});"undefined"!=typeof console&&console.error(i);try{throw new Error(i)}catch(l){}}}),e.exports=o}).call(t,n(1))},function(e,t){"use strict";function n(e,t){if(null==e)throw new TypeError("Object.assign target cannot be null or undefined");for(var n=Object(e),r=Object.prototype.hasOwnProperty,o=1;o<arguments.length;o++){var a=arguments[o];if(null!=a){var i=Object(a);for(var l in i)r.call(i,l)&&(n[l]=i[l])}}return n}e.exports=n},function(e,t){"use strict";var n=!("undefined"==typeof window||!window.document||!window.document.createElement),r={canUseDOM:n,canUseWorkers:"undefined"!=typeof Worker,canUseEventListeners:n&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:n&&!!window.screen,isInWorker:!n};e.exports=r},function(e,t,n){(function(t){"use strict";function r(e,t){for(var n=Math.min(e.length,t.length),r=0;n>r;r++)if(e.charAt(r)!==t.charAt(r))return r;return e.length===t.length?-1:n}function o(e){return e?e.nodeType===z?e.documentElement:e.firstChild:null}function a(e){var t=o(e);return t&&ee.getID(t)}function i(e){var n=l(e);if(n)if(q.hasOwnProperty(n)){var r=q[n];r!==e&&(u(r,n)?"production"!==t.env.NODE_ENV?L(!1,"ReactMount: Two valid but unequal nodes with the same `%s`: %s",H,n):L(!1):void 0,q[n]=e)}else q[n]=e;return n}function l(e){return e&&e.getAttribute&&e.getAttribute(H)||""}function s(e,t){var n=l(e);n!==t&&delete q[n],e.setAttribute(H,t),q[t]=e}function d(e){return q.hasOwnProperty(e)&&u(q[e],e)||(q[e]=ee.findReactNodeByID(e)),q[e]}function c(e){var t=T.get(e)._rootNodeID;return S.isNullComponentID(t)?null:(q.hasOwnProperty(t)&&u(q[t],t)||(q[t]=ee.findReactNodeByID(t)),q[t])}function u(e,n){if(e){l(e)!==n?"production"!==t.env.NODE_ENV?L(!1,"ReactMount: Unexpected modification of `%s`",H):L(!1):void 0;var r=ee.findReactContainerForID(n);if(r&&A(r,e))return!0}return!1}function m(e){delete q[e]}function p(e){var t=q[e];return t&&u(t,e)?void(J=t):!1}function f(e){J=null,k.traverseAncestors(e,p);var t=J;return J=null,t}function g(e,n,r,o,a,i){if(E.useCreateElement&&(i=D({},i),r.nodeType===z?i[K]=r:i[K]=r.ownerDocument),"production"!==t.env.NODE_ENV){i===O&&(i={});var l=r.nodeName.toLowerCase();i[F.ancestorInfoContextKey]=F.updatedAncestorInfo(null,l,null)}var s=_.mountComponent(e,n,o,i);e._renderedComponent._topLevelWrapper=e,ee._mountImageIntoNode(s,r,a,o)}function h(e,t,n,r,o){var a=B.ReactReconcileTransaction.getPooled(r);a.perform(g,null,e,t,n,a,r,o),B.ReactReconcileTransaction.release(a)}function v(e,t){for(_.unmountComponent(e),t.nodeType===z&&(t=t.documentElement);t.lastChild;)t.removeChild(t.lastChild)}function b(e){var t=a(e);return t?t!==k.getReactRootIDFromNodeID(t):!1}function y(e){for(;e&&e.parentNode!==e;e=e.parentNode)if(1===e.nodeType){var t=l(e);if(t){var n,r=k.getReactRootIDFromNodeID(t),o=e;do if(n=l(o),o=o.parentNode,null==o)return null;while(n!==r);if(o===X[r])return e}}return null}var x=n(14),C=n(23),N=n(11),E=n(57),w=n(12),S=n(61),k=n(20),T=n(21),U=n(125),I=n(7),_=n(16),R=n(38),B=n(8),D=n(4),O=n(27),A=n(76),P=n(73),L=n(2),M=n(26),j=n(47),F=n(49),V=n(3),H=x.ID_ATTRIBUTE_NAME,q={},W=1,z=9,$=11,K="__ReactMount_ownerDocument$"+Math.random().toString(36).slice(2),Y={},X={};if("production"!==t.env.NODE_ENV)var G={};var Z=[],J=null,Q=function(){};Q.prototype.isReactComponent={},"production"!==t.env.NODE_ENV&&(Q.displayName="TopLevelWrapper"),Q.prototype.render=function(){return this.props};var ee={TopLevelWrapper:Q,_instancesByReactRootID:Y,scrollMonitor:function(e,t){t()},_updateRootComponent:function(e,n,r,i){return ee.scrollMonitor(r,function(){R.enqueueElementInternal(e,n),i&&R.enqueueCallbackInternal(e,i)}),"production"!==t.env.NODE_ENV&&(G[a(r)]=o(r)),e},_registerComponent:function(e,n){!n||n.nodeType!==W&&n.nodeType!==z&&n.nodeType!==$?"production"!==t.env.NODE_ENV?L(!1,"_registerComponent(...): Target container is not a DOM element."):L(!1):void 0,C.ensureScrollValueMonitoring();var r=ee.registerContainer(n);return Y[r]=e,r},_renderNewRootComponent:function(e,n,r,a){"production"!==t.env.NODE_ENV?V(null==N.current,"_renderNewRootComponent(): Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate. Check the render method of %s.",N.current&&N.current.getName()||"ReactCompositeComponent"):void 0;var i=P(e,null),l=ee._registerComponent(i,n);return B.batchedUpdates(h,i,l,n,r,a),"production"!==t.env.NODE_ENV&&(G[l]=o(n)),i},renderSubtreeIntoContainer:function(e,n,r,o){return null==e||null==e._reactInternalInstance?"production"!==t.env.NODE_ENV?L(!1,"parentComponent must be a valid React Component"):L(!1):void 0,ee._renderSubtreeIntoContainer(e,n,r,o)},_renderSubtreeIntoContainer:function(e,n,r,i){w.isValidElement(n)?void 0:"production"!==t.env.NODE_ENV?L(!1,"ReactDOM.render(): Invalid component element.%s","string"==typeof n?" Instead of passing an element string, make sure to instantiate it by passing it to React.createElement.":"function"==typeof n?" Instead of passing a component class, make sure to instantiate it by passing it to React.createElement.":null!=n&&void 0!==n.props?" This may be caused by unintentionally loading two independent copies of React.":""):L(!1),"production"!==t.env.NODE_ENV?V(!r||!r.tagName||"BODY"!==r.tagName.toUpperCase(),"render(): Rendering components directly into document.body is discouraged, since its children are often manipulated by third-party scripts and browser extensions. This may lead to subtle reconciliation issues. Try rendering into a container element created for your app."):void 0;var s=new w(Q,null,null,null,null,null,n),d=Y[a(r)];if(d){var c=d._currentElement,u=c.props;if(j(u,n)){var m=d._renderedComponent.getPublicInstance(),p=i&&function(){i.call(m)};return ee._updateRootComponent(d,s,r,p),m}ee.unmountComponentAtNode(r)}var f=o(r),g=f&&!!l(f),h=b(r);if("production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?V(!h,"render(...): Replacing React-rendered children with a new root component. If you intended to update the children of this node, you should instead have the existing children update their state and render the new components instead of calling ReactDOM.render."):void 0,!g||f.nextSibling))for(var v=f;v;){if(l(v)){"production"!==t.env.NODE_ENV?V(!1,"render(): Target node has markup rendered by React, but there are unrelated nodes as well. This is most commonly caused by white-space inserted around server-rendered markup."):void 0;break}v=v.nextSibling}var y=g&&!d&&!h,x=ee._renderNewRootComponent(s,r,y,null!=e?e._reactInternalInstance._processChildContext(e._reactInternalInstance._context):O)._renderedComponent.getPublicInstance();return i&&i.call(x),x},render:function(e,t,n){return ee._renderSubtreeIntoContainer(null,e,t,n)},registerContainer:function(e){var t=a(e);return t&&(t=k.getReactRootIDFromNodeID(t)),t||(t=k.createReactRootID()),X[t]=e,t},unmountComponentAtNode:function(e){"production"!==t.env.NODE_ENV?V(null==N.current,"unmountComponentAtNode(): Render methods should be a pure function of props and state; triggering nested component updates from render is not allowed. If necessary, trigger nested updates in componentDidUpdate. Check the render method of %s.",N.current&&N.current.getName()||"ReactCompositeComponent"):void 0,!e||e.nodeType!==W&&e.nodeType!==z&&e.nodeType!==$?"production"!==t.env.NODE_ENV?L(!1,"unmountComponentAtNode(...): Target container is not a DOM element."):L(!1):void 0;var n=a(e),r=Y[n];if(!r){var o=b(e),i=l(e),s=i&&i===k.getReactRootIDFromNodeID(i);return"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?V(!o,"unmountComponentAtNode(): The node you're attempting to unmount was rendered by React and is not a top-level container. %s",s?"You may have accidentally passed in a React root node instead of its container.":"Instead, have the parent component update its state and rerender in order to remove this component."):void 0),!1}return B.batchedUpdates(v,r,e),delete Y[n],delete X[n],"production"!==t.env.NODE_ENV&&delete G[n],!0},findReactContainerForID:function(e){var n=k.getReactRootIDFromNodeID(e),r=X[n];if("production"!==t.env.NODE_ENV){var o=G[n];if(o&&o.parentNode!==r){"production"!==t.env.NODE_ENV?V(l(o)===n,"ReactMount: Root element ID differed from reactRootID."):void 0;var a=r.firstChild;a&&n===l(a)?G[n]=a:"production"!==t.env.NODE_ENV?V(!1,"ReactMount: Root element has been removed from its original container. New container: %s",o.parentNode):void 0}}return r},findReactNodeByID:function(e){var t=ee.findReactContainerForID(e);return ee.findComponentRoot(t,e)},getFirstReactDOM:function(e){return y(e)},findComponentRoot:function(e,n){var r=Z,o=0,a=f(n)||e;for("production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?V(null!=a,"React can't find the root component node for data-reactid value `%s`. If you're seeing this message, it probably means that you've loaded two copies of React on the page. At this time, only a single copy of React can be loaded at a time.",n):void 0),r[0]=a.firstChild,r.length=1;o<r.length;){for(var i,l=r[o++];l;){var s=ee.getID(l);s?n===s?i=l:k.isAncestorIDOf(s,n)&&(r.length=o=0,r.push(l.firstChild)):r.push(l.firstChild),l=l.nextSibling}if(i)return r.length=0,i}r.length=0,"production"!==t.env.NODE_ENV?L(!1,"findComponentRoot(..., %s): Unable to find element. This probably means the DOM was unexpectedly mutated (e.g., by the browser), usually due to forgetting a <tbody> when using tables, nesting tags like <form>, <p>, or <a>, or using non-SVG elements in an <svg> parent. Try inspecting the child nodes of the element with React ID `%s`.",n,ee.getID(e)):L(!1)},_mountImageIntoNode:function(e,n,a,i){if(!n||n.nodeType!==W&&n.nodeType!==z&&n.nodeType!==$?"production"!==t.env.NODE_ENV?L(!1,"mountComponentIntoNode(...): Target container is not valid."):L(!1):void 0,a){var l=o(n);if(U.canReuseMarkup(e,l))return;var s=l.getAttribute(U.CHECKSUM_ATTR_NAME);l.removeAttribute(U.CHECKSUM_ATTR_NAME);var d=l.outerHTML;l.setAttribute(U.CHECKSUM_ATTR_NAME,s);var c=e;if("production"!==t.env.NODE_ENV){var u;n.nodeType===W?(u=document.createElement("div"),u.innerHTML=e,c=u.innerHTML):(u=document.createElement("iframe"),document.body.appendChild(u),u.contentDocument.write(e),c=u.contentDocument.documentElement.outerHTML,document.body.removeChild(u))}var m=r(c,d),p=" (client) "+c.substring(m-20,m+20)+"\n (server) "+d.substring(m-20,m+20);n.nodeType===z?"production"!==t.env.NODE_ENV?L(!1,"You're trying to render a component to the document using server rendering but the checksum was invalid. This usually means you rendered a different component type or props on the client from the one on the server, or your render() methods are impure. React cannot handle this case due to cross-browser quirks by rendering at the document root. You should look for environment dependent code in your components and ensure the props are the same client and server side:\n%s",p):L(!1):void 0,"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?V(!1,"React attempted to reuse markup in a container but the checksum was invalid. This generally means that you are using server rendering and the markup generated on the server was not what the client was expecting. React injected new markup to compensate which works but you have lost many of the benefits of server rendering. Instead, figure out why the markup being generated is different on the client or server:\n%s",p):void 0)}if(n.nodeType===z?"production"!==t.env.NODE_ENV?L(!1,"You're trying to render a component to the document but you didn't use server rendering. We can't do this without using server rendering due to cross-browser quirks. See ReactDOMServer.renderToString() for server rendering."):L(!1):void 0,i.useCreateElement){for(;n.lastChild;)n.removeChild(n.lastChild);n.appendChild(e)}else M(n,e)},ownerDocumentContextKey:K,getReactRootID:a,getID:i,setID:s,getNode:d,getNodeFromInstance:c,isValid:u,purgeID:m};I.measureMethods(ee,"ReactMount",{_renderNewRootComponent:"_renderNewRootComponent",_mountImageIntoNode:"_mountImageIntoNode"}),e.exports=ee}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function n(e,t,n){return n}var r={enableMeasure:!1,storedMeasure:n,measureMethods:function(e,n,o){if("production"!==t.env.NODE_ENV)for(var a in o)o.hasOwnProperty(a)&&(e[a]=r.measure(n,o[a],e[a]))},measure:function(e,n,o){if("production"!==t.env.NODE_ENV){var a=null,i=function(){return r.enableMeasure?(a||(a=r.storedMeasure(e,n,o)),a.apply(this,arguments)):o.apply(this,arguments)};return i.displayName=e+"_"+n,i}return o},injection:{injectMeasure:function(e){r.storedMeasure=e}}};e.exports=r}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(){k.ReactReconcileTransaction&&x?void 0:"production"!==t.env.NODE_ENV?h(!1,"ReactUpdates: must inject a reconcile transaction class and batching strategy"):h(!1)}function o(){this.reinitializeTransaction(),this.dirtyComponentsLength=null,this.callbackQueue=c.getPooled(),this.reconcileTransaction=k.ReactReconcileTransaction.getPooled(!1)}function a(e,t,n,o,a,i){r(),x.batchedUpdates(e,t,n,o,a,i)}function i(e,t){return e._mountOrder-t._mountOrder}function l(e){var n=e.dirtyComponentsLength;n!==v.length?"production"!==t.env.NODE_ENV?h(!1,"Expected flush transaction's stored dirty-components length (%s) to match dirty-components array length (%s).",n,v.length):h(!1):void 0,v.sort(i);for(var r=0;n>r;r++){var o=v[r],a=o._pendingCallbacks;if(o._pendingCallbacks=null,p.performUpdateIfNecessary(o,e.reconcileTransaction),a)for(var l=0;l<a.length;l++)e.callbackQueue.enqueue(a[l],o.getPublicInstance())}}function s(e){return r(),x.isBatchingUpdates?void v.push(e):void x.batchedUpdates(s,e)}function d(e,n){x.isBatchingUpdates?void 0:"production"!==t.env.NODE_ENV?h(!1,"ReactUpdates.asap: Can't enqueue an asap callback in a context whereupdates are not being batched."):h(!1),b.enqueue(e,n),y=!0}var c=n(54),u=n(15),m=n(7),p=n(16),f=n(39),g=n(4),h=n(2),v=[],b=c.getPooled(),y=!1,x=null,C={initialize:function(){this.dirtyComponentsLength=v.length},close:function(){this.dirtyComponentsLength!==v.length?(v.splice(0,this.dirtyComponentsLength),w()):v.length=0}},N={initialize:function(){this.callbackQueue.reset()},close:function(){this.callbackQueue.notifyAll()}},E=[C,N];g(o.prototype,f.Mixin,{getTransactionWrappers:function(){return E},destructor:function(){this.dirtyComponentsLength=null,c.release(this.callbackQueue),this.callbackQueue=null,k.ReactReconcileTransaction.release(this.reconcileTransaction),this.reconcileTransaction=null},perform:function(e,t,n){return f.Mixin.perform.call(this,this.reconcileTransaction.perform,this.reconcileTransaction,e,t,n)}}),u.addPoolingTo(o);var w=function(){for(;v.length||y;){if(v.length){var e=o.getPooled();e.perform(l,null,e),o.release(e)}if(y){y=!1;var t=b;b=c.getPooled(),t.notifyAll(),c.release(t)}}};w=m.measure("ReactUpdates","flushBatchedUpdates",w);var S={injectReconcileTransaction:function(e){e?void 0:"production"!==t.env.NODE_ENV?h(!1,"ReactUpdates: must provide a reconcile transaction class"):h(!1),k.ReactReconcileTransaction=e},injectBatchingStrategy:function(e){e?void 0:"production"!==t.env.NODE_ENV?h(!1,"ReactUpdates: must provide a batching strategy"):h(!1),"function"!=typeof e.batchedUpdates?"production"!==t.env.NODE_ENV?h(!1,"ReactUpdates: must provide a batchedUpdates() function"):h(!1):void 0,"boolean"!=typeof e.isBatchingUpdates?"production"!==t.env.NODE_ENV?h(!1,"ReactUpdates: must provide an isBatchingUpdates boolean attribute"):h(!1):void 0,x=e}},k={ReactReconcileTransaction:null,batchedUpdates:a,enqueueUpdate:s,flushBatchedUpdates:w,injection:S,asap:d};e.exports=k}).call(t,n(1))},function(e,t,n){"use strict";var r=n(28),o=r({bubbled:null,captured:null}),a=r({topAbort:null,topBlur:null,topCanPlay:null,topCanPlayThrough:null,topChange:null,topClick:null,topCompositionEnd:null,topCompositionStart:null,topCompositionUpdate:null,topContextMenu:null,topCopy:null,topCut:null,topDoubleClick:null,topDrag:null,topDragEnd:null,topDragEnter:null,topDragExit:null,topDragLeave:null,topDragOver:null,topDragStart:null,topDrop:null,topDurationChange:null,topEmptied:null,topEncrypted:null,topEnded:null,topError:null,topFocus:null,topInput:null,topKeyDown:null,topKeyPress:null,topKeyUp:null,topLoad:null,topLoadedData:null,topLoadedMetadata:null,topLoadStart:null,topMouseDown:null,topMouseMove:null,topMouseOut:null,topMouseOver:null,topMouseUp:null,topPaste:null,topPause:null,topPlay:null,topPlaying:null,topProgress:null,topRateChange:null,topReset:null,topScroll:null,topSeeked:null,topSeeking:null,topSelectionChange:null,topStalled:null,topSubmit:null,topSuspend:null,topTextInput:null,topTimeUpdate:null,topTouchCancel:null,topTouchEnd:null,topTouchMove:null,topTouchStart:null,topVolumeChange:null,topWaiting:null,topWheel:null}),i={topLevelTypes:a,PropagationPhases:o};e.exports=i},function(e,t){"use strict";function n(e){return function(){return e}}function r(){}r.thatReturns=n,r.thatReturnsFalse=n(!1),r.thatReturnsTrue=n(!0),r.thatReturnsNull=n(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(e){return e},e.exports=r},function(e,t){"use strict";var n={current:null};e.exports=n},function(e,t,n){(function(t){"use strict";var r=n(11),o=n(4),a=n(40),i="function"==typeof Symbol&&Symbol["for"]&&Symbol["for"]("react.element")||60103,l={key:!0,ref:!0,__self:!0,__source:!0},s=function(e,n,r,o,l,s,d){var c={$$typeof:i,type:e,key:n,ref:r,props:d,_owner:s};return"production"!==t.env.NODE_ENV&&(c._store={},a?(Object.defineProperty(c._store,"validated",{configurable:!1,enumerable:!1,writable:!0,value:!1}),Object.defineProperty(c,"_self",{configurable:!1,enumerable:!1,writable:!1,value:o}),Object.defineProperty(c,"_source",{configurable:!1,enumerable:!1,writable:!1,value:l})):(c._store.validated=!1,c._self=o,c._source=l),Object.freeze(c.props),Object.freeze(c)),c};s.createElement=function(e,t,n){var o,a={},i=null,d=null,c=null,u=null;if(null!=t){d=void 0===t.ref?null:t.ref,i=void 0===t.key?null:""+t.key,c=void 0===t.__self?null:t.__self,u=void 0===t.__source?null:t.__source;for(o in t)t.hasOwnProperty(o)&&!l.hasOwnProperty(o)&&(a[o]=t[o])}var m=arguments.length-2;if(1===m)a.children=n;else if(m>1){for(var p=Array(m),f=0;m>f;f++)p[f]=arguments[f+2];a.children=p}if(e&&e.defaultProps){var g=e.defaultProps;for(o in g)"undefined"==typeof a[o]&&(a[o]=g[o])}return s(e,i,d,c,u,r.current,a)},s.createFactory=function(e){var t=s.createElement.bind(null,e);return t.type=e,t},s.cloneAndReplaceKey=function(e,t){var n=s(e.type,t,e.ref,e._self,e._source,e._owner,e.props);return n},s.cloneAndReplaceProps=function(e,n){var r=s(e.type,e.key,e.ref,e._self,e._source,e._owner,n);return"production"!==t.env.NODE_ENV&&(r._store.validated=e._store.validated),r},s.cloneElement=function(e,t,n){var a,i=o({},e.props),d=e.key,c=e.ref,u=e._self,m=e._source,p=e._owner;if(null!=t){void 0!==t.ref&&(c=t.ref,p=r.current),void 0!==t.key&&(d=""+t.key);for(a in t)t.hasOwnProperty(a)&&!l.hasOwnProperty(a)&&(i[a]=t[a])}var f=arguments.length-2;if(1===f)i.children=n;else if(f>1){for(var g=Array(f),h=0;f>h;h++)g[h]=arguments[h+2];i.children=g}return s(e.type,d,c,u,m,p,i)},s.isValidElement=function(e){return"object"==typeof e&&null!==e&&e.$$typeof===i},e.exports=s}).call(t,n(1))},function(e,t){"use strict";var n=function(e){var t;for(t in e)if(e.hasOwnProperty(t))return t;return null};e.exports=n},function(e,t,n){(function(t){"use strict";function r(e,t){return(e&t)===t}var o=n(2),a={MUST_USE_ATTRIBUTE:1,MUST_USE_PROPERTY:2,HAS_SIDE_EFFECTS:4,HAS_BOOLEAN_VALUE:8,HAS_NUMERIC_VALUE:16,HAS_POSITIVE_NUMERIC_VALUE:48,HAS_OVERLOADED_BOOLEAN_VALUE:64,injectDOMPropertyConfig:function(e){var n=a,i=e.Properties||{},s=e.DOMAttributeNamespaces||{},d=e.DOMAttributeNames||{},c=e.DOMPropertyNames||{},u=e.DOMMutationMethods||{};e.isCustomAttribute&&l._isCustomAttributeFunctions.push(e.isCustomAttribute);for(var m in i){l.properties.hasOwnProperty(m)?"production"!==t.env.NODE_ENV?o(!1,"injectDOMPropertyConfig(...): You're trying to inject DOM property '%s' which has already been injected. You may be accidentally injecting the same DOM property config twice, or you may be injecting two configs that have conflicting property names.",m):o(!1):void 0;var p=m.toLowerCase(),f=i[m],g={attributeName:p,attributeNamespace:null,propertyName:m,mutationMethod:null,mustUseAttribute:r(f,n.MUST_USE_ATTRIBUTE),mustUseProperty:r(f,n.MUST_USE_PROPERTY),hasSideEffects:r(f,n.HAS_SIDE_EFFECTS),hasBooleanValue:r(f,n.HAS_BOOLEAN_VALUE),hasNumericValue:r(f,n.HAS_NUMERIC_VALUE),hasPositiveNumericValue:r(f,n.HAS_POSITIVE_NUMERIC_VALUE),hasOverloadedBooleanValue:r(f,n.HAS_OVERLOADED_BOOLEAN_VALUE)};if(g.mustUseAttribute&&g.mustUseProperty?"production"!==t.env.NODE_ENV?o(!1,"DOMProperty: Cannot require using both attribute and property: %s",m):o(!1):void 0,!g.mustUseProperty&&g.hasSideEffects?"production"!==t.env.NODE_ENV?o(!1,"DOMProperty: Properties that have side effects must use property: %s",m):o(!1):void 0,g.hasBooleanValue+g.hasNumericValue+g.hasOverloadedBooleanValue<=1?void 0:"production"!==t.env.NODE_ENV?o(!1,"DOMProperty: Value can be one of boolean, overloaded boolean, or numeric value, but not a combination: %s",m):o(!1),"production"!==t.env.NODE_ENV&&(l.getPossibleStandardName[p]=m),d.hasOwnProperty(m)){var h=d[m];g.attributeName=h,"production"!==t.env.NODE_ENV&&(l.getPossibleStandardName[h]=m)}s.hasOwnProperty(m)&&(g.attributeNamespace=s[m]),c.hasOwnProperty(m)&&(g.propertyName=c[m]),u.hasOwnProperty(m)&&(g.mutationMethod=u[m]),l.properties[m]=g}}},i={},l={ID_ATTRIBUTE_NAME:"data-reactid",properties:{},getPossibleStandardName:"production"!==t.env.NODE_ENV?{}:null,_isCustomAttributeFunctions:[],isCustomAttribute:function(e){for(var t=0;t<l._isCustomAttributeFunctions.length;t++){var n=l._isCustomAttributeFunctions[t];if(n(e))return!0}return!1},getDefaultValueForProperty:function(e,t){var n,r=i[e];return r||(i[e]=r={}),t in r||(n=document.createElement(e),r[t]=n[t]),r[t]},injection:a};e.exports=l}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(2),o=function(e){var t=this;if(t.instancePool.length){var n=t.instancePool.pop();return t.call(n,e),n}return new t(e)},a=function(e,t){var n=this;if(n.instancePool.length){var r=n.instancePool.pop();return n.call(r,e,t),r}return new n(e,t)},i=function(e,t,n){var r=this;if(r.instancePool.length){var o=r.instancePool.pop();return r.call(o,e,t,n),o}return new r(e,t,n)},l=function(e,t,n,r){var o=this;if(o.instancePool.length){var a=o.instancePool.pop();return o.call(a,e,t,n,r),a}return new o(e,t,n,r)},s=function(e,t,n,r,o){var a=this;if(a.instancePool.length){var i=a.instancePool.pop();return a.call(i,e,t,n,r,o),i}return new a(e,t,n,r,o)},d=function(e){var n=this;e instanceof n?void 0:"production"!==t.env.NODE_ENV?r(!1,"Trying to release an instance into a pool of a different type."):r(!1),e.destructor(),n.instancePool.length<n.poolSize&&n.instancePool.push(e)},c=10,u=o,m=function(e,t){var n=e;return n.instancePool=[],n.getPooled=t||u,n.poolSize||(n.poolSize=c),n.release=d,n},p={addPoolingTo:m,oneArgumentPooler:o,twoArgumentPooler:a,threeArgumentPooler:i,fourArgumentPooler:l,fiveArgumentPooler:s};e.exports=p}).call(t,n(1))},function(e,t,n){"use strict";function r(){o.attachRefs(this,this._currentElement)}var o=n(130),a={mountComponent:function(e,t,n,o){var a=e.mountComponent(t,n,o);return e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e),a},unmountComponent:function(e){o.detachRefs(e,e._currentElement),e.unmountComponent()},receiveComponent:function(e,t,n,a){var i=e._currentElement;if(t!==i||a!==e._context){var l=o.shouldUpdateRefs(i,t);l&&o.detachRefs(e,i),e.receiveComponent(t,n,a),l&&e._currentElement&&null!=e._currentElement.ref&&n.getReactMountReady().enqueue(r,e)}},performUpdateIfNecessary:function(e,t){e.performUpdateIfNecessary(t)}};e.exports=a},function(e,t,n){(function(t){"use strict";function r(e,t,n,r){this.dispatchConfig=e,this.dispatchMarker=t,this.nativeEvent=n;var o=this.constructor.Interface;for(var a in o)if(o.hasOwnProperty(a)){var l=o[a];l?this[a]=l(n):"target"===a?this.target=r:this[a]=n[a]}var s=null!=n.defaultPrevented?n.defaultPrevented:n.returnValue===!1;s?this.isDefaultPrevented=i.thatReturnsTrue:this.isDefaultPrevented=i.thatReturnsFalse,this.isPropagationStopped=i.thatReturnsFalse}var o=n(15),a=n(4),i=n(10),l=n(3),s={type:null,target:null,currentTarget:i.thatReturnsNull,eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null};a(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?l(e,"This synthetic event is reused for performance reasons. If you're seeing this, you're calling `preventDefault` on a released/nullified synthetic event. This is a no-op. See https://fb.me/react-event-pooling for more information."):void 0),e&&(e.preventDefault?e.preventDefault():e.returnValue=!1,this.isDefaultPrevented=i.thatReturnsTrue)},stopPropagation:function(){var e=this.nativeEvent;"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?l(e,"This synthetic event is reused for performance reasons. If you're seeing this, you're calling `stopPropagation` on a released/nullified synthetic event. This is a no-op. See https://fb.me/react-event-pooling for more information."):void 0),e&&(e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,this.isPropagationStopped=i.thatReturnsTrue)},persist:function(){this.isPersistent=i.thatReturnsTrue},isPersistent:i.thatReturnsFalse,destructor:function(){var e=this.constructor.Interface;for(var t in e)this[t]=null;this.dispatchConfig=null,this.dispatchMarker=null,this.nativeEvent=null}}),r.Interface=s,r.augmentClass=function(e,t){var n=this,r=Object.create(n.prototype);a(r,e.prototype),e.prototype=r,e.prototype.constructor=e,e.Interface=a({},n.Interface,t),e.augmentClass=n.augmentClass,o.addPoolingTo(e,o.fourArgumentPooler)},o.addPoolingTo(r,o.fourArgumentPooler),e.exports=r}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(){var e=h&&h.traverseTwoPhase&&h.traverseEnterLeave;"production"!==t.env.NODE_ENV?c(e,"InstanceHandle not injected before use!"):void 0}var o=n(56),a=n(102),i=n(62),l=n(69),s=n(70),d=n(2),c=n(3),u={},m=null,p=function(e,t){e&&(a.executeDispatchesInOrder(e,t),e.isPersistent()||e.constructor.release(e))},f=function(e){return p(e,!0)},g=function(e){return p(e,!1)},h=null,v={injection:{injectMount:a.injection.injectMount,injectInstanceHandle:function(e){h=e,"production"!==t.env.NODE_ENV&&r()},getInstanceHandle:function(){return"production"!==t.env.NODE_ENV&&r(),h},injectEventPluginOrder:o.injectEventPluginOrder,injectEventPluginsByName:o.injectEventPluginsByName},eventNameDispatchConfigs:o.eventNameDispatchConfigs,registrationNameModules:o.registrationNameModules,putListener:function(e,n,r){"function"!=typeof r?"production"!==t.env.NODE_ENV?d(!1,"Expected %s listener to be a function, instead got type %s",n,typeof r):d(!1):void 0;var a=u[n]||(u[n]={});a[e]=r;var i=o.registrationNameModules[n];i&&i.didPutListener&&i.didPutListener(e,n,r)},getListener:function(e,t){var n=u[t];return n&&n[e]},deleteListener:function(e,t){var n=o.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t);var r=u[t];r&&delete r[e]},deleteAllListeners:function(e){for(var t in u)if(u[t][e]){var n=o.registrationNameModules[t];n&&n.willDeleteListener&&n.willDeleteListener(e,t),delete u[t][e]}},extractEvents:function(e,t,n,r,a){for(var i,s=o.plugins,d=0;d<s.length;d++){var c=s[d];if(c){var u=c.extractEvents(e,t,n,r,a);u&&(i=l(i,u))}}return i},enqueueEvents:function(e){e&&(m=l(m,e))},processEventQueue:function(e){var n=m;m=null,e?s(n,f):s(n,g),m?"production"!==t.env.NODE_ENV?d(!1,"processEventQueue(): Additional events were enqueued while processing an event queue. Support for this has not yet been implemented."):d(!1):void 0,i.rethrowCaughtError()},__purge:function(){u={}},__getListenerBank:function(){return u}};e.exports=v}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e,t,n){var r=t.dispatchConfig.phasedRegistrationNames[n];return y(e,r)}function o(e,n,o){"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?g(e,"Dispatching id must not be null"):void 0);var a=n?b.bubbled:b.captured,i=r(e,o,a);i&&(o._dispatchListeners=h(o._dispatchListeners,i),o._dispatchIDs=h(o._dispatchIDs,e))}function a(e){e&&e.dispatchConfig.phasedRegistrationNames&&f.injection.getInstanceHandle().traverseTwoPhase(e.dispatchMarker,o,e)}function i(e){e&&e.dispatchConfig.phasedRegistrationNames&&f.injection.getInstanceHandle().traverseTwoPhaseSkipTarget(e.dispatchMarker,o,e)}function l(e,t,n){if(n&&n.dispatchConfig.registrationName){var r=n.dispatchConfig.registrationName,o=y(e,r);o&&(n._dispatchListeners=h(n._dispatchListeners,o),n._dispatchIDs=h(n._dispatchIDs,e))}}function s(e){e&&e.dispatchConfig.registrationName&&l(e.dispatchMarker,null,e)}function d(e){v(e,a)}function c(e){v(e,i)}function u(e,t,n,r){f.injection.getInstanceHandle().traverseEnterLeave(n,r,l,e,t)}function m(e){v(e,s)}var p=n(9),f=n(18),g=n(3),h=n(69),v=n(70),b=p.PropagationPhases,y=f.getListener,x={accumulateTwoPhaseDispatches:d,accumulateTwoPhaseDispatchesSkipTarget:c,accumulateDirectDispatches:m,accumulateEnterLeaveDispatches:u};e.exports=x}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e){return p+e.toString(36)}function o(e,t){return e.charAt(t)===p||t===e.length}function a(e){return""===e||e.charAt(0)===p&&e.charAt(e.length-1)!==p}function i(e,t){return 0===t.indexOf(e)&&o(t,e.length);
}function l(e){return e?e.substr(0,e.lastIndexOf(p)):""}function s(e,n){if(a(e)&&a(n)?void 0:"production"!==t.env.NODE_ENV?m(!1,"getNextDescendantID(%s, %s): Received an invalid React DOM ID.",e,n):m(!1),i(e,n)?void 0:"production"!==t.env.NODE_ENV?m(!1,"getNextDescendantID(...): React has made an invalid assumption about the DOM hierarchy. Expected `%s` to be an ancestor of `%s`.",e,n):m(!1),e===n)return e;var r,l=e.length+f;for(r=l;r<n.length&&!o(n,r);r++);return n.substr(0,r)}function d(e,n){var r=Math.min(e.length,n.length);if(0===r)return"";for(var i=0,l=0;r>=l;l++)if(o(e,l)&&o(n,l))i=l;else if(e.charAt(l)!==n.charAt(l))break;var s=e.substr(0,i);return a(s)?void 0:"production"!==t.env.NODE_ENV?m(!1,"getFirstCommonAncestorID(%s, %s): Expected a valid React DOM ID: %s",e,n,s):m(!1),s}function c(e,n,r,o,a,d){e=e||"",n=n||"",e===n?"production"!==t.env.NODE_ENV?m(!1,"traverseParentPath(...): Cannot traverse from and to the same ID, `%s`.",e):m(!1):void 0;var c=i(n,e);c||i(e,n)?void 0:"production"!==t.env.NODE_ENV?m(!1,"traverseParentPath(%s, %s, ...): Cannot traverse from two IDs that do not have a parent path.",e,n):m(!1);for(var u=0,p=c?l:s,f=e;;f=p(f,n)){var h;if(a&&f===e||d&&f===n||(h=r(f,c,o)),h===!1||f===n)break;u++<g?void 0:"production"!==t.env.NODE_ENV?m(!1,"traverseParentPath(%s, %s, ...): Detected an infinite loop while traversing the React DOM ID tree. This may be due to malformed IDs: %s",e,n,f):m(!1)}}var u=n(67),m=n(2),p=".",f=p.length,g=1e4,h={createReactRootID:function(){return r(u.createReactRootIndex())},createReactID:function(e,t){return e+t},getReactRootIDFromNodeID:function(e){if(e&&e.charAt(0)===p&&e.length>1){var t=e.indexOf(p,1);return t>-1?e.substr(0,t):e}return null},traverseEnterLeave:function(e,t,n,r,o){var a=d(e,t);a!==e&&c(e,a,n,r,!1,!0),a!==t&&c(a,t,n,o,!0,!1)},traverseTwoPhase:function(e,t,n){e&&(c("",e,t,n,!0,!1),c(e,"",t,n,!1,!0))},traverseTwoPhaseSkipTarget:function(e,t,n){e&&(c("",e,t,n,!0,!0),c(e,"",t,n,!0,!0))},traverseAncestors:function(e,t,n){c("",e,t,n,!0,!1)},getFirstCommonAncestorID:d,_getNextDescendantID:s,isAncestorIDOf:i,SEPARATOR:p};e.exports=h}).call(t,n(1))},function(e,t){"use strict";var n={remove:function(e){e._reactInternalInstance=void 0},get:function(e){return e._reactInternalInstance},has:function(e){return void 0!==e._reactInternalInstance},set:function(e,t){e._reactInternalInstance=t}};e.exports=n},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(17),a=n(44),i={view:function(e){if(e.view)return e.view;var t=a(e);if(null!=t&&t.window===t)return t;var n=t.ownerDocument;return n?n.defaultView||n.parentWindow:window},detail:function(e){return e.detail||0}};o.augmentClass(r,i),e.exports=r},function(e,t,n){"use strict";function r(e){return Object.prototype.hasOwnProperty.call(e,h)||(e[h]=f++,m[e[h]]={}),m[e[h]]}var o=n(9),a=n(18),i=n(56),l=n(122),s=n(7),d=n(68),c=n(4),u=n(45),m={},p=!1,f=0,g={topAbort:"abort",topBlur:"blur",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topChange:"change",topClick:"click",topCompositionEnd:"compositionend",topCompositionStart:"compositionstart",topCompositionUpdate:"compositionupdate",topContextMenu:"contextmenu",topCopy:"copy",topCut:"cut",topDoubleClick:"dblclick",topDrag:"drag",topDragEnd:"dragend",topDragEnter:"dragenter",topDragExit:"dragexit",topDragLeave:"dragleave",topDragOver:"dragover",topDragStart:"dragstart",topDrop:"drop",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topFocus:"focus",topInput:"input",topKeyDown:"keydown",topKeyPress:"keypress",topKeyUp:"keyup",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topMouseDown:"mousedown",topMouseMove:"mousemove",topMouseOut:"mouseout",topMouseOver:"mouseover",topMouseUp:"mouseup",topPaste:"paste",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topScroll:"scroll",topSeeked:"seeked",topSeeking:"seeking",topSelectionChange:"selectionchange",topStalled:"stalled",topSuspend:"suspend",topTextInput:"textInput",topTimeUpdate:"timeupdate",topTouchCancel:"touchcancel",topTouchEnd:"touchend",topTouchMove:"touchmove",topTouchStart:"touchstart",topVolumeChange:"volumechange",topWaiting:"waiting",topWheel:"wheel"},h="_reactListenersID"+String(Math.random()).slice(2),v=c({},l,{ReactEventListener:null,injection:{injectReactEventListener:function(e){e.setHandleTopLevel(v.handleTopLevel),v.ReactEventListener=e}},setEnabled:function(e){v.ReactEventListener&&v.ReactEventListener.setEnabled(e)},isEnabled:function(){return!(!v.ReactEventListener||!v.ReactEventListener.isEnabled())},listenTo:function(e,t){for(var n=t,a=r(n),l=i.registrationNameDependencies[e],s=o.topLevelTypes,d=0;d<l.length;d++){var c=l[d];a.hasOwnProperty(c)&&a[c]||(c===s.topWheel?u("wheel")?v.ReactEventListener.trapBubbledEvent(s.topWheel,"wheel",n):u("mousewheel")?v.ReactEventListener.trapBubbledEvent(s.topWheel,"mousewheel",n):v.ReactEventListener.trapBubbledEvent(s.topWheel,"DOMMouseScroll",n):c===s.topScroll?u("scroll",!0)?v.ReactEventListener.trapCapturedEvent(s.topScroll,"scroll",n):v.ReactEventListener.trapBubbledEvent(s.topScroll,"scroll",v.ReactEventListener.WINDOW_HANDLE):c===s.topFocus||c===s.topBlur?(u("focus",!0)?(v.ReactEventListener.trapCapturedEvent(s.topFocus,"focus",n),v.ReactEventListener.trapCapturedEvent(s.topBlur,"blur",n)):u("focusin")&&(v.ReactEventListener.trapBubbledEvent(s.topFocus,"focusin",n),v.ReactEventListener.trapBubbledEvent(s.topBlur,"focusout",n)),a[s.topBlur]=!0,a[s.topFocus]=!0):g.hasOwnProperty(c)&&v.ReactEventListener.trapBubbledEvent(c,g[c],n),a[c]=!0)}},trapBubbledEvent:function(e,t,n){return v.ReactEventListener.trapBubbledEvent(e,t,n)},trapCapturedEvent:function(e,t,n){return v.ReactEventListener.trapCapturedEvent(e,t,n)},ensureScrollValueMonitoring:function(){if(!p){var e=d.refreshScrollValues;v.ReactEventListener.monitorScrollValue(e),p=!0}},eventNameDispatchConfigs:a.eventNameDispatchConfigs,registrationNameModules:a.registrationNameModules,putListener:a.putListener,getListener:a.getListener,deleteListener:a.deleteListener,deleteAllListeners:a.deleteAllListeners});s.measureMethods(v,"ReactBrowserEventEmitter",{putListener:"putListener",deleteListener:"deleteListener"}),e.exports=v},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(22),a=n(68),i=n(43),l={screenX:null,screenY:null,clientX:null,clientY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:i,button:function(e){var t=e.button;return"which"in e?t:2===t?2:4===t?1:0},buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},pageX:function(e){return"pageX"in e?e.pageX:e.clientX+a.currentScrollLeft},pageY:function(e){return"pageY"in e?e.pageY:e.clientY+a.currentScrollTop}};o.augmentClass(r,l),e.exports=r},function(e,t){"use strict";function n(e){return o[e]}function r(e){return(""+e).replace(a,n)}var o={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},a=/[&><"']/g;e.exports=r},function(e,t,n){"use strict";var r=n(5),o=/^[ \r\n\t\f]/,a=/<(!--|link|noscript|meta|script|style)[ \r\n\t\f\/>]/,i=function(e,t){e.innerHTML=t};if("undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction&&(i=function(e,t){MSApp.execUnsafeLocalFunction(function(){e.innerHTML=t})}),r.canUseDOM){var l=document.createElement("div");l.innerHTML=" ",""===l.innerHTML&&(i=function(e,t){if(e.parentNode&&e.parentNode.replaceChild(e,e),o.test(t)||"<"===t[0]&&a.test(t)){e.innerHTML=String.fromCharCode(65279)+t;var n=e.firstChild;1===n.data.length?e.removeChild(n):n.deleteData(0,1)}else e.innerHTML=t})}e.exports=i},function(e,t,n){(function(t){"use strict";var n={};"production"!==t.env.NODE_ENV&&Object.freeze(n),e.exports=n}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(2),o=function(e){var n,o={};e instanceof Object&&!Array.isArray(e)?void 0:"production"!==t.env.NODE_ENV?r(!1,"keyMirror(...): Argument must be an object."):r(!1);for(n in e)e.hasOwnProperty(n)&&(o[n]=n);return o};e.exports=o}).call(t,n(1))},function(e,t){e.exports=function(e){"function"==typeof execScript?execScript(e):eval.call(null,e)}},function(e,t){e.exports=function(){var e=[];return e.toString=function(){for(var e=[],t=0;t<this.length;t++){var n=this[t];n[2]?e.push("@media "+n[2]+"{"+n[1]+"}"):e.push(n[1])}return e.join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var r={},o=0;o<this.length;o++){var a=this[o][0];"number"==typeof a&&(r[a]=!0)}for(o=0;o<t.length;o++){var i=t[o];"number"==typeof i[0]&&r[i[0]]||(n&&!i[2]?i[2]=n:n&&(i[2]="("+i[2]+") and ("+n+")"),e.push(i))}},e}},function(e,t,n){(function(t){"use strict";function r(e){return u.hasOwnProperty(e)?!0:c.hasOwnProperty(e)?!1:d.test(e)?(u[e]=!0,!0):(c[e]=!0,"production"!==t.env.NODE_ENV?s(!1,"Invalid attribute name: `%s`",e):void 0,!1)}function o(e,t){return null==t||e.hasBooleanValue&&!t||e.hasNumericValue&&isNaN(t)||e.hasPositiveNumericValue&&1>t||e.hasOverloadedBooleanValue&&t===!1}var a=n(14),i=n(7),l=n(149),s=n(3),d=/^[a-zA-Z_][\w\.\-]*$/,c={},u={};if("production"!==t.env.NODE_ENV)var m={children:!0,dangerouslySetInnerHTML:!0,key:!0,ref:!0},p={},f=function(e){if(!(m.hasOwnProperty(e)&&m[e]||p.hasOwnProperty(e)&&p[e])){p[e]=!0;var n=e.toLowerCase(),r=a.isCustomAttribute(n)?n:a.getPossibleStandardName.hasOwnProperty(n)?a.getPossibleStandardName[n]:null;"production"!==t.env.NODE_ENV?s(null==r,"Unknown DOM property %s. Did you mean %s?",e,r):void 0}};var g={createMarkupForID:function(e){return a.ID_ATTRIBUTE_NAME+"="+l(e)},setAttributeForID:function(e,t){e.setAttribute(a.ID_ATTRIBUTE_NAME,t)},createMarkupForProperty:function(e,n){var r=a.properties.hasOwnProperty(e)?a.properties[e]:null;if(r){if(o(r,n))return"";var i=r.attributeName;return r.hasBooleanValue||r.hasOverloadedBooleanValue&&n===!0?i+'=""':i+"="+l(n)}return a.isCustomAttribute(e)?null==n?"":e+"="+l(n):("production"!==t.env.NODE_ENV&&f(e),null)},createMarkupForCustomAttribute:function(e,t){return r(e)&&null!=t?e+"="+l(t):""},setValueForProperty:function(e,n,r){var i=a.properties.hasOwnProperty(n)?a.properties[n]:null;if(i){var l=i.mutationMethod;if(l)l(e,r);else if(o(i,r))this.deleteValueForProperty(e,n);else if(i.mustUseAttribute){var s=i.attributeName,d=i.attributeNamespace;d?e.setAttributeNS(d,s,""+r):i.hasBooleanValue||i.hasOverloadedBooleanValue&&r===!0?e.setAttribute(s,""):e.setAttribute(s,""+r)}else{var c=i.propertyName;i.hasSideEffects&&""+e[c]==""+r||(e[c]=r)}}else a.isCustomAttribute(n)?g.setValueForAttribute(e,n,r):"production"!==t.env.NODE_ENV&&f(n)},setValueForAttribute:function(e,t,n){r(t)&&(null==n?e.removeAttribute(t):e.setAttribute(t,""+n))},deleteValueForProperty:function(e,n){var r=a.properties.hasOwnProperty(n)?a.properties[n]:null;if(r){var o=r.mutationMethod;if(o)o(e,void 0);else if(r.mustUseAttribute)e.removeAttribute(r.attributeName);else{var i=r.propertyName,l=a.getDefaultValueForProperty(e.nodeName,i);r.hasSideEffects&&""+e[i]===l||(e[i]=l)}}else a.isCustomAttribute(n)?e.removeAttribute(n):"production"!==t.env.NODE_ENV&&f(n)}};i.measureMethods(g,"DOMPropertyOperations",{setValueForProperty:"setValueForProperty",setValueForAttribute:"setValueForAttribute",deleteValueForProperty:"deleteValueForProperty"}),e.exports=g}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e){null!=e.checkedLink&&null!=e.valueLink?"production"!==t.env.NODE_ENV?d(!1,"Cannot provide a checkedLink and a valueLink. If you want to use checkedLink, you probably don't want to use valueLink and vice versa."):d(!1):void 0}function o(e){r(e),null!=e.value||null!=e.onChange?"production"!==t.env.NODE_ENV?d(!1,"Cannot provide a valueLink and a value or onChange event. If you want to use value or onChange, you probably don't want to use valueLink."):d(!1):void 0}function a(e){r(e),null!=e.checked||null!=e.onChange?"production"!==t.env.NODE_ENV?d(!1,"Cannot provide a checkedLink and a checked property or onChange event. If you want to use checked or onChange, you probably don't want to use checkedLink"):d(!1):void 0}function i(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}var l=n(128),s=n(37),d=n(2),c=n(3),u={button:!0,checkbox:!0,image:!0,hidden:!0,radio:!0,reset:!0,submit:!0},m={value:function(e,t,n){return!e[t]||u[e.type]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `value` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultValue`. Otherwise, set either `onChange` or `readOnly`.")},checked:function(e,t,n){return!e[t]||e.onChange||e.readOnly||e.disabled?null:new Error("You provided a `checked` prop to a form field without an `onChange` handler. This will render a read-only field. If the field should be mutable use `defaultChecked`. Otherwise, set either `onChange` or `readOnly`.")},onChange:l.func},p={},f={checkPropTypes:function(e,n,r){for(var o in m){if(m.hasOwnProperty(o))var a=m[o](n,o,e,s.prop);if(a instanceof Error&&!(a.message in p)){p[a.message]=!0;var l=i(r);"production"!==t.env.NODE_ENV?c(!1,"Failed form propType: %s%s",a.message,l):void 0}}},getValue:function(e){return e.valueLink?(o(e),e.valueLink.value):e.value},getChecked:function(e){return e.checkedLink?(a(e),e.checkedLink.value):e.checked},executeOnChange:function(e,t){return e.valueLink?(o(e),e.valueLink.requestChange(t.target.value)):e.checkedLink?(a(e),e.checkedLink.requestChange(t.target.checked)):e.onChange?e.onChange.call(void 0,t):void 0}};e.exports=f}).call(t,n(1))},function(e,t,n){"use strict";var r=n(35),o=n(6),a={processChildrenUpdates:r.dangerouslyProcessChildrenUpdates,replaceNodeWithMarkupByID:r.dangerouslyReplaceNodeWithMarkupByID,unmountIDFromEnvironment:function(e){o.purgeID(e)}};e.exports=a},function(e,t,n){(function(t){"use strict";var r=n(2),o=!1,a={unmountIDFromEnvironment:null,replaceNodeWithMarkupByID:null,processChildrenUpdates:null,injection:{injectEnvironment:function(e){o?"production"!==t.env.NODE_ENV?r(!1,"ReactCompositeComponent: injectEnvironment() can only be called once."):r(!1):void 0,a.unmountIDFromEnvironment=e.unmountIDFromEnvironment,a.replaceNodeWithMarkupByID=e.replaceNodeWithMarkupByID,a.processChildrenUpdates=e.processChildrenUpdates,o=!0}}};e.exports=a}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(55),o=n(31),a=n(6),i=n(7),l=n(2),s={dangerouslySetInnerHTML:"`dangerouslySetInnerHTML` must be set using `updateInnerHTMLByID()`.",style:"`style` must be set using `updateStylesByID()`."},d={updatePropertyByID:function(e,n,r){var i=a.getNode(e);s.hasOwnProperty(n)?"production"!==t.env.NODE_ENV?l(!1,"updatePropertyByID(...): %s",s[n]):l(!1):void 0,null!=r?o.setValueForProperty(i,n,r):o.deleteValueForProperty(i,n)},dangerouslyReplaceNodeWithMarkupByID:function(e,t){var n=a.getNode(e);r.dangerouslyReplaceNodeWithMarkup(n,t)},dangerouslyProcessChildrenUpdates:function(e,t){for(var n=0;n<e.length;n++)e[n].parentNode=a.getNode(e[n].parentID);r.processUpdates(e,t)}};i.measureMethods(d,"ReactDOMIDOperations",{dangerouslyReplaceNodeWithMarkupByID:"dangerouslyReplaceNodeWithMarkupByID",dangerouslyProcessChildrenUpdates:"dangerouslyProcessChildrenUpdates"}),e.exports=d}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var n={};"production"!==t.env.NODE_ENV&&(n={prop:"prop",context:"context",childContext:"child context"}),e.exports=n}).call(t,n(1))},function(e,t,n){"use strict";var r=n(28),o=r({prop:null,context:null,childContext:null});e.exports=o},function(e,t,n){(function(t){"use strict";function r(e){s.enqueueUpdate(e)}function o(e,n){var r=l.get(e);return r?("production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?u(null==a.current,"%s(...): Cannot update during an existing state transition (such as within `render`). Render methods should be a pure function of props and state.",n):void 0),r):("production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?u(!n,"%s(...): Can only update a mounted or mounting component. This usually means you called %s() on an unmounted component. This is a no-op. Please check the code for the %s component.",n,n,e.constructor.displayName):void 0),null)}var a=n(11),i=n(12),l=n(21),s=n(8),d=n(4),c=n(2),u=n(3),m={isMounted:function(e){if("production"!==t.env.NODE_ENV){var n=a.current;null!==n&&("production"!==t.env.NODE_ENV?u(n._warnedAboutRefsInRender,"%s is accessing isMounted inside its render() function. render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",n.getName()||"A component"):void 0,n._warnedAboutRefsInRender=!0)}var r=l.get(e);return r?!!r._renderedComponent:!1},enqueueCallback:function(e,n){"function"!=typeof n?"production"!==t.env.NODE_ENV?c(!1,"enqueueCallback(...): You called `setProps`, `replaceProps`, `setState`, `replaceState`, or `forceUpdate` with a callback that isn't callable."):c(!1):void 0;var a=o(e);return a?(a._pendingCallbacks?a._pendingCallbacks.push(n):a._pendingCallbacks=[n],void r(a)):null},enqueueCallbackInternal:function(e,n){"function"!=typeof n?"production"!==t.env.NODE_ENV?c(!1,"enqueueCallback(...): You called `setProps`, `replaceProps`, `setState`, `replaceState`, or `forceUpdate` with a callback that isn't callable."):c(!1):void 0,e._pendingCallbacks?e._pendingCallbacks.push(n):e._pendingCallbacks=[n],r(e)},enqueueForceUpdate:function(e){var t=o(e,"forceUpdate");t&&(t._pendingForceUpdate=!0,r(t))},enqueueReplaceState:function(e,t){var n=o(e,"replaceState");n&&(n._pendingStateQueue=[t],n._pendingReplaceState=!0,r(n))},enqueueSetState:function(e,t){var n=o(e,"setState");if(n){var a=n._pendingStateQueue||(n._pendingStateQueue=[]);a.push(t),r(n)}},enqueueSetProps:function(e,t){var n=o(e,"setProps");n&&m.enqueueSetPropsInternal(n,t)},enqueueSetPropsInternal:function(e,n){var o=e._topLevelWrapper;o?void 0:"production"!==t.env.NODE_ENV?c(!1,"setProps(...): You called `setProps` on a component with a parent. This is an anti-pattern since props will get reactively updated when rendered. Instead, change the owner's `render` method to pass the correct value as props to the component where it is created."):c(!1);var a=o._pendingElement||o._currentElement,l=a.props,s=d({},l.props,n);o._pendingElement=i.cloneAndReplaceProps(a,i.cloneAndReplaceProps(l,s)),r(o)},enqueueReplaceProps:function(e,t){var n=o(e,"replaceProps");n&&m.enqueueReplacePropsInternal(n,t)},enqueueReplacePropsInternal:function(e,n){var o=e._topLevelWrapper;o?void 0:"production"!==t.env.NODE_ENV?c(!1,"replaceProps(...): You called `replaceProps` on a component with a parent. This is an anti-pattern since props will get reactively updated when rendered. Instead, change the owner's `render` method to pass the correct value as props to the component where it is created."):c(!1);var a=o._pendingElement||o._currentElement,l=a.props;o._pendingElement=i.cloneAndReplaceProps(a,i.cloneAndReplaceProps(l,n)),r(o)},enqueueElementInternal:function(e,t){e._pendingElement=t,r(e)}};e.exports=m}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(2),o={reinitializeTransaction:function(){this.transactionWrappers=this.getTransactionWrappers(),this.wrapperInitData?this.wrapperInitData.length=0:this.wrapperInitData=[],this._isInTransaction=!1},_isInTransaction:!1,getTransactionWrappers:null,isInTransaction:function(){return!!this._isInTransaction},perform:function(e,n,o,a,i,l,s,d){this.isInTransaction()?"production"!==t.env.NODE_ENV?r(!1,"Transaction.perform(...): Cannot initialize a transaction when there is already an outstanding transaction."):r(!1):void 0;var c,u;try{this._isInTransaction=!0,c=!0,this.initializeAll(0),u=e.call(n,o,a,i,l,s,d),c=!1}finally{try{if(c)try{this.closeAll(0)}catch(m){}else this.closeAll(0)}finally{this._isInTransaction=!1}}return u},initializeAll:function(e){for(var t=this.transactionWrappers,n=e;n<t.length;n++){var r=t[n];try{this.wrapperInitData[n]=a.OBSERVED_ERROR,this.wrapperInitData[n]=r.initialize?r.initialize.call(this):null}finally{if(this.wrapperInitData[n]===a.OBSERVED_ERROR)try{this.initializeAll(n+1)}catch(o){}}}},closeAll:function(e){this.isInTransaction()?void 0:"production"!==t.env.NODE_ENV?r(!1,"Transaction.closeAll(): Cannot close transaction when none are open."):r(!1);for(var n=this.transactionWrappers,o=e;o<n.length;o++){var i,l=n[o],s=this.wrapperInitData[o];try{i=!0,s!==a.OBSERVED_ERROR&&l.close&&l.close.call(this,s),i=!1}finally{if(i)try{this.closeAll(o+1)}catch(d){}}}this.wrapperInitData.length=0}},a={Mixin:o,OBSERVED_ERROR:{}};e.exports=a}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var n=!1;if("production"!==t.env.NODE_ENV)try{Object.defineProperty({},"x",{get:function(){}}),n=!0}catch(r){}e.exports=n}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e){if("production"!==t.env.NODE_ENV){var n=o.current;null!==n&&("production"!==t.env.NODE_ENV?s(n._warnedAboutRefsInRender,"%s is accessing getDOMNode or findDOMNode inside its render(). render() should be a pure function of props and state. It should never access something that requires stale data from the previous render, such as refs. Move this logic to componentDidMount and componentDidUpdate instead.",n.getName()||"A component"):void 0,n._warnedAboutRefsInRender=!0)}return null==e?null:1===e.nodeType?e:a.has(e)?i.getNodeFromInstance(e):(null!=e.render&&"function"==typeof e.render?"production"!==t.env.NODE_ENV?l(!1,"findDOMNode was called on an unmounted component."):l(!1):void 0,void("production"!==t.env.NODE_ENV?l(!1,"Element appears to be neither ReactComponent nor DOMNode (keys: %s)",Object.keys(e)):l(!1)))}var o=n(11),a=n(21),i=n(6),l=n(2),s=n(3);e.exports=r}).call(t,n(1))},function(e,t){"use strict";function n(e){var t,n=e.keyCode;return"charCode"in e?(t=e.charCode,0===t&&13===n&&(t=13)):t=n,t>=32||13===t?t:0}e.exports=n},function(e,t){"use strict";function n(e){var t=this,n=t.nativeEvent;if(n.getModifierState)return n.getModifierState(e);var r=o[e];return r?!!n[r]:!1}function r(e){return n}var o={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};e.exports=r},function(e,t){"use strict";function n(e){var t=e.target||e.srcElement||window;return 3===t.nodeType?t.parentNode:t}e.exports=n},function(e,t,n){"use strict";/**
	 * Checks if an event is supported in the current execution environment.
	 *
	 * NOTE: This will not work correctly for non-generic events such as `change`,
	 * `reset`, `load`, `error`, and `select`.
	 *
	 * Borrows from Modernizr.
	 *
	 * @param {string} eventNameSuffix Event name, e.g. "click".
	 * @param {?boolean} capture Check if the capture phase is supported.
	 * @return {boolean} True if the event is supported.
	 * @internal
	 * @license Modernizr 3.0.0pre (Custom Build) | MIT
	 */
function r(e,t){if(!a.canUseDOM||t&&!("addEventListener"in document))return!1;var n="on"+e,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&o&&"wheel"===e&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r}var o,a=n(5);a.canUseDOM&&(o=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature("","")!==!0),e.exports=r},function(e,t,n){"use strict";var r=n(5),o=n(25),a=n(26),i=function(e,t){e.textContent=t};r.canUseDOM&&("textContent"in document.documentElement||(i=function(e,t){a(e,o(t))})),e.exports=i},function(e,t){"use strict";function n(e,t){var n=null===e||e===!1,r=null===t||t===!1;if(n||r)return n===r;var o=typeof e,a=typeof t;return"string"===o||"number"===o?"string"===a||"number"===a:"object"===a&&e.type===t.type&&e.key===t.key}e.exports=n},function(e,t,n){(function(t){"use strict";function r(e){return v[e]}function o(e,t){return e&&null!=e.key?i(e.key):t.toString(36)}function a(e){return(""+e).replace(b,r)}function i(e){return"$"+a(e)}function l(e,n,r,a){var s=typeof e;if("undefined"!==s&&"boolean"!==s||(e=null),null===e||"string"===s||"number"===s||c.isValidElement(e))return r(a,e,""===n?g+o(e,0):n),1;var u,v,b=0,x=""===n?g:n+h;if(Array.isArray(e))for(var C=0;C<e.length;C++)u=e[C],v=x+o(u,C),b+=l(u,v,r,a);else{var N=m(e);if(N){var E,w=N.call(e);if(N!==e.entries)for(var S=0;!(E=w.next()).done;)u=E.value,v=x+o(u,S++),b+=l(u,v,r,a);else for("production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?f(y,"Using Maps as children is not yet fully supported. It is an experimental feature that might be removed. Convert it to a sequence / iterable of keyed ReactElements instead."):void 0,y=!0);!(E=w.next()).done;){var k=E.value;k&&(u=k[1],v=x+i(k[0])+h+o(u,0),b+=l(u,v,r,a))}}else if("object"===s){var T="";if("production"!==t.env.NODE_ENV&&(T=" If you meant to render a collection of children, use an array instead or wrap the object using createFragment(object) from the React add-ons.",e._isReactElement&&(T=" It looks like you're using an element created by a different version of React. Make sure to use only one copy of React."),d.current)){var U=d.current.getName();U&&(T+=" Check the render method of `"+U+"`.")}var I=String(e);"production"!==t.env.NODE_ENV?p(!1,"Objects are not valid as a React child (found: %s).%s","[object Object]"===I?"object with keys {"+Object.keys(e).join(", ")+"}":I,T):p(!1)}}return b}function s(e,t,n){return null==e?0:l(e,"",t,n)}var d=n(11),c=n(12),u=n(20),m=n(71),p=n(2),f=n(3),g=u.SEPARATOR,h=":",v={"=":"=0",".":"=1",":":"=2"},b=/[=.:]/g,y=!1;e.exports=s}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(4),o=n(10),a=n(3),i=o;if("production"!==t.env.NODE_ENV){var l=["address","applet","area","article","aside","base","basefont","bgsound","blockquote","body","br","button","caption","center","col","colgroup","dd","details","dir","div","dl","dt","embed","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","iframe","img","input","isindex","li","link","listing","main","marquee","menu","menuitem","meta","nav","noembed","noframes","noscript","object","ol","p","param","plaintext","pre","script","section","select","source","style","summary","table","tbody","td","template","textarea","tfoot","th","thead","title","tr","track","ul","wbr","xmp"],s=["applet","caption","html","table","td","th","marquee","object","template","foreignObject","desc","title"],d=s.concat(["button"]),c=["dd","dt","li","option","optgroup","p","rp","rt"],u={parentTag:null,formTag:null,aTagInScope:null,buttonTagInScope:null,nobrTagInScope:null,pTagInButtonScope:null,listItemTagAutoclosing:null,dlItemTagAutoclosing:null},m=function(e,t,n){var o=r({},e||u),a={tag:t,instance:n};return-1!==s.indexOf(t)&&(o.aTagInScope=null,o.buttonTagInScope=null,o.nobrTagInScope=null),-1!==d.indexOf(t)&&(o.pTagInButtonScope=null),-1!==l.indexOf(t)&&"address"!==t&&"div"!==t&&"p"!==t&&(o.listItemTagAutoclosing=null,o.dlItemTagAutoclosing=null),o.parentTag=a,"form"===t&&(o.formTag=a),"a"===t&&(o.aTagInScope=a),"button"===t&&(o.buttonTagInScope=a),"nobr"===t&&(o.nobrTagInScope=a),"p"===t&&(o.pTagInButtonScope=a),"li"===t&&(o.listItemTagAutoclosing=a),"dd"!==t&&"dt"!==t||(o.dlItemTagAutoclosing=a),o},p=function(e,t){switch(t){case"select":return"option"===e||"optgroup"===e||"#text"===e;case"optgroup":return"option"===e||"#text"===e;case"option":return"#text"===e;case"tr":return"th"===e||"td"===e||"style"===e||"script"===e||"template"===e;case"tbody":case"thead":case"tfoot":return"tr"===e||"style"===e||"script"===e||"template"===e;case"colgroup":return"col"===e||"template"===e;case"table":return"caption"===e||"colgroup"===e||"tbody"===e||"tfoot"===e||"thead"===e||"style"===e||"script"===e||"template"===e;case"head":return"base"===e||"basefont"===e||"bgsound"===e||"link"===e||"meta"===e||"title"===e||"noscript"===e||"noframes"===e||"style"===e||"script"===e||"template"===e;case"html":return"head"===e||"body"===e}switch(e){case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return"h1"!==t&&"h2"!==t&&"h3"!==t&&"h4"!==t&&"h5"!==t&&"h6"!==t;case"rp":case"rt":return-1===c.indexOf(t);case"caption":case"col":case"colgroup":case"frame":case"head":case"tbody":case"td":case"tfoot":case"th":case"thead":case"tr":return null==t}return!0},f=function(e,t){switch(e){case"address":case"article":case"aside":case"blockquote":case"center":case"details":case"dialog":case"dir":case"div":case"dl":case"fieldset":case"figcaption":case"figure":case"footer":case"header":case"hgroup":case"main":case"menu":case"nav":case"ol":case"p":case"section":case"summary":case"ul":case"pre":case"listing":case"table":case"hr":case"xmp":case"h1":case"h2":case"h3":case"h4":case"h5":case"h6":return t.pTagInButtonScope;case"form":return t.formTag||t.pTagInButtonScope;case"li":return t.listItemTagAutoclosing;case"dd":case"dt":return t.dlItemTagAutoclosing;case"button":return t.buttonTagInScope;case"a":return t.aTagInScope;case"nobr":return t.nobrTagInScope}return null},g=function(e){if(!e)return[];var t=[];do t.push(e);while(e=e._currentElement._owner);return t.reverse(),t},h={};i=function(e,n,r){r=r||u;var o=r.parentTag,i=o&&o.tag,l=p(e,i)?null:o,s=l?null:f(e,r),d=l||s;if(d){var c,m=d.tag,v=d.instance,b=n&&n._currentElement._owner,y=v&&v._currentElement._owner,x=g(b),C=g(y),N=Math.min(x.length,C.length),E=-1;for(c=0;N>c&&x[c]===C[c];c++)E=c;var w="(unknown)",S=x.slice(E+1).map(function(e){return e.getName()||w}),k=C.slice(E+1).map(function(e){return e.getName()||w}),T=[].concat(-1!==E?x[E].getName()||w:[],k,m,s?["..."]:[],S,e).join(" > "),U=!!l+"|"+e+"|"+m+"|"+T;if(h[U])return;if(h[U]=!0,l){var I="";"table"===m&&"tr"===e&&(I+=" Add a <tbody> to your code to match the DOM tree generated by the browser."),"production"!==t.env.NODE_ENV?a(!1,"validateDOMNesting(...): <%s> cannot appear as a child of <%s>. See %s.%s",e,m,T,I):void 0}else"production"!==t.env.NODE_ENV?a(!1,"validateDOMNesting(...): <%s> cannot appear as a descendant of <%s>. See %s.",e,m,T):void 0}},i.ancestorInfoContextKey="__validateDOMNesting_ancestorInfo$"+Math.random().toString(36).slice(2),i.updatedAncestorInfo=m,i.isTagValidInContext=function(e,t){t=t||u;var n=t.parentTag,r=n&&n.tag;return p(e,r)&&!f(e,t)}}e.exports=i}).call(t,n(1))},function(e,t,n){function r(e,t){for(var n=0;n<e.length;n++){var r=e[n],o=p[r.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](r.parts[a]);for(;a<r.parts.length;a++)o.parts.push(d(r.parts[a],t))}else{for(var i=[],a=0;a<r.parts.length;a++)i.push(d(r.parts[a],t));p[r.id]={id:r.id,refs:1,parts:i}}}}function o(e){for(var t=[],n={},r=0;r<e.length;r++){var o=e[r],a=o[0],i=o[1],l=o[2],s=o[3],d={css:i,media:l,sourceMap:s};n[a]?n[a].parts.push(d):t.push(n[a]={id:a,parts:[d]})}return t}function a(e,t){var n=h(),r=y[y.length-1];if("top"===e.insertAt)r?r.nextSibling?n.insertBefore(t,r.nextSibling):n.appendChild(t):n.insertBefore(t,n.firstChild),y.push(t);else{if("bottom"!==e.insertAt)throw new Error("Invalid value for parameter 'insertAt'. Must be 'top' or 'bottom'.");n.appendChild(t)}}function i(e){e.parentNode.removeChild(e);var t=y.indexOf(e);t>=0&&y.splice(t,1)}function l(e){var t=document.createElement("style");return t.type="text/css",a(e,t),t}function s(e){var t=document.createElement("link");return t.rel="stylesheet",a(e,t),t}function d(e,t){var n,r,o;if(t.singleton){var a=b++;n=v||(v=l(t)),r=c.bind(null,n,a,!1),o=c.bind(null,n,a,!0)}else e.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=s(t),r=m.bind(null,n),o=function(){i(n),n.href&&URL.revokeObjectURL(n.href)}):(n=l(t),r=u.bind(null,n),o=function(){i(n)});return r(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap)return;r(e=t)}else o()}}function c(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=x(t,o);else{var a=document.createTextNode(o),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(a,i[t]):e.appendChild(a)}}function u(e,t){var n=t.css,r=t.media;t.sourceMap;if(r&&e.setAttribute("media",r),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}function m(e,t){var n=t.css,r=(t.media,t.sourceMap);r&&(n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var o=new Blob([n],{type:"text/css"}),a=e.href;e.href=URL.createObjectURL(o),a&&URL.revokeObjectURL(a)}var p={},f=function(e){var t;return function(){return"undefined"==typeof t&&(t=e.apply(this,arguments)),t}},g=f(function(){return/msie [6-9]\b/.test(window.navigator.userAgent.toLowerCase())}),h=f(function(){return document.head||document.getElementsByTagName("head")[0]}),v=null,b=0,y=[];e.exports=function(e,t){t=t||{},"undefined"==typeof t.singleton&&(t.singleton=g()),"undefined"==typeof t.insertAt&&(t.insertAt="bottom");var n=o(e);return r(n,t),function(e){for(var a=[],i=0;i<n.length;i++){var l=n[i],s=p[l.id];s.refs--,a.push(s)}if(e){var d=o(e);r(d,t)}for(var i=0;i<a.length;i++){var s=a[i];if(0===s.refs){for(var c=0;c<s.parts.length;c++)s.parts[c]();delete p[s.id]}}}};var x=function(){var e=[];return function(t,n){return e[t]=n,e.filter(Boolean).join("\n")}}()},function(e,t){e.exports=React},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(84),l=r(i),s=n(85),d=r(s),c=function(){function e(){o(this,e)}return a(e,null,[{key:"showPanel",value:function(e){d["default"].dispatch({actionType:l["default"].SHOW_PANEL})}}]),e}();t["default"]=c,e.exports=t["default"]},function(e,t){"use strict";function n(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}var r={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0},o=["Webkit","ms","Moz","O"];Object.keys(r).forEach(function(e){o.forEach(function(t){r[n(t,e)]=r[e]})});var a={background:{backgroundAttachment:!0,backgroundColor:!0,backgroundImage:!0,backgroundPositionX:!0,backgroundPositionY:!0,backgroundRepeat:!0},backgroundPosition:{backgroundPositionX:!0,backgroundPositionY:!0},border:{borderWidth:!0,borderStyle:!0,borderColor:!0},borderBottom:{borderBottomWidth:!0,borderBottomStyle:!0,borderBottomColor:!0},borderLeft:{borderLeftWidth:!0,borderLeftStyle:!0,borderLeftColor:!0},borderRight:{borderRightWidth:!0,borderRightStyle:!0,borderRightColor:!0},borderTop:{borderTopWidth:!0,borderTopStyle:!0,borderTopColor:!0},font:{fontStyle:!0,fontVariant:!0,fontWeight:!0,fontSize:!0,lineHeight:!0,fontFamily:!0},outline:{outlineWidth:!0,outlineStyle:!0,outlineColor:!0}},i={isUnitlessNumber:r,shorthandPropertyExpansions:a};e.exports=i},function(e,t,n){(function(t){"use strict";function r(){this._callbacks=null,this._contexts=null}var o=n(15),a=n(4),i=n(2);a(r.prototype,{enqueue:function(e,t){this._callbacks=this._callbacks||[],this._contexts=this._contexts||[],this._callbacks.push(e),this._contexts.push(t)},notifyAll:function(){var e=this._callbacks,n=this._contexts;if(e){e.length!==n.length?"production"!==t.env.NODE_ENV?i(!1,"Mismatched list of contexts in callback queue"):i(!1):void 0,this._callbacks=null,this._contexts=null;for(var r=0;r<e.length;r++)e[r].call(n[r]);e.length=0,n.length=0}},reset:function(){this._callbacks=null,this._contexts=null},destructor:function(){this.reset()}}),o.addPoolingTo(r),e.exports=r}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e,t,n){var r=n>=e.childNodes.length?null:e.childNodes.item(n);e.insertBefore(t,r)}var o=n(99),a=n(64),i=n(7),l=n(26),s=n(46),d=n(2),c={dangerouslyReplaceNodeWithMarkup:o.dangerouslyReplaceNodeWithMarkup,updateTextContent:s,processUpdates:function(e,n){for(var i,c=null,u=null,m=0;m<e.length;m++)if(i=e[m],i.type===a.MOVE_EXISTING||i.type===a.REMOVE_NODE){var p=i.fromIndex,f=i.parentNode.childNodes[p],g=i.parentID;f?void 0:"production"!==t.env.NODE_ENV?d(!1,"processUpdates(): Unable to find child %s of element. This probably means the DOM was unexpectedly mutated (e.g., by the browser), usually due to forgetting a <tbody> when using tables, nesting tags like <form>, <p>, or <a>, or using non-SVG elements in an <svg> parent. Try inspecting the child nodes of the element with React ID `%s`.",p,g):d(!1),c=c||{},c[g]=c[g]||[],c[g][p]=f,u=u||[],u.push(f)}var h;if(h=n.length&&"string"==typeof n[0]?o.dangerouslyRenderMarkup(n):n,u)for(var v=0;v<u.length;v++)u[v].parentNode.removeChild(u[v]);for(var b=0;b<e.length;b++)switch(i=e[b],i.type){case a.INSERT_MARKUP:r(i.parentNode,h[i.markupIndex],i.toIndex);break;case a.MOVE_EXISTING:r(i.parentNode,c[i.parentID][i.fromIndex],i.toIndex);break;case a.SET_MARKUP:l(i.parentNode,i.content);break;case a.TEXT_CONTENT:s(i.parentNode,i.content);break;case a.REMOVE_NODE:}}};i.measureMethods(c,"DOMChildrenOperations",{updateTextContent:"updateTextContent"}),e.exports=c}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(){if(l)for(var e in s){var n=s[e],r=l.indexOf(e);if(r>-1?void 0:"production"!==t.env.NODE_ENV?i(!1,"EventPluginRegistry: Cannot inject event plugins that do not exist in the plugin ordering, `%s`.",e):i(!1),!d.plugins[r]){n.extractEvents?void 0:"production"!==t.env.NODE_ENV?i(!1,"EventPluginRegistry: Event plugins must implement an `extractEvents` method, but `%s` does not.",e):i(!1),d.plugins[r]=n;var a=n.eventTypes;for(var c in a)o(a[c],n,c)?void 0:"production"!==t.env.NODE_ENV?i(!1,"EventPluginRegistry: Failed to publish event `%s` for plugin `%s`.",c,e):i(!1)}}}function o(e,n,r){d.eventNameDispatchConfigs.hasOwnProperty(r)?"production"!==t.env.NODE_ENV?i(!1,"EventPluginHub: More than one plugin attempted to publish the same event name, `%s`.",r):i(!1):void 0,d.eventNameDispatchConfigs[r]=e;var o=e.phasedRegistrationNames;if(o){for(var l in o)if(o.hasOwnProperty(l)){var s=o[l];a(s,n,r)}return!0}return e.registrationName?(a(e.registrationName,n,r),!0):!1}function a(e,n,r){d.registrationNameModules[e]?"production"!==t.env.NODE_ENV?i(!1,"EventPluginHub: More than one plugin attempted to publish the same registration name, `%s`.",e):i(!1):void 0,d.registrationNameModules[e]=n,d.registrationNameDependencies[e]=n.eventTypes[r].dependencies}var i=n(2),l=null,s={},d={plugins:[],eventNameDispatchConfigs:{},registrationNameModules:{},registrationNameDependencies:{},injectEventPluginOrder:function(e){l?"production"!==t.env.NODE_ENV?i(!1,"EventPluginRegistry: Cannot inject event plugin ordering more than once. You are likely trying to load more than one copy of React."):i(!1):void 0,l=Array.prototype.slice.call(e),r()},injectEventPluginsByName:function(e){var n=!1;for(var o in e)if(e.hasOwnProperty(o)){var a=e[o];s.hasOwnProperty(o)&&s[o]===a||(s[o]?"production"!==t.env.NODE_ENV?i(!1,"EventPluginRegistry: Cannot inject two different event plugins using the same name, `%s`.",o):i(!1):void 0,s[o]=a,n=!0)}n&&r()},getPluginModuleForEvent:function(e){var t=e.dispatchConfig;if(t.registrationName)return d.registrationNameModules[t.registrationName]||null;for(var n in t.phasedRegistrationNames)if(t.phasedRegistrationNames.hasOwnProperty(n)){var r=d.registrationNameModules[t.phasedRegistrationNames[n]];if(r)return r}return null},_resetEventPlugins:function(){l=null;for(var e in s)s.hasOwnProperty(e)&&delete s[e];d.plugins.length=0;var t=d.eventNameDispatchConfigs;for(var n in t)t.hasOwnProperty(n)&&delete t[n];var r=d.registrationNameModules;for(var o in r)r.hasOwnProperty(o)&&delete r[o]}};e.exports=d}).call(t,n(1))},function(e,t){"use strict";var n={useCreateElement:!1};e.exports=n},function(e,t,n){(function(t){"use strict";function r(){if(this._rootNodeID&&this._wrapperState.pendingUpdate){this._wrapperState.pendingUpdate=!1;var e=this._currentElement.props,t=s.getValue(e);null!=t&&i(this,Boolean(e.multiple),t)}}function o(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}function a(e,n){var r=e._currentElement._owner;s.checkPropTypes("select",n,r);for(var a=0;a<f.length;a++){var i=f[a];null!=n[i]&&(n.multiple?"production"!==t.env.NODE_ENV?m(Array.isArray(n[i]),"The `%s` prop supplied to <select> must be an array if `multiple` is true.%s",i,o(r)):void 0:"production"!==t.env.NODE_ENV?m(!Array.isArray(n[i]),"The `%s` prop supplied to <select> must be a scalar value if `multiple` is false.%s",i,o(r)):void 0)}}function i(e,t,n){var r,o,a=d.getNode(e._rootNodeID).options;if(t){for(r={},o=0;o<n.length;o++)r[""+n[o]]=!0;for(o=0;o<a.length;o++){var i=r.hasOwnProperty(a[o].value);a[o].selected!==i&&(a[o].selected=i)}}else{for(r=""+n,o=0;o<a.length;o++)if(a[o].value===r)return void(a[o].selected=!0);a.length&&(a[0].selected=!0)}}function l(e){var t=this._currentElement.props,n=s.executeOnChange(t,e);return this._wrapperState.pendingUpdate=!0,c.asap(r,this),n}var s=n(32),d=n(6),c=n(8),u=n(4),m=n(3),p="__ReactDOMSelect_value$"+Math.random().toString(36).slice(2),f=["value","defaultValue"],g={valueContextKey:p,getNativeProps:function(e,t,n){return u({},t,{onChange:e._wrapperState.onChange,value:void 0})},mountWrapper:function(e,n){"production"!==t.env.NODE_ENV&&a(e,n);var r=s.getValue(n);e._wrapperState={pendingUpdate:!1,initialValue:null!=r?r:n.defaultValue,onChange:l.bind(e),wasMultiple:Boolean(n.multiple)}},processChildContext:function(e,t,n){var r=u({},n);return r[p]=e._wrapperState.initialValue,r},postUpdateWrapper:function(e){var t=e._currentElement.props;e._wrapperState.initialValue=void 0;var n=e._wrapperState.wasMultiple;e._wrapperState.wasMultiple=Boolean(t.multiple);var r=s.getValue(t);null!=r?(e._wrapperState.pendingUpdate=!1,i(e,Boolean(t.multiple),r)):n!==Boolean(t.multiple)&&(null!=t.defaultValue?i(e,Boolean(t.multiple),t.defaultValue):i(e,Boolean(t.multiple),t.multiple?[]:""))}};e.exports=g}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(55),o=n(31),a=n(33),i=n(6),l=n(4),s=n(25),d=n(46),c=n(49),u=function(e){};l(u.prototype,{construct:function(e){this._currentElement=e,this._stringText=""+e,this._rootNodeID=null,this._mountIndex=0},mountComponent:function(e,n,r){if("production"!==t.env.NODE_ENV&&r[c.ancestorInfoContextKey]&&c("span",null,r[c.ancestorInfoContextKey]),this._rootNodeID=e,n.useCreateElement){var a=r[i.ownerDocumentContextKey],l=a.createElement("span");return o.setAttributeForID(l,e),i.getID(l),d(l,this._stringText),l}var u=s(this._stringText);return n.renderToStaticMarkup?u:"<span "+o.createMarkupForID(e)+">"+u+"</span>"},receiveComponent:function(e,t){if(e!==this._currentElement){this._currentElement=e;var n=""+e;if(n!==this._stringText){this._stringText=n;var o=i.getNode(this._rootNodeID);r.updateTextContent(o,n)}}},unmountComponent:function(){a.unmountIDFromEnvironment(this._rootNodeID)}}),e.exports=u}).call(t,n(1))},function(e,t,n){"use strict";var r,o=n(12),a=n(61),i=n(16),l=n(4),s={injectEmptyComponent:function(e){r=o.createElement(e)}},d=function(e){this._currentElement=null,this._rootNodeID=null,this._renderedComponent=e(r)};l(d.prototype,{construct:function(e){},mountComponent:function(e,t,n){return a.registerNullComponentID(e),this._rootNodeID=e,i.mountComponent(this._renderedComponent,e,t,n)},receiveComponent:function(){},unmountComponent:function(e,t,n){i.unmountComponent(this._renderedComponent),a.deregisterNullComponentID(this._rootNodeID),this._rootNodeID=null,this._renderedComponent=null}}),d.injection=s,e.exports=d},function(e,t){"use strict";function n(e){return!!a[e]}function r(e){a[e]=!0}function o(e){delete a[e]}var a={},i={isNullComponentID:n,registerNullComponentID:r,deregisterNullComponentID:o};e.exports=i},function(e,t,n){(function(t){"use strict";function n(e,t,n,o){try{return t(n,o)}catch(a){return void(null===r&&(r=a))}}var r=null,o={invokeGuardedCallback:n,invokeGuardedCallbackWithCatch:n,rethrowCaughtError:function(){if(r){var e=r;throw r=null,e}}};if("production"!==t.env.NODE_ENV&&"undefined"!=typeof window&&"function"==typeof window.dispatchEvent&&"undefined"!=typeof document&&"function"==typeof document.createEvent){var a=document.createElement("react");o.invokeGuardedCallback=function(e,t,n,r){var o=t.bind(null,n,r),i="react-"+e;a.addEventListener(i,o,!1);var l=document.createEvent("Event");l.initEvent(i,!1,!1),a.dispatchEvent(l),a.removeEventListener(i,o,!1)}}e.exports=o}).call(t,n(1))},function(e,t,n){"use strict";function r(e){return a(document.documentElement,e)}var o=n(116),a=n(76),i=n(77),l=n(78),s={hasSelectionCapabilities:function(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&"text"===e.type||"textarea"===t||"true"===e.contentEditable)},getSelectionInformation:function(){var e=l();return{focusedElem:e,selectionRange:s.hasSelectionCapabilities(e)?s.getSelection(e):null}},restoreSelection:function(e){var t=l(),n=e.focusedElem,o=e.selectionRange;t!==n&&r(n)&&(s.hasSelectionCapabilities(n)&&s.setSelection(n,o),i(n))},getSelection:function(e){var t;if("selectionStart"in e)t={start:e.selectionStart,end:e.selectionEnd};else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var n=document.selection.createRange();n.parentElement()===e&&(t={start:-n.moveStart("character",-e.value.length),end:-n.moveEnd("character",-e.value.length)})}else t=o.getOffsets(e);return t||{start:0,end:0}},setSelection:function(e,t){var n=t.start,r=t.end;if("undefined"==typeof r&&(r=n),"selectionStart"in e)e.selectionStart=n,e.selectionEnd=Math.min(r,e.value.length);else if(document.selection&&e.nodeName&&"input"===e.nodeName.toLowerCase()){var a=e.createTextRange();a.collapse(!0),a.moveStart("character",n),a.moveEnd("character",r-n),a.select()}else o.setOffsets(e,t)}};e.exports=s},function(e,t,n){"use strict";var r=n(28),o=r({INSERT_MARKUP:null,MOVE_EXISTING:null,REMOVE_NODE:null,SET_MARKUP:null,TEXT_CONTENT:null});e.exports=o},function(e,t,n){(function(t){"use strict";function r(e){if("function"==typeof e.type)return e.type;var t=e.type,n=u[t];return null==n&&(u[t]=n=d(t)),n}function o(e){return c?void 0:"production"!==t.env.NODE_ENV?s(!1,"There is no registered component for the tag %s",e.type):s(!1),new c(e.type,e.props)}function a(e){return new m(e)}function i(e){return e instanceof m}var l=n(4),s=n(2),d=null,c=null,u={},m=null,p={injectGenericComponentClass:function(e){c=e},injectTextComponentClass:function(e){m=e},injectComponentClasses:function(e){l(u,e)}},f={getComponentClassForElement:r,createInternalComponent:o,createInstanceForText:a,isTextComponent:i,injection:p};e.exports=f}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e,n){"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?o(!1,"%s(...): Can only update a mounted or mounting component. This usually means you called %s() on an unmounted component. This is a no-op. Please check the code for the %s component.",n,n,e.constructor&&e.constructor.displayName||""):void 0)}var o=n(3),a={isMounted:function(e){return!1},enqueueCallback:function(e,t){},enqueueForceUpdate:function(e){r(e,"forceUpdate")},enqueueReplaceState:function(e,t){r(e,"replaceState")},enqueueSetState:function(e,t){r(e,"setState")},enqueueSetProps:function(e,t){r(e,"setProps")},enqueueReplaceProps:function(e,t){r(e,"replaceProps")}};e.exports=a}).call(t,n(1))},function(e,t){"use strict";var n={injectCreateReactRootIndex:function(e){r.createReactRootIndex=e}},r={createReactRootIndex:null,injection:n};e.exports=r},function(e,t){"use strict";var n={currentScrollLeft:0,currentScrollTop:0,refreshScrollValues:function(e){n.currentScrollLeft=e.x,n.currentScrollTop=e.y}};e.exports=n},function(e,t,n){(function(t){"use strict";function r(e,n){if(null==n?"production"!==t.env.NODE_ENV?o(!1,"accumulateInto(...): Accumulated items must not be null or undefined."):o(!1):void 0,null==e)return n;var r=Array.isArray(e),a=Array.isArray(n);return r&&a?(e.push.apply(e,n),e):r?(e.push(n),e):a?[e].concat(n):[e,n]}var o=n(2);e.exports=r}).call(t,n(1))},function(e,t){"use strict";var n=function(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)};e.exports=n},function(e,t){"use strict";function n(e){var t=e&&(r&&e[r]||e[o]);return"function"==typeof t?t:void 0}var r="function"==typeof Symbol&&Symbol.iterator,o="@@iterator";e.exports=n},function(e,t,n){"use strict";function r(){return!a&&o.canUseDOM&&(a="textContent"in document.documentElement?"textContent":"innerText"),a}var o=n(5),a=null;e.exports=r},function(e,t,n){(function(t){"use strict";function r(e){if(e){var t=e.getName();if(t)return" Check the render method of `"+t+"`."}return""}function o(e){return"function"==typeof e&&"undefined"!=typeof e.prototype&&"function"==typeof e.prototype.mountComponent&&"function"==typeof e.prototype.receiveComponent}function a(e){var n;if(null===e||e===!1)n=new l(a);else if("object"==typeof e){var i=e;!i||"function"!=typeof i.type&&"string"!=typeof i.type?"production"!==t.env.NODE_ENV?c(!1,"Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: %s.%s",null==i.type?i.type:typeof i.type,r(i._owner)):c(!1):void 0,n="string"==typeof i.type?s.createInternalComponent(i):o(i.type)?new i.type(i):new m}else"string"==typeof e||"number"==typeof e?n=s.createInstanceForText(e):"production"!==t.env.NODE_ENV?c(!1,"Encountered invalid React node of type %s",typeof e):c(!1);return"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?u("function"==typeof n.construct&&"function"==typeof n.mountComponent&&"function"==typeof n.receiveComponent&&"function"==typeof n.unmountComponent,"Only React Components can be mounted."):void 0),n.construct(e),n._mountIndex=0,n._mountImage=null,"production"!==t.env.NODE_ENV&&(n._isOwnerNecessary=!1,n._warnedAboutRefsInRender=!1),"production"!==t.env.NODE_ENV&&Object.preventExtensions&&Object.preventExtensions(n),n}var i=n(110),l=n(60),s=n(65),d=n(4),c=n(2),u=n(3),m=function(){};d(m.prototype,i.Mixin,{_instantiateReactComponent:a}),e.exports=a}).call(t,n(1))},function(e,t){"use strict";function n(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&r[e.type]||"textarea"===t)}var r={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};e.exports=n},function(e,t,n){(function(t){"use strict";var r=n(10),o={listen:function(e,t,n){return e.addEventListener?(e.addEventListener(t,n,!1),{remove:function(){e.removeEventListener(t,n,!1)}}):e.attachEvent?(e.attachEvent("on"+t,n),{remove:function(){e.detachEvent("on"+t,n)}}):void 0},capture:function(e,n,o){return e.addEventListener?(e.addEventListener(n,o,!0),{remove:function(){e.removeEventListener(n,o,!0)}}):("production"!==t.env.NODE_ENV&&console.error("Attempted to listen to events during the capture phase on a browser that does not support the capture phase. Your application will not receive some events."),{remove:r})},registerDefault:function(){}};e.exports=o}).call(t,n(1))},function(e,t,n){"use strict";function r(e,t){var n=!0;e:for(;n;){var r=e,a=t;if(n=!1,r&&a){if(r===a)return!0;if(o(r))return!1;if(o(a)){e=r,t=a.parentNode,n=!0;continue e}return r.contains?r.contains(a):r.compareDocumentPosition?!!(16&r.compareDocumentPosition(a)):!1}return!1}}var o=n(159);e.exports=r},function(e,t){"use strict";function n(e){try{e.focus()}catch(t){}}e.exports=n},function(e,t){"use strict";function n(){if("undefined"==typeof document)return null;try{return document.activeElement||document.body}catch(e){return document.body}}e.exports=n},function(e,t,n){(function(t){"use strict";function r(e){return i?void 0:"production"!==t.env.NODE_ENV?a(!1,"Markup wrapping node not initialized"):a(!1),m.hasOwnProperty(e)||(e="*"),l.hasOwnProperty(e)||("*"===e?i.innerHTML="<link />":i.innerHTML="<"+e+"></"+e+">",l[e]=!i.firstChild),l[e]?m[e]:null}var o=n(5),a=n(2),i=o.canUseDOM?document.createElement("div"):null,l={},s=[1,'<select multiple="true">',"</select>"],d=[1,"<table>","</table>"],c=[3,"<table><tbody><tr>","</tr></tbody></table>"],u=[1,'<svg xmlns="http://www.w3.org/2000/svg">',"</svg>"],m={"*":[1,"?<div>","</div>"],area:[1,"<map>","</map>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],legend:[1,"<fieldset>","</fieldset>"],param:[1,"<object>","</object>"],tr:[2,"<table><tbody>","</tbody></table>"],optgroup:s,option:s,caption:d,colgroup:d,tbody:d,tfoot:d,thead:d,td:c,th:c},p=["circle","clipPath","defs","ellipse","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","text","tspan"];p.forEach(function(e){m[e]=u,l[e]=!0}),e.exports=r}).call(t,n(1))},function(e,t){"use strict";function n(e,t){if(e===t)return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(var a=r.bind(t),i=0;i<n.length;i++)if(!a(n[i])||e[n[i]]!==t[n[i]])return!1;return!0}var r=Object.prototype.hasOwnProperty;e.exports=n},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;r=!1,null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,a);if(void 0!==l){if("value"in l)return l.value;var s=l.get;if(void 0===s)return;return s.call(i)}var d=Object.getPrototypeOf(o);if(null===d)return;e=d,t=a,n=i,r=!0,l=d=void 0}};n(172);var s=n(51),d=r(s),c=n(83),u=r(c),m=n(82),p=r(m),f=function(e){function t(){o(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return a(t,e),i(t,[{key:"render",value:function(){return d["default"].createElement("div",{
className:"main-wrap"},d["default"].createElement(u["default"],null),d["default"].createElement(p["default"],null))}}]),t}(d["default"].Component);t["default"]=f,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;r=!1,null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,a);if(void 0!==l){if("value"in l)return l.value;var s=l.get;if(void 0===s)return;return s.call(i)}var d=Object.getPrototypeOf(o);if(null===d)return;e=d,t=a,n=i,r=!0,l=d=void 0}};n(173);var s=n(51),d=r(s),c=n(52),u=(r(c),function(e){function t(e){o(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e),this.state={keyword:"",wenhao:""}}return a(t,e),i(t,[{key:"render",value:function(){var e=this;return d["default"].createElement("div",{className:"mod-panel"},d["default"].createElement("div",{className:"search-wrap"},d["default"].createElement("input",{type:"text",className:"inp key-inp",placeholder:"关键词",value:this.state.keyword,onChange:function(t){e.handleChangeKeyword(t)}}),d["default"].createElement("input",{type:"text",className:"inp wh-inp",placeholder:"文号, 如2010 79",value:this.state.wenhao,onChange:function(t){e.handleChangeWenhao(t)}}),d["default"].createElement("button",{type:"button",className:"btn",onClick:function(){e.search()}},"查询")),d["default"].createElement("div",{className:"con-wrap"}))}},{key:"handleChangeKeyword",value:function(e){this.setState({keyword:e.target.value})}},{key:"handleChangeWenhao",value:function(e){this.setState({wenhao:e.target.value})}},{key:"search",value:function(){}}]),t}(d["default"].Component));t["default"]=u,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),l=function(e,t,n){for(var r=!0;r;){var o=e,a=t,i=n;r=!1,null===o&&(o=Function.prototype);var l=Object.getOwnPropertyDescriptor(o,a);if(void 0!==l){if("value"in l)return l.value;var s=l.get;if(void 0===s)return;return s.call(i)}var d=Object.getPrototypeOf(o);if(null===d)return;e=d,t=a,n=i,r=!0,l=d=void 0}};n(174);var s=n(51),d=r(s),c=n(52),u=r(c),m=function(e){function t(){o(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).apply(this,arguments)}return a(t,e),i(t,[{key:"componentDidMount",value:function(){UE.getEditor("mod-editor"),this.addLawBtn()}},{key:"render",value:function(){return d["default"].createElement("div",{id:"mod-editor",className:"mod-editor"})}},{key:"addLawBtn",value:function(){UE.registerUI("insertlaw",function(e,t){e.registerCommand(t,{execCommand:function(){u["default"].showPanel()}});var n=new UE.ui.Button({name:t,title:"插入法规",cssRules:"background: url(/dist/ueditor/law.png) no-repeat 50% 50% !important;",onclick:function(){e.execCommand(t)}});return e.addListener("selectionchange",function(){var r=e.queryCommandState(t);-1==r?(n.setDisabled(!0),n.setChecked(!1)):(n.setDisabled(!1),n.setChecked(r))}),n})}}]),t}(d["default"].Component);t["default"]=m,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(92),a=r(o),i=(0,a["default"])({SHOW_PANEL:null});t["default"]=i,e.exports=t["default"]},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n(89),a=r(o);t["default"]=new a["default"].Dispatcher,e.exports=t["default"]},function(e,t,n){t=e.exports=n(30)(),t.push([e.id,"",""])},function(e,t,n){t=e.exports=n(30)(),t.push([e.id,".mod-panel{position:absolute;left:760px;top:10px;border:1px solid #ccc;border-radius:5px;width:600px;padding:20px}.mod-panel .inp{padding:5px;width:40%;border-radius:3px;border:1px solid #ccc;height:20px;outline:none}.mod-panel .btn{width:14%;border-radius:3px;background-color:#06c;height:30px;line-height:28px;border:0 none;color:#fff;cursor:pointer;outline:none}",""])},function(e,t,n){t=e.exports=n(30)(),t.push([e.id,".mod-editor{width:700px;height:400px}",""])},function(e,t,n){e.exports.Dispatcher=n(90)},function(e,t,n){(function(r){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.__esModule=!0;var a=n(91),i="ID_",l=function(){function e(){o(this,e),this._callbacks={},this._isDispatching=!1,this._isHandled={},this._isPending={},this._lastID=1}return e.prototype.register=function(e){var t=i+this._lastID++;return this._callbacks[t]=e,t},e.prototype.unregister=function(e){this._callbacks[e]?void 0:"production"!==r.env.NODE_ENV?a(!1,"Dispatcher.unregister(...): `%s` does not map to a registered callback.",e):a(!1),delete this._callbacks[e]},e.prototype.waitFor=function(e){this._isDispatching?void 0:"production"!==r.env.NODE_ENV?a(!1,"Dispatcher.waitFor(...): Must be invoked while dispatching."):a(!1);for(var t=0;t<e.length;t++){var n=e[t];this._isPending[n]?this._isHandled[n]?void 0:"production"!==r.env.NODE_ENV?a(!1,"Dispatcher.waitFor(...): Circular dependency detected while waiting for `%s`.",n):a(!1):(this._callbacks[n]?void 0:"production"!==r.env.NODE_ENV?a(!1,"Dispatcher.waitFor(...): `%s` does not map to a registered callback.",n):a(!1),this._invokeCallback(n))}},e.prototype.dispatch=function(e){this._isDispatching?"production"!==r.env.NODE_ENV?a(!1,"Dispatch.dispatch(...): Cannot dispatch in the middle of a dispatch."):a(!1):void 0,this._startDispatching(e);try{for(var t in this._callbacks)this._isPending[t]||this._invokeCallback(t)}finally{this._stopDispatching()}},e.prototype.isDispatching=function(){return this._isDispatching},e.prototype._invokeCallback=function(e){this._isPending[e]=!0,this._callbacks[e](this._pendingPayload),this._isHandled[e]=!0},e.prototype._startDispatching=function(e){for(var t in this._callbacks)this._isPending[t]=!1,this._isHandled[t]=!1;this._pendingPayload=e,this._isDispatching=!0},e.prototype._stopDispatching=function(){delete this._pendingPayload,this._isDispatching=!1},e}();e.exports=l}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var n=function(e,n,r,o,a,i,l,s){if("production"!==t.env.NODE_ENV&&void 0===n)throw new Error("invariant requires an error message argument");if(!e){var d;if(void 0===n)d=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[r,o,a,i,l,s],u=0;d=new Error("Invariant Violation: "+n.replace(/%s/g,function(){return c[u++]}))}throw d.framesToPop=1,d}};e.exports=n}).call(t,n(1))},function(e,t){"use strict";var n=function(e){var t,n={};if(!(e instanceof Object)||Array.isArray(e))throw new Error("keyMirror(...): Argument must be an object.");for(t in e)e.hasOwnProperty(t)&&(n[t]=t);return n};e.exports=n},function(e,t,n){"use strict";e.exports=n(111)},function(e,t,n){"use strict";var r=n(6),o=n(41),a=n(77),i={componentDidMount:function(){this.props.autoFocus&&a(o(this))}},l={Mixin:i,focusDOMComponent:function(){a(r.getNode(this._rootNodeID))}};e.exports=l},function(e,t,n){"use strict";function r(){var e=window.opera;return"object"==typeof e&&"function"==typeof e.version&&parseInt(e.version(),10)<=12}function o(e){return(e.ctrlKey||e.altKey||e.metaKey)&&!(e.ctrlKey&&e.altKey)}function a(e){switch(e){case U.topCompositionStart:return I.compositionStart;case U.topCompositionEnd:return I.compositionEnd;case U.topCompositionUpdate:return I.compositionUpdate}}function i(e,t){return e===U.topKeyDown&&t.keyCode===C}function l(e,t){switch(e){case U.topKeyUp:return-1!==x.indexOf(t.keyCode);case U.topKeyDown:return t.keyCode!==C;case U.topKeyPress:case U.topMouseDown:case U.topBlur:return!0;default:return!1}}function s(e){var t=e.detail;return"object"==typeof t&&"data"in t?t.data:null}function d(e,t,n,r,o){var d,c;if(N?d=a(e):R?l(e,r)&&(d=I.compositionEnd):i(e,r)&&(d=I.compositionStart),!d)return null;S&&(R||d!==I.compositionStart?d===I.compositionEnd&&R&&(c=R.getData()):R=h.getPooled(t));var u=v.getPooled(d,n,r,o);if(c)u.data=c;else{var m=s(r);null!==m&&(u.data=m)}return f.accumulateTwoPhaseDispatches(u),u}function c(e,t){switch(e){case U.topCompositionEnd:return s(t);case U.topKeyPress:var n=t.which;return n!==k?null:(_=!0,T);case U.topTextInput:var r=t.data;return r===T&&_?null:r;default:return null}}function u(e,t){if(R){if(e===U.topCompositionEnd||l(e,t)){var n=R.getData();return h.release(R),R=null,n}return null}switch(e){case U.topPaste:return null;case U.topKeyPress:return t.which&&!o(t)?String.fromCharCode(t.which):null;case U.topCompositionEnd:return S?null:t.data;default:return null}}function m(e,t,n,r,o){var a;if(a=w?c(e,r):u(e,r),!a)return null;var i=b.getPooled(I.beforeInput,n,r,o);return i.data=a,f.accumulateTwoPhaseDispatches(i),i}var p=n(9),f=n(19),g=n(5),h=n(103),v=n(137),b=n(140),y=n(13),x=[9,13,27,32],C=229,N=g.canUseDOM&&"CompositionEvent"in window,E=null;g.canUseDOM&&"documentMode"in document&&(E=document.documentMode);var w=g.canUseDOM&&"TextEvent"in window&&!E&&!r(),S=g.canUseDOM&&(!N||E&&E>8&&11>=E),k=32,T=String.fromCharCode(k),U=p.topLevelTypes,I={beforeInput:{phasedRegistrationNames:{bubbled:y({onBeforeInput:null}),captured:y({onBeforeInputCapture:null})},dependencies:[U.topCompositionEnd,U.topKeyPress,U.topTextInput,U.topPaste]},compositionEnd:{phasedRegistrationNames:{bubbled:y({onCompositionEnd:null}),captured:y({onCompositionEndCapture:null})},dependencies:[U.topBlur,U.topCompositionEnd,U.topKeyDown,U.topKeyPress,U.topKeyUp,U.topMouseDown]},compositionStart:{phasedRegistrationNames:{bubbled:y({onCompositionStart:null}),captured:y({onCompositionStartCapture:null})},dependencies:[U.topBlur,U.topCompositionStart,U.topKeyDown,U.topKeyPress,U.topKeyUp,U.topMouseDown]},compositionUpdate:{phasedRegistrationNames:{bubbled:y({onCompositionUpdate:null}),captured:y({onCompositionUpdateCapture:null})},dependencies:[U.topBlur,U.topCompositionUpdate,U.topKeyDown,U.topKeyPress,U.topKeyUp,U.topMouseDown]}},_=!1,R=null,B={eventTypes:I,extractEvents:function(e,t,n,r,o){return[d(e,t,n,r,o),m(e,t,n,r,o)]}};e.exports=B},function(e,t,n){(function(t){"use strict";var r=n(53),o=n(5),a=n(7),i=n(152),l=n(145),s=n(157),d=n(160),c=n(3),u=d(function(e){return s(e)}),m=!1,p="cssFloat";if(o.canUseDOM){var f=document.createElement("div").style;try{f.font=""}catch(g){m=!0}void 0===document.documentElement.style.cssFloat&&(p="styleFloat")}if("production"!==t.env.NODE_ENV)var h=/^(?:webkit|moz|o)[A-Z]/,v=/;\s*$/,b={},y={},x=function(e){b.hasOwnProperty(e)&&b[e]||(b[e]=!0,"production"!==t.env.NODE_ENV?c(!1,"Unsupported style property %s. Did you mean %s?",e,i(e)):void 0)},C=function(e){b.hasOwnProperty(e)&&b[e]||(b[e]=!0,"production"!==t.env.NODE_ENV?c(!1,"Unsupported vendor-prefixed style property %s. Did you mean %s?",e,e.charAt(0).toUpperCase()+e.slice(1)):void 0)},N=function(e,n){y.hasOwnProperty(n)&&y[n]||(y[n]=!0,"production"!==t.env.NODE_ENV?c(!1,'Style property values shouldn\'t contain a semicolon. Try "%s: %s" instead.',e,n.replace(v,"")):void 0)},E=function(e,t){e.indexOf("-")>-1?x(e):h.test(e)?C(e):v.test(t)&&N(e,t)};var w={createMarkupForStyles:function(e){var n="";for(var r in e)if(e.hasOwnProperty(r)){var o=e[r];"production"!==t.env.NODE_ENV&&E(r,o),null!=o&&(n+=u(r)+":",n+=l(r,o)+";")}return n||null},setValueForStyles:function(e,n){var o=e.style;for(var a in n)if(n.hasOwnProperty(a)){"production"!==t.env.NODE_ENV&&E(a,n[a]);var i=l(a,n[a]);if("float"===a&&(a=p),i)o[a]=i;else{var s=m&&r.shorthandPropertyExpansions[a];if(s)for(var d in s)o[d]="";else o[a]=""}}}};a.measureMethods(w,"CSSPropertyOperations",{setValueForStyles:"setValueForStyles"}),e.exports=w}).call(t,n(1))},function(e,t,n){"use strict";function r(e){var t=e.nodeName&&e.nodeName.toLowerCase();return"select"===t||"input"===t&&"file"===e.type}function o(e){var t=E.getPooled(I.change,R,e,w(e));x.accumulateTwoPhaseDispatches(t),N.batchedUpdates(a,t)}function a(e){y.enqueueEvents(e),y.processEventQueue(!1)}function i(e,t){_=e,R=t,_.attachEvent("onchange",o)}function l(){_&&(_.detachEvent("onchange",o),_=null,R=null)}function s(e,t,n){return e===U.topChange?n:void 0}function d(e,t,n){e===U.topFocus?(l(),i(t,n)):e===U.topBlur&&l()}function c(e,t){_=e,R=t,B=e.value,D=Object.getOwnPropertyDescriptor(e.constructor.prototype,"value"),Object.defineProperty(_,"value",P),_.attachEvent("onpropertychange",m)}function u(){_&&(delete _.value,_.detachEvent("onpropertychange",m),_=null,R=null,B=null,D=null)}function m(e){if("value"===e.propertyName){var t=e.srcElement.value;t!==B&&(B=t,o(e))}}function p(e,t,n){return e===U.topInput?n:void 0}function f(e,t,n){e===U.topFocus?(u(),c(t,n)):e===U.topBlur&&u()}function g(e,t,n){return e!==U.topSelectionChange&&e!==U.topKeyUp&&e!==U.topKeyDown||!_||_.value===B?void 0:(B=_.value,R)}function h(e){return e.nodeName&&"input"===e.nodeName.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)}function v(e,t,n){return e===U.topClick?n:void 0}var b=n(9),y=n(18),x=n(19),C=n(5),N=n(8),E=n(17),w=n(44),S=n(45),k=n(74),T=n(13),U=b.topLevelTypes,I={change:{phasedRegistrationNames:{bubbled:T({onChange:null}),captured:T({onChangeCapture:null})},dependencies:[U.topBlur,U.topChange,U.topClick,U.topFocus,U.topInput,U.topKeyDown,U.topKeyUp,U.topSelectionChange]}},_=null,R=null,B=null,D=null,O=!1;C.canUseDOM&&(O=S("change")&&(!("documentMode"in document)||document.documentMode>8));var A=!1;C.canUseDOM&&(A=S("input")&&(!("documentMode"in document)||document.documentMode>9));var P={get:function(){return D.get.call(this)},set:function(e){B=""+e,D.set.call(this,e)}},L={eventTypes:I,extractEvents:function(e,t,n,o,a){var i,l;if(r(t)?O?i=s:l=d:k(t)?A?i=p:(i=g,l=f):h(t)&&(i=v),i){var c=i(e,t,n);if(c){var u=E.getPooled(I.change,c,o,a);return u.type="change",x.accumulateTwoPhaseDispatches(u),u}}l&&l(e,t,n)}};e.exports=L},function(e,t){"use strict";var n=0,r={createReactRootIndex:function(){return n++}};e.exports=r},function(e,t,n){(function(t){"use strict";function r(e){return e.substring(1,e.indexOf(" "))}var o=n(5),a=n(154),i=n(10),l=n(79),s=n(2),d=/^(<[^ \/>]+)/,c="data-danger-index",u={dangerouslyRenderMarkup:function(e){o.canUseDOM?void 0:"production"!==t.env.NODE_ENV?s(!1,"dangerouslyRenderMarkup(...): Cannot render markup in a worker thread. Make sure `window` and `document` are available globally before requiring React when unit testing or use ReactDOMServer.renderToString for server rendering."):s(!1);for(var n,u={},m=0;m<e.length;m++)e[m]?void 0:"production"!==t.env.NODE_ENV?s(!1,"dangerouslyRenderMarkup(...): Missing markup."):s(!1),n=r(e[m]),n=l(n)?n:"*",u[n]=u[n]||[],u[n][m]=e[m];var p=[],f=0;for(n in u)if(u.hasOwnProperty(n)){var g,h=u[n];for(g in h)if(h.hasOwnProperty(g)){var v=h[g];h[g]=v.replace(d,"$1 "+c+'="'+g+'" ')}for(var b=a(h.join(""),i),y=0;y<b.length;++y){var x=b[y];x.hasAttribute&&x.hasAttribute(c)?(g=+x.getAttribute(c),x.removeAttribute(c),p.hasOwnProperty(g)?"production"!==t.env.NODE_ENV?s(!1,"Danger: Assigning to an already-occupied result index."):s(!1):void 0,p[g]=x,f+=1):"production"!==t.env.NODE_ENV&&console.error("Danger: Discarding unexpected node:",x)}}return f!==p.length?"production"!==t.env.NODE_ENV?s(!1,"Danger: Did not assign to every index of resultList."):s(!1):void 0,p.length!==e.length?"production"!==t.env.NODE_ENV?s(!1,"Danger: Expected markup to render %s nodes, but rendered %s.",e.length,p.length):s(!1):void 0,p},dangerouslyReplaceNodeWithMarkup:function(e,n){o.canUseDOM?void 0:"production"!==t.env.NODE_ENV?s(!1,"dangerouslyReplaceNodeWithMarkup(...): Cannot render markup in a worker thread. Make sure `window` and `document` are available globally before requiring React when unit testing or use ReactDOMServer.renderToString() for server rendering."):s(!1),n?void 0:"production"!==t.env.NODE_ENV?s(!1,"dangerouslyReplaceNodeWithMarkup(...): Missing markup."):s(!1),"html"===e.tagName.toLowerCase()?"production"!==t.env.NODE_ENV?s(!1,"dangerouslyReplaceNodeWithMarkup(...): Cannot replace markup of the <html> node. This is because browser quirks make this unreliable and/or slow. If you want to render to the root you must use server rendering. See ReactDOMServer.renderToString()."):s(!1):void 0;var r;r="string"==typeof n?a(n,i)[0]:n,e.parentNode.replaceChild(r,e)}};e.exports=u}).call(t,n(1))},function(e,t,n){"use strict";var r=n(13),o=[r({ResponderEventPlugin:null}),r({SimpleEventPlugin:null}),r({TapEventPlugin:null}),r({EnterLeaveEventPlugin:null}),r({ChangeEventPlugin:null}),r({SelectEventPlugin:null}),r({BeforeInputEventPlugin:null})];e.exports=o},function(e,t,n){"use strict";var r=n(9),o=n(19),a=n(24),i=n(6),l=n(13),s=r.topLevelTypes,d=i.getFirstReactDOM,c={mouseEnter:{registrationName:l({onMouseEnter:null}),dependencies:[s.topMouseOut,s.topMouseOver]},mouseLeave:{registrationName:l({onMouseLeave:null}),dependencies:[s.topMouseOut,s.topMouseOver]}},u=[null,null],m={eventTypes:c,extractEvents:function(e,t,n,r,l){if(e===s.topMouseOver&&(r.relatedTarget||r.fromElement))return null;if(e!==s.topMouseOut&&e!==s.topMouseOver)return null;var m;if(t.window===t)m=t;else{var p=t.ownerDocument;m=p?p.defaultView||p.parentWindow:window}var f,g,h="",v="";if(e===s.topMouseOut?(f=t,h=n,g=d(r.relatedTarget||r.toElement),g?v=i.getID(g):g=m,g=g||m):(f=m,g=t,v=n),f===g)return null;var b=a.getPooled(c.mouseLeave,h,r,l);b.type="mouseleave",b.target=f,b.relatedTarget=g;var y=a.getPooled(c.mouseEnter,v,r,l);return y.type="mouseenter",y.target=g,y.relatedTarget=f,o.accumulateEnterLeaveDispatches(b,y,h,v),u[0]=b,u[1]=y,u}};e.exports=m},function(e,t,n){(function(t){"use strict";function r(e){return e===b.topMouseUp||e===b.topTouchEnd||e===b.topTouchCancel}function o(e){return e===b.topMouseMove||e===b.topTouchMove}function a(e){return e===b.topMouseDown||e===b.topTouchStart}function i(e,t,n,r){var o=e.type||"unknown-event";e.currentTarget=v.Mount.getNode(r),t?f.invokeGuardedCallbackWithCatch(o,n,e,r):f.invokeGuardedCallback(o,n,e,r),e.currentTarget=null}function l(e,n){var r=e._dispatchListeners,o=e._dispatchIDs;if("production"!==t.env.NODE_ENV&&m(e),Array.isArray(r))for(var a=0;a<r.length&&!e.isPropagationStopped();a++)i(e,n,r[a],o[a]);else r&&i(e,n,r,o);e._dispatchListeners=null,e._dispatchIDs=null}function s(e){var n=e._dispatchListeners,r=e._dispatchIDs;if("production"!==t.env.NODE_ENV&&m(e),Array.isArray(n)){for(var o=0;o<n.length&&!e.isPropagationStopped();o++)if(n[o](e,r[o]))return r[o]}else if(n&&n(e,r))return r;return null}function d(e){var t=s(e);return e._dispatchIDs=null,e._dispatchListeners=null,t}function c(e){"production"!==t.env.NODE_ENV&&m(e);var n=e._dispatchListeners,r=e._dispatchIDs;Array.isArray(n)?"production"!==t.env.NODE_ENV?g(!1,"executeDirectDispatch(...): Invalid `event`."):g(!1):void 0;var o=n?n(e,r):null;return e._dispatchListeners=null,e._dispatchIDs=null,o}function u(e){return!!e._dispatchListeners}var m,p=n(9),f=n(62),g=n(2),h=n(3),v={Mount:null,injectMount:function(e){v.Mount=e,"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?h(e&&e.getNode&&e.getID,"EventPluginUtils.injection.injectMount(...): Injected Mount module is missing getNode or getID."):void 0)}},b=p.topLevelTypes;"production"!==t.env.NODE_ENV&&(m=function(e){var n=e._dispatchListeners,r=e._dispatchIDs,o=Array.isArray(n),a=Array.isArray(r),i=a?r.length:r?1:0,l=o?n.length:n?1:0;"production"!==t.env.NODE_ENV?h(a===o&&i===l,"EventPluginUtils: Invalid `event`."):void 0});var y={isEndish:r,isMoveish:o,isStartish:a,executeDirectDispatch:c,executeDispatchesInOrder:l,executeDispatchesInOrderStopAtTrue:d,hasDispatches:u,getNode:function(e){return v.Mount.getNode(e)},getID:function(e){return v.Mount.getID(e)},injection:v};e.exports=y}).call(t,n(1))},function(e,t,n){"use strict";function r(e){this._root=e,this._startText=this.getText(),this._fallbackText=null}var o=n(15),a=n(4),i=n(72);a(r.prototype,{destructor:function(){this._root=null,this._startText=null,this._fallbackText=null},getText:function(){return"value"in this._root?this._root.value:this._root[i()]},getData:function(){if(this._fallbackText)return this._fallbackText;var e,t,n=this._startText,r=n.length,o=this.getText(),a=o.length;for(e=0;r>e&&n[e]===o[e];e++);var i=r-e;for(t=1;i>=t&&n[r-t]===o[a-t];t++);var l=t>1?1-t:void 0;return this._fallbackText=o.slice(e,l),this._fallbackText}}),o.addPoolingTo(r),e.exports=r},function(e,t,n){"use strict";var r,o=n(14),a=n(5),i=o.injection.MUST_USE_ATTRIBUTE,l=o.injection.MUST_USE_PROPERTY,s=o.injection.HAS_BOOLEAN_VALUE,d=o.injection.HAS_SIDE_EFFECTS,c=o.injection.HAS_NUMERIC_VALUE,u=o.injection.HAS_POSITIVE_NUMERIC_VALUE,m=o.injection.HAS_OVERLOADED_BOOLEAN_VALUE;if(a.canUseDOM){var p=document.implementation;r=p&&p.hasFeature&&p.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")}var f={isCustomAttribute:RegExp.prototype.test.bind(/^(data|aria)-[a-z_][a-z\d_.\-]*$/),Properties:{accept:null,acceptCharset:null,accessKey:null,action:null,allowFullScreen:i|s,allowTransparency:i,alt:null,async:s,autoComplete:null,autoPlay:s,capture:i|s,cellPadding:null,cellSpacing:null,charSet:i,challenge:i,checked:l|s,classID:i,className:r?i:l,cols:i|u,colSpan:null,content:null,contentEditable:null,contextMenu:i,controls:l|s,coords:null,crossOrigin:null,data:null,dateTime:i,"default":s,defer:s,dir:null,disabled:i|s,download:m,draggable:null,encType:null,form:i,formAction:i,formEncType:i,formMethod:i,formNoValidate:s,formTarget:i,frameBorder:i,headers:null,height:i,hidden:i|s,high:null,href:null,hrefLang:null,htmlFor:null,httpEquiv:null,icon:null,id:l,inputMode:i,integrity:null,is:i,keyParams:i,keyType:i,kind:null,label:null,lang:null,list:i,loop:l|s,low:null,manifest:i,marginHeight:null,marginWidth:null,max:null,maxLength:i,media:i,mediaGroup:null,method:null,min:null,minLength:i,multiple:l|s,muted:l|s,name:null,nonce:i,noValidate:s,open:s,optimum:null,pattern:null,placeholder:null,poster:null,preload:null,radioGroup:null,readOnly:l|s,rel:null,required:s,reversed:s,role:i,rows:i|u,rowSpan:null,sandbox:null,scope:null,scoped:s,scrolling:null,seamless:i|s,selected:l|s,shape:null,size:i|u,sizes:i,span:u,spellCheck:null,src:null,srcDoc:l,srcLang:null,srcSet:i,start:c,step:null,style:null,summary:null,tabIndex:null,target:null,title:null,type:null,useMap:null,value:l|d,width:i,wmode:i,wrap:null,about:i,datatype:i,inlist:i,prefix:i,property:i,resource:i,"typeof":i,vocab:i,autoCapitalize:i,autoCorrect:i,autoSave:null,color:null,itemProp:i,itemScope:i|s,itemType:i,itemID:i,itemRef:i,results:null,security:i,unselectable:i},DOMAttributeNames:{acceptCharset:"accept-charset",className:"class",htmlFor:"for",httpEquiv:"http-equiv"},DOMPropertyNames:{autoComplete:"autocomplete",autoFocus:"autofocus",autoPlay:"autoplay",autoSave:"autosave",encType:"encoding",hrefLang:"hreflang",radioGroup:"radiogroup",spellCheck:"spellcheck",srcDoc:"srcdoc",srcSet:"srcset"}};e.exports=f},function(e,t,n){(function(t){"use strict";var r=n(21),o=n(41),a=n(3),i="_getDOMNodeDidWarn",l={getDOMNode:function(){return"production"!==t.env.NODE_ENV?a(this.constructor[i],"%s.getDOMNode(...) is deprecated. Please use ReactDOM.findDOMNode(instance) instead.",r.get(this).getName()||this.tagName||"Unknown"):void 0,this.constructor[i]=!0,o(this)}};e.exports=l}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e,n,r){var o=void 0===e[r];"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?s(o,"flattenChildren(...): Encountered two children with the same key, `%s`. Child keys must be unique; when two children share a key, only the first child will be used.",r):void 0),null!=n&&o&&(e[r]=a(n,null))}var o=n(16),a=n(73),i=n(47),l=n(48),s=n(3),d={instantiateChildren:function(e,t,n){if(null==e)return null;var o={};return l(e,r,o),o},updateChildren:function(e,t,n,r){if(!t&&!e)return null;var l;for(l in t)if(t.hasOwnProperty(l)){var s=e&&e[l],d=s&&s._currentElement,c=t[l];if(null!=s&&i(d,c))o.receiveComponent(s,c,n,r),t[l]=s;else{s&&o.unmountComponent(s,l);var u=a(c,null);t[l]=u}}for(l in e)!e.hasOwnProperty(l)||t&&t.hasOwnProperty(l)||o.unmountComponent(e[l]);return t},unmountChildren:function(e){for(var t in e)if(e.hasOwnProperty(t)){var n=e[t];o.unmountComponent(n)}}};e.exports=d}).call(t,n(1))},function(e,t,n){"use strict";function r(e){return(""+e).replace(x,"//")}function o(e,t){this.func=e,this.context=t,this.count=0}function a(e,t,n){var r=e.func,o=e.context;r.call(o,t,e.count++)}function i(e,t,n){if(null==e)return e;var r=o.getPooled(t,n);v(e,a,r),o.release(r)}function l(e,t,n,r){this.result=e,this.keyPrefix=t,this.func=n,this.context=r,this.count=0}function s(e,t,n){var o=e.result,a=e.keyPrefix,i=e.func,l=e.context,s=i.call(l,t,e.count++);Array.isArray(s)?d(s,o,n,h.thatReturnsArgument):null!=s&&(g.isValidElement(s)&&(s=g.cloneAndReplaceKey(s,a+(s!==t?r(s.key||"")+"/":"")+n)),o.push(s))}function d(e,t,n,o,a){var i="";null!=n&&(i=r(n)+"/");var d=l.getPooled(t,i,o,a);v(e,s,d),l.release(d)}function c(e,t,n){if(null==e)return e;var r=[];return d(e,r,null,t,n),r}function u(e,t,n){return null}function m(e,t){return v(e,u,null)}function p(e){var t=[];return d(e,t,null,h.thatReturnsArgument),t}var f=n(15),g=n(12),h=n(10),v=n(48),b=f.twoArgumentPooler,y=f.fourArgumentPooler,x=/\/(?!\/)/g;o.prototype.destructor=function(){this.func=null,this.context=null,this.count=0},f.addPoolingTo(o,b),l.prototype.destructor=function(){this.result=null,this.keyPrefix=null,this.func=null,this.context=null,this.count=0},f.addPoolingTo(l,y);var C={forEach:i,map:c,mapIntoWithKeyPrefixInternal:d,count:m,toArray:p};e.exports=C},function(e,t,n){(function(t){"use strict";function r(){T||(T=!0,"production"!==t.env.NODE_ENV?E(!1,"setProps(...) and replaceProps(...) are deprecated. Instead, call render again at the top level."):void 0)}function o(e,n,r){for(var o in n)n.hasOwnProperty(o)&&("production"!==t.env.NODE_ENV?E("function"==typeof n[o],"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",e.displayName||"ReactClass",h[r],o):void 0)}function a(e,n){var r=U.hasOwnProperty(n)?U[n]:null;_.hasOwnProperty(n)&&(r!==S.OVERRIDE_BASE?"production"!==t.env.NODE_ENV?x(!1,"ReactClassInterface: You are attempting to override `%s` from your class specification. Ensure that your method names do not overlap with React methods.",n):x(!1):void 0),e.hasOwnProperty(n)&&(r!==S.DEFINE_MANY&&r!==S.DEFINE_MANY_MERGED?"production"!==t.env.NODE_ENV?x(!1,"ReactClassInterface: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",n):x(!1):void 0)}function i(e,n){if(n){"function"==typeof n?"production"!==t.env.NODE_ENV?x(!1,"ReactClass: You're attempting to use a component class as a mixin. Instead, just use a regular object."):x(!1):void 0,f.isValidElement(n)?"production"!==t.env.NODE_ENV?x(!1,"ReactClass: You're attempting to use a component as a mixin. Instead, just use a regular object."):x(!1):void 0;var r=e.prototype;n.hasOwnProperty(w)&&I.mixins(e,n.mixins);for(var o in n)if(n.hasOwnProperty(o)&&o!==w){var i=n[o];if(a(r,o),I.hasOwnProperty(o))I[o](e,i);else{var l=U.hasOwnProperty(o),s=r.hasOwnProperty(o),u="function"==typeof i,m=u&&!l&&!s&&n.autobind!==!1;if(m)r.__reactAutoBindMap||(r.__reactAutoBindMap={}),r.__reactAutoBindMap[o]=i,r[o]=i;else if(s){var p=U[o];!l||p!==S.DEFINE_MANY_MERGED&&p!==S.DEFINE_MANY?"production"!==t.env.NODE_ENV?x(!1,"ReactClass: Unexpected spec policy %s for key %s when mixing in component specs.",p,o):x(!1):void 0,p===S.DEFINE_MANY_MERGED?r[o]=d(r[o],i):p===S.DEFINE_MANY&&(r[o]=c(r[o],i))}else r[o]=i,"production"!==t.env.NODE_ENV&&"function"==typeof i&&n.displayName&&(r[o].displayName=n.displayName+"_"+o)}}}}function l(e,n){if(n)for(var r in n){var o=n[r];if(n.hasOwnProperty(r)){var a=r in I;a?"production"!==t.env.NODE_ENV?x(!1,'ReactClass: You are attempting to define a reserved property, `%s`, that shouldn\'t be on the "statics" key. Define it as an instance property instead; it will still be accessible on the constructor.',r):x(!1):void 0;var i=r in e;i?"production"!==t.env.NODE_ENV?x(!1,"ReactClass: You are attempting to define `%s` on your component more than once. This conflict may be due to a mixin.",r):x(!1):void 0,e[r]=o}}}function s(e,n){e&&n&&"object"==typeof e&&"object"==typeof n?void 0:"production"!==t.env.NODE_ENV?x(!1,"mergeIntoWithNoDuplicateKeys(): Cannot merge non-objects."):x(!1);for(var r in n)n.hasOwnProperty(r)&&(void 0!==e[r]?"production"!==t.env.NODE_ENV?x(!1,"mergeIntoWithNoDuplicateKeys(): Tried to merge two objects with the same key: `%s`. This conflict may be due to a mixin; in particular, this may be caused by two getInitialState() or getDefaultProps() methods returning objects with clashing keys.",r):x(!1):void 0,e[r]=n[r]);return e}function d(e,t){return function(){var n=e.apply(this,arguments),r=t.apply(this,arguments);if(null==n)return r;if(null==r)return n;var o={};return s(o,n),s(o,r),o}}function c(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function u(e,n){var r=n.bind(e);if("production"!==t.env.NODE_ENV){r.__reactBoundContext=e,r.__reactBoundMethod=n,r.__reactBoundArguments=null;var o=e.constructor.displayName,a=r.bind;r.bind=function(i){for(var l=arguments.length,s=Array(l>1?l-1:0),d=1;l>d;d++)s[d-1]=arguments[d];if(i!==e&&null!==i)"production"!==t.env.NODE_ENV?E(!1,"bind(): React component methods may only be bound to the component instance. See %s",o):void 0;else if(!s.length)return"production"!==t.env.NODE_ENV?E(!1,"bind(): You are binding a component method to the component. React does this for you automatically in a high-performance way, so you can safely remove this call. See %s",o):void 0,r;var c=a.apply(r,arguments);return c.__reactBoundContext=e,c.__reactBoundMethod=n,c.__reactBoundArguments=s,c}}return r}function m(e){for(var t in e.__reactAutoBindMap)if(e.__reactAutoBindMap.hasOwnProperty(t)){var n=e.__reactAutoBindMap[t];e[t]=u(e,n)}}var p=n(109),f=n(12),g=n(37),h=n(36),v=n(66),b=n(4),y=n(27),x=n(2),C=n(28),N=n(13),E=n(3),w=N({mixins:null}),S=C({DEFINE_ONCE:null,DEFINE_MANY:null,OVERRIDE_BASE:null,DEFINE_MANY_MERGED:null}),k=[],T=!1,U={mixins:S.DEFINE_MANY,statics:S.DEFINE_MANY,propTypes:S.DEFINE_MANY,contextTypes:S.DEFINE_MANY,childContextTypes:S.DEFINE_MANY,getDefaultProps:S.DEFINE_MANY_MERGED,getInitialState:S.DEFINE_MANY_MERGED,getChildContext:S.DEFINE_MANY_MERGED,render:S.DEFINE_ONCE,componentWillMount:S.DEFINE_MANY,componentDidMount:S.DEFINE_MANY,componentWillReceiveProps:S.DEFINE_MANY,shouldComponentUpdate:S.DEFINE_ONCE,componentWillUpdate:S.DEFINE_MANY,componentDidUpdate:S.DEFINE_MANY,componentWillUnmount:S.DEFINE_MANY,updateComponent:S.OVERRIDE_BASE},I={displayName:function(e,t){e.displayName=t;
},mixins:function(e,t){if(t)for(var n=0;n<t.length;n++)i(e,t[n])},childContextTypes:function(e,n){"production"!==t.env.NODE_ENV&&o(e,n,g.childContext),e.childContextTypes=b({},e.childContextTypes,n)},contextTypes:function(e,n){"production"!==t.env.NODE_ENV&&o(e,n,g.context),e.contextTypes=b({},e.contextTypes,n)},getDefaultProps:function(e,t){e.getDefaultProps?e.getDefaultProps=d(e.getDefaultProps,t):e.getDefaultProps=t},propTypes:function(e,n){"production"!==t.env.NODE_ENV&&o(e,n,g.prop),e.propTypes=b({},e.propTypes,n)},statics:function(e,t){l(e,t)},autobind:function(){}},_={replaceState:function(e,t){this.updater.enqueueReplaceState(this,e),t&&this.updater.enqueueCallback(this,t)},isMounted:function(){return this.updater.isMounted(this)},setProps:function(e,n){"production"!==t.env.NODE_ENV&&r(),this.updater.enqueueSetProps(this,e),n&&this.updater.enqueueCallback(this,n)},replaceProps:function(e,n){"production"!==t.env.NODE_ENV&&r(),this.updater.enqueueReplaceProps(this,e),n&&this.updater.enqueueCallback(this,n)}},R=function(){};b(R.prototype,p.prototype,_);var B={createClass:function(e){var n=function(e,r,o){"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?E(this instanceof n,"Something is calling a React component directly. Use a factory or JSX instead. See: https://fb.me/react-legacyfactory"):void 0),this.__reactAutoBindMap&&m(this),this.props=e,this.context=r,this.refs=y,this.updater=o||v,this.state=null;var a=this.getInitialState?this.getInitialState():null;"production"!==t.env.NODE_ENV&&"undefined"==typeof a&&this.getInitialState._isMockFunction&&(a=null),"object"!=typeof a||Array.isArray(a)?"production"!==t.env.NODE_ENV?x(!1,"%s.getInitialState(): must return an object or null",n.displayName||"ReactCompositeComponent"):x(!1):void 0,this.state=a};n.prototype=new R,n.prototype.constructor=n,k.forEach(i.bind(null,n)),i(n,e),n.getDefaultProps&&(n.defaultProps=n.getDefaultProps()),"production"!==t.env.NODE_ENV&&(n.getDefaultProps&&(n.getDefaultProps.isReactClassApproved={}),n.prototype.getInitialState&&(n.prototype.getInitialState.isReactClassApproved={})),n.prototype.render?void 0:"production"!==t.env.NODE_ENV?x(!1,"createClass(...): Class specification must implement a `render` method."):x(!1),"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?E(!n.prototype.componentShouldUpdate,"%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",e.displayName||"A component"):void 0,"production"!==t.env.NODE_ENV?E(!n.prototype.componentWillRecieveProps,"%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",e.displayName||"A component"):void 0);for(var r in U)n.prototype[r]||(n.prototype[r]=null);return n},injection:{injectMixin:function(e){k.push(e)}}};e.exports=B}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e,t,n){this.props=e,this.context=t,this.refs=i,this.updater=n||o}var o=n(66),a=n(40),i=n(27),l=n(2),s=n(3);if(r.prototype.isReactComponent={},r.prototype.setState=function(e,n){"object"!=typeof e&&"function"!=typeof e&&null!=e?"production"!==t.env.NODE_ENV?l(!1,"setState(...): takes an object of state variables to update or a function which returns an object of state variables."):l(!1):void 0,"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?s(null!=e,"setState(...): You passed an undefined or null state object; instead, use forceUpdate()."):void 0),this.updater.enqueueSetState(this,e),n&&this.updater.enqueueCallback(this,n)},r.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this),e&&this.updater.enqueueCallback(this,e)},"production"!==t.env.NODE_ENV){var d={getDOMNode:["getDOMNode","Use ReactDOM.findDOMNode(component) instead."],isMounted:["isMounted","Instead, make sure to clean up subscriptions and pending requests in componentWillUnmount to prevent memory leaks."],replaceProps:["replaceProps","Instead, call render again at the top level."],replaceState:["replaceState","Refactor your code to use setState instead (see https://github.com/facebook/react/issues/3236)."],setProps:["setProps","Instead, call render again at the top level."]},c=function(e,n){a&&Object.defineProperty(r.prototype,e,{get:function(){"production"!==t.env.NODE_ENV?s(!1,"%s(...) is deprecated in plain JavaScript React classes. %s",n[0],n[1]):void 0}})};for(var u in d)d.hasOwnProperty(u)&&c(u,d[u])}e.exports=r}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" Check the render method of `"+n+"`."}return""}function o(e){}var a=n(34),i=n(11),l=n(12),s=n(21),d=n(7),c=n(37),u=n(36),m=n(16),p=n(38),f=n(4),g=n(27),h=n(2),v=n(47),b=n(3);o.prototype.render=function(){var e=s.get(this)._currentElement.type;return e(this.props,this.context,this.updater)};var y=1,x={construct:function(e){this._currentElement=e,this._rootNodeID=null,this._instance=null,this._pendingElement=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._renderedComponent=null,this._context=null,this._mountOrder=0,this._topLevelWrapper=null,this._pendingCallbacks=null},mountComponent:function(e,n,r){this._context=r,this._mountOrder=y++,this._rootNodeID=e;var a,d,c=this._processProps(this._currentElement.props),u=this._processContext(r),f=this._currentElement.type,v="prototype"in f;if(v)if("production"!==t.env.NODE_ENV){i.current=this;try{a=new f(c,u,p)}finally{i.current=null}}else a=new f(c,u,p);v&&null!==a&&a!==!1&&!l.isValidElement(a)||(d=a,a=new o(f)),"production"!==t.env.NODE_ENV&&(null==a.render?"production"!==t.env.NODE_ENV?b(!1,"%s(...): No `render` method found on the returned component instance: you may have forgotten to define `render`, returned null/false from a stateless component, or tried to render an element whose type is a function that isn't a React component.",f.displayName||f.name||"Component"):void 0:"production"!==t.env.NODE_ENV?b(f.prototype&&f.prototype.isReactComponent||!v||!(a instanceof f),"%s(...): React component classes must extend React.Component.",f.displayName||f.name||"Component"):void 0),a.props=c,a.context=u,a.refs=g,a.updater=p,this._instance=a,s.set(a,this),"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?b(!a.getInitialState||a.getInitialState.isReactClassApproved,"getInitialState was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Did you mean to define a state property instead?",this.getName()||"a component"):void 0,"production"!==t.env.NODE_ENV?b(!a.getDefaultProps||a.getDefaultProps.isReactClassApproved,"getDefaultProps was defined on %s, a plain JavaScript class. This is only supported for classes created using React.createClass. Use a static property to define defaultProps instead.",this.getName()||"a component"):void 0,"production"!==t.env.NODE_ENV?b(!a.propTypes,"propTypes was defined as an instance property on %s. Use a static property to define propTypes instead.",this.getName()||"a component"):void 0,"production"!==t.env.NODE_ENV?b(!a.contextTypes,"contextTypes was defined as an instance property on %s. Use a static property to define contextTypes instead.",this.getName()||"a component"):void 0,"production"!==t.env.NODE_ENV?b("function"!=typeof a.componentShouldUpdate,"%s has a method called componentShouldUpdate(). Did you mean shouldComponentUpdate()? The name is phrased as a question because the function is expected to return a value.",this.getName()||"A component"):void 0,"production"!==t.env.NODE_ENV?b("function"!=typeof a.componentDidUnmount,"%s has a method called componentDidUnmount(). But there is no such lifecycle method. Did you mean componentWillUnmount()?",this.getName()||"A component"):void 0,"production"!==t.env.NODE_ENV?b("function"!=typeof a.componentWillRecieveProps,"%s has a method called componentWillRecieveProps(). Did you mean componentWillReceiveProps()?",this.getName()||"A component"):void 0);var x=a.state;void 0===x&&(a.state=x=null),"object"!=typeof x||Array.isArray(x)?"production"!==t.env.NODE_ENV?h(!1,"%s.state: must be set to an object or null",this.getName()||"ReactCompositeComponent"):h(!1):void 0,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,a.componentWillMount&&(a.componentWillMount(),this._pendingStateQueue&&(a.state=this._processPendingState(a.props,a.context))),void 0===d&&(d=this._renderValidatedComponent()),this._renderedComponent=this._instantiateReactComponent(d);var C=m.mountComponent(this._renderedComponent,e,n,this._processChildContext(r));return a.componentDidMount&&n.getReactMountReady().enqueue(a.componentDidMount,a),C},unmountComponent:function(){var e=this._instance;e.componentWillUnmount&&e.componentWillUnmount(),m.unmountComponent(this._renderedComponent),this._renderedComponent=null,this._instance=null,this._pendingStateQueue=null,this._pendingReplaceState=!1,this._pendingForceUpdate=!1,this._pendingCallbacks=null,this._pendingElement=null,this._context=null,this._rootNodeID=null,this._topLevelWrapper=null,s.remove(e)},_maskContext:function(e){var t=null,n=this._currentElement.type,r=n.contextTypes;if(!r)return g;t={};for(var o in r)t[o]=e[o];return t},_processContext:function(e){var n=this._maskContext(e);if("production"!==t.env.NODE_ENV){var r=this._currentElement.type;r.contextTypes&&this._checkPropTypes(r.contextTypes,n,c.context)}return n},_processChildContext:function(e){var n=this._currentElement.type,r=this._instance,o=r.getChildContext&&r.getChildContext();if(o){"object"!=typeof n.childContextTypes?"production"!==t.env.NODE_ENV?h(!1,"%s.getChildContext(): childContextTypes must be defined in order to use getChildContext().",this.getName()||"ReactCompositeComponent"):h(!1):void 0,"production"!==t.env.NODE_ENV&&this._checkPropTypes(n.childContextTypes,o,c.childContext);for(var a in o)a in n.childContextTypes?void 0:"production"!==t.env.NODE_ENV?h(!1,'%s.getChildContext(): key "%s" is not defined in childContextTypes.',this.getName()||"ReactCompositeComponent",a):h(!1);return f({},e,o)}return e},_processProps:function(e){if("production"!==t.env.NODE_ENV){var n=this._currentElement.type;n.propTypes&&this._checkPropTypes(n.propTypes,e,c.prop)}return e},_checkPropTypes:function(e,n,o){var a=this.getName();for(var i in e)if(e.hasOwnProperty(i)){var l;try{"function"!=typeof e[i]?"production"!==t.env.NODE_ENV?h(!1,"%s: %s type `%s` is invalid; it must be a function, usually from React.PropTypes.",a||"React class",u[o],i):h(!1):void 0,l=e[i](n,i,a,o)}catch(s){l=s}if(l instanceof Error){var d=r(this);o===c.prop?"production"!==t.env.NODE_ENV?b(!1,"Failed Composite propType: %s%s",l.message,d):void 0:"production"!==t.env.NODE_ENV?b(!1,"Failed Context Types: %s%s",l.message,d):void 0}}},receiveComponent:function(e,t,n){var r=this._currentElement,o=this._context;this._pendingElement=null,this.updateComponent(t,r,e,o,n)},performUpdateIfNecessary:function(e){null!=this._pendingElement&&m.receiveComponent(this,this._pendingElement||this._currentElement,e,this._context),(null!==this._pendingStateQueue||this._pendingForceUpdate)&&this.updateComponent(e,this._currentElement,this._currentElement,this._context,this._context)},updateComponent:function(e,n,r,o,a){var i,l=this._instance,s=this._context===a?l.context:this._processContext(a);n===r?i=r.props:(i=this._processProps(r.props),l.componentWillReceiveProps&&l.componentWillReceiveProps(i,s));var d=this._processPendingState(i,s),c=this._pendingForceUpdate||!l.shouldComponentUpdate||l.shouldComponentUpdate(i,d,s);"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?b("undefined"!=typeof c,"%s.shouldComponentUpdate(): Returned undefined instead of a boolean value. Make sure to return true or false.",this.getName()||"ReactCompositeComponent"):void 0),c?(this._pendingForceUpdate=!1,this._performComponentUpdate(r,i,d,s,e,a)):(this._currentElement=r,this._context=a,l.props=i,l.state=d,l.context=s)},_processPendingState:function(e,t){var n=this._instance,r=this._pendingStateQueue,o=this._pendingReplaceState;if(this._pendingReplaceState=!1,this._pendingStateQueue=null,!r)return n.state;if(o&&1===r.length)return r[0];for(var a=f({},o?r[0]:n.state),i=o?1:0;i<r.length;i++){var l=r[i];f(a,"function"==typeof l?l.call(n,a,e,t):l)}return a},_performComponentUpdate:function(e,t,n,r,o,a){var i,l,s,d=this._instance,c=Boolean(d.componentDidUpdate);c&&(i=d.props,l=d.state,s=d.context),d.componentWillUpdate&&d.componentWillUpdate(t,n,r),this._currentElement=e,this._context=a,d.props=t,d.state=n,d.context=r,this._updateRenderedComponent(o,a),c&&o.getReactMountReady().enqueue(d.componentDidUpdate.bind(d,i,l,s),d)},_updateRenderedComponent:function(e,t){var n=this._renderedComponent,r=n._currentElement,o=this._renderValidatedComponent();if(v(r,o))m.receiveComponent(n,o,e,this._processChildContext(t));else{var a=this._rootNodeID,i=n._rootNodeID;m.unmountComponent(n),this._renderedComponent=this._instantiateReactComponent(o);var l=m.mountComponent(this._renderedComponent,a,e,this._processChildContext(t));this._replaceNodeWithMarkupByID(i,l)}},_replaceNodeWithMarkupByID:function(e,t){a.replaceNodeWithMarkupByID(e,t)},_renderValidatedComponentWithoutOwnerOrContext:function(){var e=this._instance,n=e.render();return"production"!==t.env.NODE_ENV&&"undefined"==typeof n&&e.render._isMockFunction&&(n=null),n},_renderValidatedComponent:function(){var e;i.current=this;try{e=this._renderValidatedComponentWithoutOwnerOrContext()}finally{i.current=null}return null===e||e===!1||l.isValidElement(e)?void 0:"production"!==t.env.NODE_ENV?h(!1,"%s.render(): A valid ReactComponent must be returned. You may have returned undefined, an array or some other invalid object.",this.getName()||"ReactCompositeComponent"):h(!1),e},attachRef:function(e,n){var r=this.getPublicInstance();null==r?"production"!==t.env.NODE_ENV?h(!1,"Stateless function components cannot have refs."):h(!1):void 0;var o=n.getPublicInstance();if("production"!==t.env.NODE_ENV){var a=n&&n.getName?n.getName():"a component";"production"!==t.env.NODE_ENV?b(null!=o,'Stateless function components cannot be given refs (See ref "%s" in %s created by %s). Attempts to access this ref will fail.',e,a,this.getName()):void 0}var i=r.refs===g?r.refs={}:r.refs;i[e]=o},detachRef:function(e){var t=this.getPublicInstance().refs;delete t[e]},getName:function(){var e=this._currentElement.type,t=this._instance&&this._instance.constructor;return e.displayName||t&&t.displayName||e.name||t&&t.name||null},getPublicInstance:function(){var e=this._instance;return e instanceof o?null:e},_instantiateReactComponent:null};d.measureMethods(x,"ReactCompositeComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent",_renderValidatedComponent:"_renderValidatedComponent"});var C={Mixin:x};e.exports=C}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(11),o=n(59),a=n(119),i=n(20),l=n(6),s=n(7),d=n(16),c=n(8),u=n(131),m=n(41),p=n(150),f=n(3);a.inject();var g=s.measure("React","render",l.render),h={findDOMNode:m,render:g,unmountComponentAtNode:l.unmountComponentAtNode,version:u,unstable_batchedUpdates:c.batchedUpdates,unstable_renderSubtreeIntoContainer:p};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.inject&&__REACT_DEVTOOLS_GLOBAL_HOOK__.inject({CurrentOwner:r,InstanceHandles:i,Mount:l,Reconciler:d,TextComponent:o}),"production"!==t.env.NODE_ENV){var v=n(5);if(v.canUseDOM&&window.top===window.self){"undefined"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&(navigator.userAgent.indexOf("Chrome")>-1&&-1===navigator.userAgent.indexOf("Edge")||navigator.userAgent.indexOf("Firefox")>-1)&&console.debug("Download the React DevTools for a better development experience: https://fb.me/react-devtools");var b=document.documentMode&&document.documentMode<8;"production"!==t.env.NODE_ENV?f(!b,'Internet Explorer is running in compatibility mode; please add the following tag to your HTML to prevent this from happening: <meta http-equiv="X-UA-Compatible" content="IE=edge" />'):void 0;for(var y=[Array.isArray,Array.prototype.every,Array.prototype.forEach,Array.prototype.indexOf,Array.prototype.map,Date.now,Function.prototype.bind,Object.keys,String.prototype.split,String.prototype.trim,Object.create,Object.freeze],x=0;x<y.length;x++)if(!y[x]){console.error("One or more ES5 shim/shams expected by React are not available: https://fb.me/react-warning-polyfills");break}}}e.exports=h}).call(t,n(1))},function(e,t){"use strict";var n={onClick:!0,onDoubleClick:!0,onMouseDown:!0,onMouseMove:!0,onMouseUp:!0,onClickCapture:!0,onDoubleClickCapture:!0,onMouseDownCapture:!0,onMouseMoveCapture:!0,onMouseUpCapture:!0},r={getNativeProps:function(e,t,r){if(!t.disabled)return t;var o={};for(var a in t)t.hasOwnProperty(a)&&!n[a]&&(o[a]=t[a]);return o}};e.exports=r},function(e,t,n){(function(t){"use strict";function r(e){if(e){var t=e._currentElement._owner||null;if(t){var n=t.getName();if(n)return" This DOM node was rendered by `"+n+"`."}}return""}function o(){if("production"!==t.env.NODE_ENV){var e=this._reactInternalComponent;"production"!==t.env.NODE_ENV?Y(!1,"ReactDOMComponent: Do not access .getDOMNode() of a DOM node; instead, use the node directly.%s",r(e)):void 0}return this}function a(){var e=this._reactInternalComponent;return"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?Y(!1,"ReactDOMComponent: Do not access .isMounted() of a DOM node.%s",r(e)):void 0),!!e}function i(){if("production"!==t.env.NODE_ENV){var e=this._reactInternalComponent;"production"!==t.env.NODE_ENV?Y(!1,"ReactDOMComponent: Do not access .setState(), .replaceState(), or .forceUpdate() of a DOM node. This is a no-op.%s",r(e)):void 0}}function l(e,n){var o=this._reactInternalComponent;"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?Y(!1,"ReactDOMComponent: Do not access .setProps() of a DOM node. Instead, call ReactDOM.render again at the top level.%s",r(o)):void 0),o&&(L.enqueueSetPropsInternal(o,e),n&&L.enqueueCallbackInternal(o,n))}function s(e,n){var o=this._reactInternalComponent;"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?Y(!1,"ReactDOMComponent: Do not access .replaceProps() of a DOM node. Instead, call ReactDOM.render again at the top level.%s",r(o)):void 0),o&&(L.enqueueReplacePropsInternal(o,e),n&&L.enqueueCallbackInternal(o,n))}function d(e){if("object"==typeof e){if(Array.isArray(e))return"["+e.map(d).join(", ")+"]";var t=[];for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=/^[a-z$_][\w$_]*$/i.test(n)?n:JSON.stringify(n);t.push(r+": "+d(e[n]))}return"{"+t.join(", ")+"}"}return"string"==typeof e?JSON.stringify(e):"function"==typeof e?"[function object]":String(e)}function c(e,n,r){if(null!=e&&null!=n&&!$(e,n)){var o,a=r._tag,i=r._currentElement._owner;i&&(o=i.getName());var l=o+"|"+a;re.hasOwnProperty(l)||(re[l]=!0,"production"!==t.env.NODE_ENV?Y(!1,"`%s` was passed a style object that has previously been mutated. Mutating `style` is deprecated. Consider cloning it beforehand. Check the `render` %s. Previous style: %s. Mutated style: %s.",a,i?"of `"+o+"`":"using <"+a+">",d(e),d(n)):void 0)}}function u(e,n){n&&("production"!==t.env.NODE_ENV&&le[e._tag]&&("production"!==t.env.NODE_ENV?Y(null==n.children&&null==n.dangerouslySetInnerHTML,"%s is a void element tag and must not have `children` or use `props.dangerouslySetInnerHTML`.%s",e._tag,e._currentElement._owner?" Check the render method of "+e._currentElement._owner.getName()+".":""):void 0),null!=n.dangerouslySetInnerHTML&&(null!=n.children?"production"!==t.env.NODE_ENV?V(!1,"Can only set one of `children` or `props.dangerouslySetInnerHTML`."):V(!1):void 0,"object"==typeof n.dangerouslySetInnerHTML&&te in n.dangerouslySetInnerHTML?void 0:"production"!==t.env.NODE_ENV?V(!1,"`props.dangerouslySetInnerHTML` must be in the form `{__html: ...}`. Please visit https://fb.me/react-invariant-dangerously-set-inner-html for more information."):V(!1)),"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?Y(null==n.innerHTML,"Directly setting property `innerHTML` is not permitted. For more information, lookup documentation on `dangerouslySetInnerHTML`."):void 0,"production"!==t.env.NODE_ENV?Y(!n.contentEditable||null==n.children,"A component is `contentEditable` and contains `children` managed by React. It is now your responsibility to guarantee that none of those nodes are unexpectedly modified or duplicated. This is probably not intentional."):void 0),null!=n.style&&"object"!=typeof n.style?"production"!==t.env.NODE_ENV?V(!1,"The `style` prop expects a mapping from style properties to values, not a string. For example, style={{marginRight: spacing + 'em'}} when using JSX.%s",r(e)):V(!1):void 0)}function m(e,n,r,o){"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?Y("onScroll"!==n||H("scroll",!0),"This browser doesn't support the `onScroll` event"):void 0);var a=O.findReactContainerForID(e);if(a){var i=a.nodeType===ne?a.ownerDocument:a;G(n,i)}o.getReactMountReady().enqueue(p,{id:e,registrationName:n,listener:r})}function p(){var e=this;T.putListener(e.id,e.registrationName,e.listener)}function f(){var e=this;e._rootNodeID?void 0:"production"!==t.env.NODE_ENV?V(!1,"Must be mounted to trap events"):V(!1);var n=O.getNode(e._rootNodeID);switch(n?void 0:"production"!==t.env.NODE_ENV?V(!1,"trapBubbledEvent(...): Requires node to be rendered."):V(!1),e._tag){case"iframe":e._wrapperState.listeners=[T.trapBubbledEvent(k.topLevelTypes.topLoad,"load",n)];break;case"video":case"audio":e._wrapperState.listeners=[];for(var r in oe)oe.hasOwnProperty(r)&&e._wrapperState.listeners.push(T.trapBubbledEvent(k.topLevelTypes[r],oe[r],n));break;case"img":e._wrapperState.listeners=[T.trapBubbledEvent(k.topLevelTypes.topError,"error",n),T.trapBubbledEvent(k.topLevelTypes.topLoad,"load",n)];break;case"form":e._wrapperState.listeners=[T.trapBubbledEvent(k.topLevelTypes.topReset,"reset",n),T.trapBubbledEvent(k.topLevelTypes.topSubmit,"submit",n)]}}function g(){_.mountReadyWrapper(this)}function h(){B.postUpdateWrapper(this)}function v(e){ce.call(de,e)||(se.test(e)?void 0:"production"!==t.env.NODE_ENV?V(!1,"Invalid tag: %s",e):V(!1),de[e]=!0)}function b(e,t){e=M({},e);var n=e[K.ancestorInfoContextKey];return e[K.ancestorInfoContextKey]=K.updatedAncestorInfo(n,t._tag,t),e}function y(e,t){return e.indexOf("-")>=0||null!=t.is}function x(e){v(e),this._tag=e.toLowerCase(),this._renderedChildren=null,this._previousStyle=null,this._previousStyleCopy=null,this._rootNodeID=null,this._wrapperState=null,this._topLevelWrapper=null,this._nodeWithLegacyProperties=null,"production"!==t.env.NODE_ENV&&(this._unprocessedContextDev=null,this._processedContextDev=null)}var C,N=n(94),E=n(96),w=n(14),S=n(31),k=n(9),T=n(23),U=n(33),I=n(112),_=n(114),R=n(115),B=n(58),D=n(117),O=n(6),A=n(126),P=n(7),L=n(38),M=n(4),j=n(40),F=n(25),V=n(2),H=n(45),q=n(13),W=n(26),z=n(46),$=n(80),K=n(49),Y=n(3),X=T.deleteListener,G=T.listenTo,Z=T.registrationNameModules,J={string:!0,number:!0},Q=q({children:null}),ee=q({style:null}),te=q({__html:null}),ne=1;"production"!==t.env.NODE_ENV&&(C={props:{enumerable:!1,get:function(){var e=this._reactInternalComponent;return"production"!==t.env.NODE_ENV?Y(!1,"ReactDOMComponent: Do not access .props of a DOM node; instead, recreate the props as `render` did originally or read the DOM properties/attributes directly from this node (e.g., this.refs.box.className).%s",r(e)):void 0,e._currentElement.props}}});var re={},oe={topAbort:"abort",topCanPlay:"canplay",topCanPlayThrough:"canplaythrough",topDurationChange:"durationchange",topEmptied:"emptied",topEncrypted:"encrypted",topEnded:"ended",topError:"error",topLoadedData:"loadeddata",topLoadedMetadata:"loadedmetadata",topLoadStart:"loadstart",topPause:"pause",topPlay:"play",topPlaying:"playing",topProgress:"progress",topRateChange:"ratechange",topSeeked:"seeked",topSeeking:"seeking",topStalled:"stalled",topSuspend:"suspend",topTimeUpdate:"timeupdate",topVolumeChange:"volumechange",topWaiting:"waiting"},ae={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},ie={listing:!0,pre:!0,textarea:!0},le=M({menuitem:!0},ae),se=/^[a-zA-Z][a-zA-Z:_\.\-\d]*$/,de={},ce={}.hasOwnProperty;x.displayName="ReactDOMComponent",x.Mixin={construct:function(e){this._currentElement=e},mountComponent:function(e,n,r){this._rootNodeID=e;var o=this._currentElement.props;switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":this._wrapperState={listeners:null},n.getReactMountReady().enqueue(f,this);break;case"button":o=I.getNativeProps(this,o,r);break;case"input":_.mountWrapper(this,o,r),o=_.getNativeProps(this,o,r);break;case"option":R.mountWrapper(this,o,r),o=R.getNativeProps(this,o,r);break;case"select":B.mountWrapper(this,o,r),o=B.getNativeProps(this,o,r),r=B.processChildContext(this,o,r);break;case"textarea":D.mountWrapper(this,o,r),o=D.getNativeProps(this,o,r)}u(this,o),"production"!==t.env.NODE_ENV&&r[K.ancestorInfoContextKey]&&K(this._tag,this,r[K.ancestorInfoContextKey]),"production"!==t.env.NODE_ENV&&(this._unprocessedContextDev=r,this._processedContextDev=b(r,this),r=this._processedContextDev);var a;if(n.useCreateElement){var i=r[O.ownerDocumentContextKey],l=i.createElement(this._currentElement.type);S.setAttributeForID(l,this._rootNodeID),O.getID(l),this._updateDOMProperties({},o,n,l),this._createInitialChildren(n,o,r,l),a=l}else{var s=this._createOpenTagMarkupAndPutListeners(n,o),d=this._createContentMarkup(n,o,r);a=!d&&ae[this._tag]?s+"/>":s+">"+d+"</"+this._currentElement.type+">"}switch(this._tag){case"input":n.getReactMountReady().enqueue(g,this);case"button":case"select":case"textarea":o.autoFocus&&n.getReactMountReady().enqueue(N.focusDOMComponent,this)}return a},_createOpenTagMarkupAndPutListeners:function(e,n){var r="<"+this._currentElement.type;for(var o in n)if(n.hasOwnProperty(o)){var a=n[o];if(null!=a)if(Z.hasOwnProperty(o))a&&m(this._rootNodeID,o,a,e);else{o===ee&&(a&&("production"!==t.env.NODE_ENV&&(this._previousStyle=a),a=this._previousStyleCopy=M({},n.style)),a=E.createMarkupForStyles(a));var i=null;null!=this._tag&&y(this._tag,n)?o!==Q&&(i=S.createMarkupForCustomAttribute(o,a)):i=S.createMarkupForProperty(o,a),i&&(r+=" "+i)}}if(e.renderToStaticMarkup)return r;var l=S.createMarkupForID(this._rootNodeID);return r+" "+l},_createContentMarkup:function(e,t,n){var r="",o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&(r=o.__html);else{var a=J[typeof t.children]?t.children:null,i=null!=a?null:t.children;if(null!=a)r=F(a);else if(null!=i){var l=this.mountChildren(i,e,n);r=l.join("")}}return ie[this._tag]&&"\n"===r.charAt(0)?"\n"+r:r},_createInitialChildren:function(e,t,n,r){var o=t.dangerouslySetInnerHTML;if(null!=o)null!=o.__html&&W(r,o.__html);else{var a=J[typeof t.children]?t.children:null,i=null!=a?null:t.children;if(null!=a)z(r,a);else if(null!=i)for(var l=this.mountChildren(i,e,n),s=0;s<l.length;s++)r.appendChild(l[s])}},receiveComponent:function(e,t,n){var r=this._currentElement;this._currentElement=e,this.updateComponent(t,r,e,n)},updateComponent:function(e,n,r,o){var a=n.props,i=this._currentElement.props;switch(this._tag){case"button":a=I.getNativeProps(this,a),i=I.getNativeProps(this,i);break;case"input":_.updateWrapper(this),a=_.getNativeProps(this,a),i=_.getNativeProps(this,i);break;case"option":a=R.getNativeProps(this,a),i=R.getNativeProps(this,i);break;case"select":a=B.getNativeProps(this,a),i=B.getNativeProps(this,i);break;case"textarea":D.updateWrapper(this),a=D.getNativeProps(this,a),i=D.getNativeProps(this,i)}"production"!==t.env.NODE_ENV&&(this._unprocessedContextDev!==o&&(this._unprocessedContextDev=o,this._processedContextDev=b(o,this)),o=this._processedContextDev),u(this,i),this._updateDOMProperties(a,i,e,null),this._updateDOMChildren(a,i,e,o),!j&&this._nodeWithLegacyProperties&&(this._nodeWithLegacyProperties.props=i),"select"===this._tag&&e.getReactMountReady().enqueue(h,this)},_updateDOMProperties:function(e,n,r,o){var a,i,l;for(a in e)if(!n.hasOwnProperty(a)&&e.hasOwnProperty(a))if(a===ee){var s=this._previousStyleCopy;for(i in s)s.hasOwnProperty(i)&&(l=l||{},l[i]="");this._previousStyleCopy=null}else Z.hasOwnProperty(a)?e[a]&&X(this._rootNodeID,a):(w.properties[a]||w.isCustomAttribute(a))&&(o||(o=O.getNode(this._rootNodeID)),S.deleteValueForProperty(o,a));for(a in n){var d=n[a],u=a===ee?this._previousStyleCopy:e[a];if(n.hasOwnProperty(a)&&d!==u)if(a===ee)if(d?("production"!==t.env.NODE_ENV&&(c(this._previousStyleCopy,this._previousStyle,this),this._previousStyle=d),d=this._previousStyleCopy=M({},d)):this._previousStyleCopy=null,u){for(i in u)!u.hasOwnProperty(i)||d&&d.hasOwnProperty(i)||(l=l||{},l[i]="");for(i in d)d.hasOwnProperty(i)&&u[i]!==d[i]&&(l=l||{},l[i]=d[i])}else l=d;else Z.hasOwnProperty(a)?d?m(this._rootNodeID,a,d,r):u&&X(this._rootNodeID,a):y(this._tag,n)?(o||(o=O.getNode(this._rootNodeID)),a===Q&&(d=null),S.setValueForAttribute(o,a,d)):(w.properties[a]||w.isCustomAttribute(a))&&(o||(o=O.getNode(this._rootNodeID)),null!=d?S.setValueForProperty(o,a,d):S.deleteValueForProperty(o,a))}l&&(o||(o=O.getNode(this._rootNodeID)),E.setValueForStyles(o,l))},_updateDOMChildren:function(e,t,n,r){var o=J[typeof e.children]?e.children:null,a=J[typeof t.children]?t.children:null,i=e.dangerouslySetInnerHTML&&e.dangerouslySetInnerHTML.__html,l=t.dangerouslySetInnerHTML&&t.dangerouslySetInnerHTML.__html,s=null!=o?null:e.children,d=null!=a?null:t.children,c=null!=o||null!=i,u=null!=a||null!=l;null!=s&&null==d?this.updateChildren(null,n,r):c&&!u&&this.updateTextContent(""),null!=a?o!==a&&this.updateTextContent(""+a):null!=l?i!==l&&this.updateMarkup(""+l):null!=d&&this.updateChildren(d,n,r)},unmountComponent:function(){switch(this._tag){case"iframe":case"img":case"form":case"video":case"audio":var e=this._wrapperState.listeners;if(e)for(var n=0;n<e.length;n++)e[n].remove();break;case"input":_.unmountWrapper(this);break;case"html":case"head":case"body":"production"!==t.env.NODE_ENV?V(!1,"<%s> tried to unmount. Because of cross-browser quirks it is impossible to unmount some top-level components (eg <html>, <head>, and <body>) reliably and efficiently. To fix this, have a single top-level component that never unmounts render these elements.",this._tag):V(!1)}if(this.unmountChildren(),T.deleteAllListeners(this._rootNodeID),U.unmountIDFromEnvironment(this._rootNodeID),this._rootNodeID=null,this._wrapperState=null,this._nodeWithLegacyProperties){var r=this._nodeWithLegacyProperties;r._reactInternalComponent=null,this._nodeWithLegacyProperties=null}},getPublicInstance:function(){if(!this._nodeWithLegacyProperties){var e=O.getNode(this._rootNodeID);e._reactInternalComponent=this,e.getDOMNode=o,e.isMounted=a,e.setState=i,e.replaceState=i,e.forceUpdate=i,e.setProps=l,e.replaceProps=s,"production"!==t.env.NODE_ENV&&j?Object.defineProperties(e,C):e.props=this._currentElement.props,this._nodeWithLegacyProperties=e}return this._nodeWithLegacyProperties}},P.measureMethods(x,"ReactDOMComponent",{mountComponent:"mountComponent",updateComponent:"updateComponent"}),M(x.prototype,x.Mixin,A.Mixin),e.exports=x}).call(t,n(1))},function(e,t,n){(function(t){"use strict";function r(){this._rootNodeID&&m.updateWrapper(this)}function o(e){var n=this._currentElement.props,o=i.executeOnChange(n,e);s.asap(r,this);var a=n.name;if("radio"===n.type&&null!=a){for(var d=l.getNode(this._rootNodeID),m=d;m.parentNode;)m=m.parentNode;for(var p=m.querySelectorAll("input[name="+JSON.stringify(""+a)+'][type="radio"]'),f=0;f<p.length;f++){var g=p[f];if(g!==d&&g.form===d.form){var h=l.getID(g);h?void 0:"production"!==t.env.NODE_ENV?c(!1,"ReactDOMInput: Mixing React and non-React radio inputs with the same `name` is not supported."):c(!1);var v=u[h];v?void 0:"production"!==t.env.NODE_ENV?c(!1,"ReactDOMInput: Unknown radio button ID %s.",h):c(!1),
s.asap(r,v)}}}return o}var a=n(35),i=n(32),l=n(6),s=n(8),d=n(4),c=n(2),u={},m={getNativeProps:function(e,t,n){var r=i.getValue(t),o=i.getChecked(t),a=d({},t,{defaultChecked:void 0,defaultValue:void 0,value:null!=r?r:e._wrapperState.initialValue,checked:null!=o?o:e._wrapperState.initialChecked,onChange:e._wrapperState.onChange});return a},mountWrapper:function(e,n){"production"!==t.env.NODE_ENV&&i.checkPropTypes("input",n,e._currentElement._owner);var r=n.defaultValue;e._wrapperState={initialChecked:n.defaultChecked||!1,initialValue:null!=r?r:null,onChange:o.bind(e)}},mountReadyWrapper:function(e){u[e._rootNodeID]=e},unmountWrapper:function(e){delete u[e._rootNodeID]},updateWrapper:function(e){var t=e._currentElement.props,n=t.checked;null!=n&&a.updatePropertyByID(e._rootNodeID,"checked",n||!1);var r=i.getValue(t);null!=r&&a.updatePropertyByID(e._rootNodeID,"value",""+r)}};e.exports=m}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(107),o=n(58),a=n(4),i=n(3),l=o.valueContextKey,s={mountWrapper:function(e,n,r){"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?i(null==n.selected,"Use the `defaultValue` or `value` props on <select> instead of setting `selected` on <option>."):void 0);var o=r[l],a=null;if(null!=o)if(a=!1,Array.isArray(o)){for(var s=0;s<o.length;s++)if(""+o[s]==""+n.value){a=!0;break}}else a=""+o==""+n.value;e._wrapperState={selected:a}},getNativeProps:function(e,n,o){var l=a({selected:void 0,children:void 0},n);null!=e._wrapperState.selected&&(l.selected=e._wrapperState.selected);var s="";return r.forEach(n.children,function(e){null!=e&&("string"==typeof e||"number"==typeof e?s+=e:"production"!==t.env.NODE_ENV?i(!1,"Only strings and numbers are supported as <option> children."):void 0)}),s&&(l.children=s),l}};e.exports=s}).call(t,n(1))},function(e,t,n){"use strict";function r(e,t,n,r){return e===n&&t===r}function o(e){var t=document.selection,n=t.createRange(),r=n.text.length,o=n.duplicate();o.moveToElementText(e),o.setEndPoint("EndToStart",n);var a=o.text.length,i=a+r;return{start:a,end:i}}function a(e){var t=window.getSelection&&window.getSelection();if(!t||0===t.rangeCount)return null;var n=t.anchorNode,o=t.anchorOffset,a=t.focusNode,i=t.focusOffset,l=t.getRangeAt(0);try{l.startContainer.nodeType,l.endContainer.nodeType}catch(s){return null}var d=r(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),c=d?0:l.toString().length,u=l.cloneRange();u.selectNodeContents(e),u.setEnd(l.startContainer,l.startOffset);var m=r(u.startContainer,u.startOffset,u.endContainer,u.endOffset),p=m?0:u.toString().length,f=p+c,g=document.createRange();g.setStart(n,o),g.setEnd(a,i);var h=g.collapsed;return{start:h?f:p,end:h?p:f}}function i(e,t){var n,r,o=document.selection.createRange().duplicate();"undefined"==typeof t.end?(n=t.start,r=n):t.start>t.end?(n=t.end,r=t.start):(n=t.start,r=t.end),o.moveToElementText(e),o.moveStart("character",n),o.setEndPoint("EndToStart",o),o.moveEnd("character",r-n),o.select()}function l(e,t){if(window.getSelection){var n=window.getSelection(),r=e[c()].length,o=Math.min(t.start,r),a="undefined"==typeof t.end?o:Math.min(t.end,r);if(!n.extend&&o>a){var i=a;a=o,o=i}var l=d(e,o),s=d(e,a);if(l&&s){var u=document.createRange();u.setStart(l.node,l.offset),n.removeAllRanges(),o>a?(n.addRange(u),n.extend(s.node,s.offset)):(u.setEnd(s.node,s.offset),n.addRange(u))}}}var s=n(5),d=n(148),c=n(72),u=s.canUseDOM&&"selection"in document&&!("getSelection"in window),m={getOffsets:u?o:a,setOffsets:u?i:l};e.exports=m},function(e,t,n){(function(t){"use strict";function r(){this._rootNodeID&&u.updateWrapper(this)}function o(e){var t=this._currentElement.props,n=a.executeOnChange(t,e);return l.asap(r,this),n}var a=n(32),i=n(35),l=n(8),s=n(4),d=n(2),c=n(3),u={getNativeProps:function(e,n,r){null!=n.dangerouslySetInnerHTML?"production"!==t.env.NODE_ENV?d(!1,"`dangerouslySetInnerHTML` does not make sense on <textarea>."):d(!1):void 0;var o=s({},n,{defaultValue:void 0,value:void 0,children:e._wrapperState.initialValue,onChange:e._wrapperState.onChange});return o},mountWrapper:function(e,n){"production"!==t.env.NODE_ENV&&a.checkPropTypes("textarea",n,e._currentElement._owner);var r=n.defaultValue,i=n.children;null!=i&&("production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?c(!1,"Use the `defaultValue` or `value` props instead of setting children on <textarea>."):void 0),null!=r?"production"!==t.env.NODE_ENV?d(!1,"If you supply `defaultValue` on a <textarea>, do not pass children."):d(!1):void 0,Array.isArray(i)&&(i.length<=1?void 0:"production"!==t.env.NODE_ENV?d(!1,"<textarea> can only have at most one child."):d(!1),i=i[0]),r=""+i),null==r&&(r="");var l=a.getValue(n);e._wrapperState={initialValue:""+(null!=l?l:r),onChange:o.bind(e)}},updateWrapper:function(e){var t=e._currentElement.props,n=a.getValue(t);null!=n&&i.updatePropertyByID(e._rootNodeID,"value",""+n)}};e.exports=u}).call(t,n(1))},function(e,t,n){"use strict";function r(){this.reinitializeTransaction()}var o=n(8),a=n(39),i=n(4),l=n(10),s={initialize:l,close:function(){m.isBatchingUpdates=!1}},d={initialize:l,close:o.flushBatchedUpdates.bind(o)},c=[d,s];i(r.prototype,a.Mixin,{getTransactionWrappers:function(){return c}});var u=new r,m={isBatchingUpdates:!1,batchedUpdates:function(e,t,n,r,o,a){var i=m.isBatchingUpdates;m.isBatchingUpdates=!0,i?e(t,n,r,o,a):u.perform(e,null,t,n,r,o,a)}};e.exports=m},function(e,t,n){(function(t){"use strict";function r(){if(!S&&(S=!0,v.EventEmitter.injectReactEventListener(h),v.EventPluginHub.injectEventPluginOrder(l),v.EventPluginHub.injectInstanceHandle(b),v.EventPluginHub.injectMount(y),v.EventPluginHub.injectEventPluginsByName({SimpleEventPlugin:E,EnterLeaveEventPlugin:s,ChangeEventPlugin:a,SelectEventPlugin:C,BeforeInputEventPlugin:o}),v.NativeComponent.injectGenericComponentClass(f),v.NativeComponent.injectTextComponentClass(g),v.Class.injectMixin(u),v.DOMProperty.injectDOMPropertyConfig(c),v.DOMProperty.injectDOMPropertyConfig(w),v.EmptyComponent.injectEmptyComponent("noscript"),v.Updates.injectReconcileTransaction(x),v.Updates.injectBatchingStrategy(p),v.RootIndex.injectCreateReactRootIndex(d.canUseDOM?i.createReactRootIndex:N.createReactRootIndex),v.Component.injectEnvironment(m),"production"!==t.env.NODE_ENV)){var e=d.canUseDOM&&window.location.href||"";if(/[?&]react_perf\b/.test(e)){var r=n(120);r.start()}}}var o=n(95),a=n(97),i=n(98),l=n(100),s=n(101),d=n(5),c=n(104),u=n(105),m=n(33),p=n(118),f=n(113),g=n(59),h=n(123),v=n(124),b=n(20),y=n(6),x=n(129),C=n(133),N=n(134),E=n(135),w=n(132),S=!1;e.exports={inject:r}}).call(t,n(1))},function(e,t,n){"use strict";function r(e){return Math.floor(100*e)/100}function o(e,t,n){e[t]=(e[t]||0)+n}var a=n(14),i=n(121),l=n(6),s=n(7),d=n(162),c={_allMeasurements:[],_mountStack:[0],_injected:!1,start:function(){c._injected||s.injection.injectMeasure(c.measure),c._allMeasurements.length=0,s.enableMeasure=!0},stop:function(){s.enableMeasure=!1},getLastMeasurements:function(){return c._allMeasurements},printExclusive:function(e){e=e||c._allMeasurements;var t=i.getExclusiveSummary(e);console.table(t.map(function(e){return{"Component class name":e.componentName,"Total inclusive time (ms)":r(e.inclusive),"Exclusive mount time (ms)":r(e.exclusive),"Exclusive render time (ms)":r(e.render),"Mount time per instance (ms)":r(e.exclusive/e.count),"Render time per instance (ms)":r(e.render/e.count),Instances:e.count}}))},printInclusive:function(e){e=e||c._allMeasurements;var t=i.getInclusiveSummary(e);console.table(t.map(function(e){return{"Owner > component":e.componentName,"Inclusive time (ms)":r(e.time),Instances:e.count}})),console.log("Total time:",i.getTotalTime(e).toFixed(2)+" ms")},getMeasurementsSummaryMap:function(e){var t=i.getInclusiveSummary(e,!0);return t.map(function(e){return{"Owner > component":e.componentName,"Wasted time (ms)":e.time,Instances:e.count}})},printWasted:function(e){e=e||c._allMeasurements,console.table(c.getMeasurementsSummaryMap(e)),console.log("Total time:",i.getTotalTime(e).toFixed(2)+" ms")},printDOM:function(e){e=e||c._allMeasurements;var t=i.getDOMSummary(e);console.table(t.map(function(e){var t={};return t[a.ID_ATTRIBUTE_NAME]=e.id,t.type=e.type,t.args=JSON.stringify(e.args),t})),console.log("Total time:",i.getTotalTime(e).toFixed(2)+" ms")},_recordWrite:function(e,t,n,r){var o=c._allMeasurements[c._allMeasurements.length-1].writes;o[e]=o[e]||[],o[e].push({type:t,time:n,args:r})},measure:function(e,t,n){return function(){for(var r=arguments.length,a=Array(r),i=0;r>i;i++)a[i]=arguments[i];var s,u,m;if("_renderNewRootComponent"===t||"flushBatchedUpdates"===t)return c._allMeasurements.push({exclusive:{},inclusive:{},render:{},counts:{},writes:{},displayNames:{},totalTime:0,created:{}}),m=d(),u=n.apply(this,a),c._allMeasurements[c._allMeasurements.length-1].totalTime=d()-m,u;if("_mountImageIntoNode"===t||"ReactBrowserEventEmitter"===e||"ReactDOMIDOperations"===e||"CSSPropertyOperations"===e||"DOMChildrenOperations"===e||"DOMPropertyOperations"===e){if(m=d(),u=n.apply(this,a),s=d()-m,"_mountImageIntoNode"===t){var p=l.getID(a[1]);c._recordWrite(p,t,s,a[0])}else if("dangerouslyProcessChildrenUpdates"===t)a[0].forEach(function(e){var t={};null!==e.fromIndex&&(t.fromIndex=e.fromIndex),null!==e.toIndex&&(t.toIndex=e.toIndex),null!==e.textContent&&(t.textContent=e.textContent),null!==e.markupIndex&&(t.markup=a[1][e.markupIndex]),c._recordWrite(e.parentID,e.type,s,t)});else{var f=a[0];"object"==typeof f&&(f=l.getID(a[0])),c._recordWrite(f,t,s,Array.prototype.slice.call(a,1))}return u}if("ReactCompositeComponent"!==e||"mountComponent"!==t&&"updateComponent"!==t&&"_renderValidatedComponent"!==t)return n.apply(this,a);if(this._currentElement.type===l.TopLevelWrapper)return n.apply(this,a);var g="mountComponent"===t?a[0]:this._rootNodeID,h="_renderValidatedComponent"===t,v="mountComponent"===t,b=c._mountStack,y=c._allMeasurements[c._allMeasurements.length-1];if(h?o(y.counts,g,1):v&&(y.created[g]=!0,b.push(0)),m=d(),u=n.apply(this,a),s=d()-m,h)o(y.render,g,s);else if(v){var x=b.pop();b[b.length-1]+=s,o(y.exclusive,g,s-x),o(y.inclusive,g,s)}else o(y.inclusive,g,s);return y.displayNames[g]={current:this.getName(),owner:this._currentElement._owner?this._currentElement._owner.getName():"<root>"},u}}};e.exports=c},function(e,t,n){"use strict";function r(e){for(var t=0,n=0;n<e.length;n++){var r=e[n];t+=r.totalTime}return t}function o(e){var t=[];return e.forEach(function(e){Object.keys(e.writes).forEach(function(n){e.writes[n].forEach(function(e){t.push({id:n,type:c[e.type]||e.type,args:e.args})})})}),t}function a(e){for(var t,n={},r=0;r<e.length;r++){var o=e[r],a=s({},o.exclusive,o.inclusive);for(var i in a)t=o.displayNames[i].current,n[t]=n[t]||{componentName:t,inclusive:0,exclusive:0,render:0,count:0},o.render[i]&&(n[t].render+=o.render[i]),o.exclusive[i]&&(n[t].exclusive+=o.exclusive[i]),o.inclusive[i]&&(n[t].inclusive+=o.inclusive[i]),o.counts[i]&&(n[t].count+=o.counts[i])}var l=[];for(t in n)n[t].exclusive>=d&&l.push(n[t]);return l.sort(function(e,t){return t.exclusive-e.exclusive}),l}function i(e,t){for(var n,r={},o=0;o<e.length;o++){var a,i=e[o],c=s({},i.exclusive,i.inclusive);t&&(a=l(i));for(var u in c)if(!t||a[u]){var m=i.displayNames[u];n=m.owner+" > "+m.current,r[n]=r[n]||{componentName:n,time:0,count:0},i.inclusive[u]&&(r[n].time+=i.inclusive[u]),i.counts[u]&&(r[n].count+=i.counts[u])}}var p=[];for(n in r)r[n].time>=d&&p.push(r[n]);return p.sort(function(e,t){return t.time-e.time}),p}function l(e){var t={},n=Object.keys(e.writes),r=s({},e.exclusive,e.inclusive);for(var o in r){for(var a=!1,i=0;i<n.length;i++)if(0===n[i].indexOf(o)){a=!0;break}e.created[o]&&(a=!0),!a&&e.counts[o]>0&&(t[o]=!0)}return t}var s=n(4),d=1.2,c={_mountImageIntoNode:"set innerHTML",INSERT_MARKUP:"set innerHTML",MOVE_EXISTING:"move",REMOVE_NODE:"remove",SET_MARKUP:"set innerHTML",TEXT_CONTENT:"set textContent",setValueForProperty:"update attribute",setValueForAttribute:"update attribute",deleteValueForProperty:"remove attribute",setValueForStyles:"update styles",replaceNodeWithMarkup:"replace",updateTextContent:"set textContent"},u={getExclusiveSummary:a,getInclusiveSummary:i,getDOMSummary:o,getTotalTime:r};e.exports=u},function(e,t,n){"use strict";function r(e){o.enqueueEvents(e),o.processEventQueue(!1)}var o=n(18),a={handleTopLevel:function(e,t,n,a,i){var l=o.extractEvents(e,t,n,a,i);r(l)}};e.exports=a},function(e,t,n){"use strict";function r(e){var t=m.getID(e),n=u.getReactRootIDFromNodeID(t),r=m.findReactContainerForID(n),o=m.getFirstReactDOM(r);return o}function o(e,t){this.topLevelType=e,this.nativeEvent=t,this.ancestors=[]}function a(e){i(e)}function i(e){for(var t=m.getFirstReactDOM(g(e.nativeEvent))||window,n=t;n;)e.ancestors.push(n),n=r(n);for(var o=0;o<e.ancestors.length;o++){t=e.ancestors[o];var a=m.getID(t)||"";v._handleTopLevel(e.topLevelType,t,a,e.nativeEvent,g(e.nativeEvent))}}function l(e){var t=h(window);e(t)}var s=n(75),d=n(5),c=n(15),u=n(20),m=n(6),p=n(8),f=n(4),g=n(44),h=n(155);f(o.prototype,{destructor:function(){this.topLevelType=null,this.nativeEvent=null,this.ancestors.length=0}}),c.addPoolingTo(o,c.twoArgumentPooler);var v={_enabled:!0,_handleTopLevel:null,WINDOW_HANDLE:d.canUseDOM?window:null,setHandleTopLevel:function(e){v._handleTopLevel=e},setEnabled:function(e){v._enabled=!!e},isEnabled:function(){return v._enabled},trapBubbledEvent:function(e,t,n){var r=n;return r?s.listen(r,t,v.dispatchEvent.bind(null,e)):null},trapCapturedEvent:function(e,t,n){var r=n;return r?s.capture(r,t,v.dispatchEvent.bind(null,e)):null},monitorScrollValue:function(e){var t=l.bind(null,e);s.listen(window,"scroll",t)},dispatchEvent:function(e,t){if(v._enabled){var n=o.getPooled(e,t);try{p.batchedUpdates(a,n)}finally{o.release(n)}}}};e.exports=v},function(e,t,n){"use strict";var r=n(14),o=n(18),a=n(34),i=n(108),l=n(60),s=n(23),d=n(65),c=n(7),u=n(67),m=n(8),p={Component:a.injection,Class:i.injection,DOMProperty:r.injection,EmptyComponent:l.injection,EventPluginHub:o.injection,EventEmitter:s.injection,NativeComponent:d.injection,Perf:c.injection,RootIndex:u.injection,Updates:m.injection};e.exports=p},function(e,t,n){"use strict";var r=n(144),o=/\/?>/,a={CHECKSUM_ATTR_NAME:"data-react-checksum",addChecksumToMarkup:function(e){var t=r(e);return e.replace(o," "+a.CHECKSUM_ATTR_NAME+'="'+t+'"$&')},canReuseMarkup:function(e,t){var n=t.getAttribute(a.CHECKSUM_ATTR_NAME);n=n&&parseInt(n,10);var o=r(e);return o===n}};e.exports=a},function(e,t,n){(function(t){"use strict";function r(e,t,n){v.push({parentID:e,parentNode:null,type:u.INSERT_MARKUP,markupIndex:b.push(t)-1,content:null,fromIndex:null,toIndex:n})}function o(e,t,n){v.push({parentID:e,parentNode:null,type:u.MOVE_EXISTING,markupIndex:null,content:null,fromIndex:t,toIndex:n})}function a(e,t){v.push({parentID:e,parentNode:null,type:u.REMOVE_NODE,markupIndex:null,content:null,fromIndex:t,toIndex:null})}function i(e,t){v.push({parentID:e,parentNode:null,type:u.SET_MARKUP,markupIndex:null,content:t,fromIndex:null,toIndex:null})}function l(e,t){v.push({parentID:e,parentNode:null,type:u.TEXT_CONTENT,markupIndex:null,content:t,fromIndex:null,toIndex:null})}function s(){v.length&&(c.processChildrenUpdates(v,b),d())}function d(){v.length=0,b.length=0}var c=n(34),u=n(64),m=n(11),p=n(16),f=n(106),g=n(146),h=0,v=[],b=[],y={Mixin:{_reconcilerInstantiateChildren:function(e,n,r){if("production"!==t.env.NODE_ENV&&this._currentElement)try{return m.current=this._currentElement._owner,f.instantiateChildren(e,n,r)}finally{m.current=null}return f.instantiateChildren(e,n,r)},_reconcilerUpdateChildren:function(e,n,r,o){var a;if("production"!==t.env.NODE_ENV&&this._currentElement){try{m.current=this._currentElement._owner,a=g(n)}finally{m.current=null}return f.updateChildren(e,a,r,o)}return a=g(n),f.updateChildren(e,a,r,o)},mountChildren:function(e,t,n){var r=this._reconcilerInstantiateChildren(e,t,n);this._renderedChildren=r;var o=[],a=0;for(var i in r)if(r.hasOwnProperty(i)){var l=r[i],s=this._rootNodeID+i,d=p.mountComponent(l,s,t,n);l._mountIndex=a++,o.push(d)}return o},updateTextContent:function(e){h++;var t=!0;try{var n=this._renderedChildren;f.unmountChildren(n);for(var r in n)n.hasOwnProperty(r)&&this._unmountChild(n[r]);this.setTextContent(e),t=!1}finally{h--,h||(t?d():s())}},updateMarkup:function(e){h++;var t=!0;try{var n=this._renderedChildren;f.unmountChildren(n);for(var r in n)n.hasOwnProperty(r)&&this._unmountChildByName(n[r],r);this.setMarkup(e),t=!1}finally{h--,h||(t?d():s())}},updateChildren:function(e,t,n){h++;var r=!0;try{this._updateChildren(e,t,n),r=!1}finally{h--,h||(r?d():s())}},_updateChildren:function(e,t,n){var r=this._renderedChildren,o=this._reconcilerUpdateChildren(r,e,t,n);if(this._renderedChildren=o,o||r){var a,i=0,l=0;for(a in o)if(o.hasOwnProperty(a)){var s=r&&r[a],d=o[a];s===d?(this.moveChild(s,l,i),i=Math.max(s._mountIndex,i),s._mountIndex=l):(s&&(i=Math.max(s._mountIndex,i),this._unmountChild(s)),this._mountChildByNameAtIndex(d,a,l,t,n)),l++}for(a in r)!r.hasOwnProperty(a)||o&&o.hasOwnProperty(a)||this._unmountChild(r[a])}},unmountChildren:function(){var e=this._renderedChildren;f.unmountChildren(e),this._renderedChildren=null},moveChild:function(e,t,n){e._mountIndex<n&&o(this._rootNodeID,e._mountIndex,t)},createChild:function(e,t){r(this._rootNodeID,t,e._mountIndex)},removeChild:function(e){a(this._rootNodeID,e._mountIndex)},setTextContent:function(e){l(this._rootNodeID,e)},setMarkup:function(e){i(this._rootNodeID,e)},_mountChildByNameAtIndex:function(e,t,n,r,o){var a=this._rootNodeID+t,i=p.mountComponent(e,a,r,o);e._mountIndex=n,this.createChild(e,i)},_unmountChild:function(e){this.removeChild(e),e._mountIndex=null}}};e.exports=y}).call(t,n(1))},function(e,t,n){(function(t){"use strict";var r=n(2),o={isValidOwner:function(e){return!(!e||"function"!=typeof e.attachRef||"function"!=typeof e.detachRef)},addComponentAsRefTo:function(e,n,a){o.isValidOwner(a)?void 0:"production"!==t.env.NODE_ENV?r(!1,"addComponentAsRefTo(...): Only a ReactOwner can have refs. You might be adding a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner)."):r(!1),a.attachRef(n,e)},removeComponentAsRefFrom:function(e,n,a){o.isValidOwner(a)?void 0:"production"!==t.env.NODE_ENV?r(!1,"removeComponentAsRefFrom(...): Only a ReactOwner can have refs. You might be removing a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner)."):r(!1),a.getPublicInstance().refs[n]===e.getPublicInstance()&&a.detachRef(n)}};e.exports=o}).call(t,n(1))},function(e,t,n){"use strict";function r(e){function t(t,n,r,o,a,i){if(o=o||N,i=i||r,null==n[r]){var l=y[a];return t?new Error("Required "+l+" `"+i+"` was not specified in "+("`"+o+"`.")):null}return e(n,r,o,a,i)}var n=t.bind(null,!1);return n.isRequired=t.bind(null,!0),n}function o(e){function t(t,n,r,o,a){var i=t[n],l=g(i);if(l!==e){var s=y[o],d=h(i);return new Error("Invalid "+s+" `"+a+"` of type "+("`"+d+"` supplied to `"+r+"`, expected ")+("`"+e+"`."))}return null}return r(t)}function a(){return r(x.thatReturns(null))}function i(e){function t(t,n,r,o,a){var i=t[n];if(!Array.isArray(i)){var l=y[o],s=g(i);return new Error("Invalid "+l+" `"+a+"` of type "+("`"+s+"` supplied to `"+r+"`, expected an array."))}for(var d=0;d<i.length;d++){var c=e(i,d,r,o,a+"["+d+"]");if(c instanceof Error)return c}return null}return r(t)}function l(){function e(e,t,n,r,o){if(!b.isValidElement(e[t])){var a=y[r];return new Error("Invalid "+a+" `"+o+"` supplied to "+("`"+n+"`, expected a single ReactElement."))}return null}return r(e)}function s(e){function t(t,n,r,o,a){if(!(t[n]instanceof e)){var i=y[o],l=e.name||N,s=v(t[n]);return new Error("Invalid "+i+" `"+a+"` of type "+("`"+s+"` supplied to `"+r+"`, expected ")+("instance of `"+l+"`."))}return null}return r(t)}function d(e){function t(t,n,r,o,a){for(var i=t[n],l=0;l<e.length;l++)if(i===e[l])return null;var s=y[o],d=JSON.stringify(e);return new Error("Invalid "+s+" `"+a+"` of value `"+i+"` "+("supplied to `"+r+"`, expected one of "+d+"."))}return r(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOf, expected an instance of array.")})}function c(e){function t(t,n,r,o,a){var i=t[n],l=g(i);if("object"!==l){var s=y[o];return new Error("Invalid "+s+" `"+a+"` of type "+("`"+l+"` supplied to `"+r+"`, expected an object."))}for(var d in i)if(i.hasOwnProperty(d)){var c=e(i,d,r,o,a+"."+d);if(c instanceof Error)return c}return null}return r(t)}function u(e){function t(t,n,r,o,a){for(var i=0;i<e.length;i++){var l=e[i];if(null==l(t,n,r,o,a))return null}var s=y[o];return new Error("Invalid "+s+" `"+a+"` supplied to "+("`"+r+"`."))}return r(Array.isArray(e)?t:function(){return new Error("Invalid argument supplied to oneOfType, expected an instance of array.")})}function m(){function e(e,t,n,r,o){if(!f(e[t])){var a=y[r];return new Error("Invalid "+a+" `"+o+"` supplied to "+("`"+n+"`, expected a ReactNode."))}return null}return r(e)}function p(e){function t(t,n,r,o,a){var i=t[n],l=g(i);if("object"!==l){var s=y[o];return new Error("Invalid "+s+" `"+a+"` of type `"+l+"` "+("supplied to `"+r+"`, expected `object`."))}for(var d in e){var c=e[d];if(c){var u=c(i,d,r,o,a+"."+d);if(u)return u}}return null}return r(t)}function f(e){switch(typeof e){case"number":case"string":case"undefined":return!0;case"boolean":return!e;case"object":if(Array.isArray(e))return e.every(f);if(null===e||b.isValidElement(e))return!0;var t=C(e);if(!t)return!1;var n,r=t.call(e);if(t!==e.entries){for(;!(n=r.next()).done;)if(!f(n.value))return!1}else for(;!(n=r.next()).done;){var o=n.value;if(o&&!f(o[1]))return!1}return!0;default:return!1}}function g(e){var t=typeof e;return Array.isArray(e)?"array":e instanceof RegExp?"object":t}function h(e){var t=g(e);if("object"===t){if(e instanceof Date)return"date";if(e instanceof RegExp)return"regexp"}return t}function v(e){return e.constructor&&e.constructor.name?e.constructor.name:"<<anonymous>>"}var b=n(12),y=n(36),x=n(10),C=n(71),N="<<anonymous>>",E={array:o("array"),bool:o("boolean"),func:o("function"),number:o("number"),object:o("object"),string:o("string"),any:a(),arrayOf:i,element:l(),instanceOf:s,node:m(),objectOf:c,oneOf:d,oneOfType:u,shape:p};e.exports=E},function(e,t,n){"use strict";function r(e){this.reinitializeTransaction(),this.renderToStaticMarkup=!1,this.reactMountReady=o.getPooled(null),this.useCreateElement=!e&&l.useCreateElement}var o=n(54),a=n(15),i=n(23),l=n(57),s=n(63),d=n(39),c=n(4),u={initialize:s.getSelectionInformation,close:s.restoreSelection},m={initialize:function(){var e=i.isEnabled();return i.setEnabled(!1),e},close:function(e){i.setEnabled(e)}},p={initialize:function(){this.reactMountReady.reset()},close:function(){this.reactMountReady.notifyAll()}},f=[u,m,p],g={getTransactionWrappers:function(){return f},getReactMountReady:function(){return this.reactMountReady},destructor:function(){o.release(this.reactMountReady),this.reactMountReady=null}};c(r.prototype,d.Mixin,g),a.addPoolingTo(r),e.exports=r},function(e,t,n){"use strict";function r(e,t,n){"function"==typeof e?e(t.getPublicInstance()):a.addComponentAsRefTo(t,e,n)}function o(e,t,n){"function"==typeof e?e(null):a.removeComponentAsRefFrom(t,e,n)}var a=n(127),i={};i.attachRefs=function(e,t){if(null!==t&&t!==!1){var n=t.ref;null!=n&&r(n,e,t._owner)}},i.shouldUpdateRefs=function(e,t){var n=null===e||e===!1,r=null===t||t===!1;return n||r||t._owner!==e._owner||t.ref!==e.ref},i.detachRefs=function(e,t){if(null!==t&&t!==!1){var n=t.ref;null!=n&&o(n,e,t._owner)}},e.exports=i},function(e,t){"use strict";e.exports="0.14.7"},function(e,t,n){"use strict";var r=n(14),o=r.injection.MUST_USE_ATTRIBUTE,a={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},i={Properties:{clipPath:o,cx:o,cy:o,d:o,dx:o,dy:o,fill:o,fillOpacity:o,fontFamily:o,fontSize:o,fx:o,fy:o,gradientTransform:o,gradientUnits:o,markerEnd:o,markerMid:o,markerStart:o,offset:o,opacity:o,patternContentUnits:o,patternUnits:o,points:o,preserveAspectRatio:o,r:o,rx:o,ry:o,spreadMethod:o,stopColor:o,stopOpacity:o,stroke:o,strokeDasharray:o,strokeLinecap:o,strokeOpacity:o,strokeWidth:o,textAnchor:o,transform:o,version:o,viewBox:o,x1:o,x2:o,x:o,xlinkActuate:o,xlinkArcrole:o,xlinkHref:o,xlinkRole:o,xlinkShow:o,xlinkTitle:o,xlinkType:o,xmlBase:o,xmlLang:o,xmlSpace:o,y1:o,y2:o,y:o},DOMAttributeNamespaces:{xlinkActuate:a.xlink,xlinkArcrole:a.xlink,xlinkHref:a.xlink,xlinkRole:a.xlink,xlinkShow:a.xlink,xlinkTitle:a.xlink,xlinkType:a.xlink,xmlBase:a.xml,xmlLang:a.xml,xmlSpace:a.xml},DOMAttributeNames:{clipPath:"clip-path",fillOpacity:"fill-opacity",fontFamily:"font-family",fontSize:"font-size",gradientTransform:"gradientTransform",gradientUnits:"gradientUnits",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",patternContentUnits:"patternContentUnits",patternUnits:"patternUnits",preserveAspectRatio:"preserveAspectRatio",spreadMethod:"spreadMethod",stopColor:"stop-color",stopOpacity:"stop-opacity",strokeDasharray:"stroke-dasharray",strokeLinecap:"stroke-linecap",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",textAnchor:"text-anchor",viewBox:"viewBox",xlinkActuate:"xlink:actuate",xlinkArcrole:"xlink:arcrole",xlinkHref:"xlink:href",xlinkRole:"xlink:role",xlinkShow:"xlink:show",xlinkTitle:"xlink:title",xlinkType:"xlink:type",xmlBase:"xml:base",xmlLang:"xml:lang",xmlSpace:"xml:space"}};e.exports=i},function(e,t,n){"use strict";function r(e){if("selectionStart"in e&&s.hasSelectionCapabilities(e))return{start:e.selectionStart,end:e.selectionEnd};if(window.getSelection){var t=window.getSelection();return{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}}if(document.selection){var n=document.selection.createRange();return{parentElement:n.parentElement(),text:n.text,top:n.boundingTop,left:n.boundingLeft}}}function o(e,t){if(x||null==v||v!==c())return null;var n=r(v);if(!y||!p(y,n)){y=n;var o=d.getPooled(h.select,b,e,t);return o.type="select",o.target=v,i.accumulateTwoPhaseDispatches(o),o}return null}var a=n(9),i=n(19),l=n(5),s=n(63),d=n(17),c=n(78),u=n(74),m=n(13),p=n(80),f=a.topLevelTypes,g=l.canUseDOM&&"documentMode"in document&&document.documentMode<=11,h={select:{phasedRegistrationNames:{bubbled:m({onSelect:null}),captured:m({onSelectCapture:null})},dependencies:[f.topBlur,f.topContextMenu,f.topFocus,f.topKeyDown,f.topMouseDown,f.topMouseUp,f.topSelectionChange]}},v=null,b=null,y=null,x=!1,C=!1,N=m({onSelect:null}),E={eventTypes:h,extractEvents:function(e,t,n,r,a){if(!C)return null;switch(e){case f.topFocus:(u(t)||"true"===t.contentEditable)&&(v=t,b=n,y=null);break;case f.topBlur:v=null,b=null,y=null;break;case f.topMouseDown:x=!0;break;case f.topContextMenu:case f.topMouseUp:return x=!1,o(r,a);case f.topSelectionChange:if(g)break;case f.topKeyDown:case f.topKeyUp:return o(r,a)}return null},didPutListener:function(e,t,n){t===N&&(C=!0)}};e.exports=E},function(e,t){"use strict";var n=Math.pow(2,53),r={createReactRootIndex:function(){return Math.ceil(Math.random()*n)}};e.exports=r},function(e,t,n){(function(t){"use strict";var r=n(9),o=n(75),a=n(19),i=n(6),l=n(136),s=n(17),d=n(139),c=n(141),u=n(24),m=n(138),p=n(142),f=n(22),g=n(143),h=n(10),v=n(42),b=n(2),y=n(13),x=r.topLevelTypes,C={abort:{phasedRegistrationNames:{bubbled:y({onAbort:!0}),captured:y({onAbortCapture:!0})}},blur:{phasedRegistrationNames:{bubbled:y({onBlur:!0}),captured:y({onBlurCapture:!0})}},canPlay:{phasedRegistrationNames:{bubbled:y({onCanPlay:!0}),captured:y({onCanPlayCapture:!0})}},canPlayThrough:{phasedRegistrationNames:{bubbled:y({onCanPlayThrough:!0}),captured:y({onCanPlayThroughCapture:!0})}},click:{phasedRegistrationNames:{bubbled:y({onClick:!0}),captured:y({onClickCapture:!0})}},contextMenu:{phasedRegistrationNames:{bubbled:y({onContextMenu:!0}),captured:y({onContextMenuCapture:!0})}},copy:{phasedRegistrationNames:{bubbled:y({onCopy:!0}),captured:y({onCopyCapture:!0})}},cut:{phasedRegistrationNames:{bubbled:y({onCut:!0}),captured:y({onCutCapture:!0})}},doubleClick:{phasedRegistrationNames:{bubbled:y({onDoubleClick:!0}),captured:y({onDoubleClickCapture:!0})}},drag:{phasedRegistrationNames:{bubbled:y({onDrag:!0}),captured:y({onDragCapture:!0})}},dragEnd:{phasedRegistrationNames:{bubbled:y({onDragEnd:!0}),captured:y({onDragEndCapture:!0})}},dragEnter:{phasedRegistrationNames:{bubbled:y({onDragEnter:!0}),captured:y({onDragEnterCapture:!0})}},dragExit:{phasedRegistrationNames:{bubbled:y({onDragExit:!0}),captured:y({onDragExitCapture:!0})}},dragLeave:{phasedRegistrationNames:{bubbled:y({onDragLeave:!0}),captured:y({onDragLeaveCapture:!0})}},dragOver:{phasedRegistrationNames:{bubbled:y({onDragOver:!0}),captured:y({onDragOverCapture:!0})}},dragStart:{phasedRegistrationNames:{bubbled:y({onDragStart:!0}),captured:y({onDragStartCapture:!0})}},drop:{phasedRegistrationNames:{bubbled:y({onDrop:!0}),captured:y({onDropCapture:!0})}},durationChange:{phasedRegistrationNames:{bubbled:y({onDurationChange:!0}),captured:y({onDurationChangeCapture:!0})}},emptied:{phasedRegistrationNames:{bubbled:y({onEmptied:!0}),captured:y({onEmptiedCapture:!0})}},encrypted:{phasedRegistrationNames:{bubbled:y({onEncrypted:!0}),captured:y({onEncryptedCapture:!0})}},ended:{phasedRegistrationNames:{bubbled:y({onEnded:!0}),captured:y({onEndedCapture:!0})}},error:{phasedRegistrationNames:{bubbled:y({onError:!0}),captured:y({onErrorCapture:!0})}},focus:{phasedRegistrationNames:{bubbled:y({onFocus:!0}),captured:y({onFocusCapture:!0})}},input:{phasedRegistrationNames:{bubbled:y({onInput:!0}),captured:y({onInputCapture:!0})}},keyDown:{phasedRegistrationNames:{bubbled:y({onKeyDown:!0}),captured:y({onKeyDownCapture:!0})}},keyPress:{phasedRegistrationNames:{bubbled:y({onKeyPress:!0}),captured:y({onKeyPressCapture:!0})}},keyUp:{phasedRegistrationNames:{bubbled:y({onKeyUp:!0}),captured:y({onKeyUpCapture:!0})}},load:{phasedRegistrationNames:{bubbled:y({onLoad:!0}),captured:y({onLoadCapture:!0})}},loadedData:{phasedRegistrationNames:{bubbled:y({onLoadedData:!0}),captured:y({onLoadedDataCapture:!0})}},loadedMetadata:{phasedRegistrationNames:{bubbled:y({onLoadedMetadata:!0}),captured:y({onLoadedMetadataCapture:!0})}},loadStart:{phasedRegistrationNames:{bubbled:y({onLoadStart:!0}),captured:y({onLoadStartCapture:!0})}},mouseDown:{phasedRegistrationNames:{bubbled:y({onMouseDown:!0}),captured:y({onMouseDownCapture:!0})}},mouseMove:{phasedRegistrationNames:{bubbled:y({onMouseMove:!0}),captured:y({onMouseMoveCapture:!0})}},mouseOut:{phasedRegistrationNames:{bubbled:y({onMouseOut:!0}),captured:y({onMouseOutCapture:!0})}},mouseOver:{phasedRegistrationNames:{bubbled:y({onMouseOver:!0}),captured:y({onMouseOverCapture:!0})}},mouseUp:{phasedRegistrationNames:{bubbled:y({onMouseUp:!0}),captured:y({onMouseUpCapture:!0})}},paste:{phasedRegistrationNames:{bubbled:y({onPaste:!0}),captured:y({onPasteCapture:!0})}},pause:{phasedRegistrationNames:{bubbled:y({onPause:!0}),captured:y({onPauseCapture:!0})}},play:{phasedRegistrationNames:{bubbled:y({onPlay:!0}),captured:y({onPlayCapture:!0})}},playing:{phasedRegistrationNames:{bubbled:y({onPlaying:!0}),captured:y({onPlayingCapture:!0})}},progress:{phasedRegistrationNames:{bubbled:y({onProgress:!0}),captured:y({onProgressCapture:!0})}},rateChange:{phasedRegistrationNames:{bubbled:y({onRateChange:!0}),captured:y({onRateChangeCapture:!0})}},reset:{phasedRegistrationNames:{bubbled:y({onReset:!0}),captured:y({onResetCapture:!0})}},scroll:{phasedRegistrationNames:{bubbled:y({onScroll:!0}),captured:y({onScrollCapture:!0})}},seeked:{phasedRegistrationNames:{bubbled:y({onSeeked:!0}),captured:y({onSeekedCapture:!0})}},seeking:{phasedRegistrationNames:{bubbled:y({onSeeking:!0}),captured:y({onSeekingCapture:!0})}},stalled:{phasedRegistrationNames:{bubbled:y({onStalled:!0}),captured:y({onStalledCapture:!0})}},submit:{phasedRegistrationNames:{
bubbled:y({onSubmit:!0}),captured:y({onSubmitCapture:!0})}},suspend:{phasedRegistrationNames:{bubbled:y({onSuspend:!0}),captured:y({onSuspendCapture:!0})}},timeUpdate:{phasedRegistrationNames:{bubbled:y({onTimeUpdate:!0}),captured:y({onTimeUpdateCapture:!0})}},touchCancel:{phasedRegistrationNames:{bubbled:y({onTouchCancel:!0}),captured:y({onTouchCancelCapture:!0})}},touchEnd:{phasedRegistrationNames:{bubbled:y({onTouchEnd:!0}),captured:y({onTouchEndCapture:!0})}},touchMove:{phasedRegistrationNames:{bubbled:y({onTouchMove:!0}),captured:y({onTouchMoveCapture:!0})}},touchStart:{phasedRegistrationNames:{bubbled:y({onTouchStart:!0}),captured:y({onTouchStartCapture:!0})}},volumeChange:{phasedRegistrationNames:{bubbled:y({onVolumeChange:!0}),captured:y({onVolumeChangeCapture:!0})}},waiting:{phasedRegistrationNames:{bubbled:y({onWaiting:!0}),captured:y({onWaitingCapture:!0})}},wheel:{phasedRegistrationNames:{bubbled:y({onWheel:!0}),captured:y({onWheelCapture:!0})}}},N={topAbort:C.abort,topBlur:C.blur,topCanPlay:C.canPlay,topCanPlayThrough:C.canPlayThrough,topClick:C.click,topContextMenu:C.contextMenu,topCopy:C.copy,topCut:C.cut,topDoubleClick:C.doubleClick,topDrag:C.drag,topDragEnd:C.dragEnd,topDragEnter:C.dragEnter,topDragExit:C.dragExit,topDragLeave:C.dragLeave,topDragOver:C.dragOver,topDragStart:C.dragStart,topDrop:C.drop,topDurationChange:C.durationChange,topEmptied:C.emptied,topEncrypted:C.encrypted,topEnded:C.ended,topError:C.error,topFocus:C.focus,topInput:C.input,topKeyDown:C.keyDown,topKeyPress:C.keyPress,topKeyUp:C.keyUp,topLoad:C.load,topLoadedData:C.loadedData,topLoadedMetadata:C.loadedMetadata,topLoadStart:C.loadStart,topMouseDown:C.mouseDown,topMouseMove:C.mouseMove,topMouseOut:C.mouseOut,topMouseOver:C.mouseOver,topMouseUp:C.mouseUp,topPaste:C.paste,topPause:C.pause,topPlay:C.play,topPlaying:C.playing,topProgress:C.progress,topRateChange:C.rateChange,topReset:C.reset,topScroll:C.scroll,topSeeked:C.seeked,topSeeking:C.seeking,topStalled:C.stalled,topSubmit:C.submit,topSuspend:C.suspend,topTimeUpdate:C.timeUpdate,topTouchCancel:C.touchCancel,topTouchEnd:C.touchEnd,topTouchMove:C.touchMove,topTouchStart:C.touchStart,topVolumeChange:C.volumeChange,topWaiting:C.waiting,topWheel:C.wheel};for(var E in N)N[E].dependencies=[E];var w=y({onClick:null}),S={},k={eventTypes:C,extractEvents:function(e,n,r,o,i){var h=N[e];if(!h)return null;var y;switch(e){case x.topAbort:case x.topCanPlay:case x.topCanPlayThrough:case x.topDurationChange:case x.topEmptied:case x.topEncrypted:case x.topEnded:case x.topError:case x.topInput:case x.topLoad:case x.topLoadedData:case x.topLoadedMetadata:case x.topLoadStart:case x.topPause:case x.topPlay:case x.topPlaying:case x.topProgress:case x.topRateChange:case x.topReset:case x.topSeeked:case x.topSeeking:case x.topStalled:case x.topSubmit:case x.topSuspend:case x.topTimeUpdate:case x.topVolumeChange:case x.topWaiting:y=s;break;case x.topKeyPress:if(0===v(o))return null;case x.topKeyDown:case x.topKeyUp:y=c;break;case x.topBlur:case x.topFocus:y=d;break;case x.topClick:if(2===o.button)return null;case x.topContextMenu:case x.topDoubleClick:case x.topMouseDown:case x.topMouseMove:case x.topMouseOut:case x.topMouseOver:case x.topMouseUp:y=u;break;case x.topDrag:case x.topDragEnd:case x.topDragEnter:case x.topDragExit:case x.topDragLeave:case x.topDragOver:case x.topDragStart:case x.topDrop:y=m;break;case x.topTouchCancel:case x.topTouchEnd:case x.topTouchMove:case x.topTouchStart:y=p;break;case x.topScroll:y=f;break;case x.topWheel:y=g;break;case x.topCopy:case x.topCut:case x.topPaste:y=l}y?void 0:"production"!==t.env.NODE_ENV?b(!1,"SimpleEventPlugin: Unhandled event type, `%s`.",e):b(!1);var C=y.getPooled(h,r,o,i);return a.accumulateTwoPhaseDispatches(C),C},didPutListener:function(e,t,n){if(t===w){var r=i.getNode(e);S[e]||(S[e]=o.listen(r,"click",h))}},willDeleteListener:function(e,t){t===w&&(S[e].remove(),delete S[e])}};e.exports=k}).call(t,n(1))},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(17),a={clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}};o.augmentClass(r,a),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(17),a={data:null};o.augmentClass(r,a),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(24),a={dataTransfer:null};o.augmentClass(r,a),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(22),a={relatedTarget:null};o.augmentClass(r,a),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(17),a={data:null};o.augmentClass(r,a),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(22),a=n(42),i=n(147),l=n(43),s={key:i,location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:l,charCode:function(e){return"keypress"===e.type?a(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?a(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}};o.augmentClass(r,s),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(22),a=n(43),i={touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:a};o.augmentClass(r,i),e.exports=r},function(e,t,n){"use strict";function r(e,t,n,r){o.call(this,e,t,n,r)}var o=n(24),a={deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null};o.augmentClass(r,a),e.exports=r},function(e,t){"use strict";function n(e){for(var t=1,n=0,o=0,a=e.length,i=-4&a;i>o;){for(;o<Math.min(o+4096,i);o+=4)n+=(t+=e.charCodeAt(o))+(t+=e.charCodeAt(o+1))+(t+=e.charCodeAt(o+2))+(t+=e.charCodeAt(o+3));t%=r,n%=r}for(;a>o;o++)n+=t+=e.charCodeAt(o);return t%=r,n%=r,t|n<<16}var r=65521;e.exports=n},function(e,t,n){"use strict";function r(e,t){var n=null==t||"boolean"==typeof t||""===t;if(n)return"";var r=isNaN(t);return r||0===t||a.hasOwnProperty(e)&&a[e]?""+t:("string"==typeof t&&(t=t.trim()),t+"px")}var o=n(53),a=o.isUnitlessNumber;e.exports=r},function(e,t,n){(function(t){"use strict";function r(e,n,r){var o=e,a=void 0===o[r];"production"!==t.env.NODE_ENV&&("production"!==t.env.NODE_ENV?i(a,"flattenChildren(...): Encountered two children with the same key, `%s`. Child keys must be unique; when two children share a key, only the first child will be used.",r):void 0),a&&null!=n&&(o[r]=n)}function o(e){if(null==e)return e;var t={};return a(e,r,t),t}var a=n(48),i=n(3);e.exports=o}).call(t,n(1))},function(e,t,n){"use strict";function r(e){if(e.key){var t=a[e.key]||e.key;if("Unidentified"!==t)return t}if("keypress"===e.type){var n=o(e);return 13===n?"Enter":String.fromCharCode(n)}return"keydown"===e.type||"keyup"===e.type?i[e.keyCode]||"Unidentified":""}var o=n(42),a={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},i={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"};e.exports=r},function(e,t){"use strict";function n(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function r(e){for(;e;){if(e.nextSibling)return e.nextSibling;e=e.parentNode}}function o(e,t){for(var o=n(e),a=0,i=0;o;){if(3===o.nodeType){if(i=a+o.textContent.length,t>=a&&i>=t)return{node:o,offset:t-a};a=i}o=n(r(o))}}e.exports=o},function(e,t,n){"use strict";function r(e){return'"'+o(e)+'"'}var o=n(25);e.exports=r},function(e,t,n){"use strict";var r=n(6);e.exports=r.renderSubtreeIntoContainer},function(e,t){"use strict";function n(e){return e.replace(r,function(e,t){return t.toUpperCase()})}var r=/-(.)/g;e.exports=n},function(e,t,n){"use strict";function r(e){return o(e.replace(a,"ms-"))}var o=n(151),a=/^-ms-/;e.exports=r},function(e,t,n){"use strict";function r(e){return!!e&&("object"==typeof e||"function"==typeof e)&&"length"in e&&!("setInterval"in e)&&"number"!=typeof e.nodeType&&(Array.isArray(e)||"callee"in e||"item"in e)}function o(e){return r(e)?Array.isArray(e)?e.slice():a(e):[e]}var a=n(163);e.exports=o},function(e,t,n){(function(t){"use strict";function r(e){var t=e.match(c);return t&&t[1].toLowerCase()}function o(e,n){var o=d;d?void 0:"production"!==t.env.NODE_ENV?s(!1,"createNodesFromMarkup dummy not initialized"):s(!1);var a=r(e),c=a&&l(a);if(c){o.innerHTML=c[1]+e+c[2];for(var u=c[0];u--;)o=o.lastChild}else o.innerHTML=e;var m=o.getElementsByTagName("script");m.length&&(n?void 0:"production"!==t.env.NODE_ENV?s(!1,"createNodesFromMarkup(...): Unexpected <script> element rendered."):s(!1),i(m).forEach(n));for(var p=i(o.childNodes);o.lastChild;)o.removeChild(o.lastChild);return p}var a=n(5),i=n(153),l=n(79),s=n(2),d=a.canUseDOM?document.createElement("div"):null,c=/^\s*<(\w+)/;e.exports=o}).call(t,n(1))},function(e,t){"use strict";function n(e){return e===window?{x:window.pageXOffset||document.documentElement.scrollLeft,y:window.pageYOffset||document.documentElement.scrollTop}:{x:e.scrollLeft,y:e.scrollTop}}e.exports=n},function(e,t){"use strict";function n(e){return e.replace(r,"-$1").toLowerCase()}var r=/([A-Z])/g;e.exports=n},function(e,t,n){"use strict";function r(e){return o(e).replace(a,"-ms-")}var o=n(156),a=/^ms-/;e.exports=r},function(e,t){"use strict";function n(e){return!(!e||!("function"==typeof Node?e instanceof Node:"object"==typeof e&&"number"==typeof e.nodeType&&"string"==typeof e.nodeName))}e.exports=n},function(e,t,n){"use strict";function r(e){return o(e)&&3==e.nodeType}var o=n(158);e.exports=r},function(e,t){"use strict";function n(e){var t={};return function(n){return t.hasOwnProperty(n)||(t[n]=e.call(this,n)),t[n]}}e.exports=n},function(e,t,n){"use strict";var r,o=n(5);o.canUseDOM&&(r=window.performance||window.msPerformance||window.webkitPerformance),e.exports=r||{}},function(e,t,n){"use strict";var r,o=n(161);r=o.now?function(){return o.now()}:function(){return Date.now()},e.exports=r},function(e,t,n){(function(t){"use strict";function r(e){var n=e.length;if(Array.isArray(e)||"object"!=typeof e&&"function"!=typeof e?"production"!==t.env.NODE_ENV?o(!1,"toArray: Array-like object expected"):o(!1):void 0,"number"!=typeof n?"production"!==t.env.NODE_ENV?o(!1,"toArray: Object needs a length property"):o(!1):void 0,0===n||n-1 in e?void 0:"production"!==t.env.NODE_ENV?o(!1,"toArray: Object should have keys for indices"):o(!1),e.hasOwnProperty)try{return Array.prototype.slice.call(e)}catch(r){}for(var a=Array(n),i=0;n>i;i++)a[i]=e[i];return a}var o=n(2);e.exports=r}).call(t,n(1))},function(e,t,n){n(29)(n(168))},function(e,t,n){n(29)(n(169))},function(e,t,n){n(29)(n(170))},function(e,t,n){n(29)(n(171))},function(e,t){e.exports="/**\r\n * Created with JetBrains PhpStorm.\r\n * User: taoqili\r\n * Date: 12-6-12\r\n * Time: 下午5:02\r\n * To change this template use File | Settings | File Templates.\r\n */\n'use strict';\n\nUE.I18N['zh-cn'] = {\n    'labelMap': {\n        'anchor': '锚点', 'undo': '撤销', 'redo': '重做', 'bold': '加粗', 'indent': '首行缩进', 'snapscreen': '截图',\n        'italic': '斜体', 'underline': '下划线', 'strikethrough': '删除线', 'subscript': '下标', 'fontborder': '字符边框',\n        'superscript': '上标', 'formatmatch': '格式刷', 'source': '源代码', 'blockquote': '引用',\n        'pasteplain': '纯文本粘贴模式', 'selectall': '全选', 'print': '打印', 'preview': '预览',\n        'horizontal': '分隔线', 'removeformat': '清除格式', 'time': '时间', 'date': '日期',\n        'unlink': '取消链接', 'insertrow': '前插入行', 'insertcol': '前插入列', 'mergeright': '右合并单元格', 'mergedown': '下合并单元格',\n        'deleterow': '删除行', 'deletecol': '删除列', 'splittorows': '拆分成行',\n        'splittocols': '拆分成列', 'splittocells': '完全拆分单元格', 'deletecaption': '删除表格标题', 'inserttitle': '插入标题',\n        'mergecells': '合并多个单元格', 'deletetable': '删除表格', 'cleardoc': '清空文档', 'insertparagraphbeforetable': \"表格前插入行\", 'insertcode': '代码语言',\n        'fontfamily': '字体', 'fontsize': '字号', 'paragraph': '段落格式', 'simpleupload': '单图上传', 'insertimage': '多图上传', 'edittable': '表格属性', 'edittd': '单元格属性', 'link': '超链接',\n        'emotion': '表情', 'spechars': '特殊字符', 'searchreplace': '查询替换', 'map': 'Baidu地图', 'gmap': 'Google地图',\n        'insertvideo': '视频', 'help': '帮助', 'justifyleft': '居左对齐', 'justifyright': '居右对齐', 'justifycenter': '居中对齐',\n        'justifyjustify': '两端对齐', 'forecolor': '字体颜色', 'backcolor': '背景色', 'insertorderedlist': '有序列表',\n        'insertunorderedlist': '无序列表', 'fullscreen': '全屏', 'directionalityltr': '从左向右输入', 'directionalityrtl': '从右向左输入',\n        'rowspacingtop': '段前距', 'rowspacingbottom': '段后距', 'pagebreak': '分页', 'insertframe': '插入Iframe', 'imagenone': '默认',\n        'imageleft': '左浮动', 'imageright': '右浮动', 'attachment': '附件', 'imagecenter': '居中', 'wordimage': '图片转存',\n        'lineheight': '行间距', 'edittip': '编辑提示', 'customstyle': '自定义标题', 'autotypeset': '自动排版',\n        'webapp': '百度应用', 'touppercase': '字母大写', 'tolowercase': '字母小写', 'background': '背景', 'template': '模板', 'scrawl': '涂鸦',\n        'music': '音乐', 'inserttable': '插入表格', 'drafts': '从草稿箱加载', 'charts': '图表'\n    },\n    'insertorderedlist': {\n        'num': '1,2,3...',\n        'num1': '1),2),3)...',\n        'num2': '(1),(2),(3)...',\n        'cn': '一,二,三....',\n        'cn1': '一),二),三)....',\n        'cn2': '(一),(二),(三)....',\n        'decimal': '1,2,3...',\n        'lower-alpha': 'a,b,c...',\n        'lower-roman': 'i,ii,iii...',\n        'upper-alpha': 'A,B,C...',\n        'upper-roman': 'I,II,III...'\n    },\n    'insertunorderedlist': {\n        'circle': '○ 大圆圈',\n        'disc': '● 小黑点',\n        'square': '■ 小方块 ',\n        'dash': '— 破折号',\n        'dot': ' 。 小圆圈'\n    },\n    'paragraph': { 'p': '段落', 'h1': '标题 1', 'h2': '标题 2', 'h3': '标题 3', 'h4': '标题 4', 'h5': '标题 5', 'h6': '标题 6' },\n    'fontfamily': {\n        'songti': '宋体',\n        'kaiti': '楷体',\n        'heiti': '黑体',\n        'lishu': '隶书',\n        'yahei': '微软雅黑',\n        'andaleMono': 'andale mono',\n        'arial': 'arial',\n        'arialBlack': 'arial black',\n        'comicSansMs': 'comic sans ms',\n        'impact': 'impact',\n        'timesNewRoman': 'times new roman'\n    },\n    'customstyle': {\n        'tc': '标题居中',\n        'tl': '标题居左',\n        'im': '强调',\n        'hi': '明显强调'\n    },\n    'autoupload': {\n        'exceedSizeError': '文件大小超出限制',\n        'exceedTypeError': '文件格式不允许',\n        'jsonEncodeError': '服务器返回格式错误',\n        'loading': \"正在上传...\",\n        'loadError': \"上传错误\",\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！'\n    },\n    'simpleupload': {\n        'exceedSizeError': '文件大小超出限制',\n        'exceedTypeError': '文件格式不允许',\n        'jsonEncodeError': '服务器返回格式错误',\n        'loading': \"正在上传...\",\n        'loadError': \"上传错误\",\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！'\n    },\n    'elementPathTip': \"元素路径\",\n    'wordCountTip': \"字数统计\",\n    'wordCountMsg': '当前已输入{#count}个字符, 您还可以输入{#leave}个字符。 ',\n    'wordOverFlowMsg': '<span style=\"color:red;\">字数超出最大允许值，服务器可能拒绝保存！</span>',\n    'ok': \"确认\",\n    'cancel': \"取消\",\n    'closeDialog': \"关闭对话框\",\n    'tableDrag': \"表格拖动必须引入uiUtils.js文件！\",\n    'autofloatMsg': \"工具栏浮动依赖编辑器UI，您首先需要引入UI文件!\",\n    'loadconfigError': '获取后台配置项请求出错，上传功能将不能正常使用！',\n    'loadconfigFormatError': '后台配置项返回格式出错，上传功能将不能正常使用！',\n    'loadconfigHttpError': '请求后台配置项http错误，上传功能将不能正常使用！',\n    'snapScreen_plugin': {\n        'browserMsg': \"仅支持IE浏览器！\",\n        'callBackErrorMsg': \"服务器返回数据有误，请检查配置项之后重试。\",\n        'uploadErrorMsg': \"截图上传失败，请检查服务器端环境! \"\n    },\n    'insertcode': {\n        'as3': 'ActionScript 3',\n        'bash': 'Bash/Shell',\n        'cpp': 'C/C++',\n        'css': 'CSS',\n        'cf': 'ColdFusion',\n        'c#': 'C#',\n        'delphi': 'Delphi',\n        'diff': 'Diff',\n        'erlang': 'Erlang',\n        'groovy': 'Groovy',\n        'html': 'HTML',\n        'java': 'Java',\n        'jfx': 'JavaFX',\n        'js': 'JavaScript',\n        'pl': 'Perl',\n        'php': 'PHP',\n        'plain': 'Plain Text',\n        'ps': 'PowerShell',\n        'python': 'Python',\n        'ruby': 'Ruby',\n        'scala': 'Scala',\n        'sql': 'SQL',\n        'vb': 'Visual Basic',\n        'xml': 'XML'\n    },\n    'confirmClear': \"确定清空当前文档么？\",\n    'contextMenu': {\n        'delete': \"删除\",\n        'selectall': \"全选\",\n        'deletecode': \"删除代码\",\n        'cleardoc': \"清空文档\",\n        'confirmclear': \"确定清空当前文档么？\",\n        'unlink': \"删除超链接\",\n        'paragraph': \"段落格式\",\n        'edittable': \"表格属性\",\n        'aligntd': \"单元格对齐方式\",\n        'aligntable': '表格对齐方式',\n        'tableleft': '左浮动',\n        'tablecenter': '居中显示',\n        'tableright': '右浮动',\n        'edittd': \"单元格属性\",\n        'setbordervisible': '设置表格边线可见',\n        'justifyleft': '左对齐',\n        'justifyright': '右对齐',\n        'justifycenter': '居中对齐',\n        'justifyjustify': '两端对齐',\n        'table': \"表格\",\n        'inserttable': '插入表格',\n        'deletetable': \"删除表格\",\n        'insertparagraphbefore': \"前插入段落\",\n        'insertparagraphafter': '后插入段落',\n        'deleterow': \"删除当前行\",\n        'deletecol': \"删除当前列\",\n        'insertrow': \"前插入行\",\n        'insertcol': \"左插入列\",\n        'insertrownext': '后插入行',\n        'insertcolnext': '右插入列',\n        'insertcaption': '插入表格名称',\n        'deletecaption': '删除表格名称',\n        'inserttitle': '插入表格标题行',\n        'deletetitle': '删除表格标题行',\n        'inserttitlecol': '插入表格标题列',\n        'deletetitlecol': '删除表格标题列',\n        'averageDiseRow': '平均分布各行',\n        'averageDisCol': '平均分布各列',\n        'mergeright': \"向右合并\",\n        'mergeleft': \"向左合并\",\n        'mergedown': \"向下合并\",\n        'mergecells': \"合并单元格\",\n        'splittocells': \"完全拆分单元格\",\n        'splittocols': \"拆分成列\",\n        'splittorows': \"拆分成行\",\n        'tablesort': '表格排序',\n        'enablesort': '设置表格可排序',\n        'disablesort': '取消表格可排序',\n        'reversecurrent': '逆序当前',\n        'orderbyasc': '按ASCII字符升序',\n        'reversebyasc': '按ASCII字符降序',\n        'orderbynum': '按数值大小升序',\n        'reversebynum': '按数值大小降序',\n        'borderbk': '边框底纹',\n        'setcolor': '表格隔行变色',\n        'unsetcolor': '取消表格隔行变色',\n        'setbackground': '选区背景隔行',\n        'unsetbackground': '取消选区背景',\n        'redandblue': '红蓝相间',\n        'threecolorgradient': '三色渐变',\n        'copy': \"复制(Ctrl + c)\",\n        'copymsg': \"浏览器不支持,请使用 'Ctrl + c'\",\n        'paste': \"粘贴(Ctrl + v)\",\n        'pastemsg': \"浏览器不支持,请使用 'Ctrl + v'\"\n    },\n    'copymsg': \"浏览器不支持,请使用 'Ctrl + c'\",\n    'pastemsg': \"浏览器不支持,请使用 'Ctrl + v'\",\n    'anthorMsg': \"链接\",\n    'clearColor': '清空颜色',\n    'standardColor': '标准颜色',\n    'themeColor': '主题颜色',\n    'property': '属性',\n    'default': '默认',\n    'modify': '修改',\n    'justifyleft': '左对齐',\n    'justifyright': '右对齐',\n    'justifycenter': '居中',\n    'justify': '默认',\n    'clear': '清除',\n    'anchorMsg': '锚点',\n    'delete': '删除',\n    'clickToUpload': \"点击上传\",\n    'unset': '尚未设置语言文件',\n    't_row': '行',\n    't_col': '列',\n    'more': '更多',\n    'pasteOpt': '粘贴选项',\n    'pasteSourceFormat': \"保留源格式\",\n    'tagFormat': '只保留标签',\n    'pasteTextFormat': '只保留文本',\n    'autoTypeSet': {\n        'mergeLine': \"合并空行\",\n        'delLine': \"清除空行\",\n        'removeFormat': \"清除格式\",\n        'indent': \"首行缩进\",\n        'alignment': \"对齐方式\",\n        'imageFloat': \"图片浮动\",\n        'removeFontsize': \"清除字号\",\n        'removeFontFamily': \"清除字体\",\n        'removeHtml': \"清除冗余HTML代码\",\n        'pasteFilter': \"粘贴过滤\",\n        'run': \"执行\",\n        'symbol': '符号转换',\n        'bdc2sb': '全角转半角',\n        'tobdc': '半角转全角'\n    },\n\n    'background': {\n        'static': {\n            'lang_background_normal': '背景设置',\n            'lang_background_local': '在线图片',\n            'lang_background_set': '选项',\n            'lang_background_none': '无背景色',\n            'lang_background_colored': '有背景色',\n            'lang_background_color': '颜色设置',\n            'lang_background_netimg': '网络图片',\n            'lang_background_align': '对齐方式',\n            'lang_background_position': '精确定位',\n            'repeatType': { 'options': [\"居中\", \"横向重复\", \"纵向重复\", \"平铺\", \"自定义\"] }\n\n        },\n        'noUploadImage': \"当前未上传过任何图片！\",\n        'toggleSelect': \"单击可切换选中状态\\n原图尺寸: \"\n    },\n    //===============dialog i18N=======================\n    'insertimage': {\n        'static': {\n            'lang_tab_remote': \"插入图片\", //节点\n            'lang_tab_upload': \"本地上传\",\n            'lang_tab_online': \"在线管理\",\n            'lang_tab_search': \"图片搜索\",\n            'lang_input_url': \"地 址：\",\n            'lang_input_size': \"大 小：\",\n            'lang_input_width': \"宽度\",\n            'lang_input_height': \"高度\",\n            'lang_input_border': \"边 框：\",\n            'lang_input_vhspace': \"边 距：\",\n            'lang_input_title': \"描 述：\",\n            'lang_input_align': '图片浮动方式：',\n            'lang_imgLoading': \"　图片加载中……\",\n            'lang_start_upload': \"开始上传\",\n            'lock': { 'title': \"锁定宽高比例\" }, //属性\n            'searchType': { 'title': \"图片类型\", 'options': [\"新闻\", \"壁纸\", \"表情\", \"头像\"] }, //select的option\n            'searchTxt': { 'value': \"请输入搜索关键词\" },\n            'searchBtn': { 'value': \"百度一下\" },\n            'searchReset': { 'value': \"清空搜索\" },\n            'noneAlign': { 'title': '无浮动' },\n            'leftAlign': { 'title': '左浮动' },\n            'rightAlign': { 'title': '右浮动' },\n            'centerAlign': { 'title': '居中独占一行' }\n        },\n        'uploadSelectFile': '点击选择图片',\n        'uploadAddFile': '继续添加',\n        'uploadStart': '开始上传',\n        'uploadPause': '暂停上传',\n        'uploadContinue': '继续上传',\n        'uploadRetry': '重试上传',\n        'uploadDelete': '删除',\n        'uploadTurnLeft': '向左旋转',\n        'uploadTurnRight': '向右旋转',\n        'uploadPreview': '预览中',\n        'uploadNoPreview': '不能预览',\n        'updateStatusReady': '选中_张图片，共_KB。',\n        'updateStatusConfirm': '已成功上传_张照片，_张照片上传失败',\n        'updateStatusFinish': '共_张（_KB），_张上传成功',\n        'updateStatusError': '，_张上传失败。',\n        'errorNotSupport': 'WebUploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器。',\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！',\n        'errorExceedSize': '文件大小超出',\n        'errorFileType': '文件格式不允许',\n        'errorInterrupt': '文件传输中断',\n        'errorUploadRetry': '上传失败，请重试',\n        'errorHttp': 'http请求错误',\n        'errorServerUpload': '服务器返回出错',\n        'remoteLockError': \"宽高不正确,不能所定比例\",\n        'numError': \"请输入正确的长度或者宽度值！例如：123，400\",\n        'imageUrlError': \"不允许的图片格式或者图片域！\",\n        'imageLoadError': \"图片加载失败！请检查链接地址或网络状态！\",\n        'searchRemind': \"请输入搜索关键词\",\n        'searchLoading': \"图片加载中，请稍后……\",\n        'searchRetry': \" :( ，抱歉，没有找到图片！请重试一次！\"\n    },\n    'attachment': {\n        'static': {\n            'lang_tab_upload': '上传附件',\n            'lang_tab_online': '在线附件',\n            'lang_start_upload': \"开始上传\",\n            'lang_drop_remind': \"可以将文件拖到这里，单次最多可选100个文件\"\n        },\n        'uploadSelectFile': '点击选择文件',\n        'uploadAddFile': '继续添加',\n        'uploadStart': '开始上传',\n        'uploadPause': '暂停上传',\n        'uploadContinue': '继续上传',\n        'uploadRetry': '重试上传',\n        'uploadDelete': '删除',\n        'uploadTurnLeft': '向左旋转',\n        'uploadTurnRight': '向右旋转',\n        'uploadPreview': '预览中',\n        'updateStatusReady': '选中_个文件，共_KB。',\n        'updateStatusConfirm': '已成功上传_个文件，_个文件上传失败',\n        'updateStatusFinish': '共_个（_KB），_个上传成功',\n        'updateStatusError': '，_张上传失败。',\n        'errorNotSupport': 'WebUploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器。',\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！',\n        'errorExceedSize': '文件大小超出',\n        'errorFileType': '文件格式不允许',\n        'errorInterrupt': '文件传输中断',\n        'errorUploadRetry': '上传失败，请重试',\n        'errorHttp': 'http请求错误',\n        'errorServerUpload': '服务器返回出错'\n    },\n    'insertvideo': {\n        'static': {\n            'lang_tab_insertV': \"插入视频\",\n            'lang_tab_searchV': \"搜索视频\",\n            'lang_tab_uploadV': \"上传视频\",\n            'lang_video_url': \"视频网址\",\n            'lang_video_size': \"视频尺寸\",\n            'lang_videoW': \"宽度\",\n            'lang_videoH': \"高度\",\n            'lang_alignment': \"对齐方式\",\n            'videoSearchTxt': { 'value': \"请输入搜索关键字！\" },\n            'videoType': { 'options': [\"全部\", \"热门\", \"娱乐\", \"搞笑\", \"体育\", \"科技\", \"综艺\"] },\n            'videoSearchBtn': { 'value': \"百度一下\" },\n            'videoSearchReset': { 'value': \"清空结果\" },\n\n            'lang_input_fileStatus': ' 当前未上传文件',\n            'startUpload': { 'style': \"background:url(upload.png) no-repeat;\" },\n\n            'lang_upload_size': \"视频尺寸\",\n            'lang_upload_width': \"宽度\",\n            'lang_upload_height': \"高度\",\n            'lang_upload_alignment': \"对齐方式\",\n            'lang_format_advice': \"建议使用mp4格式.\"\n\n        },\n        'numError': \"请输入正确的数值，如123,400\",\n        'floatLeft': \"左浮动\",\n        'floatRight': \"右浮动\",\n        '\"default\"': \"默认\",\n        'block': \"独占一行\",\n        'urlError': \"输入的视频地址有误，请检查后再试！\",\n        'loading': \" &nbsp;视频加载中，请等待……\",\n        'clickToSelect': \"点击选中\",\n        'goToSource': '访问源视频',\n        'noVideo': \" &nbsp; &nbsp;抱歉，找不到对应的视频，请重试！\",\n\n        'browseFiles': '浏览文件',\n        'uploadSuccess': '上传成功!',\n        'delSuccessFile': '从成功队列中移除',\n        'delFailSaveFile': '移除保存失败文件',\n        'statusPrompt': ' 个文件已上传！ ',\n        'flashVersionError': '当前Flash版本过低，请更新FlashPlayer后重试！',\n        'flashLoadingError': 'Flash加载失败!请检查路径或网络状态',\n        'fileUploadReady': '等待上传……',\n        'delUploadQueue': '从上传队列中移除',\n        'limitPrompt1': '单次不能选择超过',\n        'limitPrompt2': '个文件！请重新选择！',\n        'delFailFile': '移除失败文件',\n        'fileSizeLimit': '文件大小超出限制！',\n        'emptyFile': '空文件无法上传！',\n        'fileTypeError': '文件类型不允许！',\n        'unknownError': '未知错误！',\n        'fileUploading': '上传中，请等待……',\n        'cancelUpload': '取消上传',\n        'netError': '网络错误',\n        'failUpload': '上传失败!',\n        'serverIOError': '服务器IO错误！',\n        'noAuthority': '无权限！',\n        'fileNumLimit': '上传个数限制',\n        'failCheck': '验证失败，本次上传被跳过！',\n        'fileCanceling': '取消中，请等待……',\n        'stopUploading': '上传已停止……',\n\n        'uploadSelectFile': '点击选择文件',\n        'uploadAddFile': '继续添加',\n        'uploadStart': '开始上传',\n        'uploadPause': '暂停上传',\n        'uploadContinue': '继续上传',\n        'uploadRetry': '重试上传',\n        'uploadDelete': '删除',\n        'uploadTurnLeft': '向左旋转',\n        'uploadTurnRight': '向右旋转',\n        'uploadPreview': '预览中',\n        'updateStatusReady': '选中_个文件，共_KB。',\n        'updateStatusConfirm': '成功上传_个，_个失败',\n        'updateStatusFinish': '共_个(_KB)，_个成功上传',\n        'updateStatusError': '，_张上传失败。',\n        'errorNotSupport': 'WebUploader 不支持您的浏览器！如果你使用的是IE浏览器，请尝试升级 flash 播放器。',\n        'errorLoadConfig': '后端配置项没有正常加载，上传插件不能正常使用！',\n        'errorExceedSize': '文件大小超出',\n        'errorFileType': '文件格式不允许',\n        'errorInterrupt': '文件传输中断',\n        'errorUploadRetry': '上传失败，请重试',\n        'errorHttp': 'http请求错误',\n        'errorServerUpload': '服务器返回出错'\n    },\n    'webapp': {\n        'tip1': \"本功能由百度APP提供，如看到此页面，请各位站长首先申请百度APPKey!\",\n        'tip2': \"申请完成之后请至ueditor.config.js中配置获得的appkey! \",\n        'applyFor': \"点此申请\",\n        'anthorApi': \"百度API\"\n    },\n    'template': {\n        'static': {\n            'lang_template_bkcolor': '背景颜色',\n            'lang_template_clear': '保留原有内容',\n            'lang_template_select': '选择模板'\n        },\n        'blank': \"空白文档\",\n        'blog': \"博客文章\",\n        'resume': \"个人简历\",\n        'richText': \"图文混排\",\n        'sciPapers': \"科技论文\"\n\n    },\n    'scrawl': {\n        'static': {\n            'lang_input_previousStep': \"上一步\",\n            'lang_input_nextsStep': \"下一步\",\n            'lang_input_clear': '清空',\n            'lang_input_addPic': '添加背景',\n            'lang_input_ScalePic': '缩放背景',\n            'lang_input_removePic': '删除背景',\n            'J_imgTxt': { title: '添加背景图片' }\n        },\n        'noScarwl': \"尚未作画，白纸一张~\",\n        'scrawlUpLoading': \"涂鸦上传中,别急哦~\",\n        'continueBtn': \"继续\",\n        'imageError': \"糟糕，图片读取失败了！\",\n        'backgroundUploading': '背景图片上传中,别急哦~'\n    },\n    'music': {\n        'static': {\n            'lang_input_tips': \"输入歌手/歌曲/专辑，搜索您感兴趣的音乐！\",\n            'J_searchBtn': { value: '搜索歌曲' }\n        },\n        'emptyTxt': '未搜索到相关音乐结果，请换一个关键词试试。',\n        'chapter': '歌曲',\n        'singer': '歌手',\n        'special': '专辑',\n        'listenTest': '试听'\n    },\n    'anchor': {\n        'static': {\n            'lang_input_anchorName': '锚点名字：'\n        }\n    },\n    'charts': {\n        'static': {\n            'lang_data_source': '数据源：',\n            'lang_chart_format': '图表格式：',\n            'lang_data_align': '数据对齐方式',\n            'lang_chart_align_same': '数据源与图表X轴Y轴一致',\n            'lang_chart_align_reverse': '数据源与图表X轴Y轴相反',\n            'lang_chart_title': '图表标题',\n            'lang_chart_main_title': '主标题：',\n            'lang_chart_sub_title': '子标题：',\n            'lang_chart_x_title': 'X轴标题：',\n            'lang_chart_y_title': 'Y轴标题：',\n            'lang_chart_tip': '提示文字',\n            'lang_cahrt_tip_prefix': '提示文字前缀：',\n            'lang_cahrt_tip_description': '仅饼图有效， 当鼠标移动到饼图中相应的块上时，提示框内的文字的前缀',\n            'lang_chart_data_unit': '数据单位',\n            'lang_chart_data_unit_title': '单位：',\n            'lang_chart_data_unit_description': '显示在每个数据点上的数据的单位， 比如： 温度的单位 ℃',\n            'lang_chart_type': '图表类型：',\n            'lang_prev_btn': '上一个',\n            'lang_next_btn': '下一个'\n        }\n    },\n    'emotion': {\n        'static': {\n            'lang_input_choice': '精选',\n            'lang_input_Tuzki': '兔斯基',\n            'lang_input_BOBO': 'BOBO',\n            'lang_input_lvdouwa': '绿豆蛙',\n            'lang_input_babyCat': 'baby猫',\n            'lang_input_bubble': '泡泡',\n            'lang_input_youa': '有啊'\n        }\n    },\n    'gmap': {\n        'static': {\n            'lang_input_address': '地址',\n            'lang_input_search': '搜索',\n            'address': { value: \"北京\" }\n        },\n        searchError: '无法定位到该地址!'\n    },\n    'help': {\n        'static': {\n            'lang_input_about': '关于UEditor',\n            'lang_input_shortcuts': '快捷键',\n            'lang_input_introduction': 'UEditor是由百度web前端研发部开发的所见即所得富文本web编辑器，具有轻量，可定制，注重用户体验等特点。开源基于BSD协议，允许自由使用和修改代码。',\n            'lang_Txt_shortcuts': '快捷键',\n            'lang_Txt_func': '功能',\n            'lang_Txt_bold': '给选中字设置为加粗',\n            'lang_Txt_copy': '复制选中内容',\n            'lang_Txt_cut': '剪切选中内容',\n            'lang_Txt_Paste': '粘贴',\n            'lang_Txt_undo': '重新执行上次操作',\n            'lang_Txt_redo': '撤销上一次操作',\n            'lang_Txt_italic': '给选中字设置为斜体',\n            'lang_Txt_underline': '给选中字加下划线',\n            'lang_Txt_selectAll': '全部选中',\n            'lang_Txt_visualEnter': '软回车',\n            'lang_Txt_fullscreen': '全屏'\n        }\n    },\n    'insertframe': {\n        'static': {\n            'lang_input_address': '地址：',\n            'lang_input_width': '宽度：',\n            'lang_input_height': '高度：',\n            'lang_input_isScroll': '允许滚动条：',\n            'lang_input_frameborder': '显示框架边框：',\n            'lang_input_alignMode': '对齐方式：',\n            'align': { title: \"对齐方式\", options: [\"默认\", \"左对齐\", \"右对齐\", \"居中\"] }\n        },\n        'enterAddress': '请输入地址!'\n    },\n    'link': {\n        'static': {\n            'lang_input_text': '文本内容：',\n            'lang_input_url': '链接地址：',\n            'lang_input_title': '标题：',\n            'lang_input_target': '是否在新窗口打开：'\n        },\n        'validLink': '只支持选中一个链接时生效',\n        'httpPrompt': '您输入的超链接中不包含http等协议名称，默认将为您添加http://前缀'\n    },\n    'map': {\n        'static': {\n            lang_city: \"城市\",\n            lang_address: \"地址\",\n            city: { value: \"北京\" },\n            lang_search: \"搜索\",\n            lang_dynamicmap: \"插入动态地图\"\n        },\n        cityMsg: \"请选择城市\",\n        errorMsg: \"抱歉，找不到该位置！\"\n    },\n    'searchreplace': {\n        'static': {\n            lang_tab_search: \"查找\",\n            lang_tab_replace: \"替换\",\n            lang_search1: \"查找\",\n            lang_search2: \"查找\",\n            lang_replace: \"替换\",\n            lang_searchReg: '支持正则表达式，添加前后斜杠标示为正则表达式，例如“/表达式/”',\n            lang_searchReg1: '支持正则表达式，添加前后斜杠标示为正则表达式，例如“/表达式/”',\n            lang_case_sensitive1: \"区分大小写\",\n            lang_case_sensitive2: \"区分大小写\",\n            nextFindBtn: { value: \"下一个\" },\n            preFindBtn: { value: \"上一个\" },\n            nextReplaceBtn: { value: \"下一个\" },\n            preReplaceBtn: { value: \"上一个\" },\n            repalceBtn: { value: \"替换\" },\n            repalceAllBtn: { value: \"全部替换\" }\n        },\n        getEnd: \"已经搜索到文章末尾！\",\n        getStart: \"已经搜索到文章头部\",\n        countMsg: \"总共替换了{#count}处！\"\n    },\n    'snapscreen': {\n        'static': {\n            lang_showMsg: \"截图功能需要首先安装UEditor截图插件！ \",\n            lang_download: \"点此下载\",\n            lang_step1: \"第一步，下载UEditor截图插件并运行安装。\",\n            lang_step2: \"第二步，插件安装完成后即可使用，如不生效，请重启浏览器后再试！\"\n        }\n    },\n    'spechars': {\n        'static': {},\n        tsfh: \"特殊字符\",\n        lmsz: \"罗马字符\",\n        szfh: \"数学字符\",\n        rwfh: \"日文字符\",\n        xlzm: \"希腊字母\",\n        ewzm: \"俄文字符\",\n        pyzm: \"拼音字母\",\n        yyyb: \"英语音标\",\n        zyzf: \"其他\"\n    },\n    'edittable': {\n        'static': {\n            'lang_tableStyle': '表格样式',\n            'lang_insertCaption': '添加表格名称行',\n            'lang_insertTitle': '添加表格标题行',\n            'lang_insertTitleCol': '添加表格标题列',\n            'lang_orderbycontent': \"使表格内容可排序\",\n            'lang_tableSize': '自动调整表格尺寸',\n            'lang_autoSizeContent': '按表格文字自适应',\n            'lang_autoSizePage': '按页面宽度自适应',\n            'lang_example': '示例',\n            'lang_borderStyle': '表格边框',\n            'lang_color': '颜色:'\n        },\n        captionName: '表格名称',\n        titleName: '标题',\n        cellsName: '内容',\n        errorMsg: '有合并单元格，不可排序'\n    },\n    'edittip': {\n        'static': {\n            lang_delRow: '删除整行',\n            lang_delCol: '删除整列'\n        }\n    },\n    'edittd': {\n        'static': {\n            lang_tdBkColor: '背景颜色:'\n        }\n    },\n    'formula': {\n        'static': {}\n    },\n    'wordimage': {\n        'static': {\n            lang_resave: \"转存步骤\",\n            uploadBtn: { src: \"upload.png\", alt: \"上传\" },\n            clipboard: { style: \"background: url(copy.png) -153px -1px no-repeat;\" },\n            lang_step: \"1、点击顶部复制按钮，将地址复制到剪贴板；2、点击添加照片按钮，在弹出的对话框中使用Ctrl+V粘贴地址；3、点击打开后选择图片上传流程。\"\n        },\n        'fileType': \"图片\",\n        'flashError': \"FLASH初始化失败，请检查FLASH插件是否正确安装！\",\n        'netError': \"网络连接错误，请重试！\",\n        'copySuccess': \"图片地址已经复制！\",\n        'flashI18n': {} //留空默认中文\n    },\n    'autosave': {\n        'saving': '保存中...',\n        'success': '本地保存成功'\n    }\n};";
},function(e,t){e.exports='/*!\n* ZeroClipboard\n* The ZeroClipboard library provides an easy way to copy text to the clipboard using an invisible Adobe Flash movie and a JavaScript interface.\n* Copyright (c) 2014 Jon Rohan, James M. Greene\n* Licensed MIT\n* http://zeroclipboard.org/\n* v2.0.0-beta.5\n*/\n"use strict";\n\n(function (window) {\n  "use strict";\n  var _currentElement;\n  var _flashState = {\n    bridge: null,\n    version: "0.0.0",\n    pluginType: "unknown",\n    disabled: null,\n    outdated: null,\n    unavailable: null,\n    deactivated: null,\n    overdue: null,\n    ready: null\n  };\n  var _clipData = {};\n  var _clipDataFormatMap = null;\n  var _clientIdCounter = 0;\n  var _clientMeta = {};\n  var _elementIdCounter = 0;\n  var _elementMeta = {};\n  var _swfPath = (function () {\n    var i,\n        jsDir,\n        tmpJsPath,\n        jsPath,\n        swfPath = "ZeroClipboard.swf";\n    if (!(document.currentScript && (jsPath = document.currentScript.src))) {\n      var scripts = document.getElementsByTagName("script");\n      if ("readyState" in scripts[0]) {\n        for (i = scripts.length; i--;) {\n          if (scripts[i].readyState === "interactive" && (jsPath = scripts[i].src)) {\n            break;\n          }\n        }\n      } else if (document.readyState === "loading") {\n        jsPath = scripts[scripts.length - 1].src;\n      } else {\n        for (i = scripts.length; i--;) {\n          tmpJsPath = scripts[i].src;\n          if (!tmpJsPath) {\n            jsDir = null;\n            break;\n          }\n          tmpJsPath = tmpJsPath.split("#")[0].split("?")[0];\n          tmpJsPath = tmpJsPath.slice(0, tmpJsPath.lastIndexOf("/") + 1);\n          if (jsDir == null) {\n            jsDir = tmpJsPath;\n          } else if (jsDir !== tmpJsPath) {\n            jsDir = null;\n            break;\n          }\n        }\n        if (jsDir !== null) {\n          jsPath = jsDir;\n        }\n      }\n    }\n    if (jsPath) {\n      jsPath = jsPath.split("#")[0].split("?")[0];\n      swfPath = jsPath.slice(0, jsPath.lastIndexOf("/") + 1) + swfPath;\n    }\n    return swfPath;\n  })();\n  var _camelizeCssPropName = (function () {\n    var matcherRegex = /\\-([a-z])/g,\n        replacerFn = function replacerFn(match, group) {\n      return group.toUpperCase();\n    };\n    return function (prop) {\n      return prop.replace(matcherRegex, replacerFn);\n    };\n  })();\n  var _getStyle = function _getStyle(el, prop) {\n    var value, camelProp, tagName;\n    if (window.getComputedStyle) {\n      value = window.getComputedStyle(el, null).getPropertyValue(prop);\n    } else {\n      camelProp = _camelizeCssPropName(prop);\n      if (el.currentStyle) {\n        value = el.currentStyle[camelProp];\n      } else {\n        value = el.style[camelProp];\n      }\n    }\n    if (prop === "cursor") {\n      if (!value || value === "auto") {\n        tagName = el.tagName.toLowerCase();\n        if (tagName === "a") {\n          return "pointer";\n        }\n      }\n    }\n    return value;\n  };\n  var _elementMouseOver = function _elementMouseOver(event) {\n    if (!event) {\n      event = window.event;\n    }\n    var target;\n    if (this !== window) {\n      target = this;\n    } else if (event.target) {\n      target = event.target;\n    } else if (event.srcElement) {\n      target = event.srcElement;\n    }\n    ZeroClipboard.activate(target);\n  };\n  var _addEventHandler = function _addEventHandler(element, method, func) {\n    if (!element || element.nodeType !== 1) {\n      return;\n    }\n    if (element.addEventListener) {\n      element.addEventListener(method, func, false);\n    } else if (element.attachEvent) {\n      element.attachEvent("on" + method, func);\n    }\n  };\n  var _removeEventHandler = function _removeEventHandler(element, method, func) {\n    if (!element || element.nodeType !== 1) {\n      return;\n    }\n    if (element.removeEventListener) {\n      element.removeEventListener(method, func, false);\n    } else if (element.detachEvent) {\n      element.detachEvent("on" + method, func);\n    }\n  };\n  var _addClass = function _addClass(element, value) {\n    if (!element || element.nodeType !== 1) {\n      return element;\n    }\n    if (element.classList) {\n      if (!element.classList.contains(value)) {\n        element.classList.add(value);\n      }\n      return element;\n    }\n    if (value && typeof value === "string") {\n      var classNames = (value || "").split(/\\s+/);\n      if (element.nodeType === 1) {\n        if (!element.className) {\n          element.className = value;\n        } else {\n          var className = " " + element.className + " ",\n              setClass = element.className;\n          for (var c = 0, cl = classNames.length; c < cl; c++) {\n            if (className.indexOf(" " + classNames[c] + " ") < 0) {\n              setClass += " " + classNames[c];\n            }\n          }\n          element.className = setClass.replace(/^\\s+|\\s+$/g, "");\n        }\n      }\n    }\n    return element;\n  };\n  var _removeClass = function _removeClass(element, value) {\n    if (!element || element.nodeType !== 1) {\n      return element;\n    }\n    if (element.classList) {\n      if (element.classList.contains(value)) {\n        element.classList.remove(value);\n      }\n      return element;\n    }\n    if (value && typeof value === "string" || value === undefined) {\n      var classNames = (value || "").split(/\\s+/);\n      if (element.nodeType === 1 && element.className) {\n        if (value) {\n          var className = (" " + element.className + " ").replace(/[\\n\\t]/g, " ");\n          for (var c = 0, cl = classNames.length; c < cl; c++) {\n            className = className.replace(" " + classNames[c] + " ", " ");\n          }\n          element.className = className.replace(/^\\s+|\\s+$/g, "");\n        } else {\n          element.className = "";\n        }\n      }\n    }\n    return element;\n  };\n  var _getZoomFactor = function _getZoomFactor() {\n    var rect,\n        physicalWidth,\n        logicalWidth,\n        zoomFactor = 1;\n    if (typeof document.body.getBoundingClientRect === "function") {\n      rect = document.body.getBoundingClientRect();\n      physicalWidth = rect.right - rect.left;\n      logicalWidth = document.body.offsetWidth;\n      zoomFactor = Math.round(physicalWidth / logicalWidth * 100) / 100;\n    }\n    return zoomFactor;\n  };\n  var _getDOMObjectPosition = function _getDOMObjectPosition(obj, defaultZIndex) {\n    var info = {\n      left: 0,\n      top: 0,\n      width: 0,\n      height: 0,\n      zIndex: _getSafeZIndex(defaultZIndex) - 1\n    };\n    if (obj.getBoundingClientRect) {\n      var rect = obj.getBoundingClientRect();\n      var pageXOffset, pageYOffset, zoomFactor;\n      if ("pageXOffset" in window && "pageYOffset" in window) {\n        pageXOffset = window.pageXOffset;\n        pageYOffset = window.pageYOffset;\n      } else {\n        zoomFactor = _getZoomFactor();\n        pageXOffset = Math.round(document.documentElement.scrollLeft / zoomFactor);\n        pageYOffset = Math.round(document.documentElement.scrollTop / zoomFactor);\n      }\n      var leftBorderWidth = document.documentElement.clientLeft || 0;\n      var topBorderWidth = document.documentElement.clientTop || 0;\n      info.left = rect.left + pageXOffset - leftBorderWidth;\n      info.top = rect.top + pageYOffset - topBorderWidth;\n      info.width = "width" in rect ? rect.width : rect.right - rect.left;\n      info.height = "height" in rect ? rect.height : rect.bottom - rect.top;\n    }\n    return info;\n  };\n  var _cacheBust = function _cacheBust(path, options) {\n    var cacheBust = options == null || options && options.cacheBust === true;\n    if (cacheBust) {\n      return (path.indexOf("?") === -1 ? "?" : "&") + "noCache=" + new Date().getTime();\n    } else {\n      return "";\n    }\n  };\n  var _vars = function _vars(options) {\n    var i,\n        len,\n        domain,\n        domains,\n        str = "",\n        trustedOriginsExpanded = [];\n    if (options.trustedDomains) {\n      if (typeof options.trustedDomains === "string") {\n        domains = [options.trustedDomains];\n      } else if (typeof options.trustedDomains === "object" && "length" in options.trustedDomains) {\n        domains = options.trustedDomains;\n      }\n    }\n    if (domains && domains.length) {\n      for (i = 0, len = domains.length; i < len; i++) {\n        if (domains.hasOwnProperty(i) && domains[i] && typeof domains[i] === "string") {\n          domain = _extractDomain(domains[i]);\n          if (!domain) {\n            continue;\n          }\n          if (domain === "*") {\n            trustedOriginsExpanded = [domain];\n            break;\n          }\n          trustedOriginsExpanded.push.apply(trustedOriginsExpanded, [domain, "//" + domain, window.location.protocol + "//" + domain]);\n        }\n      }\n    }\n    if (trustedOriginsExpanded.length) {\n      str += "trustedOrigins=" + encodeURIComponent(trustedOriginsExpanded.join(","));\n    }\n    if (options.forceEnhancedClipboard === true) {\n      str += (str ? "&" : "") + "forceEnhancedClipboard=true";\n    }\n    return str;\n  };\n  var _inArray = function _inArray(elem, array, fromIndex) {\n    if (typeof array.indexOf === "function") {\n      return array.indexOf(elem, fromIndex);\n    }\n    var i,\n        len = array.length;\n    if (typeof fromIndex === "undefined") {\n      fromIndex = 0;\n    } else if (fromIndex < 0) {\n      fromIndex = len + fromIndex;\n    }\n    for (i = fromIndex; i < len; i++) {\n      if (array.hasOwnProperty(i) && array[i] === elem) {\n        return i;\n      }\n    }\n    return -1;\n  };\n  var _prepClip = function _prepClip(elements) {\n    if (typeof elements === "string") {\n      throw new TypeError("ZeroClipboard doesn\'t accept query strings.");\n    }\n    return typeof elements.length !== "number" ? [elements] : elements;\n  };\n  var _dispatchCallback = function _dispatchCallback(func, context, args, async) {\n    if (async) {\n      window.setTimeout(function () {\n        func.apply(context, args);\n      }, 0);\n    } else {\n      func.apply(context, args);\n    }\n  };\n  var _getSafeZIndex = function _getSafeZIndex(val) {\n    var zIndex, tmp;\n    if (val) {\n      if (typeof val === "number" && val > 0) {\n        zIndex = val;\n      } else if (typeof val === "string" && (tmp = parseInt(val, 10)) && !isNaN(tmp) && tmp > 0) {\n        zIndex = tmp;\n      }\n    }\n    if (!zIndex) {\n      if (typeof _globalConfig.zIndex === "number" && _globalConfig.zIndex > 0) {\n        zIndex = _globalConfig.zIndex;\n      } else if (typeof _globalConfig.zIndex === "string" && (tmp = parseInt(_globalConfig.zIndex, 10)) && !isNaN(tmp) && tmp > 0) {\n        zIndex = tmp;\n      }\n    }\n    return zIndex || 0;\n  };\n  var _extend = function _extend() {\n    var i,\n        len,\n        arg,\n        prop,\n        src,\n        copy,\n        target = arguments[0] || {};\n    for (i = 1, len = arguments.length; i < len; i++) {\n      if ((arg = arguments[i]) != null) {\n        for (prop in arg) {\n          if (arg.hasOwnProperty(prop)) {\n            src = target[prop];\n            copy = arg[prop];\n            if (target === copy) {\n              continue;\n            }\n            if (copy !== undefined) {\n              target[prop] = copy;\n            }\n          }\n        }\n      }\n    }\n    return target;\n  };\n  var _extractDomain = function _extractDomain(originOrUrl) {\n    if (originOrUrl == null || originOrUrl === "") {\n      return null;\n    }\n    originOrUrl = originOrUrl.replace(/^\\s+|\\s+$/g, "");\n    if (originOrUrl === "") {\n      return null;\n    }\n    var protocolIndex = originOrUrl.indexOf("//");\n    originOrUrl = protocolIndex === -1 ? originOrUrl : originOrUrl.slice(protocolIndex + 2);\n    var pathIndex = originOrUrl.indexOf("/");\n    originOrUrl = pathIndex === -1 ? originOrUrl : protocolIndex === -1 || pathIndex === 0 ? null : originOrUrl.slice(0, pathIndex);\n    if (originOrUrl && originOrUrl.slice(-4).toLowerCase() === ".swf") {\n      return null;\n    }\n    return originOrUrl || null;\n  };\n  var _determineScriptAccess = (function () {\n    var _extractAllDomains = function _extractAllDomains(origins, resultsArray) {\n      var i, len, tmp;\n      if (origins == null || resultsArray[0] === "*") {\n        return;\n      }\n      if (typeof origins === "string") {\n        origins = [origins];\n      }\n      if (!(typeof origins === "object" && typeof origins.length === "number")) {\n        return;\n      }\n      for (i = 0, len = origins.length; i < len; i++) {\n        if (origins.hasOwnProperty(i) && (tmp = _extractDomain(origins[i]))) {\n          if (tmp === "*") {\n            resultsArray.length = 0;\n            resultsArray.push("*");\n            break;\n          }\n          if (_inArray(tmp, resultsArray) === -1) {\n            resultsArray.push(tmp);\n          }\n        }\n      }\n    };\n    return function (currentDomain, configOptions) {\n      var swfDomain = _extractDomain(configOptions.swfPath);\n      if (swfDomain === null) {\n        swfDomain = currentDomain;\n      }\n      var trustedDomains = [];\n      _extractAllDomains(configOptions.trustedOrigins, trustedDomains);\n      _extractAllDomains(configOptions.trustedDomains, trustedDomains);\n      var len = trustedDomains.length;\n      if (len > 0) {\n        if (len === 1 && trustedDomains[0] === "*") {\n          return "always";\n        }\n        if (_inArray(currentDomain, trustedDomains) !== -1) {\n          if (len === 1 && currentDomain === swfDomain) {\n            return "sameDomain";\n          }\n          return "always";\n        }\n      }\n      return "never";\n    };\n  })();\n  var _objectKeys = function _objectKeys(obj) {\n    if (obj == null) {\n      return [];\n    }\n    if (Object.keys) {\n      return Object.keys(obj);\n    }\n    var keys = [];\n    for (var prop in obj) {\n      if (obj.hasOwnProperty(prop)) {\n        keys.push(prop);\n      }\n    }\n    return keys;\n  };\n  var _deleteOwnProperties = function _deleteOwnProperties(obj) {\n    if (obj) {\n      for (var prop in obj) {\n        if (obj.hasOwnProperty(prop)) {\n          delete obj[prop];\n        }\n      }\n    }\n    return obj;\n  };\n  var _safeActiveElement = function _safeActiveElement() {\n    try {\n      return document.activeElement;\n    } catch (err) {}\n    return null;\n  };\n  var _pick = function _pick(obj, keys) {\n    var newObj = {};\n    for (var i = 0, len = keys.length; i < len; i++) {\n      if (keys[i] in obj) {\n        newObj[keys[i]] = obj[keys[i]];\n      }\n    }\n    return newObj;\n  };\n  var _omit = function _omit(obj, keys) {\n    var newObj = {};\n    for (var prop in obj) {\n      if (_inArray(prop, keys) === -1) {\n        newObj[prop] = obj[prop];\n      }\n    }\n    return newObj;\n  };\n  var _mapClipDataToFlash = function _mapClipDataToFlash(clipData) {\n    var newClipData = {},\n        formatMap = {};\n    if (!(typeof clipData === "object" && clipData)) {\n      return;\n    }\n    for (var dataFormat in clipData) {\n      if (dataFormat && clipData.hasOwnProperty(dataFormat) && typeof clipData[dataFormat] === "string" && clipData[dataFormat]) {\n        switch (dataFormat.toLowerCase()) {\n          case "text/plain":\n          case "text":\n          case "air:text":\n          case "flash:text":\n            newClipData.text = clipData[dataFormat];\n            formatMap.text = dataFormat;\n            break;\n\n          case "text/html":\n          case "html":\n          case "air:html":\n          case "flash:html":\n            newClipData.html = clipData[dataFormat];\n            formatMap.html = dataFormat;\n            break;\n\n          case "application/rtf":\n          case "text/rtf":\n          case "rtf":\n          case "richtext":\n          case "air:rtf":\n          case "flash:rtf":\n            newClipData.rtf = clipData[dataFormat];\n            formatMap.rtf = dataFormat;\n            break;\n\n          default:\n            break;\n        }\n      }\n    }\n    return {\n      data: newClipData,\n      formatMap: formatMap\n    };\n  };\n  var _mapClipResultsFromFlash = function _mapClipResultsFromFlash(clipResults, formatMap) {\n    if (!(typeof clipResults === "object" && clipResults && typeof formatMap === "object" && formatMap)) {\n      return clipResults;\n    }\n    var newResults = {};\n    for (var prop in clipResults) {\n      if (clipResults.hasOwnProperty(prop)) {\n        if (prop !== "success" && prop !== "data") {\n          newResults[prop] = clipResults[prop];\n          continue;\n        }\n        newResults[prop] = {};\n        var tmpHash = clipResults[prop];\n        for (var dataFormat in tmpHash) {\n          if (dataFormat && tmpHash.hasOwnProperty(dataFormat) && formatMap.hasOwnProperty(dataFormat)) {\n            newResults[prop][formatMap[dataFormat]] = tmpHash[dataFormat];\n          }\n        }\n      }\n    }\n    return newResults;\n  };\n  var _args = (function (arraySlice) {\n    return function (args) {\n      return arraySlice.call(args, 0);\n    };\n  })(window.Array.prototype.slice);\n  var _detectFlashSupport = function _detectFlashSupport() {\n    var plugin,\n        ax,\n        mimeType,\n        hasFlash = false,\n        isActiveX = false,\n        isPPAPI = false,\n        flashVersion = "";\n    function parseFlashVersion(desc) {\n      var matches = desc.match(/[\\d]+/g);\n      matches.length = 3;\n      return matches.join(".");\n    }\n    function isPepperFlash(flashPlayerFileName) {\n      return !!flashPlayerFileName && (flashPlayerFileName = flashPlayerFileName.toLowerCase()) && (/^(pepflashplayer\\.dll|libpepflashplayer\\.so|pepperflashplayer\\.plugin)$/.test(flashPlayerFileName) || flashPlayerFileName.slice(-13) === "chrome.plugin");\n    }\n    function inspectPlugin(plugin) {\n      if (plugin) {\n        hasFlash = true;\n        if (plugin.version) {\n          flashVersion = parseFlashVersion(plugin.version);\n        }\n        if (!flashVersion && plugin.description) {\n          flashVersion = parseFlashVersion(plugin.description);\n        }\n        if (plugin.filename) {\n          isPPAPI = isPepperFlash(plugin.filename);\n        }\n      }\n    }\n    if (navigator.plugins && navigator.plugins.length) {\n      plugin = navigator.plugins["Shockwave Flash"];\n      inspectPlugin(plugin);\n      if (navigator.plugins["Shockwave Flash 2.0"]) {\n        hasFlash = true;\n        flashVersion = "2.0.0.11";\n      }\n    } else if (navigator.mimeTypes && navigator.mimeTypes.length) {\n      mimeType = navigator.mimeTypes["application/x-shockwave-flash"];\n      plugin = mimeType && mimeType.enabledPlugin;\n      inspectPlugin(plugin);\n    } else if (typeof ActiveXObject !== "undefined") {\n      isActiveX = true;\n      try {\n        ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");\n        hasFlash = true;\n        flashVersion = parseFlashVersion(ax.GetVariable("$version"));\n      } catch (e1) {\n        try {\n          ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");\n          hasFlash = true;\n          flashVersion = "6.0.21";\n        } catch (e2) {\n          try {\n            ax = new ActiveXObject("ShockwaveFlash.ShockwaveFlash");\n            hasFlash = true;\n            flashVersion = parseFlashVersion(ax.GetVariable("$version"));\n          } catch (e3) {\n            isActiveX = false;\n          }\n        }\n      }\n    }\n    _flashState.disabled = hasFlash !== true;\n    _flashState.outdated = flashVersion && parseFloat(flashVersion) < 11;\n    _flashState.version = flashVersion || "0.0.0";\n    _flashState.pluginType = isPPAPI ? "pepper" : isActiveX ? "activex" : hasFlash ? "netscape" : "unknown";\n  };\n  _detectFlashSupport();\n  var ZeroClipboard = function ZeroClipboard(elements) {\n    if (!(this instanceof ZeroClipboard)) {\n      return new ZeroClipboard(elements);\n    }\n    this.id = "" + _clientIdCounter++;\n    _clientMeta[this.id] = {\n      instance: this,\n      elements: [],\n      handlers: {}\n    };\n    if (elements) {\n      this.clip(elements);\n    }\n    if (typeof _flashState.ready !== "boolean") {\n      _flashState.ready = false;\n    }\n    if (!ZeroClipboard.isFlashUnusable() && _flashState.bridge === null) {\n      var _client = this;\n      var maxWait = _globalConfig.flashLoadTimeout;\n      if (typeof maxWait === "number" && maxWait >= 0) {\n        setTimeout(function () {\n          if (typeof _flashState.deactivated !== "boolean") {\n            _flashState.deactivated = true;\n          }\n          if (_flashState.deactivated === true) {\n            ZeroClipboard.emit({\n              type: "error",\n              name: "flash-deactivated",\n              client: _client\n            });\n          }\n        }, maxWait);\n      }\n      _flashState.overdue = false;\n      _bridge();\n    }\n  };\n  ZeroClipboard.prototype.setText = function (text) {\n    ZeroClipboard.setData("text/plain", text);\n    return this;\n  };\n  ZeroClipboard.prototype.setHtml = function (html) {\n    ZeroClipboard.setData("text/html", html);\n    return this;\n  };\n  ZeroClipboard.prototype.setRichText = function (richText) {\n    ZeroClipboard.setData("application/rtf", richText);\n    return this;\n  };\n  ZeroClipboard.prototype.setData = function () {\n    ZeroClipboard.setData.apply(ZeroClipboard, _args(arguments));\n    return this;\n  };\n  ZeroClipboard.prototype.clearData = function () {\n    ZeroClipboard.clearData.apply(ZeroClipboard, _args(arguments));\n    return this;\n  };\n  ZeroClipboard.prototype.setSize = function (width, height) {\n    _setSize(width, height);\n    return this;\n  };\n  var _setHandCursor = function _setHandCursor(enabled) {\n    if (_flashState.ready === true && _flashState.bridge && typeof _flashState.bridge.setHandCursor === "function") {\n      _flashState.bridge.setHandCursor(enabled);\n    } else {\n      _flashState.ready = false;\n    }\n  };\n  ZeroClipboard.prototype.destroy = function () {\n    this.unclip();\n    this.off();\n    delete _clientMeta[this.id];\n  };\n  var _getAllClients = function _getAllClients() {\n    var i,\n        len,\n        client,\n        clients = [],\n        clientIds = _objectKeys(_clientMeta);\n    for (i = 0, len = clientIds.length; i < len; i++) {\n      client = _clientMeta[clientIds[i]].instance;\n      if (client && client instanceof ZeroClipboard) {\n        clients.push(client);\n      }\n    }\n    return clients;\n  };\n  ZeroClipboard.version = "2.0.0-beta.5";\n  var _globalConfig = {\n    swfPath: _swfPath,\n    trustedDomains: window.location.host ? [window.location.host] : [],\n    cacheBust: true,\n    forceHandCursor: false,\n    forceEnhancedClipboard: false,\n    zIndex: 999999999,\n    debug: false,\n    title: null,\n    autoActivate: true,\n    flashLoadTimeout: 3e4\n  };\n  ZeroClipboard.isFlashUnusable = function () {\n    return !!(_flashState.disabled || _flashState.outdated || _flashState.unavailable || _flashState.deactivated);\n  };\n  ZeroClipboard.config = function (options) {\n    if (typeof options === "object" && options !== null) {\n      _extend(_globalConfig, options);\n    }\n    if (typeof options === "string" && options) {\n      if (_globalConfig.hasOwnProperty(options)) {\n        return _globalConfig[options];\n      }\n      return;\n    }\n    var copy = {};\n    for (var prop in _globalConfig) {\n      if (_globalConfig.hasOwnProperty(prop)) {\n        if (typeof _globalConfig[prop] === "object" && _globalConfig[prop] !== null) {\n          if ("length" in _globalConfig[prop]) {\n            copy[prop] = _globalConfig[prop].slice(0);\n          } else {\n            copy[prop] = _extend({}, _globalConfig[prop]);\n          }\n        } else {\n          copy[prop] = _globalConfig[prop];\n        }\n      }\n    }\n    return copy;\n  };\n  ZeroClipboard.destroy = function () {\n    ZeroClipboard.deactivate();\n    for (var clientId in _clientMeta) {\n      if (_clientMeta.hasOwnProperty(clientId) && _clientMeta[clientId]) {\n        var client = _clientMeta[clientId].instance;\n        if (client && typeof client.destroy === "function") {\n          client.destroy();\n        }\n      }\n    }\n    var flashBridge = _flashState.bridge;\n    if (flashBridge) {\n      var htmlBridge = _getHtmlBridge(flashBridge);\n      if (htmlBridge) {\n        if (_flashState.pluginType === "activex" && "readyState" in flashBridge) {\n          flashBridge.style.display = "none";\n          (function removeSwfFromIE() {\n            if (flashBridge.readyState === 4) {\n              for (var prop in flashBridge) {\n                if (typeof flashBridge[prop] === "function") {\n                  flashBridge[prop] = null;\n                }\n              }\n              flashBridge.parentNode.removeChild(flashBridge);\n              if (htmlBridge.parentNode) {\n                htmlBridge.parentNode.removeChild(htmlBridge);\n              }\n            } else {\n              setTimeout(removeSwfFromIE, 10);\n            }\n          })();\n        } else {\n          flashBridge.parentNode.removeChild(flashBridge);\n          if (htmlBridge.parentNode) {\n            htmlBridge.parentNode.removeChild(htmlBridge);\n          }\n        }\n      }\n      _flashState.ready = null;\n      _flashState.bridge = null;\n      _flashState.deactivated = null;\n    }\n    ZeroClipboard.clearData();\n  };\n  ZeroClipboard.activate = function (element) {\n    if (_currentElement) {\n      _removeClass(_currentElement, _globalConfig.hoverClass);\n      _removeClass(_currentElement, _globalConfig.activeClass);\n    }\n    _currentElement = element;\n    _addClass(element, _globalConfig.hoverClass);\n    _reposition();\n    var newTitle = _globalConfig.title || element.getAttribute("title");\n    if (newTitle) {\n      var htmlBridge = _getHtmlBridge(_flashState.bridge);\n      if (htmlBridge) {\n        htmlBridge.setAttribute("title", newTitle);\n      }\n    }\n    var useHandCursor = _globalConfig.forceHandCursor === true || _getStyle(element, "cursor") === "pointer";\n    _setHandCursor(useHandCursor);\n  };\n  ZeroClipboard.deactivate = function () {\n    var htmlBridge = _getHtmlBridge(_flashState.bridge);\n    if (htmlBridge) {\n      htmlBridge.removeAttribute("title");\n      htmlBridge.style.left = "0px";\n      htmlBridge.style.top = "-9999px";\n      _setSize(1, 1);\n    }\n    if (_currentElement) {\n      _removeClass(_currentElement, _globalConfig.hoverClass);\n      _removeClass(_currentElement, _globalConfig.activeClass);\n      _currentElement = null;\n    }\n  };\n  ZeroClipboard.state = function () {\n    return {\n      browser: _pick(window.navigator, ["userAgent", "platform", "appName"]),\n      flash: _omit(_flashState, ["bridge"]),\n      zeroclipboard: {\n        version: ZeroClipboard.version,\n        config: ZeroClipboard.config()\n      }\n    };\n  };\n  ZeroClipboard.setData = function (format, data) {\n    var dataObj;\n    if (typeof format === "object" && format && typeof data === "undefined") {\n      dataObj = format;\n      ZeroClipboard.clearData();\n    } else if (typeof format === "string" && format) {\n      dataObj = {};\n      dataObj[format] = data;\n    } else {\n      return;\n    }\n    for (var dataFormat in dataObj) {\n      if (dataFormat && dataObj.hasOwnProperty(dataFormat) && typeof dataObj[dataFormat] === "string" && dataObj[dataFormat]) {\n        _clipData[dataFormat] = dataObj[dataFormat];\n      }\n    }\n  };\n  ZeroClipboard.clearData = function (format) {\n    if (typeof format === "undefined") {\n      _deleteOwnProperties(_clipData);\n      _clipDataFormatMap = null;\n    } else if (typeof format === "string" && _clipData.hasOwnProperty(format)) {\n      delete _clipData[format];\n    }\n  };\n  var _bridge = function _bridge() {\n    var flashBridge, len;\n    var container = document.getElementById("global-zeroclipboard-html-bridge");\n    if (!container) {\n      var allowScriptAccess = _determineScriptAccess(window.location.host, _globalConfig);\n      var allowNetworking = allowScriptAccess === "never" ? "none" : "all";\n      var flashvars = _vars(_globalConfig);\n      var swfUrl = _globalConfig.swfPath + _cacheBust(_globalConfig.swfPath, _globalConfig);\n      container = _createHtmlBridge();\n      var divToBeReplaced = document.createElement("div");\n      container.appendChild(divToBeReplaced);\n      document.body.appendChild(container);\n      var tmpDiv = document.createElement("div");\n      var oldIE = _flashState.pluginType === "activex";\n      tmpDiv.innerHTML = \'<object id="global-zeroclipboard-flash-bridge" name="global-zeroclipboard-flash-bridge" \' + \'width="100%" height="100%" \' + (oldIE ? \'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"\' : \'type="application/x-shockwave-flash" data="\' + swfUrl + \'"\') + ">" + (oldIE ? \'<param name="movie" value="\' + swfUrl + \'"/>\' : "") + \'<param name="allowScriptAccess" value="\' + allowScriptAccess + \'"/>\' + \'<param name="allowNetworking" value="\' + allowNetworking + \'"/>\' + \'<param name="menu" value="false"/>\' + \'<param name="wmode" value="transparent"/>\' + \'<param name="flashvars" value="\' + flashvars + \'"/>\' + "</object>";\n      flashBridge = tmpDiv.firstChild;\n      tmpDiv = null;\n      flashBridge.ZeroClipboard = ZeroClipboard;\n      container.replaceChild(flashBridge, divToBeReplaced);\n    }\n    if (!flashBridge) {\n      flashBridge = document["global-zeroclipboard-flash-bridge"];\n      if (flashBridge && (len = flashBridge.length)) {\n        flashBridge = flashBridge[len - 1];\n      }\n      if (!flashBridge) {\n        flashBridge = container.firstChild;\n      }\n    }\n    _flashState.bridge = flashBridge || null;\n  };\n  var _createHtmlBridge = function _createHtmlBridge() {\n    var container = document.createElement("div");\n    container.id = "global-zeroclipboard-html-bridge";\n    container.className = "global-zeroclipboard-container";\n    container.style.position = "absolute";\n    container.style.left = "0px";\n    container.style.top = "-9999px";\n    container.style.width = "1px";\n    container.style.height = "1px";\n    container.style.zIndex = "" + _getSafeZIndex(_globalConfig.zIndex);\n    return container;\n  };\n  var _getHtmlBridge = function _getHtmlBridge(flashBridge) {\n    var htmlBridge = flashBridge && flashBridge.parentNode;\n    while (htmlBridge && htmlBridge.nodeName === "OBJECT" && htmlBridge.parentNode) {\n      htmlBridge = htmlBridge.parentNode;\n    }\n    return htmlBridge || null;\n  };\n  var _reposition = function _reposition() {\n    if (_currentElement) {\n      var pos = _getDOMObjectPosition(_currentElement, _globalConfig.zIndex);\n      var htmlBridge = _getHtmlBridge(_flashState.bridge);\n      if (htmlBridge) {\n        htmlBridge.style.top = pos.top + "px";\n        htmlBridge.style.left = pos.left + "px";\n        htmlBridge.style.width = pos.width + "px";\n        htmlBridge.style.height = pos.height + "px";\n        htmlBridge.style.zIndex = pos.zIndex + 1;\n      }\n      _setSize(pos.width, pos.height);\n    }\n  };\n  var _setSize = function _setSize(width, height) {\n    var htmlBridge = _getHtmlBridge(_flashState.bridge);\n    if (htmlBridge) {\n      htmlBridge.style.width = width + "px";\n      htmlBridge.style.height = height + "px";\n    }\n  };\n  ZeroClipboard.emit = function (event) {\n    var eventType, eventObj, performCallbackAsync, clients, i, len, eventCopy, returnVal, tmp;\n    if (typeof event === "string" && event) {\n      eventType = event;\n    }\n    if (typeof event === "object" && event && typeof event.type === "string" && event.type) {\n      eventType = event.type;\n      eventObj = event;\n    }\n    if (!eventType) {\n      return;\n    }\n    event = _createEvent(eventType, eventObj);\n    _preprocessEvent(event);\n    if (event.type === "ready" && _flashState.overdue === true) {\n      return ZeroClipboard.emit({\n        type: "error",\n        name: "flash-overdue"\n      });\n    }\n    performCallbackAsync = !/^(before)?copy$/.test(event.type);\n    if (event.client) {\n      _dispatchClientCallbacks.call(event.client, event, performCallbackAsync);\n    } else {\n      clients = event.target && event.target !== window && _globalConfig.autoActivate === true ? _getAllClientsClippedToElement(event.target) : _getAllClients();\n      for (i = 0, len = clients.length; i < len; i++) {\n        eventCopy = _extend({}, event, {\n          client: clients[i]\n        });\n        _dispatchClientCallbacks.call(clients[i], eventCopy, performCallbackAsync);\n      }\n    }\n    if (event.type === "copy") {\n      tmp = _mapClipDataToFlash(_clipData);\n      returnVal = tmp.data;\n      _clipDataFormatMap = tmp.formatMap;\n    }\n    return returnVal;\n  };\n  var _dispatchClientCallbacks = function _dispatchClientCallbacks(event, async) {\n    var handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers[event.type];\n    if (handlers && handlers.length) {\n      var i,\n          len,\n          func,\n          context,\n          originalContext = this;\n      for (i = 0, len = handlers.length; i < len; i++) {\n        func = handlers[i];\n        context = originalContext;\n        if (typeof func === "string" && typeof window[func] === "function") {\n          func = window[func];\n        }\n        if (typeof func === "object" && func && typeof func.handleEvent === "function") {\n          context = func;\n          func = func.handleEvent;\n        }\n        if (typeof func === "function") {\n          _dispatchCallback(func, context, [event], async);\n        }\n      }\n    }\n    return this;\n  };\n  var _eventMessages = {\n    ready: "Flash communication is established",\n    error: {\n      "flash-disabled": "Flash is disabled or not installed",\n      "flash-outdated": "Flash is too outdated to support ZeroClipboard",\n      "flash-unavailable": "Flash is unable to communicate bidirectionally with JavaScript",\n      "flash-deactivated": "Flash is too outdated for your browser and/or is configured as click-to-activate",\n      "flash-overdue": "Flash communication was established but NOT within the acceptable time limit"\n    }\n  };\n  var _createEvent = function _createEvent(eventType, event) {\n    if (!(eventType || event && event.type)) {\n      return;\n    }\n    event = event || {};\n    eventType = (eventType || event.type).toLowerCase();\n    _extend(event, {\n      type: eventType,\n      target: event.target || _currentElement || null,\n      relatedTarget: event.relatedTarget || null,\n      currentTarget: _flashState && _flashState.bridge || null\n    });\n    var msg = _eventMessages[event.type];\n    if (event.type === "error" && event.name && msg) {\n      msg = msg[event.name];\n    }\n    if (msg) {\n      event.message = msg;\n    }\n    if (event.type === "ready") {\n      _extend(event, {\n        target: null,\n        version: _flashState.version\n      });\n    }\n    if (event.type === "error") {\n      event.target = null;\n      if (/^flash-(outdated|unavailable|deactivated|overdue)$/.test(event.name)) {\n        _extend(event, {\n          version: _flashState.version,\n          minimumVersion: "11.0.0"\n        });\n      }\n    }\n    if (event.type === "copy") {\n      event.clipboardData = {\n        setData: ZeroClipboard.setData,\n        clearData: ZeroClipboard.clearData\n      };\n    }\n    if (event.type === "aftercopy") {\n      event = _mapClipResultsFromFlash(event, _clipDataFormatMap);\n    }\n    if (event.target && !event.relatedTarget) {\n      event.relatedTarget = _getRelatedTarget(event.target);\n    }\n    return event;\n  };\n  var _getRelatedTarget = function _getRelatedTarget(targetEl) {\n    var relatedTargetId = targetEl && targetEl.getAttribute && targetEl.getAttribute("data-clipboard-target");\n    return relatedTargetId ? document.getElementById(relatedTargetId) : null;\n  };\n  var _preprocessEvent = function _preprocessEvent(event) {\n    var element = event.target || _currentElement;\n    switch (event.type) {\n      case "error":\n        if (_inArray(event.name, ["flash-disabled", "flash-outdated", "flash-deactivated", "flash-overdue"])) {\n          _extend(_flashState, {\n            disabled: event.name === "flash-disabled",\n            outdated: event.name === "flash-outdated",\n            unavailable: event.name === "flash-unavailable",\n            deactivated: event.name === "flash-deactivated",\n            overdue: event.name === "flash-overdue",\n            ready: false\n          });\n        }\n        break;\n\n      case "ready":\n        var wasDeactivated = _flashState.deactivated === true;\n        _extend(_flashState, {\n          disabled: false,\n          outdated: false,\n          unavailable: false,\n          deactivated: false,\n          overdue: wasDeactivated,\n          ready: !wasDeactivated\n        });\n        break;\n\n      case "copy":\n        var textContent,\n            htmlContent,\n            targetEl = event.relatedTarget;\n        if (!(_clipData["text/html"] || _clipData["text/plain"]) && targetEl && (htmlContent = targetEl.value || targetEl.outerHTML || targetEl.innerHTML) && (textContent = targetEl.value || targetEl.textContent || targetEl.innerText)) {\n          event.clipboardData.clearData();\n          event.clipboardData.setData("text/plain", textContent);\n          if (htmlContent !== textContent) {\n            event.clipboardData.setData("text/html", htmlContent);\n          }\n        } else if (!_clipData["text/plain"] && event.target && (textContent = event.target.getAttribute("data-clipboard-text"))) {\n          event.clipboardData.clearData();\n          event.clipboardData.setData("text/plain", textContent);\n        }\n        break;\n\n      case "aftercopy":\n        ZeroClipboard.clearData();\n        if (element && element !== _safeActiveElement() && element.focus) {\n          element.focus();\n        }\n        break;\n\n      case "mouseover":\n        _addClass(element, _globalConfig.hoverClass);\n        break;\n\n      case "mouseout":\n        if (_globalConfig.autoActivate === true) {\n          ZeroClipboard.deactivate();\n        }\n        break;\n\n      case "mousedown":\n        _addClass(element, _globalConfig.activeClass);\n        break;\n\n      case "mouseup":\n        _removeClass(element, _globalConfig.activeClass);\n        break;\n    }\n  };\n  ZeroClipboard.prototype.on = function (eventName, func) {\n    var i,\n        len,\n        events,\n        added = {},\n        handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n    if (typeof eventName === "string" && eventName) {\n      events = eventName.toLowerCase().split(/\\s+/);\n    } else if (typeof eventName === "object" && eventName && typeof func === "undefined") {\n      for (i in eventName) {\n        if (eventName.hasOwnProperty(i) && typeof i === "string" && i && typeof eventName[i] === "function") {\n          this.on(i, eventName[i]);\n        }\n      }\n    }\n    if (events && events.length) {\n      for (i = 0, len = events.length; i < len; i++) {\n        eventName = events[i].replace(/^on/, "");\n        added[eventName] = true;\n        if (!handlers[eventName]) {\n          handlers[eventName] = [];\n        }\n        handlers[eventName].push(func);\n      }\n      if (added.ready && _flashState.ready) {\n        ZeroClipboard.emit({\n          type: "ready",\n          client: this\n        });\n      }\n      if (added.error) {\n        var errorTypes = ["disabled", "outdated", "unavailable", "deactivated", "overdue"];\n        for (i = 0, len = errorTypes.length; i < len; i++) {\n          if (_flashState[errorTypes[i]]) {\n            ZeroClipboard.emit({\n              type: "error",\n              name: "flash-" + errorTypes[i],\n              client: this\n            });\n            break;\n          }\n        }\n      }\n    }\n    return this;\n  };\n  ZeroClipboard.prototype.off = function (eventName, func) {\n    var i,\n        len,\n        foundIndex,\n        events,\n        perEventHandlers,\n        handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n    if (arguments.length === 0) {\n      events = _objectKeys(handlers);\n    } else if (typeof eventName === "string" && eventName) {\n      events = eventName.split(/\\s+/);\n    } else if (typeof eventName === "object" && eventName && typeof func === "undefined") {\n      for (i in eventName) {\n        if (eventName.hasOwnProperty(i) && typeof i === "string" && i && typeof eventName[i] === "function") {\n          this.off(i, eventName[i]);\n        }\n      }\n    }\n    if (events && events.length) {\n      for (i = 0, len = events.length; i < len; i++) {\n        eventName = events[i].toLowerCase().replace(/^on/, "");\n        perEventHandlers = handlers[eventName];\n        if (perEventHandlers && perEventHandlers.length) {\n          if (func) {\n            foundIndex = _inArray(func, perEventHandlers);\n            while (foundIndex !== -1) {\n              perEventHandlers.splice(foundIndex, 1);\n              foundIndex = _inArray(func, perEventHandlers, foundIndex);\n            }\n          } else {\n            handlers[eventName].length = 0;\n          }\n        }\n      }\n    }\n    return this;\n  };\n  ZeroClipboard.prototype.handlers = function (eventName) {\n    var prop,\n        copy = null,\n        handlers = _clientMeta[this.id] && _clientMeta[this.id].handlers;\n    if (handlers) {\n      if (typeof eventName === "string" && eventName) {\n        return handlers[eventName] ? handlers[eventName].slice(0) : null;\n      }\n      copy = {};\n      for (prop in handlers) {\n        if (handlers.hasOwnProperty(prop) && handlers[prop]) {\n          copy[prop] = handlers[prop].slice(0);\n        }\n      }\n    }\n    return copy;\n  };\n  ZeroClipboard.prototype.clip = function (elements) {\n    elements = _prepClip(elements);\n    for (var i = 0; i < elements.length; i++) {\n      if (elements.hasOwnProperty(i) && elements[i] && elements[i].nodeType === 1) {\n        if (!elements[i].zcClippingId) {\n          elements[i].zcClippingId = "zcClippingId_" + _elementIdCounter++;\n          _elementMeta[elements[i].zcClippingId] = [this.id];\n          if (_globalConfig.autoActivate === true) {\n            _addEventHandler(elements[i], "mouseover", _elementMouseOver);\n          }\n        } else if (_inArray(this.id, _elementMeta[elements[i].zcClippingId]) === -1) {\n          _elementMeta[elements[i].zcClippingId].push(this.id);\n        }\n        var clippedElements = _clientMeta[this.id].elements;\n        if (_inArray(elements[i], clippedElements) === -1) {\n          clippedElements.push(elements[i]);\n        }\n      }\n    }\n    return this;\n  };\n  ZeroClipboard.prototype.unclip = function (elements) {\n    var meta = _clientMeta[this.id];\n    if (!meta) {\n      return this;\n    }\n    var clippedElements = meta.elements;\n    var arrayIndex;\n    if (typeof elements === "undefined") {\n      elements = clippedElements.slice(0);\n    } else {\n      elements = _prepClip(elements);\n    }\n    for (var i = elements.length; i--;) {\n      if (elements.hasOwnProperty(i) && elements[i] && elements[i].nodeType === 1) {\n        arrayIndex = 0;\n        while ((arrayIndex = _inArray(elements[i], clippedElements, arrayIndex)) !== -1) {\n          clippedElements.splice(arrayIndex, 1);\n        }\n        var clientIds = _elementMeta[elements[i].zcClippingId];\n        if (clientIds) {\n          arrayIndex = 0;\n          while ((arrayIndex = _inArray(this.id, clientIds, arrayIndex)) !== -1) {\n            clientIds.splice(arrayIndex, 1);\n          }\n          if (clientIds.length === 0) {\n            if (_globalConfig.autoActivate === true) {\n              _removeEventHandler(elements[i], "mouseover", _elementMouseOver);\n            }\n            delete elements[i].zcClippingId;\n          }\n        }\n      }\n    }\n    return this;\n  };\n  ZeroClipboard.prototype.elements = function () {\n    var meta = _clientMeta[this.id];\n    return meta && meta.elements ? meta.elements.slice(0) : [];\n  };\n  var _getAllClientsClippedToElement = function _getAllClientsClippedToElement(element) {\n    var elementMetaId,\n        clientIds,\n        i,\n        len,\n        client,\n        clients = [];\n    if (element && element.nodeType === 1 && (elementMetaId = element.zcClippingId) && _elementMeta.hasOwnProperty(elementMetaId)) {\n      clientIds = _elementMeta[elementMetaId];\n      if (clientIds && clientIds.length) {\n        for (i = 0, len = clientIds.length; i < len; i++) {\n          client = _clientMeta[clientIds[i]].instance;\n          if (client && client instanceof ZeroClipboard) {\n            clients.push(client);\n          }\n        }\n      }\n    }\n    return clients;\n  };\n  _globalConfig.hoverClass = "zeroclipboard-is-hover";\n  _globalConfig.activeClass = "zeroclipboard-is-active";\n  if (typeof define === "function" && define.amd) {\n    define(function () {\n      return ZeroClipboard;\n    });\n  } else if (typeof module === "object" && module && typeof module.exports === "object" && module.exports) {\n    module.exports = ZeroClipboard;\n  } else {\n    window.ZeroClipboard = ZeroClipboard;\n  }\n})((function () {\n  return this || window;\n})());';
},function(e,t){e.exports="/*!\r\n * UEditor\r\n * version: ueditor\r\n * build: Sun Mar 06 2016 16:58:05 GMT+0800 (CST)\r\n */'use strict';(function(){ // editor.js\nUEDITOR_CONFIG = window.UEDITOR_CONFIG || {};var baidu=window.baidu || {};window.baidu = baidu;window.UE = baidu.editor = window.UE || {};UE.plugins = {};UE.commands = {};UE.instants = {};UE.I18N = {};UE._customizeUI = {};UE.version = \"1.4.3\";var dom=UE.dom = {}; // core/browser.js\n/**\r\n * 浏览器判断模块\r\n * @file\r\n * @module UE.browser\r\n * @since 1.2.6.1\r\n */ /**\r\n * 提供浏览器检测的模块\r\n * @unfile\r\n * @module UE.browser\r\n */var browser=UE.browser = (function(){var agent=navigator.userAgent.toLowerCase(),opera=window.opera,browser={ /**\r\n         * @property {boolean} ie 检测当前浏览器是否为IE\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.ie ) {\r\n         *     console.log( '当前浏览器是IE' );\r\n         * }\r\n         * ```\r\n         */ie:/(msie\\s|trident.*rv:)([\\w.]+)/.test(agent), /**\r\n         * @property {boolean} opera 检测当前浏览器是否为Opera\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.opera ) {\r\n         *     console.log( '当前浏览器是Opera' );\r\n         * }\r\n         * ```\r\n         */opera:!!opera && opera.version, /**\r\n         * @property {boolean} webkit 检测当前浏览器是否是webkit内核的浏览器\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.webkit ) {\r\n         *     console.log( '当前浏览器是webkit内核浏览器' );\r\n         * }\r\n         * ```\r\n         */webkit:agent.indexOf(' applewebkit/') > -1, /**\r\n         * @property {boolean} mac 检测当前浏览器是否是运行在mac平台下\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.mac ) {\r\n         *     console.log( '当前浏览器运行在mac平台下' );\r\n         * }\r\n         * ```\r\n         */mac:agent.indexOf('macintosh') > -1, /**\r\n         * @property {boolean} quirks 检测当前浏览器是否处于“怪异模式”下\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.quirks ) {\r\n         *     console.log( '当前浏览器运行处于“怪异模式”' );\r\n         * }\r\n         * ```\r\n         */quirks:document.compatMode == 'BackCompat'}; /**\r\n    * @property {boolean} gecko 检测当前浏览器内核是否是gecko内核\r\n    * @example\r\n    * ```javascript\r\n    * if ( UE.browser.gecko ) {\r\n    *     console.log( '当前浏览器内核是gecko内核' );\r\n    * }\r\n    * ```\r\n    */browser.gecko = navigator.product == 'Gecko' && !browser.webkit && !browser.opera && !browser.ie;var version=0; // Internet Explorer 6.0+\nif(browser.ie){var v1=agent.match(/(?:msie\\s([\\w.]+))/);var v2=agent.match(/(?:trident.*rv:([\\w.]+))/);if(v1 && v2 && v1[1] && v2[1]){version = Math.max(v1[1] * 1,v2[1] * 1);}else if(v1 && v1[1]){version = v1[1] * 1;}else if(v2 && v2[1]){version = v2[1] * 1;}else {version = 0;}browser.ie11Compat = document.documentMode == 11; /**\r\n         * @property { boolean } ie9Compat 检测浏览器模式是否为 IE9 兼容模式\r\n         * @warning 如果浏览器不是IE， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.ie9Compat ) {\r\n         *     console.log( '当前浏览器运行在IE9兼容模式下' );\r\n         * }\r\n         * ```\r\n         */browser.ie9Compat = document.documentMode == 9; /**\r\n         * @property { boolean } ie8 检测浏览器是否是IE8浏览器\r\n         * @warning 如果浏览器不是IE， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.ie8 ) {\r\n         *     console.log( '当前浏览器是IE8浏览器' );\r\n         * }\r\n         * ```\r\n         */browser.ie8 = !!document.documentMode; /**\r\n         * @property { boolean } ie8Compat 检测浏览器模式是否为 IE8 兼容模式\r\n         * @warning 如果浏览器不是IE， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.ie8Compat ) {\r\n         *     console.log( '当前浏览器运行在IE8兼容模式下' );\r\n         * }\r\n         * ```\r\n         */browser.ie8Compat = document.documentMode == 8; /**\r\n         * @property { boolean } ie7Compat 检测浏览器模式是否为 IE7 兼容模式\r\n         * @warning 如果浏览器不是IE， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.ie7Compat ) {\r\n         *     console.log( '当前浏览器运行在IE7兼容模式下' );\r\n         * }\r\n         * ```\r\n         */browser.ie7Compat = version == 7 && !document.documentMode || document.documentMode == 7; /**\r\n         * @property { boolean } ie6Compat 检测浏览器模式是否为 IE6 模式 或者怪异模式\r\n         * @warning 如果浏览器不是IE， 则该值为undefined\r\n         * @example\r\n         * ```javascript\r\n         * if ( UE.browser.ie6Compat ) {\r\n         *     console.log( '当前浏览器运行在IE6模式或者怪异模式下' );\r\n         * }\r\n         * ```\r\n         */browser.ie6Compat = version < 7 || browser.quirks;browser.ie9above = version > 8;browser.ie9below = version < 9;browser.ie11above = version > 10;browser.ie11below = version < 11;} // Gecko.\nif(browser.gecko){var geckoRelease=agent.match(/rv:([\\d\\.]+)/);if(geckoRelease){geckoRelease = geckoRelease[1].split('.');version = geckoRelease[0] * 10000 + (geckoRelease[1] || 0) * 100 + (geckoRelease[2] || 0) * 1;}} /**\r\n     * @property { Number } chrome 检测当前浏览器是否为Chrome, 如果是，则返回Chrome的大版本号\r\n     * @warning 如果浏览器不是chrome， 则该值为undefined\r\n     * @example\r\n     * ```javascript\r\n     * if ( UE.browser.chrome ) {\r\n     *     console.log( '当前浏览器是Chrome' );\r\n     * }\r\n     * ```\r\n     */if(/chrome\\/(\\d+\\.\\d)/i.test(agent)){browser.chrome = +RegExp['\\x241'];} /**\r\n     * @property { Number } safari 检测当前浏览器是否为Safari, 如果是，则返回Safari的大版本号\r\n     * @warning 如果浏览器不是safari， 则该值为undefined\r\n     * @example\r\n     * ```javascript\r\n     * if ( UE.browser.safari ) {\r\n     *     console.log( '当前浏览器是Safari' );\r\n     * }\r\n     * ```\r\n     */if(/(\\d+\\.\\d)?(?:\\.\\d)?\\s+safari\\/?(\\d+\\.\\d+)?/i.test(agent) && !/chrome/i.test(agent)){browser.safari = +(RegExp['\\x241'] || RegExp['\\x242']);} // Opera 9.50+\nif(browser.opera)version = parseFloat(opera.version()); // WebKit 522+ (Safari 3+)\nif(browser.webkit)version = parseFloat(agent.match(/ applewebkit\\/(\\d+)/)[1]); /**\r\n     * @property { Number } version 检测当前浏览器版本号\r\n     * @remind\r\n     * <ul>\r\n     *     <li>IE系列返回值为5,6,7,8,9,10等</li>\r\n     *     <li>gecko系列会返回10900，158900等</li>\r\n     *     <li>webkit系列会返回其build号 (如 522等)</li>\r\n     * </ul>\r\n     * @example\r\n     * ```javascript\r\n     * console.log( '当前浏览器版本号是： ' + UE.browser.version );\r\n     * ```\r\n     */browser.version = version; /**\r\n     * @property { boolean } isCompatible 检测当前浏览器是否能够与UEditor良好兼容\r\n     * @example\r\n     * ```javascript\r\n     * if ( UE.browser.isCompatible ) {\r\n     *     console.log( '浏览器与UEditor能够良好兼容' );\r\n     * }\r\n     * ```\r\n     */browser.isCompatible = !browser.mobile && (browser.ie && version >= 6 || browser.gecko && version >= 10801 || browser.opera && version >= 9.5 || browser.air && version >= 1 || browser.webkit && version >= 522 || false);return browser;})(); //快捷方式\nvar ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera; // core/utils.js\n/**\r\n * 工具函数包\r\n * @file\r\n * @module UE.utils\r\n * @since 1.2.6.1\r\n */ /**\r\n * UEditor封装使用的静态工具函数\r\n * @module UE.utils\r\n * @unfile\r\n */var utils=UE.utils = { /**\r\n     * 用给定的迭代器遍历对象\r\n     * @method each\r\n     * @param { Object } obj 需要遍历的对象\r\n     * @param { Function } iterator 迭代器， 该方法接受两个参数， 第一个参数是当前所处理的value， 第二个参数是当前遍历对象的key\r\n     * @example\r\n     * ```javascript\r\n     * var demoObj = {\r\n     *     key1: 1,\r\n     *     key2: 2\r\n     * };\r\n     *\r\n     * //output: key1: 1, key2: 2\r\n     * UE.utils.each( demoObj, funciton ( value, key ) {\r\n     *\r\n     *     console.log( key + \":\" + value );\r\n     *\r\n     * } );\r\n     * ```\r\n     */ /**\r\n     * 用给定的迭代器遍历数组或类数组对象\r\n     * @method each\r\n     * @param { Array } array 需要遍历的数组或者类数组\r\n     * @param { Function } iterator 迭代器， 该方法接受两个参数， 第一个参数是当前所处理的value， 第二个参数是当前遍历对象的key\r\n     * @example\r\n     * ```javascript\r\n     * var divs = document.getElmentByTagNames( \"div\" );\r\n     *\r\n     * //output: 0: DIV, 1: DIV ...\r\n     * UE.utils.each( divs, funciton ( value, key ) {\r\n     *\r\n     *     console.log( key + \":\" + value.tagName );\r\n     *\r\n     * } );\r\n     * ```\r\n     */each:function each(obj,iterator,context){if(obj == null)return;if(obj.length === +obj.length){for(var i=0,l=obj.length;i < l;i++) {if(iterator.call(context,obj[i],i,obj) === false)return false;}}else {for(var key in obj) {if(obj.hasOwnProperty(key)){if(iterator.call(context,obj[key],key,obj) === false)return false;}}}}, /**\r\n     * 以给定对象作为原型创建一个新对象\r\n     * @method makeInstance\r\n     * @param { Object } protoObject 该对象将作为新创建对象的原型\r\n     * @return { Object } 新的对象， 该对象的原型是给定的protoObject对象\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var protoObject = { sayHello: function () { console.log('Hello UEditor!'); } };\r\n     *\r\n     * var newObject = UE.utils.makeInstance( protoObject );\r\n     * //output: Hello UEditor!\r\n     * newObject.sayHello();\r\n     * ```\r\n     */makeInstance:function makeInstance(obj){var noop=new Function();noop.prototype = obj;obj = new noop();noop.prototype = null;return obj;}, /**\r\n     * 将source对象中的属性扩展到target对象上\r\n     * @method extend\r\n     * @remind 该方法将强制把source对象上的属性复制到target对象上\r\n     * @see UE.utils.extend(Object,Object,Boolean)\r\n     * @param { Object } target 目标对象， 新的属性将附加到该对象上\r\n     * @param { Object } source 源对象， 该对象的属性会被附加到target对象上\r\n     * @return { Object } 返回target对象\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var target = { name: 'target', sex: 1 },\r\n     *      source = { name: 'source', age: 17 };\r\n     *\r\n     * UE.utils.extend( target, source );\r\n     *\r\n     * //output: { name: 'source', sex: 1, age: 17 }\r\n     * console.log( target );\r\n     *\r\n     * ```\r\n     */ /**\r\n     * 将source对象中的属性扩展到target对象上， 根据指定的isKeepTarget值决定是否保留目标对象中与\r\n     * 源对象属性名相同的属性值。\r\n     * @method extend\r\n     * @param { Object } target 目标对象， 新的属性将附加到该对象上\r\n     * @param { Object } source 源对象， 该对象的属性会被附加到target对象上\r\n     * @param { Boolean } isKeepTarget 是否保留目标对象中与源对象中属性名相同的属性\r\n     * @return { Object } 返回target对象\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var target = { name: 'target', sex: 1 },\r\n     *      source = { name: 'source', age: 17 };\r\n     *\r\n     * UE.utils.extend( target, source, true );\r\n     *\r\n     * //output: { name: 'target', sex: 1, age: 17 }\r\n     * console.log( target );\r\n     *\r\n     * ```\r\n     */extend:function extend(t,s,b){if(s){for(var k in s) {if(!b || !t.hasOwnProperty(k)){t[k] = s[k];}}}return t;}, /**\r\n     * 将给定的多个对象的属性复制到目标对象target上\r\n     * @method extend2\r\n     * @remind 该方法将强制把源对象上的属性复制到target对象上\r\n     * @remind 该方法支持两个及以上的参数， 从第二个参数开始， 其属性都会被复制到第一个参数上。 如果遇到同名的属性，\r\n     *          将会覆盖掉之前的值。\r\n     * @param { Object } target 目标对象， 新的属性将附加到该对象上\r\n     * @param { Object... } source 源对象， 支持多个对象， 该对象的属性会被附加到target对象上\r\n     * @return { Object } 返回target对象\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var target = {},\r\n     *     source1 = { name: 'source', age: 17 },\r\n     *     source2 = { title: 'dev' };\r\n     *\r\n     * UE.utils.extend2( target, source1, source2 );\r\n     *\r\n     * //output: { name: 'source', age: 17, title: 'dev' }\r\n     * console.log( target );\r\n     *\r\n     * ```\r\n     */extend2:function extend2(t){var a=arguments;for(var i=1;i < a.length;i++) {var x=a[i];for(var k in x) {if(!t.hasOwnProperty(k)){t[k] = x[k];}}}return t;}, /**\r\n     * 模拟继承机制， 使得subClass继承自superClass\r\n     * @method inherits\r\n     * @param { Object } subClass 子类对象\r\n     * @param { Object } superClass 超类对象\r\n     * @warning 该方法只能让subClass继承超类的原型， subClass对象自身的属性和方法不会被继承\r\n     * @return { Object } 继承superClass后的子类对象\r\n     * @example\r\n     * ```javascript\r\n     * function SuperClass(){\r\n     *     this.name = \"小李\";\r\n     * }\r\n     *\r\n     * SuperClass.prototype = {\r\n     *     hello:function(str){\r\n     *         console.log(this.name + str);\r\n     *     }\r\n     * }\r\n     *\r\n     * function SubClass(){\r\n     *     this.name = \"小张\";\r\n     * }\r\n     *\r\n     * UE.utils.inherits(SubClass,SuperClass);\r\n     *\r\n     * var sub = new SubClass();\r\n     * //output: '小张早上好!\r\n     * sub.hello(\"早上好!\");\r\n     * ```\r\n     */inherits:function inherits(subClass,superClass){var oldP=subClass.prototype,newP=utils.makeInstance(superClass.prototype);utils.extend(newP,oldP,true);subClass.prototype = newP;return newP.constructor = subClass;}, /**\r\n     * 用指定的context对象作为函数fn的上下文\r\n     * @method bind\r\n     * @param { Function } fn 需要绑定上下文的函数对象\r\n     * @param { Object } content 函数fn新的上下文对象\r\n     * @return { Function } 一个新的函数， 该函数作为原始函数fn的代理， 将完成fn的上下文调换工作。\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var name = 'window',\r\n     *     newTest = null;\r\n     *\r\n     * function test () {\r\n     *     console.log( this.name );\r\n     * }\r\n     *\r\n     * newTest = UE.utils.bind( test, { name: 'object' } );\r\n     *\r\n     * //output: object\r\n     * newTest();\r\n     *\r\n     * //output: window\r\n     * test();\r\n     *\r\n     * ```\r\n     */bind:function bind(fn,context){return function(){return fn.apply(context,arguments);};}, /**\r\n     * 创建延迟指定时间后执行的函数fn\r\n     * @method defer\r\n     * @param { Function } fn 需要延迟执行的函数对象\r\n     * @param { int } delay 延迟的时间， 单位是毫秒\r\n     * @warning 该方法的时间控制是不精确的，仅仅只能保证函数的执行是在给定的时间之后，\r\n     *           而不能保证刚好到达延迟时间时执行。\r\n     * @return { Function } 目标函数fn的代理函数， 只有执行该函数才能起到延时效果\r\n     * @example\r\n     * ```javascript\r\n     * var start = 0;\r\n     *\r\n     * function test(){\r\n     *     console.log( new Date() - start );\r\n     * }\r\n     *\r\n     * var testDefer = UE.utils.defer( test, 1000 );\r\n     * //\r\n     * start = new Date();\r\n     * //output: (大约在1000毫秒之后输出) 1000\r\n     * testDefer();\r\n     * ```\r\n     */ /**\r\n     * 创建延迟指定时间后执行的函数fn, 如果在延迟时间内再次执行该方法， 将会根据指定的exclusion的值，\r\n     * 决定是否取消前一次函数的执行， 如果exclusion的值为true， 则取消执行，反之，将继续执行前一个方法。\r\n     * @method defer\r\n     * @param { Function } fn 需要延迟执行的函数对象\r\n     * @param { int } delay 延迟的时间， 单位是毫秒\r\n     * @param { Boolean } exclusion 如果在延迟时间内再次执行该函数，该值将决定是否取消执行前一次函数的执行，\r\n     *                     值为true表示取消执行， 反之则将在执行前一次函数之后才执行本次函数调用。\r\n     * @warning 该方法的时间控制是不精确的，仅仅只能保证函数的执行是在给定的时间之后，\r\n     *           而不能保证刚好到达延迟时间时执行。\r\n     * @return { Function } 目标函数fn的代理函数， 只有执行该函数才能起到延时效果\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * function test(){\r\n     *     console.log(1);\r\n     * }\r\n     *\r\n     * var testDefer = UE.utils.defer( test, 1000, true );\r\n     *\r\n     * //output: (两次调用仅有一次输出) 1\r\n     * testDefer();\r\n     * testDefer();\r\n     * ```\r\n     */defer:function defer(fn,delay,exclusion){var timerID;return function(){if(exclusion){clearTimeout(timerID);}timerID = setTimeout(fn,delay);};}, /**\r\n     * 获取元素item在数组array中首次出现的位置, 如果未找到item， 则返回-1\r\n     * @method indexOf\r\n     * @remind 该方法的匹配过程使用的是恒等“===”\r\n     * @param { Array } array 需要查找的数组对象\r\n     * @param { * } item 需要在目标数组中查找的值\r\n     * @return { int } 返回item在目标数组array中首次出现的位置， 如果在数组中未找到item， 则返回-1\r\n     * @example\r\n     * ```javascript\r\n     * var item = 1,\r\n     *     arr = [ 3, 4, 6, 8, 1, 1, 2 ];\r\n     *\r\n     * //output: 4\r\n     * console.log( UE.utils.indexOf( arr, item ) );\r\n     * ```\r\n     */ /**\r\n     * 获取元素item数组array中首次出现的位置, 如果未找到item， 则返回-1。通过start的值可以指定搜索的起始位置。\r\n     * @method indexOf\r\n     * @remind 该方法的匹配过程使用的是恒等“===”\r\n     * @param { Array } array 需要查找的数组对象\r\n     * @param { * } item 需要在目标数组中查找的值\r\n     * @param { int } start 搜索的起始位置\r\n     * @return { int } 返回item在目标数组array中的start位置之后首次出现的位置， 如果在数组中未找到item， 则返回-1\r\n     * @example\r\n     * ```javascript\r\n     * var item = 1,\r\n     *     arr = [ 3, 4, 6, 8, 1, 2, 8, 3, 2, 1, 1, 4 ];\r\n     *\r\n     * //output: 9\r\n     * console.log( UE.utils.indexOf( arr, item, 5 ) );\r\n     * ```\r\n     */indexOf:function indexOf(array,item,start){var index=-1;start = this.isNumber(start)?start:0;this.each(array,function(v,i){if(i >= start && v === item){index = i;return false;}});return index;}, /**\r\n     * 移除数组array中所有的元素item\r\n     * @method removeItem\r\n     * @param { Array } array 要移除元素的目标数组\r\n     * @param { * } item 将要被移除的元素\r\n     * @remind 该方法的匹配过程使用的是恒等“===”\r\n     * @example\r\n     * ```javascript\r\n     * var arr = [ 4, 5, 7, 1, 3, 4, 6 ];\r\n     *\r\n     * UE.utils.removeItem( arr, 4 );\r\n     * //output: [ 5, 7, 1, 3, 6 ]\r\n     * console.log( arr );\r\n     *\r\n     * ```\r\n     */removeItem:function removeItem(array,item){for(var i=0,l=array.length;i < l;i++) {if(array[i] === item){array.splice(i,1);i--;}}}, /**\r\n     * 删除字符串str的首尾空格\r\n     * @method trim\r\n     * @param { String } str 需要删除首尾空格的字符串\r\n     * @return { String } 删除了首尾的空格后的字符串\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var str = \" UEdtior \";\r\n     *\r\n     * //output: 9\r\n     * console.log( str.length );\r\n     *\r\n     * //output: 7\r\n     * console.log( UE.utils.trim( \" UEdtior \" ).length );\r\n     *\r\n     * //output: 9\r\n     * console.log( str.length );\r\n     *\r\n     *  ```\r\n     */trim:function trim(str){return str.replace(/(^[ \\t\\n\\r]+)|([ \\t\\n\\r]+$)/g,'');}, /**\r\n     * 将字符串str以','分隔成数组后，将该数组转换成哈希对象， 其生成的hash对象的key为数组中的元素， value为1\r\n     * @method listToMap\r\n     * @warning 该方法在生成的hash对象中，会为每一个key同时生成一个另一个全大写的key。\r\n     * @param { String } str 该字符串将被以','分割为数组， 然后进行转化\r\n     * @return { Object } 转化之后的hash对象\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * //output: Object {UEdtior: 1, UEDTIOR: 1, Hello: 1, HELLO: 1}\r\n     * console.log( UE.utils.listToMap( 'UEdtior,Hello' ) );\r\n     *\r\n     * ```\r\n     */ /**\r\n     * 将字符串数组转换成哈希对象， 其生成的hash对象的key为数组中的元素， value为1\r\n     * @method listToMap\r\n     * @warning 该方法在生成的hash对象中，会为每一个key同时生成一个另一个全大写的key。\r\n     * @param { Array } arr 字符串数组\r\n     * @return { Object } 转化之后的hash对象\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * //output: Object {UEdtior: 1, UEDTIOR: 1, Hello: 1, HELLO: 1}\r\n     * console.log( UE.utils.listToMap( [ 'UEdtior', 'Hello' ] ) );\r\n     *\r\n     * ```\r\n     */listToMap:function listToMap(list){if(!list)return {};list = utils.isArray(list)?list:list.split(',');for(var i=0,ci,obj={};ci = list[i++];) {obj[ci.toUpperCase()] = obj[ci] = 1;}return obj;}, /**\r\n     * 将str中的html符号转义,将转义“'，&，<，\"，>”五个字符\r\n     * @method unhtml\r\n     * @param { String } str 需要转义的字符串\r\n     * @return { String } 转义后的字符串\r\n     * @example\r\n     * ```javascript\r\n     * var html = '<body>&</body>';\r\n     *\r\n     * //output: &lt;body&gt;&amp;&lt;/body&gt;\r\n     * console.log( UE.utils.unhtml( html ) );\r\n     *\r\n     * ```\r\n     */unhtml:function unhtml(str,reg){return str?str.replace(reg || /[&<\">'](?:(amp|lt|quot|gt|#39|nbsp|#\\d+);)?/g,function(a,b){if(b){return a;}else {return ({'<':'&lt;','&':'&amp;','\"':'&quot;','>':'&gt;',\"'\":'&#39;'})[a];}}):'';}, /**\r\n     * 将str中的转义字符还原成html字符\r\n     * @see UE.utils.unhtml(String);\r\n     * @method html\r\n     * @param { String } str 需要逆转义的字符串\r\n     * @return { String } 逆转义后的字符串\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var str = '&lt;body&gt;&amp;&lt;/body&gt;';\r\n     *\r\n     * //output: <body>&</body>\r\n     * console.log( UE.utils.html( str ) );\r\n     *\r\n     * ```\r\n     */html:function html(str){return str?str.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(m){return ({'&lt;':'<','&amp;':'&','&quot;':'\"','&gt;':'>','&#39;':\"'\",'&nbsp;':' '})[m];}):'';}, /**\r\n     * 将css样式转换为驼峰的形式\r\n     * @method cssStyleToDomStyle\r\n     * @param { String } cssName 需要转换的css样式名\r\n     * @return { String } 转换成驼峰形式后的css样式名\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var str = 'border-top';\r\n     *\r\n     * //output: borderTop\r\n     * console.log( UE.utils.cssStyleToDomStyle( str ) );\r\n     *\r\n     * ```\r\n     */cssStyleToDomStyle:(function(){var test=document.createElement('div').style,cache={'float':test.cssFloat != undefined?'cssFloat':test.styleFloat != undefined?'styleFloat':'float'};return function(cssName){return cache[cssName] || (cache[cssName] = cssName.toLowerCase().replace(/-./g,function(match){return match.charAt(1).toUpperCase();}));};})(), /**\r\n     * 动态加载文件到doc中\r\n     * @method loadFile\r\n     * @param { DomDocument } document 需要加载资源文件的文档对象\r\n     * @param { Object } options 加载资源文件的属性集合， 取值请参考代码示例\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * UE.utils.loadFile( document, {\r\n     *     src:\"test.js\",\r\n     *     tag:\"script\",\r\n     *     type:\"text/javascript\",\r\n     *     defer:\"defer\"\r\n     * } );\r\n     *\r\n     * ```\r\n     */ /**\r\n     * 动态加载文件到doc中，加载成功后执行的回调函数fn\r\n     * @method loadFile\r\n     * @param { DomDocument } document 需要加载资源文件的文档对象\r\n     * @param { Object } options 加载资源文件的属性集合， 该集合支持的值是script标签和style标签支持的所有属性。\r\n     * @param { Function } fn 资源文件加载成功之后执行的回调\r\n     * @warning 对于在同一个文档中多次加载同一URL的文件， 该方法会在第一次加载之后缓存该请求，\r\n     *           在此之后的所有同一URL的请求， 将会直接触发回调。\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * UE.utils.loadFile( document, {\r\n     *     src:\"test.js\",\r\n     *     tag:\"script\",\r\n     *     type:\"text/javascript\",\r\n     *     defer:\"defer\"\r\n     * }, function () {\r\n     *     console.log('加载成功');\r\n     * } );\r\n     *\r\n     * ```\r\n     */loadFile:(function(){var tmpList=[];function getItem(doc,obj){try{for(var i=0,ci;ci = tmpList[i++];) {if(ci.doc === doc && ci.url == (obj.src || obj.href)){return ci;}}}catch(e) {return null;}}return function(doc,obj,fn){var item=getItem(doc,obj);if(item){if(item.ready){fn && fn();}else {item.funs.push(fn);}return;}tmpList.push({doc:doc,url:obj.src || obj.href,funs:[fn]});if(!doc.body){var html=[];for(var p in obj) {if(p == 'tag')continue;html.push(p + '=\"' + obj[p] + '\"');}doc.write('<' + obj.tag + ' ' + html.join(' ') + ' ></' + obj.tag + '>');return;}if(obj.id && doc.getElementById(obj.id)){return;}var element=doc.createElement(obj.tag);delete obj.tag;for(var p in obj) {element.setAttribute(p,obj[p]);}element.onload = element.onreadystatechange = function(){if(!this.readyState || /loaded|complete/.test(this.readyState)){item = getItem(doc,obj);if(item.funs.length > 0){item.ready = 1;for(var fi;fi = item.funs.pop();) {fi();}}element.onload = element.onreadystatechange = null;}};element.onerror = function(){throw Error('The load ' + (obj.href || obj.src) + ' fails,check the url settings of file ueditor.config.js ');};doc.getElementsByTagName(\"head\")[0].appendChild(element);};})(), /**\r\n     * 判断obj对象是否为空\r\n     * @method isEmptyObject\r\n     * @param { * } obj 需要判断的对象\r\n     * @remind 如果判断的对象是NULL， 将直接返回true， 如果是数组且为空， 返回true， 如果是字符串， 且字符串为空，\r\n     *          返回true， 如果是普通对象， 且该对象没有任何实例属性， 返回true\r\n     * @return { Boolean } 对象是否为空\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * //output: true\r\n     * console.log( UE.utils.isEmptyObject( {} ) );\r\n     *\r\n     * //output: true\r\n     * console.log( UE.utils.isEmptyObject( [] ) );\r\n     *\r\n     * //output: true\r\n     * console.log( UE.utils.isEmptyObject( \"\" ) );\r\n     *\r\n     * //output: false\r\n     * console.log( UE.utils.isEmptyObject( { key: 1 } ) );\r\n     *\r\n     * //output: false\r\n     * console.log( UE.utils.isEmptyObject( [1] ) );\r\n     *\r\n     * //output: false\r\n     * console.log( UE.utils.isEmptyObject( \"1\" ) );\r\n     *\r\n     * ```\r\n     */isEmptyObject:function isEmptyObject(obj){if(obj == null)return true;if(this.isArray(obj) || this.isString(obj))return obj.length === 0;for(var key in obj) if(obj.hasOwnProperty(key))return false;return true;}, /**\r\n     * 把rgb格式的颜色值转换成16进制格式\r\n     * @method fixColor\r\n     * @param { String } rgb格式的颜色值\r\n     * @param { String }\r\n     * @example\r\n     * rgb(255,255,255)  => \"#ffffff\"\r\n     */fixColor:function fixColor(name,value){if(/color/i.test(name) && /rgba?/.test(value)){var array=value.split(\",\");if(array.length > 3)return \"\";value = \"#\";for(var i=0,color;color = array[i++];) {color = parseInt(color.replace(/[^\\d]/gi,''),10).toString(16);value += color.length == 1?\"0\" + color:color;}value = value.toUpperCase();}return value;}, /**\r\n     * 只针对border,padding,margin做了处理，因为性能问题\r\n     * @public\r\n     * @function\r\n     * @param {String}    val style字符串\r\n     */optCss:function optCss(val){var padding,margin,border;val = val.replace(/(padding|margin|border)\\-([^:]+):([^;]+);?/gi,function(str,key,name,val){if(val.split(' ').length == 1){switch(key){case 'padding':!padding && (padding = {});padding[name] = val;return '';case 'margin':!margin && (margin = {});margin[name] = val;return '';case 'border':return val == 'initial'?'':str;}}return str;});function opt(obj,name){if(!obj){return '';}var t=obj.top,b=obj.bottom,l=obj.left,r=obj.right,val='';if(!t || !l || !b || !r){for(var p in obj) {val += ';' + name + '-' + p + ':' + obj[p] + ';';}}else {val += ';' + name + ':' + (t == b && b == l && l == r?t:t == b && l == r?t + ' ' + l:l == r?t + ' ' + l + ' ' + b:t + ' ' + r + ' ' + b + ' ' + l) + ';';}return val;}val += opt(padding,'padding') + opt(margin,'margin');return val.replace(/^[ \\n\\r\\t;]*|[ \\n\\r\\t]*$/,'').replace(/;([ \\n\\r\\t]+)|\\1;/g,';').replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(a,b){return b?b + \";;\":';';});}, /**\r\n     * 克隆对象\r\n     * @method clone\r\n     * @param { Object } source 源对象\r\n     * @return { Object } source的一个副本\r\n     */ /**\r\n     * 深度克隆对象，将source的属性克隆到target对象， 会覆盖target重名的属性。\r\n     * @method clone\r\n     * @param { Object } source 源对象\r\n     * @param { Object } target 目标对象\r\n     * @return { Object } 附加了source对象所有属性的target对象\r\n     */clone:function clone(source,target){var tmp;target = target || {};for(var i in source) {if(source.hasOwnProperty(i)){tmp = source[i];if(typeof tmp == 'object'){target[i] = utils.isArray(tmp)?[]:{};utils.clone(source[i],target[i]);}else {target[i] = tmp;}}}return target;}, /**\r\n     * 把cm／pt为单位的值转换为px为单位的值\r\n     * @method transUnitToPx\r\n     * @param { String } 待转换的带单位的字符串\r\n     * @return { String } 转换为px为计量单位的值的字符串\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * //output: 500px\r\n     * console.log( UE.utils.transUnitToPx( '20cm' ) );\r\n     *\r\n     * //output: 27px\r\n     * console.log( UE.utils.transUnitToPx( '20pt' ) );\r\n     *\r\n     * ```\r\n     */transUnitToPx:function transUnitToPx(val){if(!/(pt|cm)/.test(val)){return val;}var unit;val.replace(/([\\d.]+)(\\w+)/,function(str,v,u){val = v;unit = u;});switch(unit){case 'cm':val = parseFloat(val) * 25;break;case 'pt':val = Math.round(parseFloat(val) * 96 / 72);}return val + (val?'px':'');}, /**\r\n     * 在dom树ready之后执行给定的回调函数\r\n     * @method domReady\r\n     * @remind 如果在执行该方法的时候， dom树已经ready， 那么回调函数将立刻执行\r\n     * @param { Function } fn dom树ready之后的回调函数\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * UE.utils.domReady( function () {\r\n     *\r\n     *     console.log('123');\r\n     *\r\n     * } );\r\n     *\r\n     * ```\r\n     */domReady:(function(){var fnArr=[];function doReady(doc){ //确保onready只执行一次\ndoc.isReady = true;for(var ci;ci = fnArr.pop();ci()) {}}return function(onready,win){win = win || window;var doc=win.document;onready && fnArr.push(onready);if(doc.readyState === \"complete\"){doReady(doc);}else {doc.isReady && doReady(doc);if(browser.ie && browser.version != 11){(function a(){if(doc.isReady)return;try{doc.documentElement.doScroll(\"left\");}catch(error) {setTimeout(a,0);return;}doReady(doc);})();win.attachEvent('onload',function(){doReady(doc);});}else {doc.addEventListener(\"DOMContentLoaded\",function a(){doc.removeEventListener(\"DOMContentLoaded\",a,false);doReady(doc);},false);win.addEventListener('load',function(){doReady(doc);},false);}}};})(), /**\r\n     * 动态添加css样式\r\n     * @method cssRule\r\n     * @param { String } 节点名称\r\n     * @grammar UE.utils.cssRule('添加的样式的节点名称',['样式'，'放到哪个document上'])\r\n     * @grammar UE.utils.cssRule('body','body{background:#ccc}') => null  //给body添加背景颜色\r\n     * @grammar UE.utils.cssRule('body') =>样式的字符串  //取得key值为body的样式的内容,如果没有找到key值先关的样式将返回空，例如刚才那个背景颜色，将返回 body{background:#ccc}\r\n     * @grammar UE.utils.cssRule('body',document) => 返回指定key的样式，并且指定是哪个document\r\n     * @grammar UE.utils.cssRule('body','') =>null //清空给定的key值的背景颜色\r\n     */cssRule:browser.ie && browser.version != 11?function(key,style,doc){var indexList,index;if(style === undefined || style && style.nodeType && style.nodeType == 9){ //获取样式\ndoc = style && style.nodeType && style.nodeType == 9?style:doc || document;indexList = doc.indexList || (doc.indexList = {});index = indexList[key];if(index !== undefined){return doc.styleSheets[index].cssText;}return undefined;}doc = doc || document;indexList = doc.indexList || (doc.indexList = {});index = indexList[key]; //清除样式\nif(style === ''){if(index !== undefined){doc.styleSheets[index].cssText = '';delete indexList[key];return true;}return false;} //添加样式\nif(index !== undefined){sheetStyle = doc.styleSheets[index];}else {sheetStyle = doc.createStyleSheet('',index = doc.styleSheets.length);indexList[key] = index;}sheetStyle.cssText = style;}:function(key,style,doc){var head,node;if(style === undefined || style && style.nodeType && style.nodeType == 9){ //获取样式\ndoc = style && style.nodeType && style.nodeType == 9?style:doc || document;node = doc.getElementById(key);return node?node.innerHTML:undefined;}doc = doc || document;node = doc.getElementById(key); //清除样式\nif(style === ''){if(node){node.parentNode.removeChild(node);return true;}return false;} //添加样式\nif(node){node.innerHTML = style;}else {node = doc.createElement('style');node.id = key;node.innerHTML = style;doc.getElementsByTagName('head')[0].appendChild(node);}},sort:function sort(array,compareFn){compareFn = compareFn || function(item1,item2){return item1.localeCompare(item2);};for(var i=0,len=array.length;i < len;i++) {for(var j=i,length=array.length;j < length;j++) {if(compareFn(array[i],array[j]) > 0){var t=array[i];array[i] = array[j];array[j] = t;}}}return array;},serializeParam:function serializeParam(json){var strArr=[];for(var i in json) { //忽略默认的几个参数\nif(i == \"method\" || i == \"timeout\" || i == \"async\")continue; //传递过来的对象和函数不在提交之列\nif(!((typeof json[i]).toLowerCase() == \"function\" || (typeof json[i]).toLowerCase() == \"object\")){strArr.push(encodeURIComponent(i) + \"=\" + encodeURIComponent(json[i]));}else if(utils.isArray(json[i])){ //支持传数组内容\nfor(var j=0;j < json[i].length;j++) {strArr.push(encodeURIComponent(i) + \"[]=\" + encodeURIComponent(json[i][j]));}}}return strArr.join(\"&\");},formatUrl:function formatUrl(url){var u=url.replace(/&&/g,'&');u = u.replace(/\\?&/g,'?');u = u.replace(/&$/g,'');u = u.replace(/&#/g,'#');u = u.replace(/&+/g,'&');return u;},isCrossDomainUrl:function isCrossDomainUrl(url){var a=document.createElement('a');a.href = url;if(browser.ie){a.href = a.href;}return !(a.protocol == location.protocol && a.hostname == location.hostname && (a.port == location.port || a.port == '80' && location.port == '' || a.port == '' && location.port == '80'));},clearEmptyAttrs:function clearEmptyAttrs(obj){for(var p in obj) {if(obj[p] === ''){delete obj[p];}}return obj;},str2json:function str2json(s){if(!utils.isString(s))return null;if(window.JSON){return JSON.parse(s);}else {return new Function(\"return \" + utils.trim(s || ''))();}},json2str:(function(){if(window.JSON){return JSON.stringify;}else {var escapeMap;var _ret=(function(){var encodeString=function encodeString(source){if(/[\"\\\\\\x00-\\x1f]/.test(source)){source = source.replace(/[\"\\\\\\x00-\\x1f]/g,function(match){var c=escapeMap[match];if(c){return c;}c = match.charCodeAt();return '\\\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);});}return '\"' + source + '\"';};var encodeArray=function encodeArray(source){var result=[\"[\"],l=source.length,preComma,i,item;for(i = 0;i < l;i++) {item = source[i];switch(typeof item){case \"undefined\":case \"function\":case \"unknown\":break;default:if(preComma){result.push(',');}result.push(utils.json2str(item));preComma = 1;}}result.push(\"]\");return result.join(\"\");};var pad=function pad(source){return source < 10?'0' + source:source;};var encodeDate=function encodeDate(source){return '\"' + source.getFullYear() + \"-\" + pad(source.getMonth() + 1) + \"-\" + pad(source.getDate()) + \"T\" + pad(source.getHours()) + \":\" + pad(source.getMinutes()) + \":\" + pad(source.getSeconds()) + '\"';};escapeMap = {\"\\b\":'\\\\b',\"\\t\":'\\\\t',\"\\n\":'\\\\n',\"\\f\":'\\\\f',\"\\r\":'\\\\r','\"':'\\\\\"',\"\\\\\":'\\\\\\\\'};return {v:function(value){switch(typeof value){case 'undefined':return 'undefined';case 'number':return isFinite(value)?String(value):\"null\";case 'string':return encodeString(value);case 'boolean':return String(value);default:if(value === null){return 'null';}else if(utils.isArray(value)){return encodeArray(value);}else if(utils.isDate(value)){return encodeDate(value);}else {var result=['{'],encode=utils.json2str,preComma,item;for(var key in value) {if(Object.prototype.hasOwnProperty.call(value,key)){item = value[key];switch(typeof item){case 'undefined':case 'unknown':case 'function':break;default:if(preComma){result.push(',');}preComma = 1;result.push(encode(key) + ':' + encode(item));}}}result.push('}');return result.join('');}}}};})();if(typeof _ret === 'object')return _ret.v;}})()}; /**\r\n * 判断给定的对象是否是字符串\r\n * @method isString\r\n * @param { * } object 需要判断的对象\r\n * @return { Boolean } 给定的对象是否是字符串\r\n */ /**\r\n * 判断给定的对象是否是数组\r\n * @method isArray\r\n * @param { * } object 需要判断的对象\r\n * @return { Boolean } 给定的对象是否是数组\r\n */ /**\r\n * 判断给定的对象是否是一个Function\r\n * @method isFunction\r\n * @param { * } object 需要判断的对象\r\n * @return { Boolean } 给定的对象是否是Function\r\n */ /**\r\n * 判断给定的对象是否是Number\r\n * @method isNumber\r\n * @param { * } object 需要判断的对象\r\n * @return { Boolean } 给定的对象是否是Number\r\n */ /**\r\n * 判断给定的对象是否是一个正则表达式\r\n * @method isRegExp\r\n * @param { * } object 需要判断的对象\r\n * @return { Boolean } 给定的对象是否是正则表达式\r\n */ /**\r\n * 判断给定的对象是否是一个普通对象\r\n * @method isObject\r\n * @param { * } object 需要判断的对象\r\n * @return { Boolean } 给定的对象是否是普通对象\r\n */utils.each(['String','Function','Array','Number','RegExp','Object','Date'],function(v){UE.utils['is' + v] = function(obj){return Object.prototype.toString.apply(obj) == '[object ' + v + ']';};}); // core/EventBase.js\n/**\r\n * UE采用的事件基类\r\n * @file\r\n * @module UE\r\n * @class EventBase\r\n * @since 1.2.6.1\r\n */ /**\r\n * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n * @unfile\r\n * @module UE\r\n */ /**\r\n * UE采用的事件基类，继承此类的对应类将获取addListener,removeListener,fireEvent方法。\r\n * 在UE中，Editor以及所有ui实例都继承了该类，故可以在对应的ui对象以及editor对象上使用上述方法。\r\n * @unfile\r\n * @module UE\r\n * @class EventBase\r\n */ /**\r\n * 通过此构造器，子类可以继承EventBase获取事件监听的方法\r\n * @constructor\r\n * @example\r\n * ```javascript\r\n * UE.EventBase.call(editor);\r\n * ```\r\n */var EventBase=UE.EventBase = function(){};EventBase.prototype = { /**\r\n     * 注册事件监听器\r\n     * @method addListener\r\n     * @param { String } types 监听的事件名称，同时监听多个事件使用空格分隔\r\n     * @param { Function } fn 监听的事件被触发时，会执行该回调函数\r\n     * @waining 事件被触发时，监听的函数假如返回的值恒等于true，回调函数的队列中后面的函数将不执行\r\n     * @example\r\n     * ```javascript\r\n     * editor.addListener('selectionchange',function(){\r\n     *      console.log(\"选区已经变化！\");\r\n     * })\r\n     * editor.addListener('beforegetcontent aftergetcontent',function(type){\r\n     *         if(type == 'beforegetcontent'){\r\n     *             //do something\r\n     *         }else{\r\n     *             //do something\r\n     *         }\r\n     *         console.log(this.getContent) // this是注册的事件的编辑器实例\r\n     * })\r\n     * ```\r\n     * @see UE.EventBase:fireEvent(String)\r\n     */addListener:function addListener(types,listener){types = utils.trim(types).split(/\\s+/);for(var i=0,ti;ti = types[i++];) {getListener(this,ti,true).push(listener);}},on:function on(types,listener){return this.addListener(types,listener);},off:function off(types,listener){return this.removeListener(types,listener);},trigger:function trigger(){return this.fireEvent.apply(this,arguments);}, /**\r\n     * 移除事件监听器\r\n     * @method removeListener\r\n     * @param { String } types 移除的事件名称，同时移除多个事件使用空格分隔\r\n     * @param { Function } fn 移除监听事件的函数引用\r\n     * @example\r\n     * ```javascript\r\n     * //changeCallback为方法体\r\n     * editor.removeListener(\"selectionchange\",changeCallback);\r\n     * ```\r\n     */removeListener:function removeListener(types,listener){types = utils.trim(types).split(/\\s+/);for(var i=0,ti;ti = types[i++];) {utils.removeItem(getListener(this,ti) || [],listener);}}, /**\r\n     * 触发事件\r\n     * @method fireEvent\r\n     * @param { String } types 触发的事件名称，同时触发多个事件使用空格分隔\r\n     * @remind 该方法会触发addListener\r\n     * @return { * } 返回触发事件的队列中，最后执行的回调函数的返回值\r\n     * @example\r\n     * ```javascript\r\n     * editor.fireEvent(\"selectionchange\");\r\n     * ```\r\n     */ /**\r\n     * 触发事件\r\n     * @method fireEvent\r\n     * @param { String } types 触发的事件名称，同时触发多个事件使用空格分隔\r\n     * @param { *... } options 可选参数，可以传入一个或多个参数，会传给事件触发的回调函数\r\n     * @return { * } 返回触发事件的队列中，最后执行的回调函数的返回值\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * editor.addListener( \"selectionchange\", function ( type, arg1, arg2 ) {\r\n     *\r\n     *     console.log( arg1 + \" \" + arg2 );\r\n     *\r\n     * } );\r\n     *\r\n     * //触发selectionchange事件， 会执行上面的事件监听器\r\n     * //output: Hello World\r\n     * editor.fireEvent(\"selectionchange\", \"Hello\", \"World\");\r\n     * ```\r\n     */fireEvent:function fireEvent(){var types=arguments[0];types = utils.trim(types).split(' ');for(var i=0,ti;ti = types[i++];) {var listeners=getListener(this,ti),r,t,k;if(listeners){k = listeners.length;while(k--) {if(!listeners[k])continue;t = listeners[k].apply(this,arguments);if(t === true){return t;}if(t !== undefined){r = t;}}}if(t = this['on' + ti.toLowerCase()]){r = t.apply(this,arguments);}}return r;}}; /**\r\n * 获得对象所拥有监听类型的所有监听器\r\n * @unfile\r\n * @module UE\r\n * @since 1.2.6.1\r\n * @method getListener\r\n * @public\r\n * @param { Object } obj  查询监听器的对象\r\n * @param { String } type 事件类型\r\n * @param { Boolean } force  为true且当前所有type类型的侦听器不存在时，创建一个空监听器数组\r\n * @return { Array } 监听器数组\r\n */function getListener(obj,type,force){var allListeners;type = type.toLowerCase();return (allListeners = obj.__allListeners || force && (obj.__allListeners = {})) && (allListeners[type] || force && (allListeners[type] = []));} // core/dtd.js\n///import editor.js\n///import core/dom/dom.js\n///import core/utils.js\n/**\r\n * dtd html语义化的体现类\r\n * @constructor\r\n * @namespace dtd\r\n */var dtd=dom.dtd = (function(){function _(s){for(var k in s) {s[k.toUpperCase()] = s[k];}return s;}var X=utils.extend2;var A=_({isindex:1,fieldset:1}),B=_({input:1,button:1,select:1,textarea:1,label:1}),C=X(_({a:1}),B),D=X({iframe:1},C),E=_({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),F=_({ins:1,del:1,script:1,style:1}),G=X(_({b:1,acronym:1,bdo:1,'var':1,'#':1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),F),H=X(_({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),G),I=X(_({p:1}),H),J=X(_({iframe:1}),H,B),K=_({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,'#':1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,'var':1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),L=X(_({a:0}),J), //a不能被切开，所以把他\nM=_({tr:1}),N=_({'#':1}),O=X(_({param:1}),K),P=X(_({form:1}),A,D,E,I),Q=_({li:1,ol:1,ul:1}),R=_({style:1,script:1}),S=_({base:1,link:1,meta:1,title:1}),T=X(S,R),U=_({head:1,body:1}),V=_({html:1});var block=_({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),empty=_({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return _({ // $ 表示自定的属性\n// body外的元素列表.\n$nonBodyContent:X(V,U,S), //块结构元素列表\n$block:block, //内联元素列表\n$inline:L,$inlineWithA:X(_({a:1}),L),$body:X(_({script:1,style:1}),block),$cdata:_({script:1,style:1}), //自闭和元素\n$empty:empty, //不是自闭合，但不能让range选中里边\n$nonChild:_({iframe:1,textarea:1}), //列表元素列表\n$listItem:_({dd:1,dt:1,li:1}), //列表根元素列表\n$list:_({ul:1,ol:1,dl:1}), //不能认为是空的元素\n$isNotEmpty:_({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}), //如果没有子节点就可以删除的元素列表，像span,a\n$removeEmpty:_({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,'var':1}),$removeEmptyBlock:_({'p':1,'div':1}), //在table元素里的元素列表\n$tableContent:_({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}), //不转换的标签\n$notTransContent:_({pre:1,script:1,style:1,textarea:1}),html:U,head:T,style:N,script:N,body:P,base:{},link:{},meta:{},title:N,col:{},tr:_({td:1,th:1}),img:{},embed:{},colgroup:_({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:P,td:P,br:{},th:P,center:P,kbd:L,button:X(I,E),basefont:{},h5:L,h4:L,samp:L,h6:L,ol:Q,h1:L,h3:L,option:N,h2:L,form:X(A,D,E,I),select:_({optgroup:1,option:1}),font:L,ins:L,menu:Q,abbr:L,label:L,table:_({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:L,tfoot:M,cite:L,li:P,input:{},iframe:P,strong:L,textarea:N,noframes:P,big:L,small:L, //trace:\nspan:_({'#':1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:L,dt:L,sub:L,optgroup:_({option:1}),param:{},bdo:L,'var':L,div:P,object:O,sup:L,dd:P,strike:L,area:{},dir:Q,map:X(_({area:1,form:1,p:1}),A,F,E),applet:O,dl:_({dt:1,dd:1}),del:L,isindex:{},fieldset:X(_({legend:1}),K),thead:M,ul:Q,acronym:L,b:L,a:X(_({a:1}),J),blockquote:X(_({td:1,tr:1,tbody:1,li:1}),P),caption:L,i:L,u:L,tbody:M,s:L,address:X(D,I),tt:L,legend:L,q:L,pre:X(G,C),p:X(_({'a':1}),L),em:L,dfn:L});})(); // core/domUtils.js\n/**\r\n * Dom操作工具包\r\n * @file\r\n * @module UE.dom.domUtils\r\n * @since 1.2.6.1\r\n */ /**\r\n * Dom操作工具包\r\n * @unfile\r\n * @module UE.dom.domUtils\r\n */function getDomNode(_x,_x2,_x3,_x4,_x5,_x6){var _again=true;_function: while(_again) {var node=_x,start=_x2,ltr=_x3,startFromChild=_x4,fn=_x5,guard=_x6;_again = false;var tmpNode=startFromChild && node[start],parent;!tmpNode && (tmpNode = node[ltr]);while(!tmpNode && (parent = (parent || node).parentNode)) {if(parent.tagName == 'BODY' || guard && !guard(parent)){return null;}tmpNode = parent[ltr];}if(tmpNode && fn && !fn(tmpNode)){_x = tmpNode;_x2 = start;_x3 = ltr;_x4 = false;_x5 = fn;_x6 = undefined;_again = true;tmpNode = parent = undefined;continue _function;}return tmpNode;}}var attrFix=ie && browser.version < 9?{tabindex:\"tabIndex\",readonly:\"readOnly\",\"for\":\"htmlFor\",\"class\":\"className\",maxlength:\"maxLength\",cellspacing:\"cellSpacing\",cellpadding:\"cellPadding\",rowspan:\"rowSpan\",colspan:\"colSpan\",usemap:\"useMap\",frameborder:\"frameBorder\"}:{tabindex:\"tabIndex\",readonly:\"readOnly\"},styleBlock=utils.listToMap(['-webkit-box','-moz-box','block','list-item','table','table-row-group','table-header-group','table-footer-group','table-row','table-column-group','table-column','table-cell','table-caption']);var domUtils=dom.domUtils = { //节点常量\nNODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11, //位置关系\nPOSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16, //ie6使用其他的会有一段空白出现\nfillChar:ie && browser.version == '6'?'\ufeff':'​', //-------------------------Node部分--------------------------------\nkeys:{ /*Backspace*/8:1, /*Delete*/46:1, /*Shift*/16:1, /*Ctrl*/17:1, /*Alt*/18:1,37:1,38:1,39:1,40:1,13:1 /*enter*/}, /**\r\n     * 获取节点A相对于节点B的位置关系\r\n     * @method getPosition\r\n     * @param { Node } nodeA 需要查询位置关系的节点A\r\n     * @param { Node } nodeB 需要查询位置关系的节点B\r\n     * @return { Number } 节点A与节点B的关系\r\n     * @example\r\n     * ```javascript\r\n     * //output: 20\r\n     * var position = UE.dom.domUtils.getPosition( document.documentElement, document.body );\r\n     *\r\n     * switch ( position ) {\r\n     *\r\n     *      //0\r\n     *      case UE.dom.domUtils.POSITION_IDENTICAL:\r\n     *          console.log('元素相同');\r\n     *          break;\r\n     *      //1\r\n     *      case UE.dom.domUtils.POSITION_DISCONNECTED:\r\n     *          console.log('两个节点在不同的文档中');\r\n     *          break;\r\n     *      //2\r\n     *      case UE.dom.domUtils.POSITION_FOLLOWING:\r\n     *          console.log('节点A在节点B之后');\r\n     *          break;\r\n     *      //4\r\n     *      case UE.dom.domUtils.POSITION_PRECEDING;\r\n     *          console.log('节点A在节点B之前');\r\n     *          break;\r\n     *      //8\r\n     *      case UE.dom.domUtils.POSITION_IS_CONTAINED:\r\n     *          console.log('节点A被节点B包含');\r\n     *          break;\r\n     *      case 10:\r\n     *          console.log('节点A被节点B包含且节点A在节点B之后');\r\n     *          break;\r\n     *      //16\r\n     *      case UE.dom.domUtils.POSITION_CONTAINS:\r\n     *          console.log('节点A包含节点B');\r\n     *          break;\r\n     *      case 20:\r\n     *          console.log('节点A包含节点B且节点A在节点B之前');\r\n     *          break;\r\n     *\r\n     * }\r\n     * ```\r\n     */getPosition:function getPosition(nodeA,nodeB){ // 如果两个节点是同一个节点\nif(nodeA === nodeB){ // domUtils.POSITION_IDENTICAL\nreturn 0;}var node,parentsA=[nodeA],parentsB=[nodeB];node = nodeA;while(node = node.parentNode) { // 如果nodeB是nodeA的祖先节点\nif(node === nodeB){ // domUtils.POSITION_IS_CONTAINED + domUtils.POSITION_FOLLOWING\nreturn 10;}parentsA.push(node);}node = nodeB;while(node = node.parentNode) { // 如果nodeA是nodeB的祖先节点\nif(node === nodeA){ // domUtils.POSITION_CONTAINS + domUtils.POSITION_PRECEDING\nreturn 20;}parentsB.push(node);}parentsA.reverse();parentsB.reverse();if(parentsA[0] !== parentsB[0]){ // domUtils.POSITION_DISCONNECTED\nreturn 1;}var i=-1;while((i++,parentsA[i] === parentsB[i])) {}nodeA = parentsA[i];nodeB = parentsB[i];while(nodeA = nodeA.nextSibling) {if(nodeA === nodeB){ // domUtils.POSITION_PRECEDING\nreturn 4;}} // domUtils.POSITION_FOLLOWING\nreturn 2;}, /**\r\n     * 检测节点node在父节点中的索引位置\r\n     * @method getNodeIndex\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Number } 该节点在父节点中的位置\r\n     * @see UE.dom.domUtils.getNodeIndex(Node,Boolean)\r\n     */ /**\r\n     * 检测节点node在父节点中的索引位置， 根据给定的mergeTextNode参数决定是否要合并多个连续的文本节点为一个节点\r\n     * @method getNodeIndex\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @param { Boolean } mergeTextNode 是否合并多个连续的文本节点为一个节点\r\n     * @return { Number } 该节点在父节点中的位置\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     *      var node = document.createElement(\"div\");\r\n     *\r\n     *      node.appendChild( document.createTextNode( \"hello\" ) );\r\n     *      node.appendChild( document.createTextNode( \"world\" ) );\r\n     *      node.appendChild( node = document.createElement( \"div\" ) );\r\n     *\r\n     *      //output: 2\r\n     *      console.log( UE.dom.domUtils.getNodeIndex( node ) );\r\n     *\r\n     *      //output: 1\r\n     *      console.log( UE.dom.domUtils.getNodeIndex( node, true ) );\r\n     *\r\n     * ```\r\n     */getNodeIndex:function getNodeIndex(node,ignoreTextNode){var preNode=node,i=0;while(preNode = preNode.previousSibling) {if(ignoreTextNode && preNode.nodeType == 3){if(preNode.nodeType != preNode.nextSibling.nodeType){i++;}continue;}i++;}return i;}, /**\r\n     * 检测节点node是否在给定的document对象上\r\n     * @method inDoc\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @param { DomDocument } doc 需要检测的document对象\r\n     * @return { Boolean } 该节点node是否在给定的document的dom树上\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var node = document.createElement(\"div\");\r\n     *\r\n     * //output: false\r\n     * console.log( UE.do.domUtils.inDoc( node, document ) );\r\n     *\r\n     * document.body.appendChild( node );\r\n     *\r\n     * //output: true\r\n     * console.log( UE.do.domUtils.inDoc( node, document ) );\r\n     *\r\n     * ```\r\n     */inDoc:function inDoc(node,doc){return domUtils.getPosition(node,doc) == 10;}, /**\r\n     * 根据给定的过滤规则filterFn， 查找符合该过滤规则的node节点的第一个祖先节点，\r\n     * 查找的起点是给定node节点的父节点。\r\n     * @method findParent\r\n     * @param { Node } node 需要查找的节点\r\n     * @param { Function } filterFn 自定义的过滤方法。\r\n     * @warning 查找的终点是到body节点为止\r\n     * @remind 自定义的过滤方法filterFn接受一个Node对象作为参数， 该对象代表当前执行检测的祖先节点。 如果该\r\n     *          节点满足过滤条件， 则要求返回true， 这时将直接返回该节点作为findParent()的结果， 否则， 请返回false。\r\n     * @return { Node | Null } 如果找到符合过滤条件的节点， 就返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```javascript\r\n     * var filterNode = UE.dom.domUtils.findParent( document.body.firstChild, function ( node ) {\r\n     *\r\n     *     //由于查找的终点是body节点， 所以永远也不会匹配当前过滤器的条件， 即这里永远会返回false\r\n     *     return node.tagName === \"HTML\";\r\n     *\r\n     * } );\r\n     *\r\n     * //output: true\r\n     * console.log( filterNode === null );\r\n     * ```\r\n     */ /**\r\n     * 根据给定的过滤规则filterFn， 查找符合该过滤规则的node节点的第一个祖先节点，\r\n     * 如果includeSelf的值为true，则查找的起点是给定的节点node， 否则， 起点是node的父节点\r\n     * @method findParent\r\n     * @param { Node } node 需要查找的节点\r\n     * @param { Function } filterFn 自定义的过滤方法。\r\n     * @param { Boolean } includeSelf 查找过程是否包含自身\r\n     * @warning 查找的终点是到body节点为止\r\n     * @remind 自定义的过滤方法filterFn接受一个Node对象作为参数， 该对象代表当前执行检测的祖先节点。 如果该\r\n     *          节点满足过滤条件， 则要求返回true， 这时将直接返回该节点作为findParent()的结果， 否则， 请返回false。\r\n     * @remind 如果includeSelf为true， 则过滤器第一次执行时的参数会是节点本身。\r\n     *          反之， 过滤器第一次执行时的参数将是该节点的父节点。\r\n     * @return { Node | Null } 如果找到符合过滤条件的节点， 就返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```html\r\n     * <body>\r\n     *\r\n     *      <div id=\"test\">\r\n     *      </div>\r\n     *\r\n     *      <script type=\"text/javascript\">\r\n     *\r\n     *          //output: DIV, BODY\r\n     *          var filterNode = UE.dom.domUtils.findParent( document.getElementById( \"test\" ), function ( node ) {\r\n     *\r\n     *              console.log( node.tagName );\r\n     *              return false;\r\n     *\r\n     *          }, true );\r\n     *\r\n     *      </script>\r\n     * </body>\r\n     * ```\r\n     */findParent:function findParent(node,filterFn,includeSelf){if(node && !domUtils.isBody(node)){node = includeSelf?node:node.parentNode;while(node) {if(!filterFn || filterFn(node) || domUtils.isBody(node)){return filterFn && !filterFn(node) && domUtils.isBody(node)?null:node;}node = node.parentNode;}}return null;}, /**\r\n     * 查找node的节点名为tagName的第一个祖先节点， 查找的起点是node节点的父节点。\r\n     * @method findParentByTagName\r\n     * @param { Node } node 需要查找的节点对象\r\n     * @param { Array } tagNames 需要查找的父节点的名称数组\r\n     * @warning 查找的终点是到body节点为止\r\n     * @return { Node | NULL } 如果找到符合条件的节点， 则返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```javascript\r\n     * var node = UE.dom.domUtils.findParentByTagName( document.getElementsByTagName(\"div\")[0], [ \"BODY\" ] );\r\n     * //output: BODY\r\n     * console.log( node.tagName );\r\n     * ```\r\n     */ /**\r\n     * 查找node的节点名为tagName的祖先节点， 如果includeSelf的值为true，则查找的起点是给定的节点node，\r\n     * 否则， 起点是node的父节点。\r\n     * @method findParentByTagName\r\n     * @param { Node } node 需要查找的节点对象\r\n     * @param { Array } tagNames 需要查找的父节点的名称数组\r\n     * @param { Boolean } includeSelf 查找过程是否包含node节点自身\r\n     * @warning 查找的终点是到body节点为止\r\n     * @return { Node | NULL } 如果找到符合条件的节点， 则返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```javascript\r\n     * var queryTarget = document.getElementsByTagName(\"div\")[0];\r\n     * var node = UE.dom.domUtils.findParentByTagName( queryTarget, [ \"DIV\" ], true );\r\n     * //output: true\r\n     * console.log( queryTarget === node );\r\n     * ```\r\n     */findParentByTagName:function findParentByTagName(node,tagNames,includeSelf,excludeFn){tagNames = utils.listToMap(utils.isArray(tagNames)?tagNames:[tagNames]);return domUtils.findParent(node,function(node){return tagNames[node.tagName] && !(excludeFn && excludeFn(node));},includeSelf);}, /**\r\n     * 查找节点node的祖先节点集合， 查找的起点是给定节点的父节点，结果集中不包含给定的节点。\r\n     * @method findParents\r\n     * @param { Node } node 需要查找的节点对象\r\n     * @return { Array } 给定节点的祖先节点数组\r\n     * @grammar UE.dom.domUtils.findParents(node)  => Array  //返回一个祖先节点数组集合，不包含自身\r\n     * @grammar UE.dom.domUtils.findParents(node,includeSelf)  => Array  //返回一个祖先节点数组集合，includeSelf指定是否包含自身\r\n     * @grammar UE.dom.domUtils.findParents(node,includeSelf,filterFn)  => Array  //返回一个祖先节点数组集合，filterFn指定过滤条件，返回true的node将被选取\r\n     * @grammar UE.dom.domUtils.findParents(node,includeSelf,filterFn,closerFirst)  => Array  //返回一个祖先节点数组集合，closerFirst为true的话，node的直接父亲节点是数组的第0个\r\n     */ /**\r\n     * 查找节点node的祖先节点集合， 如果includeSelf的值为true，\r\n     * 则返回的结果集中允许出现当前给定的节点， 否则， 该节点不会出现在其结果集中。\r\n     * @method findParents\r\n     * @param { Node } node 需要查找的节点对象\r\n     * @param { Boolean } includeSelf 查找的结果中是否允许包含当前查找的节点对象\r\n     * @return { Array } 给定节点的祖先节点数组\r\n     */findParents:function findParents(node,includeSelf,filterFn,closerFirst){var parents=includeSelf && (filterFn && filterFn(node) || !filterFn)?[node]:[];while(node = domUtils.findParent(node,filterFn)) {parents.push(node);}return closerFirst?parents:parents.reverse();}, /**\r\n     * 在节点node后面插入新节点newNode\r\n     * @method insertAfter\r\n     * @param { Node } node 目标节点\r\n     * @param { Node } newNode 新插入的节点， 该节点将置于目标节点之后\r\n     * @return { Node } 新插入的节点\r\n     */insertAfter:function insertAfter(node,newNode){return node.nextSibling?node.parentNode.insertBefore(newNode,node.nextSibling):node.parentNode.appendChild(newNode);}, /**\r\n     * 删除节点node及其下属的所有节点\r\n     * @method remove\r\n     * @param { Node } node 需要删除的节点对象\r\n     * @return { Node } 返回刚删除的节点对象\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\">\r\n     *     <div id=\"child\">你好</div>\r\n     * </div>\r\n     * <script>\r\n     *     UE.dom.domUtils.remove( document.body, false );\r\n     *     //output: false\r\n     *     console.log( document.getElementById( \"child\" ) !== null );\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 删除节点node，并根据keepChildren的值决定是否保留子节点\r\n     * @method remove\r\n     * @param { Node } node 需要删除的节点对象\r\n     * @param { Boolean } keepChildren 是否需要保留子节点\r\n     * @return { Node } 返回刚删除的节点对象\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\">\r\n     *     <div id=\"child\">你好</div>\r\n     * </div>\r\n     * <script>\r\n     *     UE.dom.domUtils.remove( document.body, true );\r\n     *     //output: true\r\n     *     console.log( document.getElementById( \"child\" ) !== null );\r\n     * </script>\r\n     * ```\r\n     */remove:function remove(node,keepChildren){var parent=node.parentNode,child;if(parent){if(keepChildren && node.hasChildNodes()){while(child = node.firstChild) {parent.insertBefore(child,node);}}parent.removeChild(node);}return node;}, /**\r\n     * 取得node节点的下一个兄弟节点， 如果该节点其后没有兄弟节点， 则递归查找其父节点之后的第一个兄弟节点，\r\n     * 直到找到满足条件的节点或者递归到BODY节点之后才会结束。\r\n     * @method getNextDomNode\r\n     * @param { Node } node 需要获取其后的兄弟节点的节点对象\r\n     * @return { Node | NULL } 如果找满足条件的节点， 则返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```html\r\n     *     <body>\r\n     *      <div id=\"test\">\r\n     *          <span></span>\r\n     *      </div>\r\n     *      <i>xxx</i>\r\n     * </body>\r\n     * <script>\r\n     *\r\n     *     //output: i节点\r\n     *     console.log( UE.dom.domUtils.getNextDomNode( document.getElementById( \"test\" ) ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     * @example\r\n     * ```html\r\n     * <body>\r\n     *      <div>\r\n     *          <span></span>\r\n     *          <i id=\"test\">xxx</i>\r\n     *      </div>\r\n     *      <b>xxx</b>\r\n     * </body>\r\n     * <script>\r\n     *\r\n     *     //由于id为test的i节点之后没有兄弟节点， 则查找其父节点（div）后面的兄弟节点\r\n     *     //output: b节点\r\n     *     console.log( UE.dom.domUtils.getNextDomNode( document.getElementById( \"test\" ) ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 取得node节点的下一个兄弟节点， 如果startFromChild的值为ture，则先获取其子节点，\r\n     * 如果有子节点则直接返回第一个子节点；如果没有子节点或者startFromChild的值为false，\r\n     * 则执行<a href=\"#UE.dom.domUtils.getNextDomNode(Node)\">getNextDomNode(Node node)</a>的查找过程。\r\n     * @method getNextDomNode\r\n     * @param { Node } node 需要获取其后的兄弟节点的节点对象\r\n     * @param { Boolean } startFromChild 查找过程是否从其子节点开始\r\n     * @return { Node | NULL } 如果找满足条件的节点， 则返回该节点， 否则返回NULL\r\n     * @see UE.dom.domUtils.getNextDomNode(Node)\r\n     */getNextDomNode:function getNextDomNode(node,startFromChild,filterFn,guard){return getDomNode(node,'firstChild','nextSibling',startFromChild,filterFn,guard);},getPreDomNode:function getPreDomNode(node,startFromChild,filterFn,guard){return getDomNode(node,'lastChild','previousSibling',startFromChild,filterFn,guard);}, /**\r\n     * 检测节点node是否属是UEditor定义的bookmark节点\r\n     * @method isBookmarkNode\r\n     * @private\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Boolean } 是否是bookmark节点\r\n     * @example\r\n     * ```html\r\n     * <span id=\"_baidu_bookmark_1\"></span>\r\n     * <script>\r\n     *      var bookmarkNode = document.getElementById(\"_baidu_bookmark_1\");\r\n     *      //output: true\r\n     *      console.log( UE.dom.domUtils.isBookmarkNode( bookmarkNode ) );\r\n     * </script>\r\n     * ```\r\n     */isBookmarkNode:function isBookmarkNode(node){return node.nodeType == 1 && node.id && /^_baidu_bookmark_/i.test(node.id);}, /**\r\n     * 获取节点node所属的window对象\r\n     * @method  getWindow\r\n     * @param { Node } node 节点对象\r\n     * @return { Window } 当前节点所属的window对象\r\n     * @example\r\n     * ```javascript\r\n     * //output: true\r\n     * console.log( UE.dom.domUtils.getWindow( document.body ) === window );\r\n     * ```\r\n     */getWindow:function getWindow(node){var doc=node.ownerDocument || node;return doc.defaultView || doc.parentWindow;}, /**\r\n     * 获取离nodeA与nodeB最近的公共的祖先节点\r\n     * @method  getCommonAncestor\r\n     * @param { Node } nodeA 第一个节点\r\n     * @param { Node } nodeB 第二个节点\r\n     * @remind 如果给定的两个节点是同一个节点， 将直接返回该节点。\r\n     * @return { Node | NULL } 如果未找到公共节点， 返回NULL， 否则返回最近的公共祖先节点。\r\n     * @example\r\n     * ```javascript\r\n     * var commonAncestor = UE.dom.domUtils.getCommonAncestor( document.body, document.body.firstChild );\r\n     * //output: true\r\n     * console.log( commonAncestor.tagName.toLowerCase() === 'body' );\r\n     * ```\r\n     */getCommonAncestor:function getCommonAncestor(nodeA,nodeB){if(nodeA === nodeB)return nodeA;var parentsA=[nodeA],parentsB=[nodeB],parent=nodeA,i=-1;while(parent = parent.parentNode) {if(parent === nodeB){return parent;}parentsA.push(parent);}parent = nodeB;while(parent = parent.parentNode) {if(parent === nodeA)return parent;parentsB.push(parent);}parentsA.reverse();parentsB.reverse();while((i++,parentsA[i] === parentsB[i])) {}return i == 0?null:parentsA[i - 1];}, /**\r\n     * 清除node节点左右连续为空的兄弟inline节点\r\n     * @method clearEmptySibling\r\n     * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\r\n     * 则这些兄弟节点将被删除\r\n     * @grammar UE.dom.domUtils.clearEmptySibling(node,ignoreNext)  //ignoreNext指定是否忽略右边空节点\r\n     * @grammar UE.dom.domUtils.clearEmptySibling(node,ignoreNext,ignorePre)  //ignorePre指定是否忽略左边空节点\r\n     * @example\r\n     * ```html\r\n     * <body>\r\n     *     <div></div>\r\n     *     <span id=\"test\"></span>\r\n     *     <i></i>\r\n     *     <b></b>\r\n     *     <em>xxx</em>\r\n     *     <span></span>\r\n     * </body>\r\n     * <script>\r\n     *\r\n     *      UE.dom.domUtils.clearEmptySibling( document.getElementById( \"test\" ) );\r\n     *\r\n     *      //output: <div></div><span id=\"test\"></span><em>xxx</em><span></span>\r\n     *      console.log( document.body.innerHTML );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 清除node节点左右连续为空的兄弟inline节点， 如果ignoreNext的值为true，\r\n     * 则忽略对右边兄弟节点的操作。\r\n     * @method clearEmptySibling\r\n     * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\r\n     * @param { Boolean } ignoreNext 是否忽略忽略对右边的兄弟节点的操作\r\n     * 则这些兄弟节点将被删除\r\n     * @see UE.dom.domUtils.clearEmptySibling(Node)\r\n     */ /**\r\n     * 清除node节点左右连续为空的兄弟inline节点， 如果ignoreNext的值为true，\r\n     * 则忽略对右边兄弟节点的操作， 如果ignorePre的值为true，则忽略对左边兄弟节点的操作。\r\n     * @method clearEmptySibling\r\n     * @param { Node } node 执行的节点对象， 如果该节点的左右连续的兄弟节点是空的inline节点，\r\n     * @param { Boolean } ignoreNext 是否忽略忽略对右边的兄弟节点的操作\r\n     * @param { Boolean } ignorePre 是否忽略忽略对左边的兄弟节点的操作\r\n     * 则这些兄弟节点将被删除\r\n     * @see UE.dom.domUtils.clearEmptySibling(Node)\r\n     */clearEmptySibling:function clearEmptySibling(node,ignoreNext,ignorePre){function clear(next,dir){var tmpNode;while(next && !domUtils.isBookmarkNode(next) && (domUtils.isEmptyInlineElement(next) //这里不能把空格算进来会吧空格干掉，出现文字间的空格丢掉了\n || !new RegExp('[^\\t\\n\\r' + domUtils.fillChar + ']').test(next.nodeValue))) {tmpNode = next[dir];domUtils.remove(next);next = tmpNode;}}!ignoreNext && clear(node.nextSibling,'nextSibling');!ignorePre && clear(node.previousSibling,'previousSibling');}, /**\r\n     * 将一个文本节点textNode拆分成两个文本节点，offset指定拆分位置\r\n     * @method split\r\n     * @param { Node } textNode 需要拆分的文本节点对象\r\n     * @param { int } offset 需要拆分的位置， 位置计算从0开始\r\n     * @return { Node } 拆分后形成的新节点\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\">abcdef</div>\r\n     * <script>\r\n     *      var newNode = UE.dom.domUtils.split( document.getElementById( \"test\" ).firstChild, 3 );\r\n     *      //output: def\r\n     *      console.log( newNode.nodeValue );\r\n     * </script>\r\n     * ```\r\n     */split:function split(node,offset){var doc=node.ownerDocument;if(browser.ie && offset == node.nodeValue.length){var next=doc.createTextNode('');return domUtils.insertAfter(node,next);}var retval=node.splitText(offset); //ie8下splitText不会跟新childNodes,我们手动触发他的更新\nif(browser.ie8){var tmpNode=doc.createTextNode('');domUtils.insertAfter(retval,tmpNode);domUtils.remove(tmpNode);}return retval;}, /**\r\n     * 检测文本节点textNode是否为空节点（包括空格、换行、占位符等字符）\r\n     * @method  isWhitespace\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Boolean } 检测的节点是否为空\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\">\r\n     *\r\n     * </div>\r\n     * <script>\r\n     *      //output: true\r\n     *      console.log( UE.dom.domUtils.isWhitespace( document.getElementById(\"test\").firstChild ) );\r\n     * </script>\r\n     * ```\r\n     */isWhitespace:function isWhitespace(node){return !new RegExp('[^ \\t\\n\\r' + domUtils.fillChar + ']').test(node.nodeValue);}, /**\r\n     * 获取元素element相对于viewport的位置坐标\r\n     * @method getXY\r\n     * @param { Node } element 需要计算位置的节点对象\r\n     * @return { Object } 返回形如{x:left,y:top}的一个key-value映射对象， 其中键x代表水平偏移距离，\r\n     *                          y代表垂直偏移距离。\r\n     *\r\n     * @example\r\n     * ```javascript\r\n     * var location = UE.dom.domUtils.getXY( document.getElementById(\"test\") );\r\n     * //output: test的坐标为: 12, 24\r\n     * console.log( 'test的坐标为： ', location.x, ',', location.y );\r\n     * ```\r\n     */getXY:function getXY(element){var x=0,y=0;while(element.offsetParent) {y += element.offsetTop;x += element.offsetLeft;element = element.offsetParent;}return {'x':x,'y':y};}, /**\r\n     * 为元素element绑定原生DOM事件，type为事件类型，handler为处理函数\r\n     * @method on\r\n     * @param { Node } element 需要绑定事件的节点对象\r\n     * @param { String } type 绑定的事件类型\r\n     * @param { Function } handler 事件处理器\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.on(document.body,\"click\",function(e){\r\n     *     //e为事件对象，this为被点击元素对戏那个\r\n     * });\r\n     * ```\r\n     */ /**\r\n     * 为元素element绑定原生DOM事件，type为事件类型，handler为处理函数\r\n     * @method on\r\n     * @param { Node } element 需要绑定事件的节点对象\r\n     * @param { Array } type 绑定的事件类型数组\r\n     * @param { Function } handler 事件处理器\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.on(document.body,[\"click\",\"mousedown\"],function(evt){\r\n     *     //evt为事件对象，this为被点击元素对象\r\n     * });\r\n     * ```\r\n     */on:function on(element,type,handler){var types=utils.isArray(type)?type:utils.trim(type).split(/\\s+/),k=types.length;if(k)while(k--) {type = types[k];if(element.addEventListener){element.addEventListener(type,handler,false);}else {if(!handler._d){handler._d = {els:[]};}var key=type + handler.toString(),index=utils.indexOf(handler._d.els,element);if(!handler._d[key] || index == -1){if(index == -1){handler._d.els.push(element);}if(!handler._d[key]){handler._d[key] = function(evt){return handler.call(evt.srcElement,evt || window.event);};}element.attachEvent('on' + type,handler._d[key]);}}}element = null;}, /**\r\n     * 解除DOM事件绑定\r\n     * @method un\r\n     * @param { Node } element 需要解除事件绑定的节点对象\r\n     * @param { String } type 需要接触绑定的事件类型\r\n     * @param { Function } handler 对应的事件处理器\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.un(document.body,\"click\",function(evt){\r\n     *     //evt为事件对象，this为被点击元素对象\r\n     * });\r\n     * ```\r\n     */ /**\r\n     * 解除DOM事件绑定\r\n     * @method un\r\n     * @param { Node } element 需要解除事件绑定的节点对象\r\n     * @param { Array } type 需要接触绑定的事件类型数组\r\n     * @param { Function } handler 对应的事件处理器\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.un(document.body, [\"click\",\"mousedown\"],function(evt){\r\n     *     //evt为事件对象，this为被点击元素对象\r\n     * });\r\n     * ```\r\n     */un:function un(element,type,handler){var types=utils.isArray(type)?type:utils.trim(type).split(/\\s+/),k=types.length;if(k)while(k--) {type = types[k];if(element.removeEventListener){element.removeEventListener(type,handler,false);}else {var key=type + handler.toString();try{element.detachEvent('on' + type,handler._d?handler._d[key]:handler);}catch(e) {}if(handler._d && handler._d[key]){var index=utils.indexOf(handler._d.els,element);if(index != -1){handler._d.els.splice(index,1);}handler._d.els.length == 0 && delete handler._d[key];}}}}, /**\r\n     * 比较节点nodeA与节点nodeB是否具有相同的标签名、属性名以及属性值\r\n     * @method  isSameElement\r\n     * @param { Node } nodeA 需要比较的节点\r\n     * @param { Node } nodeB 需要比较的节点\r\n     * @return { Boolean } 两个节点是否具有相同的标签名、属性名以及属性值\r\n     * @example\r\n     * ```html\r\n     * <span style=\"font-size:12px\">ssss</span>\r\n     * <span style=\"font-size:12px\">bbbbb</span>\r\n     * <span style=\"font-size:13px\">ssss</span>\r\n     * <span style=\"font-size:14px\">bbbbb</span>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var nodes = document.getElementsByTagName( \"span\" );\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.isSameElement( nodes[0], nodes[1] ) );\r\n     *\r\n     *     //output: false\r\n     *     console.log( UE.dom.domUtils.isSameElement( nodes[2], nodes[3] ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */isSameElement:function isSameElement(nodeA,nodeB){if(nodeA.tagName != nodeB.tagName){return false;}var thisAttrs=nodeA.attributes,otherAttrs=nodeB.attributes;if(!ie && thisAttrs.length != otherAttrs.length){return false;}var attrA,attrB,al=0,bl=0;for(var i=0;attrA = thisAttrs[i++];) {if(attrA.nodeName == 'style'){if(attrA.specified){al++;}if(domUtils.isSameStyle(nodeA,nodeB)){continue;}else {return false;}}if(ie){if(attrA.specified){al++;attrB = otherAttrs.getNamedItem(attrA.nodeName);}else {continue;}}else {attrB = nodeB.attributes[attrA.nodeName];}if(!attrB.specified || attrA.nodeValue != attrB.nodeValue){return false;}} // 有可能attrB的属性包含了attrA的属性之外还有自己的属性\nif(ie){for(i = 0;attrB = otherAttrs[i++];) {if(attrB.specified){bl++;}}if(al != bl){return false;}}return true;}, /**\r\n     * 判断节点nodeA与节点nodeB的元素的style属性是否一致\r\n     * @method isSameStyle\r\n     * @param { Node } nodeA 需要比较的节点\r\n     * @param { Node } nodeB 需要比较的节点\r\n     * @return { Boolean } 两个节点是否具有相同的style属性值\r\n     * @example\r\n     * ```html\r\n     * <span style=\"font-size:12px\">ssss</span>\r\n     * <span style=\"font-size:12px\">bbbbb</span>\r\n     * <span style=\"font-size:13px\">ssss</span>\r\n     * <span style=\"font-size:14px\">bbbbb</span>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var nodes = document.getElementsByTagName( \"span\" );\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.isSameStyle( nodes[0], nodes[1] ) );\r\n     *\r\n     *     //output: false\r\n     *     console.log( UE.dom.domUtils.isSameStyle( nodes[2], nodes[3] ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */isSameStyle:function isSameStyle(nodeA,nodeB){var styleA=nodeA.style.cssText.replace(/( ?; ?)/g,';').replace(/( ?: ?)/g,':'),styleB=nodeB.style.cssText.replace(/( ?; ?)/g,';').replace(/( ?: ?)/g,':');if(browser.opera){styleA = nodeA.style;styleB = nodeB.style;if(styleA.length != styleB.length)return false;for(var p in styleA) {if(/^(\\d+|csstext)$/i.test(p)){continue;}if(styleA[p] != styleB[p]){return false;}}return true;}if(!styleA || !styleB){return styleA == styleB;}styleA = styleA.split(';');styleB = styleB.split(';');if(styleA.length != styleB.length){return false;}for(var i=0,ci;ci = styleA[i++];) {if(utils.indexOf(styleB,ci) == -1){return false;}}return true;}, /**\r\n     * 检查节点node是否为block元素\r\n     * @method isBlockElm\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Boolean } 是否是block元素节点\r\n     * @warning 该方法的判断规则如下： 如果该元素原本是block元素， 则不论该元素当前的css样式是什么都会返回true；\r\n     *          否则，检测该元素的css样式， 如果该元素当前是block元素， 则返回true。 其余情况下都返回false。\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test1\" style=\"display: block\"></span>\r\n     * <span id=\"test2\"></span>\r\n     * <div id=\"test3\" style=\"display: inline\"></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.isBlockElm( document.getElementById(\"test1\") ) );\r\n     *\r\n     *     //output: false\r\n     *     console.log( UE.dom.domUtils.isBlockElm( document.getElementById(\"test2\") ) );\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.isBlockElm( document.getElementById(\"test3\") ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */isBlockElm:function isBlockElm(node){return node.nodeType == 1 && (dtd.$block[node.tagName] || styleBlock[domUtils.getComputedStyle(node,'display')]) && !dtd.$nonChild[node.tagName];}, /**\r\n     * 检测node节点是否为body节点\r\n     * @method isBody\r\n     * @param { Element } node 需要检测的dom元素\r\n     * @return { Boolean } 给定的元素是否是body元素\r\n     * @example\r\n     * ```javascript\r\n     * //output: true\r\n     * console.log( UE.dom.domUtils.isBody( document.body ) );\r\n     * ```\r\n     */isBody:function isBody(node){return node && node.nodeType == 1 && node.tagName.toLowerCase() == 'body';}, /**\r\n     * 以node节点为分界，将该节点的指定祖先节点parent拆分成两个独立的节点，\r\n     * 拆分形成的两个节点之间是node节点\r\n     * @method breakParent\r\n     * @param { Node } node 作为分界的节点对象\r\n     * @param { Node } parent 该节点必须是node节点的祖先节点， 且是block节点。\r\n     * @return { Node } 给定的node分界节点\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     *      var node = document.createElement(\"span\"),\r\n     *          wrapNode = document.createElement( \"div\" ),\r\n     *          parent = document.createElement(\"p\");\r\n     *\r\n     *      parent.appendChild( node );\r\n     *      wrapNode.appendChild( parent );\r\n     *\r\n     *      //拆分前\r\n     *      //output: <p><span></span></p>\r\n     *      console.log( wrapNode.innerHTML );\r\n     *\r\n     *\r\n     *      UE.dom.domUtils.breakParent( node, parent );\r\n     *      //拆分后\r\n     *      //output: <p></p><span></span><p></p>\r\n     *      console.log( wrapNode.innerHTML );\r\n     *\r\n     * ```\r\n     */breakParent:function breakParent(node,parent){var tmpNode,parentClone=node,clone=node,leftNodes,rightNodes;do {parentClone = parentClone.parentNode;if(leftNodes){tmpNode = parentClone.cloneNode(false);tmpNode.appendChild(leftNodes);leftNodes = tmpNode;tmpNode = parentClone.cloneNode(false);tmpNode.appendChild(rightNodes);rightNodes = tmpNode;}else {leftNodes = parentClone.cloneNode(false);rightNodes = leftNodes.cloneNode(false);}while(tmpNode = clone.previousSibling) {leftNodes.insertBefore(tmpNode,leftNodes.firstChild);}while(tmpNode = clone.nextSibling) {rightNodes.appendChild(tmpNode);}clone = parentClone;}while(parent !== parentClone);tmpNode = parent.parentNode;tmpNode.insertBefore(leftNodes,parent);tmpNode.insertBefore(rightNodes,parent);tmpNode.insertBefore(node,rightNodes);domUtils.remove(parent);return node;}, /**\r\n     * 检查节点node是否是空inline节点\r\n     * @method  isEmptyInlineElement\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Number }  如果给定的节点是空的inline节点， 则返回1, 否则返回0。\r\n     * @example\r\n     * ```html\r\n     * <b><i></i></b> => 1\r\n     * <b><i></i><u></u></b> => 1\r\n     * <b></b> => 1\r\n     * <b>xx<i></i></b> => 0\r\n     * ```\r\n     */isEmptyInlineElement:function isEmptyInlineElement(node){if(node.nodeType != 1 || !dtd.$removeEmpty[node.tagName]){return 0;}node = node.firstChild;while(node) { //如果是创建的bookmark就跳过\nif(domUtils.isBookmarkNode(node)){return 0;}if(node.nodeType == 1 && !domUtils.isEmptyInlineElement(node) || node.nodeType == 3 && !domUtils.isWhitespace(node)){return 0;}node = node.nextSibling;}return 1;}, /**\r\n     * 删除node节点下首尾两端的空白文本子节点\r\n     * @method trimWhiteTextNode\r\n     * @param { Element } node 需要执行删除操作的元素对象\r\n     * @example\r\n     * ```javascript\r\n     *      var node = document.createElement(\"div\");\r\n     *\r\n     *      node.appendChild( document.createTextNode( \"\" ) );\r\n     *\r\n     *      node.appendChild( document.createElement(\"div\") );\r\n     *\r\n     *      node.appendChild( document.createTextNode( \"\" ) );\r\n     *\r\n     *      //3\r\n     *      console.log( node.childNodes.length );\r\n     *\r\n     *      UE.dom.domUtils.trimWhiteTextNode( node );\r\n     *\r\n     *      //1\r\n     *      console.log( node.childNodes.length );\r\n     * ```\r\n     */trimWhiteTextNode:function trimWhiteTextNode(node){function remove(dir){var child;while((child = node[dir]) && child.nodeType == 3 && domUtils.isWhitespace(child)) {node.removeChild(child);}}remove('firstChild');remove('lastChild');}, /**\r\n     * 合并node节点下相同的子节点\r\n     * @name mergeChild\r\n     * @desc\r\n     * UE.dom.domUtils.mergeChild(node,tagName) //tagName要合并的子节点的标签\r\n     * @example\r\n     * <p><span style=\"font-size:12px;\">xx<span style=\"font-size:12px;\">aa</span>xx</span></p>\r\n     * ==> UE.dom.domUtils.mergeChild(node,'span')\r\n     * <p><span style=\"font-size:12px;\">xxaaxx</span></p>\r\n     */mergeChild:function mergeChild(node,tagName,attrs){var list=domUtils.getElementsByTagName(node,node.tagName.toLowerCase());for(var i=0,ci;ci = list[i++];) {if(!ci.parentNode || domUtils.isBookmarkNode(ci)){continue;} //span单独处理\nif(ci.tagName.toLowerCase() == 'span'){if(node === ci.parentNode){domUtils.trimWhiteTextNode(node);if(node.childNodes.length == 1){node.style.cssText = ci.style.cssText + \";\" + node.style.cssText;domUtils.remove(ci,true);continue;}}ci.style.cssText = node.style.cssText + ';' + ci.style.cssText;if(attrs){var style=attrs.style;if(style){style = style.split(';');for(var j=0,s;s = style[j++];) {ci.style[utils.cssStyleToDomStyle(s.split(':')[0])] = s.split(':')[1];}}}if(domUtils.isSameStyle(ci,node)){domUtils.remove(ci,true);}continue;}if(domUtils.isSameElement(node,ci)){domUtils.remove(ci,true);}}}, /**\r\n     * 原生方法getElementsByTagName的封装\r\n     * @method getElementsByTagName\r\n     * @param { Node } node 目标节点对象\r\n     * @param { String } tagName 需要查找的节点的tagName， 多个tagName以空格分割\r\n     * @return { Array } 符合条件的节点集合\r\n     */getElementsByTagName:function getElementsByTagName(node,name,filter){if(filter && utils.isString(filter)){var className=filter;filter = function(node){return domUtils.hasClass(node,className);};}name = utils.trim(name).replace(/[ ]{2,}/g,' ').split(' ');var arr=[];for(var n=0,ni;ni = name[n++];) {var list=node.getElementsByTagName(ni);for(var i=0,ci;ci = list[i++];) {if(!filter || filter(ci))arr.push(ci);}}return arr;}, /**\r\n     * 将节点node提取到父节点上\r\n     * @method mergeToParent\r\n     * @param { Element } node 需要提取的元素对象\r\n     * @example\r\n     * ```html\r\n     * <div id=\"parent\">\r\n     *     <div id=\"sub\">\r\n     *         <span id=\"child\"></span>\r\n     *     </div>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var child = document.getElementById( \"child\" );\r\n     *\r\n     *     //output: sub\r\n     *     console.log( child.parentNode.id );\r\n     *\r\n     *     UE.dom.domUtils.mergeToParent( child );\r\n     *\r\n     *     //output: parent\r\n     *     console.log( child.parentNode.id );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */mergeToParent:function mergeToParent(node){var parent=node.parentNode;while(parent && dtd.$removeEmpty[parent.tagName]) {if(parent.tagName == node.tagName || parent.tagName == 'A'){ //针对a标签单独处理\ndomUtils.trimWhiteTextNode(parent); //span需要特殊处理  不处理这样的情况 <span stlye=\"color:#fff\">xxx<span style=\"color:#ccc\">xxx</span>xxx</span>\nif(parent.tagName == 'SPAN' && !domUtils.isSameStyle(parent,node) || parent.tagName == 'A' && node.tagName == 'SPAN'){if(parent.childNodes.length > 1 || parent !== node.parentNode){node.style.cssText = parent.style.cssText + \";\" + node.style.cssText;parent = parent.parentNode;continue;}else {parent.style.cssText += \";\" + node.style.cssText; //trace:952 a标签要保持下划线\nif(parent.tagName == 'A'){parent.style.textDecoration = 'underline';}}}if(parent.tagName != 'A'){parent === node.parentNode && domUtils.remove(node,true);break;}}parent = parent.parentNode;}}, /**\r\n     * 合并节点node的左右兄弟节点\r\n     * @method mergeSibling\r\n     * @param { Element } node 需要合并的目标节点\r\n     * @example\r\n     * ```html\r\n     * <b>xxxx</b><b id=\"test\">ooo</b><b>xxxx</b>\r\n     *\r\n     * <script>\r\n     *     var demoNode = document.getElementById(\"test\");\r\n     *     UE.dom.domUtils.mergeSibling( demoNode );\r\n     *     //output: xxxxoooxxxx\r\n     *     console.log( demoNode.innerHTML );\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 合并节点node的左右兄弟节点， 可以根据给定的条件选择是否忽略合并左节点。\r\n     * @method mergeSibling\r\n     * @param { Element } node 需要合并的目标节点\r\n     * @param { Boolean } ignorePre 是否忽略合并左节点\r\n     * @example\r\n     * ```html\r\n     * <b>xxxx</b><b id=\"test\">ooo</b><b>xxxx</b>\r\n     *\r\n     * <script>\r\n     *     var demoNode = document.getElementById(\"test\");\r\n     *     UE.dom.domUtils.mergeSibling( demoNode, true );\r\n     *     //output: oooxxxx\r\n     *     console.log( demoNode.innerHTML );\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 合并节点node的左右兄弟节点，可以根据给定的条件选择是否忽略合并左右节点。\r\n     * @method mergeSibling\r\n     * @param { Element } node 需要合并的目标节点\r\n     * @param { Boolean } ignorePre 是否忽略合并左节点\r\n     * @param { Boolean } ignoreNext 是否忽略合并右节点\r\n     * @remind 如果同时忽略左右节点， 则该操作什么也不会做\r\n     * @example\r\n     * ```html\r\n     * <b>xxxx</b><b id=\"test\">ooo</b><b>xxxx</b>\r\n     *\r\n     * <script>\r\n     *     var demoNode = document.getElementById(\"test\");\r\n     *     UE.dom.domUtils.mergeSibling( demoNode, false, true );\r\n     *     //output: xxxxooo\r\n     *     console.log( demoNode.innerHTML );\r\n     * </script>\r\n     * ```\r\n     */mergeSibling:function mergeSibling(node,ignorePre,ignoreNext){function merge(rtl,start,node){var next;if((next = node[rtl]) && !domUtils.isBookmarkNode(next) && next.nodeType == 1 && domUtils.isSameElement(node,next)){while(next.firstChild) {if(start == 'firstChild'){node.insertBefore(next.lastChild,node.firstChild);}else {node.appendChild(next.firstChild);}}domUtils.remove(next);}}!ignorePre && merge('previousSibling','firstChild',node);!ignoreNext && merge('nextSibling','lastChild',node);}, /**\r\n     * 设置节点node及其子节点不会被选中\r\n     * @method unSelectable\r\n     * @param { Element } node 需要执行操作的dom元素\r\n     * @remind 执行该操作后的节点， 将不能被鼠标选中\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.unSelectable( document.body );\r\n     * ```\r\n     */unSelectable:ie && browser.ie9below || browser.opera?function(node){ //for ie9\nnode.onselectstart = function(){return false;};node.onclick = node.onkeyup = node.onkeydown = function(){return false;};node.unselectable = 'on';node.setAttribute(\"unselectable\",\"on\");for(var i=0,ci;ci = node.all[i++];) {switch(ci.tagName.toLowerCase()){case 'iframe':case 'textarea':case 'input':case 'select':break;default:ci.unselectable = 'on';node.setAttribute(\"unselectable\",\"on\");}}}:function(node){node.style.MozUserSelect = node.style.webkitUserSelect = node.style.msUserSelect = node.style.KhtmlUserSelect = 'none';}, /**\r\n     * 删除节点node上的指定属性名称的属性\r\n     * @method  removeAttributes\r\n     * @param { Node } node 需要删除属性的节点对象\r\n     * @param { String } attrNames 可以是空格隔开的多个属性名称，该操作将会依次删除相应的属性\r\n     * @example\r\n     * ```html\r\n     * <div id=\"wrap\">\r\n     *      <span style=\"font-size:14px;\" id=\"test\" name=\"followMe\">xxxxx</span>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     UE.dom.domUtils.removeAttributes( document.getElementById( \"test\" ), \"id name\" );\r\n     *\r\n     *     //output: <span style=\"font-size:14px;\">xxxxx</span>\r\n     *     console.log( document.getElementById(\"wrap\").innerHTML );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 删除节点node上的指定属性名称的属性\r\n     * @method  removeAttributes\r\n     * @param { Node } node 需要删除属性的节点对象\r\n     * @param { Array } attrNames 需要删除的属性名数组\r\n     * @example\r\n     * ```html\r\n     * <div id=\"wrap\">\r\n     *      <span style=\"font-size:14px;\" id=\"test\" name=\"followMe\">xxxxx</span>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     UE.dom.domUtils.removeAttributes( document.getElementById( \"test\" ), [\"id\", \"name\"] );\r\n     *\r\n     *     //output: <span style=\"font-size:14px;\">xxxxx</span>\r\n     *     console.log( document.getElementById(\"wrap\").innerHTML );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */removeAttributes:function removeAttributes(node,attrNames){attrNames = utils.isArray(attrNames)?attrNames:utils.trim(attrNames).replace(/[ ]{2,}/g,' ').split(' ');for(var i=0,ci;ci = attrNames[i++];) {ci = attrFix[ci] || ci;switch(ci){case 'className':node[ci] = '';break;case 'style':node.style.cssText = '';var val=node.getAttributeNode('style');!browser.ie && val && node.removeAttributeNode(val);}node.removeAttribute(ci);}}, /**\r\n     * 在doc下创建一个标签名为tag，属性为attrs的元素\r\n     * @method createElement\r\n     * @param { DomDocument } doc 新创建的元素属于该document节点创建\r\n     * @param { String } tagName 需要创建的元素的标签名\r\n     * @param { Object } attrs 新创建的元素的属性key-value集合\r\n     * @return { Element } 新创建的元素对象\r\n     * @example\r\n     * ```javascript\r\n     * var ele = UE.dom.domUtils.createElement( document, 'div', {\r\n     *     id: 'test'\r\n     * } );\r\n     *\r\n     * //output: DIV\r\n     * console.log( ele.tagName );\r\n     *\r\n     * //output: test\r\n     * console.log( ele.id );\r\n     *\r\n     * ```\r\n     */createElement:function createElement(doc,tag,attrs){return domUtils.setAttributes(doc.createElement(tag),attrs);}, /**\r\n     * 为节点node添加属性attrs，attrs为属性键值对\r\n     * @method setAttributes\r\n     * @param { Element } node 需要设置属性的元素对象\r\n     * @param { Object } attrs 需要设置的属性名-值对\r\n     * @return { Element } 设置属性的元素对象\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test\"></span>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var testNode = UE.dom.domUtils.setAttributes( document.getElementById( \"test\" ), {\r\n     *         id: 'demo'\r\n     *     } );\r\n     *\r\n     *     //output: demo\r\n     *     console.log( testNode.id );\r\n     *\r\n     * </script>\r\n     *\r\n     */setAttributes:function setAttributes(node,attrs){for(var attr in attrs) {if(attrs.hasOwnProperty(attr)){var value=attrs[attr];switch(attr){case 'class': //ie下要这样赋值，setAttribute不起作用\nnode.className = value;break;case 'style':node.style.cssText = node.style.cssText + \";\" + value;break;case 'innerHTML':node[attr] = value;break;case 'value':node.value = value;break;default:node.setAttribute(attrFix[attr] || attr,value);}}}return node;}, /**\r\n     * 获取元素element经过计算后的样式值\r\n     * @method getComputedStyle\r\n     * @param { Element } element 需要获取样式的元素对象\r\n     * @param { String } styleName 需要获取的样式名\r\n     * @return { String } 获取到的样式值\r\n     * @example\r\n     * ```html\r\n     * <style type=\"text/css\">\r\n     *      #test {\r\n     *          font-size: 15px;\r\n     *      }\r\n     * </style>\r\n     *\r\n     * <span id=\"test\"></span>\r\n     *\r\n     * <script>\r\n     *     //output: 15px\r\n     *     console.log( UE.dom.domUtils.getComputedStyle( document.getElementById( \"test\" ), 'font-size' ) );\r\n     * </script>\r\n     * ```\r\n     */getComputedStyle:function getComputedStyle(element,styleName){ //一下的属性单独处理\nvar pros='width height top left';if(pros.indexOf(styleName) > -1){return element['offset' + styleName.replace(/^\\w/,function(s){return s.toUpperCase();})] + 'px';} //忽略文本节点\nif(element.nodeType == 3){element = element.parentNode;} //ie下font-size若body下定义了font-size，则从currentStyle里会取到这个font-size. 取不到实际值，故此修改.\nif(browser.ie && browser.version < 9 && styleName == 'font-size' && !element.style.fontSize && !dtd.$empty[element.tagName] && !dtd.$nonChild[element.tagName]){var span=element.ownerDocument.createElement('span');span.style.cssText = 'padding:0;border:0;font-family:simsun;';span.innerHTML = '.';element.appendChild(span);var result=span.offsetHeight;element.removeChild(span);span = null;return result + 'px';}try{var value=domUtils.getStyle(element,styleName) || (window.getComputedStyle?domUtils.getWindow(element).getComputedStyle(element,'').getPropertyValue(styleName):(element.currentStyle || element.style)[utils.cssStyleToDomStyle(styleName)]);}catch(e) {return \"\";}return utils.transUnitToPx(utils.fixColor(styleName,value));}, /**\r\n     * 删除元素element指定的className\r\n     * @method removeClasses\r\n     * @param { Element } ele 需要删除class的元素节点\r\n     * @param { String } classNames 需要删除的className， 多个className之间以空格分开\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test\" class=\"test1 test2 test3\">xxx</span>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var testNode = document.getElementById( \"test\" );\r\n     *     UE.dom.domUtils.removeClasses( testNode, \"test1 test2\" );\r\n     *\r\n     *     //output: test3\r\n     *     console.log( testNode.className );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 删除元素element指定的className\r\n     * @method removeClasses\r\n     * @param { Element } ele 需要删除class的元素节点\r\n     * @param { Array } classNames 需要删除的className数组\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test\" class=\"test1 test2 test3\">xxx</span>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var testNode = document.getElementById( \"test\" );\r\n     *     UE.dom.domUtils.removeClasses( testNode, [\"test1\", \"test2\"] );\r\n     *\r\n     *     //output: test3\r\n     *     console.log( testNode.className );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */removeClasses:function removeClasses(elm,classNames){classNames = utils.isArray(classNames)?classNames:utils.trim(classNames).replace(/[ ]{2,}/g,' ').split(' ');for(var i=0,ci,cls=elm.className;ci = classNames[i++];) {cls = cls.replace(new RegExp('\\\\b' + ci + '\\\\b'),'');}cls = utils.trim(cls).replace(/[ ]{2,}/g,' ');if(cls){elm.className = cls;}else {domUtils.removeAttributes(elm,['class']);}}, /**\r\n     * 给元素element添加className\r\n     * @method addClass\r\n     * @param { Node } ele 需要增加className的元素\r\n     * @param { String } classNames 需要添加的className， 多个className之间以空格分割\r\n     * @remind 相同的类名不会被重复添加\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test\" class=\"cls1 cls2\"></span>\r\n     *\r\n     * <script>\r\n     *     var testNode = document.getElementById(\"test\");\r\n     *\r\n     *     UE.dom.domUtils.addClass( testNode, \"cls2 cls3 cls4\" );\r\n     *\r\n     *     //output: cl1 cls2 cls3 cls4\r\n     *     console.log( testNode.className );\r\n     *\r\n     * <script>\r\n     * ```\r\n     */ /**\r\n     * 给元素element添加className\r\n     * @method addClass\r\n     * @param { Node } ele 需要增加className的元素\r\n     * @param { Array } classNames 需要添加的className的数组\r\n     * @remind 相同的类名不会被重复添加\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test\" class=\"cls1 cls2\"></span>\r\n     *\r\n     * <script>\r\n     *     var testNode = document.getElementById(\"test\");\r\n     *\r\n     *     UE.dom.domUtils.addClass( testNode, [\"cls2\", \"cls3\", \"cls4\"] );\r\n     *\r\n     *     //output: cl1 cls2 cls3 cls4\r\n     *     console.log( testNode.className );\r\n     *\r\n     * <script>\r\n     * ```\r\n     */addClass:function addClass(elm,classNames){if(!elm)return;classNames = utils.trim(classNames).replace(/[ ]{2,}/g,' ').split(' ');for(var i=0,ci,cls=elm.className;ci = classNames[i++];) {if(!new RegExp('\\\\b' + ci + '\\\\b').test(cls)){cls += ' ' + ci;}}elm.className = utils.trim(cls);}, /**\r\n     * 判断元素element是否包含给定的样式类名className\r\n     * @method hasClass\r\n     * @param { Node } ele 需要检测的元素\r\n     * @param { String } classNames 需要检测的className， 多个className之间用空格分割\r\n     * @return { Boolean } 元素是否包含所有给定的className\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test1\" class=\"cls1 cls2\"></span>\r\n     *\r\n     * <script>\r\n     *     var test1 = document.getElementById(\"test1\");\r\n     *\r\n     *     //output: false\r\n     *     console.log( UE.dom.domUtils.hasClass( test1, \"cls2 cls1 cls3\" ) );\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.hasClass( test1, \"cls2 cls1\" ) );\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 判断元素element是否包含给定的样式类名className\r\n     * @method hasClass\r\n     * @param { Node } ele 需要检测的元素\r\n     * @param { Array } classNames 需要检测的className数组\r\n     * @return { Boolean } 元素是否包含所有给定的className\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test1\" class=\"cls1 cls2\"></span>\r\n     *\r\n     * <script>\r\n     *     var test1 = document.getElementById(\"test1\");\r\n     *\r\n     *     //output: false\r\n     *     console.log( UE.dom.domUtils.hasClass( test1, [ \"cls2\", \"cls1\", \"cls3\" ] ) );\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.hasClass( test1, [ \"cls2\", \"cls1\" ]) );\r\n     * </script>\r\n     * ```\r\n     */hasClass:function hasClass(element,className){if(utils.isRegExp(className)){return className.test(element.className);}className = utils.trim(className).replace(/[ ]{2,}/g,' ').split(' ');for(var i=0,ci,cls=element.className;ci = className[i++];) {if(!new RegExp('\\\\b' + ci + '\\\\b','i').test(cls)){return false;}}return i - 1 == className.length;}, /**\r\n     * 阻止事件默认行为\r\n     * @method preventDefault\r\n     * @param { Event } evt 需要阻止默认行为的事件对象\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.preventDefault( evt );\r\n     * ```\r\n     */preventDefault:function preventDefault(evt){evt.preventDefault?evt.preventDefault():evt.returnValue = false;}, /**\r\n     * 删除元素element指定的样式\r\n     * @method removeStyle\r\n     * @param { Element } element 需要删除样式的元素\r\n     * @param { String } styleName 需要删除的样式名\r\n     * @example\r\n     * ```html\r\n     * <span id=\"test\" style=\"color: red; background: blue;\"></span>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var testNode = document.getElementById(\"test\");\r\n     *\r\n     *     UE.dom.domUtils.removeStyle( testNode, 'color' );\r\n     *\r\n     *     //output: background: blue;\r\n     *     console.log( testNode.style.cssText );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */removeStyle:function removeStyle(element,name){if(browser.ie){ //针对color先单独处理一下\nif(name == 'color'){name = '(^|;)' + name;}element.style.cssText = element.style.cssText.replace(new RegExp(name + '[^:]*:[^;]+;?','ig'),'');}else {if(element.style.removeProperty){element.style.removeProperty(name);}else {element.style.removeAttribute(utils.cssStyleToDomStyle(name));}}if(!element.style.cssText){domUtils.removeAttributes(element,['style']);}}, /**\r\n     * 获取元素element的style属性的指定值\r\n     * @method getStyle\r\n     * @param { Element } element 需要获取属性值的元素\r\n     * @param { String } styleName 需要获取的style的名称\r\n     * @warning 该方法仅获取元素style属性中所标明的值\r\n     * @return { String } 该元素包含指定的style属性值\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\" style=\"color: red;\"></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *      var testNode = document.getElementById( \"test\" );\r\n     *\r\n     *      //output: red\r\n     *      console.log( UE.dom.domUtils.getStyle( testNode, \"color\" ) );\r\n     *\r\n     *      //output: \"\"\r\n     *      console.log( UE.dom.domUtils.getStyle( testNode, \"background\" ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */getStyle:function getStyle(element,name){var value=element.style[utils.cssStyleToDomStyle(name)];return utils.fixColor(name,value);}, /**\r\n     * 为元素element设置样式属性值\r\n     * @method setStyle\r\n     * @param { Element } element 需要设置样式的元素\r\n     * @param { String } styleName 样式名\r\n     * @param { String } styleValue 样式值\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\"></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *      var testNode = document.getElementById( \"test\" );\r\n     *\r\n     *      //output: \"\"\r\n     *      console.log( testNode.style.color );\r\n     *\r\n     *      UE.dom.domUtils.setStyle( testNode, 'color', 'red' );\r\n     *      //output: \"red\"\r\n     *      console.log( testNode.style.color );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */setStyle:function setStyle(element,name,value){element.style[utils.cssStyleToDomStyle(name)] = value;if(!utils.trim(element.style.cssText)){this.removeAttributes(element,'style');}}, /**\r\n     * 为元素element设置多个样式属性值\r\n     * @method setStyles\r\n     * @param { Element } element 需要设置样式的元素\r\n     * @param { Object } styles 样式名值对\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\"></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *      var testNode = document.getElementById( \"test\" );\r\n     *\r\n     *      //output: \"\"\r\n     *      console.log( testNode.style.color );\r\n     *\r\n     *      UE.dom.domUtils.setStyles( testNode, {\r\n     *          'color': 'red'\r\n     *      } );\r\n     *      //output: \"red\"\r\n     *      console.log( testNode.style.color );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */setStyles:function setStyles(element,styles){for(var name in styles) {if(styles.hasOwnProperty(name)){domUtils.setStyle(element,name,styles[name]);}}}, /**\r\n     * 删除_moz_dirty属性\r\n     * @private\r\n     * @method removeDirtyAttr\r\n     */removeDirtyAttr:function removeDirtyAttr(node){for(var i=0,ci,nodes=node.getElementsByTagName('*');ci = nodes[i++];) {ci.removeAttribute('_moz_dirty');}node.removeAttribute('_moz_dirty');}, /**\r\n     * 获取子节点的数量\r\n     * @method getChildCount\r\n     * @param { Element } node 需要检测的元素\r\n     * @return { Number } 给定的node元素的子节点数量\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\">\r\n     *      <span></span>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     //output: 3\r\n     *     console.log( UE.dom.domUtils.getChildCount( document.getElementById(\"test\") ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 根据给定的过滤规则， 获取符合条件的子节点的数量\r\n     * @method getChildCount\r\n     * @param { Element } node 需要检测的元素\r\n     * @param { Function } fn 过滤器， 要求对符合条件的子节点返回true， 反之则要求返回false\r\n     * @return { Number } 符合过滤条件的node元素的子节点数量\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\">\r\n     *      <span></span>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     //output: 1\r\n     *     console.log( UE.dom.domUtils.getChildCount( document.getElementById(\"test\"), function ( node ) {\r\n     *\r\n     *         return node.nodeType === 1;\r\n     *\r\n     *     } ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */getChildCount:function getChildCount(node,fn){var count=0,first=node.firstChild;fn = fn || function(){return 1;};while(first) {if(fn(first)){count++;}first = first.nextSibling;}return count;}, /**\r\n     * 判断给定节点是否为空节点\r\n     * @method isEmptyNode\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Boolean } 节点是否为空\r\n     * @example\r\n     * ```javascript\r\n     * UE.dom.domUtils.isEmptyNode( document.body );\r\n     * ```\r\n     */isEmptyNode:function isEmptyNode(node){return !node.firstChild || domUtils.getChildCount(node,function(node){return !domUtils.isBr(node) && !domUtils.isBookmarkNode(node) && !domUtils.isWhitespace(node);}) == 0;},clearSelectedArr:function clearSelectedArr(nodes){var node;while(node = nodes.pop()) {domUtils.removeAttributes(node,['class']);}}, /**\r\n     * 将显示区域滚动到指定节点的位置\r\n     * @method scrollToView\r\n     * @param    {Node}   node    节点\r\n     * @param    {window}   win      window对象\r\n     * @param    {Number}    offsetTop    距离上方的偏移量\r\n     */scrollToView:function scrollToView(node,win,offsetTop){var getViewPaneSize=function getViewPaneSize(){var doc=win.document,mode=doc.compatMode == 'CSS1Compat';return {width:(mode?doc.documentElement.clientWidth:doc.body.clientWidth) || 0,height:(mode?doc.documentElement.clientHeight:doc.body.clientHeight) || 0};},getScrollPosition=function getScrollPosition(win){if('pageXOffset' in win){return {x:win.pageXOffset || 0,y:win.pageYOffset || 0};}else {var doc=win.document;return {x:doc.documentElement.scrollLeft || doc.body.scrollLeft || 0,y:doc.documentElement.scrollTop || doc.body.scrollTop || 0};}};var winHeight=getViewPaneSize().height,offset=winHeight * -1 + offsetTop;offset += node.offsetHeight || 0;var elementPosition=domUtils.getXY(node);offset += elementPosition.y;var currentScroll=getScrollPosition(win).y; // offset += 50;\nif(offset > currentScroll || offset < currentScroll - winHeight){win.scrollTo(0,offset + (offset < 0?-20:20));}}, /**\r\n     * 判断给定节点是否为br\r\n     * @method isBr\r\n     * @param { Node } node 需要判断的节点对象\r\n     * @return { Boolean } 给定的节点是否是br节点\r\n     */isBr:function isBr(node){return node.nodeType == 1 && node.tagName == 'BR';}, /**\r\n     * 判断给定的节点是否是一个“填充”节点\r\n     * @private\r\n     * @method isFillChar\r\n     * @param { Node } node 需要判断的节点\r\n     * @param { Boolean } isInStart 是否从节点内容的开始位置匹配\r\n     * @returns { Boolean } 节点是否是填充节点\r\n     */isFillChar:function isFillChar(node,isInStart){if(node.nodeType != 3)return false;var text=node.nodeValue;if(isInStart){return new RegExp('^' + domUtils.fillChar).test(text);}return !text.replace(new RegExp(domUtils.fillChar,'g'),'').length;},isStartInblock:function isStartInblock(range){var tmpRange=range.cloneRange(),flag=0,start=tmpRange.startContainer,tmp;if(start.nodeType == 1 && start.childNodes[tmpRange.startOffset]){start = start.childNodes[tmpRange.startOffset];var pre=start.previousSibling;while(pre && domUtils.isFillChar(pre)) {start = pre;pre = pre.previousSibling;}}if(this.isFillChar(start,true) && tmpRange.startOffset == 1){tmpRange.setStartBefore(start);start = tmpRange.startContainer;}while(start && domUtils.isFillChar(start)) {tmp = start;start = start.previousSibling;}if(tmp){tmpRange.setStartBefore(tmp);start = tmpRange.startContainer;}if(start.nodeType == 1 && domUtils.isEmptyNode(start) && tmpRange.startOffset == 1){tmpRange.setStart(start,0).collapse(true);}while(!tmpRange.startOffset) {start = tmpRange.startContainer;if(domUtils.isBlockElm(start) || domUtils.isBody(start)){flag = 1;break;}var pre=tmpRange.startContainer.previousSibling,tmpNode;if(!pre){tmpRange.setStartBefore(tmpRange.startContainer);}else {while(pre && domUtils.isFillChar(pre)) {tmpNode = pre;pre = pre.previousSibling;}if(tmpNode){tmpRange.setStartBefore(tmpNode);}else {tmpRange.setStartBefore(tmpRange.startContainer);}}}return flag && !domUtils.isBody(tmpRange.startContainer)?1:0;}, /**\r\n     * 判断给定的元素是否是一个空元素\r\n     * @method isEmptyBlock\r\n     * @param { Element } node 需要判断的元素\r\n     * @return { Boolean } 是否是空元素\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\"></div>\r\n     *\r\n     * <script>\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.isEmptyBlock( document.getElementById(\"test\") ) );\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 根据指定的判断规则判断给定的元素是否是一个空元素\r\n     * @method isEmptyBlock\r\n     * @param { Element } node 需要判断的元素\r\n     * @param { RegExp } reg 对内容执行判断的正则表达式对象\r\n     * @return { Boolean } 是否是空元素\r\n     */isEmptyBlock:function isEmptyBlock(node,reg){if(node.nodeType != 1)return 0;reg = reg || new RegExp('[ \\xa0\\t\\r\\n' + domUtils.fillChar + ']','g');if(node[browser.ie?'innerText':'textContent'].replace(reg,'').length > 0){return 0;}for(var n in dtd.$isNotEmpty) {if(node.getElementsByTagName(n).length){return 0;}}return 1;}, /**\r\n     * 移动元素使得该元素的位置移动指定的偏移量的距离\r\n     * @method setViewportOffset\r\n     * @param { Element } element 需要设置偏移量的元素\r\n     * @param { Object } offset 偏移量， 形如{ left: 100, top: 50 }的一个键值对， 表示该元素将在\r\n     *                                  现有的位置上向水平方向偏移offset.left的距离， 在竖直方向上偏移\r\n     *                                  offset.top的距离\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\" style=\"top: 100px; left: 50px; position: absolute;\"></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var testNode = document.getElementById(\"test\");\r\n     *\r\n     *     UE.dom.domUtils.setViewportOffset( testNode, {\r\n     *         left: 200,\r\n     *         top: 50\r\n     *     } );\r\n     *\r\n     *     //output: top: 300px; left: 100px; position: absolute;\r\n     *     console.log( testNode.style.cssText );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */setViewportOffset:function setViewportOffset(element,offset){var left=parseInt(element.style.left) | 0;var top=parseInt(element.style.top) | 0;var rect=element.getBoundingClientRect();var offsetLeft=offset.left - rect.left;var offsetTop=offset.top - rect.top;if(offsetLeft){element.style.left = left + offsetLeft + 'px';}if(offsetTop){element.style.top = top + offsetTop + 'px';}}, /**\r\n     * 用“填充字符”填充节点\r\n     * @method fillNode\r\n     * @private\r\n     * @param { DomDocument } doc 填充的节点所在的docment对象\r\n     * @param { Node } node 需要填充的节点对象\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\"></div>\r\n     *\r\n     * <script>\r\n     *     var testNode = document.getElementById(\"test\");\r\n     *\r\n     *     //output: 0\r\n     *     console.log( testNode.childNodes.length );\r\n     *\r\n     *     UE.dom.domUtils.fillNode( document, testNode );\r\n     *\r\n     *     //output: 1\r\n     *     console.log( testNode.childNodes.length );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */fillNode:function fillNode(doc,node){var tmpNode=browser.ie?doc.createTextNode(domUtils.fillChar):doc.createElement('br');node.innerHTML = '';node.appendChild(tmpNode);}, /**\r\n     * 把节点src的所有子节点追加到另一个节点tag上去\r\n     * @method moveChild\r\n     * @param { Node } src 源节点， 该节点下的所有子节点将被移除\r\n     * @param { Node } tag 目标节点， 从源节点移除的子节点将被追加到该节点下\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test1\">\r\n     *      <span></span>\r\n     * </div>\r\n     * <div id=\"test2\">\r\n     *     <div></div>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var test1 = document.getElementById(\"test1\"),\r\n     *         test2 = document.getElementById(\"test2\");\r\n     *\r\n     *     UE.dom.domUtils.moveChild( test1, test2 );\r\n     *\r\n     *     //output: \"\"（空字符串）\r\n     *     console.log( test1.innerHTML );\r\n     *\r\n     *     //output: \"<div></div><span></span>\"\r\n     *     console.log( test2.innerHTML );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */ /**\r\n     * 把节点src的所有子节点移动到另一个节点tag上去, 可以通过dir参数控制附加的行为是“追加”还是“插入顶部”\r\n     * @method moveChild\r\n     * @param { Node } src 源节点， 该节点下的所有子节点将被移除\r\n     * @param { Node } tag 目标节点， 从源节点移除的子节点将被附加到该节点下\r\n     * @param { Boolean } dir 附加方式， 如果为true， 则附加进去的节点将被放到目标节点的顶部， 反之，则放到末尾\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test1\">\r\n     *      <span></span>\r\n     * </div>\r\n     * <div id=\"test2\">\r\n     *     <div></div>\r\n     * </div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     var test1 = document.getElementById(\"test1\"),\r\n     *         test2 = document.getElementById(\"test2\");\r\n     *\r\n     *     UE.dom.domUtils.moveChild( test1, test2, true );\r\n     *\r\n     *     //output: \"\"（空字符串）\r\n     *     console.log( test1.innerHTML );\r\n     *\r\n     *     //output: \"<span></span><div></div>\"\r\n     *     console.log( test2.innerHTML );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */moveChild:function moveChild(src,tag,dir){while(src.firstChild) {if(dir && tag.firstChild){tag.insertBefore(src.lastChild,tag.firstChild);}else {tag.appendChild(src.firstChild);}}}, /**\r\n     * 判断节点的标签上是否不存在任何属性\r\n     * @method hasNoAttributes\r\n     * @private\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @return { Boolean } 节点是否不包含任何属性\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\"><span>xxxx</span></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     //output: false\r\n     *     console.log( UE.dom.domUtils.hasNoAttributes( document.getElementById(\"test\") ) );\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.hasNoAttributes( document.getElementById(\"test\").firstChild ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */hasNoAttributes:function hasNoAttributes(node){return browser.ie?/^<\\w+\\s*?>/.test(node.outerHTML):node.attributes.length == 0;}, /**\r\n     * 检测节点是否是UEditor所使用的辅助节点\r\n     * @method isCustomeNode\r\n     * @private\r\n     * @param { Node } node 需要检测的节点\r\n     * @remind 辅助节点是指编辑器要完成工作临时添加的节点， 在输出的时候将会从编辑器内移除， 不会影响最终的结果。\r\n     * @return { Boolean } 给定的节点是否是一个辅助节点\r\n     */isCustomeNode:function isCustomeNode(node){return node.nodeType == 1 && node.getAttribute('_ue_custom_node_');}, /**\r\n     * 检测节点的标签是否是给定的标签\r\n     * @method isTagNode\r\n     * @param { Node } node 需要检测的节点对象\r\n     * @param { String } tagName 标签\r\n     * @return { Boolean } 节点的标签是否是给定的标签\r\n     * @example\r\n     * ```html\r\n     * <div id=\"test\"></div>\r\n     *\r\n     * <script>\r\n     *\r\n     *     //output: true\r\n     *     console.log( UE.dom.domUtils.isTagNode( document.getElementById(\"test\"), \"div\" ) );\r\n     *\r\n     * </script>\r\n     * ```\r\n     */isTagNode:function isTagNode(node,tagNames){return node.nodeType == 1 && new RegExp('\\\\b' + node.tagName + '\\\\b','i').test(tagNames);}, /**\r\n     * 给定一个节点数组，在通过指定的过滤器过滤后， 获取其中满足过滤条件的第一个节点\r\n     * @method filterNodeList\r\n     * @param { Array } nodeList 需要过滤的节点数组\r\n     * @param { Function } fn 过滤器， 对符合条件的节点， 执行结果返回true， 反之则返回false\r\n     * @return { Node | NULL } 如果找到符合过滤条件的节点， 则返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```javascript\r\n     * var divNodes = document.getElementsByTagName(\"div\");\r\n     * divNodes = [].slice.call( divNodes, 0 );\r\n     *\r\n     * //output: null\r\n     * console.log( UE.dom.domUtils.filterNodeList( divNodes, function ( node ) {\r\n     *     return node.tagName.toLowerCase() !== 'div';\r\n     * } ) );\r\n     * ```\r\n     */ /**\r\n     * 给定一个节点数组nodeList和一组标签名tagNames， 获取其中能够匹配标签名的节点集合中的第一个节点\r\n     * @method filterNodeList\r\n     * @param { Array } nodeList 需要过滤的节点数组\r\n     * @param { String } tagNames 需要匹配的标签名， 多个标签名之间用空格分割\r\n     * @return { Node | NULL } 如果找到标签名匹配的节点， 则返回该节点， 否则返回NULL\r\n     * @example\r\n     * ```javascript\r\n     * var divNodes = document.getElementsByTagName(\"div\");\r\n     * divNodes = [].slice.call( divNodes, 0 );\r\n     *\r\n     * //output: null\r\n     * console.log( UE.dom.domUtils.filterNodeList( divNodes, 'a span' ) );\r\n     * ```\r\n     */ /**\r\n     * 给定一个节点数组，在通过指定的过滤器过滤后， 如果参数forAll为true， 则会返回所有满足过滤\r\n     * 条件的节点集合， 否则， 返回满足条件的节点集合中的第一个节点\r\n     * @method filterNodeList\r\n     * @param { Array } nodeList 需要过滤的节点数组\r\n     * @param { Function } fn 过滤器， 对符合条件的节点， 执行结果返回true， 反之则返回false\r\n     * @param { Boolean } forAll 是否返回整个节点数组, 如果该参数为false， 则返回节点集合中的第一个节点\r\n     * @return { Array | Node | NULL } 如果找到符合过滤条件的节点， 则根据参数forAll的值决定返回满足\r\n     *                                      过滤条件的节点数组或第一个节点， 否则返回NULL\r\n     * @example\r\n     * ```javascript\r\n     * var divNodes = document.getElementsByTagName(\"div\");\r\n     * divNodes = [].slice.call( divNodes, 0 );\r\n     *\r\n     * //output: 3（假定有3个div）\r\n     * console.log( divNodes.length );\r\n     *\r\n     * var nodes = UE.dom.domUtils.filterNodeList( divNodes, function ( node ) {\r\n     *     return node.tagName.toLowerCase() === 'div';\r\n     * }, true );\r\n     *\r\n     * //output: 3\r\n     * console.log( nodes.length );\r\n     *\r\n     * var node = UE.dom.domUtils.filterNodeList( divNodes, function ( node ) {\r\n     *     return node.tagName.toLowerCase() === 'div';\r\n     * }, false );\r\n     *\r\n     * //output: div\r\n     * console.log( node.nodeName );\r\n     * ```\r\n     */filterNodeList:function filterNodeList(nodelist,filter,forAll){var results=[];if(!utils.isFunction(filter)){var str=filter;filter = function(n){return utils.indexOf(utils.isArray(str)?str:str.split(' '),n.tagName.toLowerCase()) != -1;};}utils.each(nodelist,function(n){filter(n) && results.push(n);});return results.length == 0?null:results.length == 1 || !forAll?results[0]:results;}, /**\r\n     * 查询给定的range选区是否在给定的node节点内，且在该节点的最末尾\r\n     * @method isInNodeEndBoundary\r\n     * @param { UE.dom.Range } rng 需要判断的range对象， 该对象的startContainer不能为NULL\r\n     * @param node 需要检测的节点对象\r\n     * @return { Number } 如果给定的选取range对象是在node内部的最末端， 则返回1, 否则返回0\r\n     */isInNodeEndBoundary:function isInNodeEndBoundary(rng,node){var start=rng.startContainer;if(start.nodeType == 3 && rng.startOffset != start.nodeValue.length){return 0;}if(start.nodeType == 1 && rng.startOffset != start.childNodes.length){return 0;}while(start !== node) {if(start.nextSibling){return 0;};start = start.parentNode;}return 1;},isBoundaryNode:function isBoundaryNode(node,dir){var tmp;while(!domUtils.isBody(node)) {tmp = node;node = node.parentNode;if(tmp !== node[dir]){return false;}}return true;},fillHtml:browser.ie11below?'&nbsp;':'<br/>'};var fillCharReg=new RegExp(domUtils.fillChar,'g'); // core/Range.js\n/**\r\n * Range封装\r\n * @file\r\n * @module UE.dom\r\n * @class Range\r\n * @since 1.2.6.1\r\n */ /**\r\n * dom操作封装\r\n * @unfile\r\n * @module UE.dom\r\n */ /**\r\n * Range实现类，本类是UEditor底层核心类，封装不同浏览器之间的Range操作。\r\n * @unfile\r\n * @module UE.dom\r\n * @class Range\r\n */(function(){var guid=0,fillChar=domUtils.fillChar,fillData; /**\r\n     * 更新range的collapse状态\r\n     * @param  {Range}   range    range对象\r\n     */function updateCollapse(range){range.collapsed = range.startContainer && range.endContainer && range.startContainer === range.endContainer && range.startOffset == range.endOffset;}function selectOneNode(rng){return !rng.collapsed && rng.startContainer.nodeType == 1 && rng.startContainer === rng.endContainer && rng.endOffset - rng.startOffset == 1;}function setEndPoint(toStart,node,offset,range){ //如果node是自闭合标签要处理\nif(node.nodeType == 1 && (dtd.$empty[node.tagName] || dtd.$nonChild[node.tagName])){offset = domUtils.getNodeIndex(node) + (toStart?0:1);node = node.parentNode;}if(toStart){range.startContainer = node;range.startOffset = offset;if(!range.endContainer){range.collapse(true);}}else {range.endContainer = node;range.endOffset = offset;if(!range.startContainer){range.collapse(false);}}updateCollapse(range);return range;}function execContentsAction(range,action){ //调整边界\n//range.includeBookmark();\nvar start=range.startContainer,end=range.endContainer,startOffset=range.startOffset,endOffset=range.endOffset,doc=range.document,frag=doc.createDocumentFragment(),tmpStart,tmpEnd;if(start.nodeType == 1){start = start.childNodes[startOffset] || (tmpStart = start.appendChild(doc.createTextNode('')));}if(end.nodeType == 1){end = end.childNodes[endOffset] || (tmpEnd = end.appendChild(doc.createTextNode('')));}if(start === end && start.nodeType == 3){frag.appendChild(doc.createTextNode(start.substringData(startOffset,endOffset - startOffset))); //is not clone\nif(action){start.deleteData(startOffset,endOffset - startOffset);range.collapse(true);}return frag;}var current,currentLevel,clone=frag,startParents=domUtils.findParents(start,true),endParents=domUtils.findParents(end,true);for(var i=0;startParents[i] == endParents[i];) {i++;}for(var j=i,si;si = startParents[j];j++) {current = si.nextSibling;if(si == start){if(!tmpStart){if(range.startContainer.nodeType == 3){clone.appendChild(doc.createTextNode(start.nodeValue.slice(startOffset))); //is not clone\nif(action){start.deleteData(startOffset,start.nodeValue.length - startOffset);}}else {clone.appendChild(!action?start.cloneNode(true):start);}}}else {currentLevel = si.cloneNode(false);clone.appendChild(currentLevel);}while(current) {if(current === end || current === endParents[j]){break;}si = current.nextSibling;clone.appendChild(!action?current.cloneNode(true):current);current = si;}clone = currentLevel;}clone = frag;if(!startParents[i]){clone.appendChild(startParents[i - 1].cloneNode(false));clone = clone.firstChild;}for(var j=i,ei;ei = endParents[j];j++) {current = ei.previousSibling;if(ei == end){if(!tmpEnd && range.endContainer.nodeType == 3){clone.appendChild(doc.createTextNode(end.substringData(0,endOffset))); //is not clone\nif(action){end.deleteData(0,endOffset);}}}else {currentLevel = ei.cloneNode(false);clone.appendChild(currentLevel);} //如果两端同级，右边第一次已经被开始做了\nif(j != i || !startParents[i]){while(current) {if(current === start){break;}ei = current.previousSibling;clone.insertBefore(!action?current.cloneNode(true):current,clone.firstChild);current = ei;}}clone = currentLevel;}if(action){range.setStartBefore(!endParents[i]?endParents[i - 1]:!startParents[i]?startParents[i - 1]:endParents[i]).collapse(true);}tmpStart && domUtils.remove(tmpStart);tmpEnd && domUtils.remove(tmpEnd);return frag;} /**\r\n     * 创建一个跟document绑定的空的Range实例\r\n     * @constructor\r\n     * @param { Document } document 新建的选区所属的文档对象\r\n     */ /**\r\n     * @property { Node } startContainer 当前Range的开始边界的容器节点, 可以是一个元素节点或者是文本节点\r\n     */ /**\r\n     * @property { Node } startOffset 当前Range的开始边界容器节点的偏移量, 如果是元素节点，\r\n     *                              该值就是childNodes中的第几个节点， 如果是文本节点就是文本内容的第几个字符\r\n     */ /**\r\n     * @property { Node } endContainer 当前Range的结束边界的容器节点, 可以是一个元素节点或者是文本节点\r\n     */ /**\r\n     * @property { Node } endOffset 当前Range的结束边界容器节点的偏移量, 如果是元素节点，\r\n     *                              该值就是childNodes中的第几个节点， 如果是文本节点就是文本内容的第几个字符\r\n     */ /**\r\n     * @property { Boolean } collapsed 当前Range是否闭合\r\n     * @default true\r\n     * @remind Range是闭合的时候， startContainer === endContainer && startOffset === endOffset\r\n     */ /**\r\n     * @property { Document } document 当前Range所属的Document对象\r\n     * @remind 不同range的的document属性可以是不同的\r\n     */var Range=dom.Range = function(document){var me=this;me.startContainer = me.startOffset = me.endContainer = me.endOffset = null;me.document = document;me.collapsed = true;}; /**\r\n     * 删除fillData\r\n     * @param doc\r\n     * @param excludeNode\r\n     */function removeFillData(doc,excludeNode){try{if(fillData && domUtils.inDoc(fillData,doc)){if(!fillData.nodeValue.replace(fillCharReg,'').length){var tmpNode=fillData.parentNode;domUtils.remove(fillData);while(tmpNode && domUtils.isEmptyInlineElement(tmpNode) && ( //safari的contains有bug\nbrowser.safari?!(domUtils.getPosition(tmpNode,excludeNode) & domUtils.POSITION_CONTAINS):!tmpNode.contains(excludeNode))) {fillData = tmpNode.parentNode;domUtils.remove(tmpNode);tmpNode = fillData;}}else {fillData.nodeValue = fillData.nodeValue.replace(fillCharReg,'');}}}catch(e) {}} /**\r\n     * @param node\r\n     * @param dir\r\n     */function mergeSibling(node,dir){var tmpNode;node = node[dir];while(node && domUtils.isFillChar(node)) {tmpNode = node[dir];domUtils.remove(node);node = tmpNode;}}Range.prototype = { /**\r\n         * 克隆选区的内容到一个DocumentFragment里\r\n         * @method cloneContents\r\n         * @return { DocumentFragment | NULL } 如果选区是闭合的将返回null， 否则， 返回包含所clone内容的DocumentFragment元素\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *      <!-- 中括号表示选区 -->\r\n         *      <b>x<i>x[x</i>xx]x</b>\r\n         *\r\n         *      <script>\r\n         *          //range是已选中的选区\r\n         *          var fragment = range.cloneContents(),\r\n         *              node = document.createElement(\"div\");\r\n         *\r\n         *          node.appendChild( fragment );\r\n         *\r\n         *          //output: <i>x</i>xx\r\n         *          console.log( node.innerHTML );\r\n         *\r\n         *      </script>\r\n         * </body>\r\n         * ```\r\n         */cloneContents:function cloneContents(){return this.collapsed?null:execContentsAction(this,0);}, /**\r\n         * 删除当前选区范围中的所有内容\r\n         * @method deleteContents\r\n         * @remind 执行完该操作后， 当前Range对象变成了闭合状态\r\n         * @return { UE.dom.Range } 当前操作的Range对象\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *      <!-- 中括号表示选区 -->\r\n         *      <b>x<i>x[x</i>xx]x</b>\r\n         *\r\n         *      <script>\r\n         *          //range是已选中的选区\r\n         *          range.deleteContents();\r\n         *\r\n         *          //竖线表示闭合后的选区位置\r\n         *          //output: <b>x<i>x</i>|x</b>\r\n         *          console.log( document.body.innerHTML );\r\n         *\r\n         *          //此时， range的各项属性为\r\n         *          //output: B\r\n         *          console.log( range.startContainer.tagName );\r\n         *          //output: 2\r\n         *          console.log( range.startOffset );\r\n         *          //output: B\r\n         *          console.log( range.endContainer.tagName );\r\n         *          //output: 2\r\n         *          console.log( range.endOffset );\r\n         *          //output: true\r\n         *          console.log( range.collapsed );\r\n         *\r\n         *      </script>\r\n         * </body>\r\n         * ```\r\n         */deleteContents:function deleteContents(){var txt;if(!this.collapsed){execContentsAction(this,1);}if(browser.webkit){txt = this.startContainer;if(txt.nodeType == 3 && !txt.nodeValue.length){this.setStartBefore(txt).collapse(true);domUtils.remove(txt);}}return this;}, /**\r\n         * 将当前选区的内容提取到一个DocumentFragment里\r\n         * @method extractContents\r\n         * @remind 执行该操作后， 选区将变成闭合状态\r\n         * @warning 执行该操作后， 原来选区所选中的内容将从dom树上剥离出来\r\n         * @return { DocumentFragment } 返回包含所提取内容的DocumentFragment对象\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *      <!-- 中括号表示选区 -->\r\n         *      <b>x<i>x[x</i>xx]x</b>\r\n         *\r\n         *      <script>\r\n         *          //range是已选中的选区\r\n         *          var fragment = range.extractContents(),\r\n         *              node = document.createElement( \"div\" );\r\n         *\r\n         *          node.appendChild( fragment );\r\n         *\r\n         *          //竖线表示闭合后的选区位置\r\n         *\r\n         *          //output: <b>x<i>x</i>|x</b>\r\n         *          console.log( document.body.innerHTML );\r\n         *          //output: <i>x</i>xx\r\n         *          console.log( node.innerHTML );\r\n         *\r\n         *          //此时， range的各项属性为\r\n         *          //output: B\r\n         *          console.log( range.startContainer.tagName );\r\n         *          //output: 2\r\n         *          console.log( range.startOffset );\r\n         *          //output: B\r\n         *          console.log( range.endContainer.tagName );\r\n         *          //output: 2\r\n         *          console.log( range.endOffset );\r\n         *          //output: true\r\n         *          console.log( range.collapsed );\r\n         *\r\n         *      </script>\r\n         * </body>\r\n         */extractContents:function extractContents(){return this.collapsed?null:execContentsAction(this,2);}, /**\r\n         * 设置Range的开始容器节点和偏移量\r\n         * @method  setStart\r\n         * @remind 如果给定的节点是元素节点，那么offset指的是其子元素中索引为offset的元素，\r\n         *          如果是文本节点，那么offset指的是其文本内容的第offset个字符\r\n         * @remind 如果提供的容器节点是一个不能包含子元素的节点， 则该选区的开始容器将被设置\r\n         *          为该节点的父节点， 此时， 其距离开始容器的偏移量也变成了该节点在其父节点\r\n         *          中的索引\r\n         * @param { Node } node 将被设为当前选区开始边界容器的节点对象\r\n         * @param { int } offset 选区的开始位置偏移量\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区 -->\r\n         * <b>xxx<i>x<span>xx</span>xx<em>xx</em>xxx</i>[xxx]</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.setStart( document.getElementsByTagName(\"i\")[0], 1 );\r\n         *\r\n         *     //此时， 选区变成了\r\n         *     //<b>xxx<i>x[<span>xx</span>xx<em>xx</em>xxx</i>xxx]</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区 -->\r\n         * <b>xxx<img>[xx]x</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.setStart( document.getElementsByTagName(\"img\")[0], 3 );\r\n         *\r\n         *     //此时， 选区变成了\r\n         *     //<b>xxx[<img>xx]x</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */setStart:function setStart(node,offset){return setEndPoint(true,node,offset,this);}, /**\r\n         * 设置Range的结束容器和偏移量\r\n         * @method  setEnd\r\n         * @param { Node } node 作为当前选区结束边界容器的节点对象\r\n         * @param { int } offset 结束边界的偏移量\r\n         * @see UE.dom.Range:setStart(Node,int)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */setEnd:function setEnd(node,offset){return setEndPoint(false,node,offset,this);}, /**\r\n         * 将Range开始位置设置到node节点之后\r\n         * @method  setStartAfter\r\n         * @remind 该操作将会把给定节点的父节点作为range的开始容器， 且偏移量是该节点在其父节点中的位置索引+1\r\n         * @param { Node } node 选区的开始边界将紧接着该节点之后\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>xx<i>xxx</i><span>xx[x</span>xxx]</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.setStartAfter( document.getElementsByTagName(\"i\")[0] );\r\n         *\r\n         *     //结果选区\r\n         *     //<b>xx<i>xxx</i>[<span>xxx</span>xxx]</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */setStartAfter:function setStartAfter(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node) + 1);}, /**\r\n         * 将Range开始位置设置到node节点之前\r\n         * @method  setStartBefore\r\n         * @remind 该操作将会把给定节点的父节点作为range的开始容器， 且偏移量是该节点在其父节点中的位置索引\r\n         * @param { Node } node 新的选区开始位置在该节点之前\r\n         * @see UE.dom.Range:setStartAfter(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */setStartBefore:function setStartBefore(node){return this.setStart(node.parentNode,domUtils.getNodeIndex(node));}, /**\r\n         * 将Range结束位置设置到node节点之后\r\n         * @method  setEndAfter\r\n         * @remind 该操作将会把给定节点的父节点作为range的结束容器， 且偏移量是该节点在其父节点中的位置索引+1\r\n         * @param { Node } node 目标节点\r\n         * @see UE.dom.Range:setStartAfter(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>[xx<i>xxx</i><span>xx]x</span>xxx</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.setStartAfter( document.getElementsByTagName(\"span\")[0] );\r\n         *\r\n         *     //结果选区\r\n         *     //<b>[xx<i>xxx</i><span>xxx</span>]xxx</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */setEndAfter:function setEndAfter(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node) + 1);}, /**\r\n         * 将Range结束位置设置到node节点之前\r\n         * @method  setEndBefore\r\n         * @remind 该操作将会把给定节点的父节点作为range的结束容器， 且偏移量是该节点在其父节点中的位置索引\r\n         * @param { Node } node 目标节点\r\n         * @see UE.dom.Range:setEndAfter(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */setEndBefore:function setEndBefore(node){return this.setEnd(node.parentNode,domUtils.getNodeIndex(node));}, /**\r\n         * 设置Range的开始位置到node节点内的第一个子节点之前\r\n         * @method  setStartAtFirst\r\n         * @remind 选区的开始容器将变成给定的节点， 且偏移量为0\r\n         * @remind 如果给定的节点是元素节点， 则该节点必须是允许包含子节点的元素。\r\n         * @param { Node } node 目标节点\r\n         * @see UE.dom.Range:setStartBefore(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.setStartAtFirst( document.getElementsByTagName(\"i\")[0] );\r\n         *\r\n         *     //结果选区\r\n         *     //<b>xx<i>[xxx</i><span>xx]x</span>xxx</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */setStartAtFirst:function setStartAtFirst(node){return this.setStart(node,0);}, /**\r\n         * 设置Range的开始位置到node节点内的最后一个节点之后\r\n         * @method setStartAtLast\r\n         * @remind 选区的开始容器将变成给定的节点， 且偏移量为该节点的子节点数\r\n         * @remind 如果给定的节点是元素节点， 则该节点必须是允许包含子节点的元素。\r\n         * @param { Node } node 目标节点\r\n         * @see UE.dom.Range:setStartAtFirst(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */setStartAtLast:function setStartAtLast(node){return this.setStart(node,node.nodeType == 3?node.nodeValue.length:node.childNodes.length);}, /**\r\n         * 设置Range的结束位置到node节点内的第一个节点之前\r\n         * @method  setEndAtFirst\r\n         * @param { Node } node 目标节点\r\n         * @remind 选区的结束容器将变成给定的节点， 且偏移量为0\r\n         * @remind node必须是一个元素节点， 且必须是允许包含子节点的元素。\r\n         * @see UE.dom.Range:setStartAtFirst(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */setEndAtFirst:function setEndAtFirst(node){return this.setEnd(node,0);}, /**\r\n         * 设置Range的结束位置到node节点内的最后一个节点之后\r\n         * @method  setEndAtLast\r\n         * @param { Node } node 目标节点\r\n         * @remind 选区的结束容器将变成给定的节点， 且偏移量为该节点的子节点数量\r\n         * @remind node必须是一个元素节点， 且必须是允许包含子节点的元素。\r\n         * @see UE.dom.Range:setStartAtFirst(Node)\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */setEndAtLast:function setEndAtLast(node){return this.setEnd(node,node.nodeType == 3?node.nodeValue.length:node.childNodes.length);}, /**\r\n         * 选中给定节点\r\n         * @method  selectNode\r\n         * @remind 此时， 选区的开始容器和结束容器都是该节点的父节点， 其startOffset是该节点在父节点中的位置索引，\r\n         *          而endOffset为startOffset+1\r\n         * @param { Node } node 需要选中的节点\r\n         * @return { UE.dom.Range } 当前range对象，此时的range仅包含当前给定的节点对象\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.selectNode( document.getElementsByTagName(\"i\")[0] );\r\n         *\r\n         *     //结果选区\r\n         *     //<b>xx[<i>xxx</i>]<span>xxx</span>xxx</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */selectNode:function selectNode(node){return this.setStartBefore(node).setEndAfter(node);}, /**\r\n         * 选中给定节点内部的所有节点\r\n         * @method  selectNodeContents\r\n         * @remind 此时， 选区的开始容器和结束容器都是该节点， 其startOffset为0，\r\n         *          而endOffset是该节点的子节点数。\r\n         * @param { Node } node 目标节点， 当前range将包含该节点内的所有节点\r\n         * @return { UE.dom.Range } 当前range对象， 此时range仅包含给定节点的所有子节点\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.selectNode( document.getElementsByTagName(\"b\")[0] );\r\n         *\r\n         *     //结果选区\r\n         *     //<b>[xx<i>xxx</i><span>xxx</span>xxx]</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */selectNodeContents:function selectNodeContents(node){return this.setStart(node,0).setEndAtLast(node);}, /**\r\n         * clone当前Range对象\r\n         * @method  cloneRange\r\n         * @remind 返回的range是一个全新的range对象， 其内部所有属性与当前被clone的range相同。\r\n         * @return { UE.dom.Range } 当前range对象的一个副本\r\n         */cloneRange:function cloneRange(){var me=this;return new Range(me.document).setStart(me.startContainer,me.startOffset).setEnd(me.endContainer,me.endOffset);}, /**\r\n         * 向当前选区的结束处闭合选区\r\n         * @method  collapse\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.collapse();\r\n         *\r\n         *     //结果选区\r\n         *     //“|”表示选区已闭合\r\n         *     //<b>xx<i>xxx</i><span>xx|x</span>xxx</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */ /**\r\n         * 闭合当前选区，根据给定的toStart参数项决定是向当前选区开始处闭合还是向结束处闭合，\r\n         * 如果toStart的值为true，则向开始位置闭合， 反之，向结束位置闭合。\r\n         * @method  collapse\r\n         * @param { Boolean } toStart 是否向选区开始处闭合\r\n         * @return { UE.dom.Range } 当前range对象，此时range对象处于闭合状态\r\n         * @see UE.dom.Range:collapse()\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>xx<i>xxx</i><span>[xx]x</span>xxx</b>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行操作\r\n         *     range.collapse( true );\r\n         *\r\n         *     //结果选区\r\n         *     //“|”表示选区已闭合\r\n         *     //<b>xx<i>xxx</i><span>|xxx</span>xxx</b>\r\n         *\r\n         * </script>\r\n         * ```\r\n         */collapse:function collapse(toStart){var me=this;if(toStart){me.endContainer = me.startContainer;me.endOffset = me.startOffset;}else {me.startContainer = me.endContainer;me.startOffset = me.endOffset;}me.collapsed = true;return me;}, /**\r\n         * 调整range的开始位置和结束位置，使其\"收缩\"到最小的位置\r\n         * @method  shrinkBoundary\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         * <span>xx<b>xx[</b>xxxxx]</span> => <span>xx<b>xx</b>[xxxxx]</span>\r\n         * ```\r\n         *\r\n         * @example\r\n         * ```html\r\n         * <!-- 选区示例 -->\r\n         * <b>x[xx</b><i>]xxx</i>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //执行收缩\r\n         *     range.shrinkBoundary();\r\n         *\r\n         *     //结果选区\r\n         *     //<b>x[xx]</b><i>xxx</i>\r\n         * </script>\r\n         * ```\r\n         *\r\n         * @example\r\n         * ```html\r\n         * [<b><i>xxxx</i>xxxxxxx</b>] => <b><i>[xxxx</i>xxxxxxx]</b>\r\n         * ```\r\n         */ /**\r\n         * 调整range的开始位置和结束位置，使其\"收缩\"到最小的位置，\r\n         * 如果ignoreEnd的值为true，则忽略对结束位置的调整\r\n         * @method  shrinkBoundary\r\n         * @param { Boolean } ignoreEnd 是否忽略对结束位置的调整\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @see UE.dom.domUtils.Range:shrinkBoundary()\r\n         */shrinkBoundary:function shrinkBoundary(ignoreEnd){var me=this,child,collapsed=me.collapsed;function check(node){return node.nodeType == 1 && !domUtils.isBookmarkNode(node) && !dtd.$empty[node.tagName] && !dtd.$nonChild[node.tagName];}while(me.startContainer.nodeType == 1 //是element\n && (child = me.startContainer.childNodes[me.startOffset]) //子节点也是element\n && check(child)) {me.setStart(child,0);}if(collapsed){return me.collapse(true);}if(!ignoreEnd){while(me.endContainer.nodeType == 1 //是element\n && me.endOffset > 0 //如果是空元素就退出 endOffset=0那么endOffst-1为负值，childNodes[endOffset]报错\n && (child = me.endContainer.childNodes[me.endOffset - 1]) //子节点也是element\n && check(child)) {me.setEnd(child,child.childNodes.length);}}return me;}, /**\r\n         * 获取离当前选区内包含的所有节点最近的公共祖先节点，\r\n         * @method  getCommonAncestor\r\n         * @remind 返回的公共祖先节点一定不是range自身的容器节点， 但有可能是一个文本节点\r\n         * @return { Node } 当前range对象内所有节点的公共祖先节点\r\n         * @example\r\n         * ```html\r\n         * //选区示例\r\n         * <span>xxx<b>x[x<em>xx]x</em>xxx</b>xx</span>\r\n         * <script>\r\n         *\r\n         *     var node = range.getCommonAncestor();\r\n         *\r\n         *     //公共祖先节点是： b节点\r\n         *     //输出： B\r\n         *     console.log(node.tagName);\r\n         *\r\n         * </script>\r\n         * ```\r\n         */ /**\r\n         * 获取当前选区所包含的所有节点的公共祖先节点， 可以根据给定的参数 includeSelf 决定获取到\r\n         * 的公共祖先节点是否可以是当前选区的startContainer或endContainer节点， 如果 includeSelf\r\n         * 的取值为true， 则返回的节点可以是自身的容器节点， 否则， 则不能是容器节点\r\n         * @method  getCommonAncestor\r\n         * @param { Boolean } includeSelf 是否允许获取到的公共祖先节点是当前range对象的容器节点\r\n         * @return { Node } 当前range对象内所有节点的公共祖先节点\r\n         * @see UE.dom.Range:getCommonAncestor()\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *\r\n         *     <!-- 选区示例 -->\r\n         *     <b>xxx<i>xxxx<span>xx[x</span>xx]x</i>xxxxxxx</b>\r\n         *\r\n         *     <script>\r\n         *\r\n         *         var node = range.getCommonAncestor( false );\r\n         *\r\n         *         //这里的公共祖先节点是B而不是I， 是因为参数限制了获取到的节点不能是容器节点\r\n         *         //output: B\r\n         *         console.log( node.tagName );\r\n         *\r\n         *     </script>\r\n         *\r\n         * </body>\r\n         * ```\r\n         */ /**\r\n         * 获取当前选区所包含的所有节点的公共祖先节点， 可以根据给定的参数 includeSelf 决定获取到\r\n         * 的公共祖先节点是否可以是当前选区的startContainer或endContainer节点， 如果 includeSelf\r\n         * 的取值为true， 则返回的节点可以是自身的容器节点， 否则， 则不能是容器节点； 同时可以根据\r\n         * ignoreTextNode 参数的取值决定是否忽略类型为文本节点的祖先节点。\r\n         * @method  getCommonAncestor\r\n         * @param { Boolean } includeSelf 是否允许获取到的公共祖先节点是当前range对象的容器节点\r\n         * @param { Boolean } ignoreTextNode 获取祖先节点的过程中是否忽略类型为文本节点的祖先节点\r\n         * @return { Node } 当前range对象内所有节点的公共祖先节点\r\n         * @see UE.dom.Range:getCommonAncestor()\r\n         * @see UE.dom.Range:getCommonAncestor(Boolean)\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *\r\n         *     <!-- 选区示例 -->\r\n         *     <b>xxx<i>xxxx<span>x[x]x</span>xxx</i>xxxxxxx</b>\r\n         *\r\n         *     <script>\r\n         *\r\n         *         var node = range.getCommonAncestor( true, false );\r\n         *\r\n         *         //output: SPAN\r\n         *         console.log( node.tagName );\r\n         *\r\n         *     </script>\r\n         *\r\n         * </body>\r\n         * ```\r\n         */getCommonAncestor:function getCommonAncestor(includeSelf,ignoreTextNode){var me=this,start=me.startContainer,end=me.endContainer;if(start === end){if(includeSelf && selectOneNode(this)){start = start.childNodes[me.startOffset];if(start.nodeType == 1)return start;} //只有在上来就相等的情况下才会出现是文本的情况\nreturn ignoreTextNode && start.nodeType == 3?start.parentNode:start;}return domUtils.getCommonAncestor(start,end);}, /**\r\n         * 调整当前Range的开始和结束边界容器，如果是容器节点是文本节点,就调整到包含该文本节点的父节点上\r\n         * @method trimBoundary\r\n         * @remind 该操作有可能会引起文本节点被切开\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         *\r\n         * //选区示例\r\n         * <b>xxx<i>[xxxxx]</i>xxx</b>\r\n         *\r\n         * <script>\r\n         *     //未调整前， 选区的开始容器和结束都是文本节点\r\n         *     //执行调整\r\n         *     range.trimBoundary();\r\n         *\r\n         *     //调整之后， 容器节点变成了i节点\r\n         *     //<b>xxx[<i>xxxxx</i>]xxx</b>\r\n         * </script>\r\n         * ```\r\n         */ /**\r\n         * 调整当前Range的开始和结束边界容器，如果是容器节点是文本节点,就调整到包含该文本节点的父节点上，\r\n         * 可以根据 ignoreEnd 参数的值决定是否调整对结束边界的调整\r\n         * @method trimBoundary\r\n         * @param { Boolean } ignoreEnd 是否忽略对结束边界的调整\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         *\r\n         * //选区示例\r\n         * <b>xxx<i>[xxxxx]</i>xxx</b>\r\n         *\r\n         * <script>\r\n         *     //未调整前， 选区的开始容器和结束都是文本节点\r\n         *     //执行调整\r\n         *     range.trimBoundary( true );\r\n         *\r\n         *     //调整之后， 开始容器节点变成了i节点\r\n         *     //但是， 结束容器没有发生变化\r\n         *     //<b>xxx[<i>xxxxx]</i>xxx</b>\r\n         * </script>\r\n         * ```\r\n         */trimBoundary:function trimBoundary(ignoreEnd){this.txtToElmBoundary();var start=this.startContainer,offset=this.startOffset,collapsed=this.collapsed,end=this.endContainer;if(start.nodeType == 3){if(offset == 0){this.setStartBefore(start);}else {if(offset >= start.nodeValue.length){this.setStartAfter(start);}else {var textNode=domUtils.split(start,offset); //跟新结束边界\nif(start === end){this.setEnd(textNode,this.endOffset - offset);}else if(start.parentNode === end){this.endOffset += 1;}this.setStartBefore(textNode);}}if(collapsed){return this.collapse(true);}}if(!ignoreEnd){offset = this.endOffset;end = this.endContainer;if(end.nodeType == 3){if(offset == 0){this.setEndBefore(end);}else {offset < end.nodeValue.length && domUtils.split(end,offset);this.setEndAfter(end);}}}return this;}, /**\r\n         * 如果选区在文本的边界上，就扩展选区到文本的父节点上, 如果当前选区是闭合的， 则什么也不做\r\n         * @method txtToElmBoundary\r\n         * @remind 该操作不会修改dom节点\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */ /**\r\n         * 如果选区在文本的边界上，就扩展选区到文本的父节点上, 如果当前选区是闭合的， 则根据参数项\r\n         * ignoreCollapsed 的值决定是否执行该调整\r\n         * @method txtToElmBoundary\r\n         * @param { Boolean } ignoreCollapsed 是否忽略选区的闭合状态， 如果该参数取值为true， 则\r\n         *                      不论选区是否闭合， 都会执行该操作， 反之， 则不会对闭合的选区执行该操作\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */txtToElmBoundary:function txtToElmBoundary(ignoreCollapsed){function adjust(r,c){var container=r[c + 'Container'],offset=r[c + 'Offset'];if(container.nodeType == 3){if(!offset){r['set' + c.replace(/(\\w)/,function(a){return a.toUpperCase();}) + 'Before'](container);}else if(offset >= container.nodeValue.length){r['set' + c.replace(/(\\w)/,function(a){return a.toUpperCase();}) + 'After'](container);}}}if(ignoreCollapsed || !this.collapsed){adjust(this,'start');adjust(this,'end');}return this;}, /**\r\n         * 在当前选区的开始位置前插入节点，新插入的节点会被该range包含\r\n         * @method  insertNode\r\n         * @param { Node } node 需要插入的节点\r\n         * @remind 插入的节点可以是一个DocumentFragment依次插入多个节点\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */insertNode:function insertNode(node){var first=node,length=1;if(node.nodeType == 11){first = node.firstChild;length = node.childNodes.length;}this.trimBoundary(true);var start=this.startContainer,offset=this.startOffset;var nextNode=start.childNodes[offset];if(nextNode){start.insertBefore(node,nextNode);}else {start.appendChild(node);}if(first.parentNode === this.endContainer){this.endOffset = this.endOffset + length;}return this.setStartBefore(first);}, /**\r\n         * 闭合选区到当前选区的开始位置， 并且定位光标到闭合后的位置\r\n         * @method  setCursor\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @see UE.dom.Range:collapse()\r\n         */ /**\r\n         * 闭合选区，可以根据参数toEnd的值控制选区是向前闭合还是向后闭合， 并且定位光标到闭合后的位置。\r\n         * @method  setCursor\r\n         * @param { Boolean } toEnd 是否向后闭合， 如果为true， 则闭合选区时， 将向结束容器方向闭合，\r\n         *                      反之，则向开始容器方向闭合\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @see UE.dom.Range:collapse(Boolean)\r\n         */setCursor:function setCursor(toEnd,noFillData){return this.collapse(!toEnd).select(noFillData);}, /**\r\n         * 创建当前range的一个书签，记录下当前range的位置，方便当dom树改变时，还能找回原来的选区位置\r\n         * @method createBookmark\r\n         * @param { Boolean } serialize 控制返回的标记位置是对当前位置的引用还是ID，如果该值为true，则\r\n         *                              返回标记位置的ID， 反之则返回标记位置节点的引用\r\n         * @return { Object } 返回一个书签记录键值对， 其包含的key有： start => 开始标记的ID或者引用，\r\n         *                          end => 结束标记的ID或引用， id => 当前标记的类型， 如果为true，则表示\r\n         *                          返回的记录的类型为ID， 反之则为引用\r\n         */createBookmark:function createBookmark(serialize,same){var endNode,startNode=this.document.createElement('span');startNode.style.cssText = 'display:none;line-height:0px;';startNode.appendChild(this.document.createTextNode('‍'));startNode.id = '_baidu_bookmark_start_' + (same?'':guid++);if(!this.collapsed){endNode = startNode.cloneNode(true);endNode.id = '_baidu_bookmark_end_' + (same?'':guid++);}this.insertNode(startNode);if(endNode){this.collapse().insertNode(endNode).setEndBefore(endNode);}this.setStartAfter(startNode);return {start:serialize?startNode.id:startNode,end:endNode?serialize?endNode.id:endNode:null,id:serialize};}, /**\r\n         *  调整当前range的边界到书签位置，并删除该书签对象所标记的位置内的节点\r\n         *  @method  moveToBookmark\r\n         *  @param { BookMark } bookmark createBookmark所创建的标签对象\r\n         *  @return { UE.dom.Range } 当前range对象\r\n         *  @see UE.dom.Range:createBookmark(Boolean)\r\n         */moveToBookmark:function moveToBookmark(bookmark){var start=bookmark.id?this.document.getElementById(bookmark.start):bookmark.start,end=bookmark.end && bookmark.id?this.document.getElementById(bookmark.end):bookmark.end;this.setStartBefore(start);domUtils.remove(start);if(end){this.setEndBefore(end);domUtils.remove(end);}else {this.collapse(true);}return this;}, /**\r\n         * 调整range的边界，使其\"放大\"到最近的父节点\r\n         * @method  enlarge\r\n         * @remind 会引起选区的变化\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */ /**\r\n         * 调整range的边界，使其\"放大\"到最近的父节点，根据参数 toBlock 的取值， 可以\r\n         * 要求扩大之后的父节点是block节点\r\n         * @method  enlarge\r\n         * @param { Boolean } toBlock 是否要求扩大之后的父节点必须是block节点\r\n         * @return { UE.dom.Range } 当前range对象\r\n         */enlarge:function enlarge(toBlock,stopFn){var isBody=domUtils.isBody,pre,node,tmp=this.document.createTextNode('');if(toBlock){node = this.startContainer;if(node.nodeType == 1){if(node.childNodes[this.startOffset]){pre = node = node.childNodes[this.startOffset];}else {node.appendChild(tmp);pre = node = tmp;}}else {pre = node;}while(1) {if(domUtils.isBlockElm(node)){node = pre;while((pre = node.previousSibling) && !domUtils.isBlockElm(pre)) {node = pre;}this.setStartBefore(node);break;}pre = node;node = node.parentNode;}node = this.endContainer;if(node.nodeType == 1){if(pre = node.childNodes[this.endOffset]){node.insertBefore(tmp,pre);}else {node.appendChild(tmp);}pre = node = tmp;}else {pre = node;}while(1) {if(domUtils.isBlockElm(node)){node = pre;while((pre = node.nextSibling) && !domUtils.isBlockElm(pre)) {node = pre;}this.setEndAfter(node);break;}pre = node;node = node.parentNode;}if(tmp.parentNode === this.endContainer){this.endOffset--;}domUtils.remove(tmp);} // 扩展边界到最大\nif(!this.collapsed){while(this.startOffset == 0) {if(stopFn && stopFn(this.startContainer)){break;}if(isBody(this.startContainer)){break;}this.setStartBefore(this.startContainer);}while(this.endOffset == (this.endContainer.nodeType == 1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)) {if(stopFn && stopFn(this.endContainer)){break;}if(isBody(this.endContainer)){break;}this.setEndAfter(this.endContainer);}}return this;},enlargeToBlockElm:function enlargeToBlockElm(ignoreEnd){while(!domUtils.isBlockElm(this.startContainer)) {this.setStartBefore(this.startContainer);}if(!ignoreEnd){while(!domUtils.isBlockElm(this.endContainer)) {this.setEndAfter(this.endContainer);}}return this;}, /**\r\n         * 调整Range的边界，使其\"缩小\"到最合适的位置\r\n         * @method adjustmentBoundary\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @see UE.dom.Range:shrinkBoundary()\r\n         */adjustmentBoundary:function adjustmentBoundary(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer) && this.startOffset == this.startContainer[this.startContainer.nodeType == 3?'nodeValue':'childNodes'].length && this.startContainer[this.startContainer.nodeType == 3?'nodeValue':'childNodes'].length) {this.setStartAfter(this.startContainer);}while(!domUtils.isBody(this.endContainer) && !this.endOffset && this.endContainer[this.endContainer.nodeType == 3?'nodeValue':'childNodes'].length) {this.setEndBefore(this.endContainer);}}return this;}, /**\r\n         * 给range选区中的内容添加给定的inline标签\r\n         * @method applyInlineStyle\r\n         * @param { String } tagName 需要添加的标签名\r\n         * @example\r\n         * ```html\r\n         * <p>xxxx[xxxx]x</p>  ==>  range.applyInlineStyle(\"strong\")  ==>  <p>xxxx[<strong>xxxx</strong>]x</p>\r\n         * ```\r\n         */ /**\r\n         * 给range选区中的内容添加给定的inline标签， 并且为标签附加上一些初始化属性。\r\n         * @method applyInlineStyle\r\n         * @param { String } tagName 需要添加的标签名\r\n         * @param { Object } attrs 跟随新添加的标签的属性\r\n         * @return { UE.dom.Range } 当前选区\r\n         * @example\r\n         * ```html\r\n         * <p>xxxx[xxxx]x</p>\r\n         *\r\n         * ==>\r\n         *\r\n         * <!-- 执行操作 -->\r\n         * range.applyInlineStyle(\"strong\",{\"style\":\"font-size:12px\"})\r\n         *\r\n         * ==>\r\n         *\r\n         * <p>xxxx[<strong style=\"font-size:12px\">xxxx</strong>]x</p>\r\n         * ```\r\n         */applyInlineStyle:function applyInlineStyle(tagName,attrs,list){if(this.collapsed)return this;this.trimBoundary().enlarge(false,function(node){return node.nodeType == 1 && domUtils.isBlockElm(node);}).adjustmentBoundary();var bookmark=this.createBookmark(),end=bookmark.end,filterFn=function filterFn(node){return node.nodeType == 1?node.tagName.toLowerCase() != 'br':!domUtils.isWhitespace(node);},current=domUtils.getNextDomNode(bookmark.start,false,filterFn),node,pre,range=this.cloneRange();while(current && domUtils.getPosition(current,end) & domUtils.POSITION_PRECEDING) {if(current.nodeType == 3 || dtd[tagName][current.tagName]){range.setStartBefore(current);node = current;while(node && (node.nodeType == 3 || dtd[tagName][node.tagName]) && node !== end) {pre = node;node = domUtils.getNextDomNode(node,node.nodeType == 1,null,function(parent){return dtd[tagName][parent.tagName];});}var frag=range.setEndAfter(pre).extractContents(),elm;if(list && list.length > 0){var level,top;top = level = list[0].cloneNode(false);for(var i=1,ci;ci = list[i++];) {level.appendChild(ci.cloneNode(false));level = level.firstChild;}elm = level;}else {elm = range.document.createElement(tagName);}if(attrs){domUtils.setAttributes(elm,attrs);}elm.appendChild(frag);range.insertNode(list?top:elm); //处理下滑线在a上的情况\nvar aNode;if(tagName == 'span' && attrs.style && /text\\-decoration/.test(attrs.style) && (aNode = domUtils.findParentByTagName(elm,'a',true))){domUtils.setAttributes(aNode,attrs);domUtils.remove(elm,true);elm = aNode;}else {domUtils.mergeSibling(elm);domUtils.clearEmptySibling(elm);} //去除子节点相同的\ndomUtils.mergeChild(elm,attrs);current = domUtils.getNextDomNode(elm,false,filterFn);domUtils.mergeToParent(elm);if(node === end){break;}}else {current = domUtils.getNextDomNode(current,true,filterFn);}}return this.moveToBookmark(bookmark);}, /**\r\n         * 移除当前选区内指定的inline标签，但保留其中的内容\r\n         * @method removeInlineStyle\r\n         * @param { String } tagName 需要移除的标签名\r\n         * @return { UE.dom.Range } 当前的range对象\r\n         * @example\r\n         * ```html\r\n         * xx[x<span>xxx<em>yyy</em>zz]z</span>  => range.removeInlineStyle([\"em\"])  => xx[x<span>xxxyyyzz]z</span>\r\n         * ```\r\n         */ /**\r\n         * 移除当前选区内指定的一组inline标签，但保留其中的内容\r\n         * @method removeInlineStyle\r\n         * @param { Array } tagNameArr 需要移除的标签名的数组\r\n         * @return { UE.dom.Range } 当前的range对象\r\n         * @see UE.dom.Range:removeInlineStyle(String)\r\n         */removeInlineStyle:function removeInlineStyle(tagNames){if(this.collapsed)return this;tagNames = utils.isArray(tagNames)?tagNames:[tagNames];this.shrinkBoundary().adjustmentBoundary();var start=this.startContainer,end=this.endContainer;while(1) {if(start.nodeType == 1){if(utils.indexOf(tagNames,start.tagName.toLowerCase()) > -1){break;}if(start.tagName.toLowerCase() == 'body'){start = null;break;}}start = start.parentNode;}while(1) {if(end.nodeType == 1){if(utils.indexOf(tagNames,end.tagName.toLowerCase()) > -1){break;}if(end.tagName.toLowerCase() == 'body'){end = null;break;}}end = end.parentNode;}var bookmark=this.createBookmark(),frag,tmpRange;if(start){tmpRange = this.cloneRange().setEndBefore(bookmark.start).setStartBefore(start);frag = tmpRange.extractContents();tmpRange.insertNode(frag);domUtils.clearEmptySibling(start,true);start.parentNode.insertBefore(bookmark.start,start);}if(end){tmpRange = this.cloneRange().setStartAfter(bookmark.end).setEndAfter(end);frag = tmpRange.extractContents();tmpRange.insertNode(frag);domUtils.clearEmptySibling(end,false,true);end.parentNode.insertBefore(bookmark.end,end.nextSibling);}var current=domUtils.getNextDomNode(bookmark.start,false,function(node){return node.nodeType == 1;}),next;while(current && current !== bookmark.end) {next = domUtils.getNextDomNode(current,true,function(node){return node.nodeType == 1;});if(utils.indexOf(tagNames,current.tagName.toLowerCase()) > -1){domUtils.remove(current,true);}current = next;}return this.moveToBookmark(bookmark);}, /**\r\n         * 获取当前选中的自闭合的节点\r\n         * @method  getClosedNode\r\n         * @return { Node | NULL } 如果当前选中的是自闭合节点， 则返回该节点， 否则返回NULL\r\n         */getClosedNode:function getClosedNode(){var node;if(!this.collapsed){var range=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(selectOneNode(range)){var child=range.startContainer.childNodes[range.startOffset];if(child && child.nodeType == 1 && (dtd.$empty[child.tagName] || dtd.$nonChild[child.tagName])){node = child;}}}return node;}, /**\r\n         * 在页面上高亮range所表示的选区\r\n         * @method select\r\n         * @return { UE.dom.Range } 返回当前Range对象\r\n         */ //这里不区分ie9以上，trace:3824\nselect:browser.ie?function(noFillData,textRange){var nativeRange;if(!this.collapsed)this.shrinkBoundary();var node=this.getClosedNode();if(node && !textRange){try{nativeRange = this.document.body.createControlRange();nativeRange.addElement(node);nativeRange.select();}catch(e) {}return this;}var bookmark=this.createBookmark(),start=bookmark.start,end;nativeRange = this.document.body.createTextRange();nativeRange.moveToElementText(start);nativeRange.moveStart('character',1);if(!this.collapsed){var nativeRangeEnd=this.document.body.createTextRange();end = bookmark.end;nativeRangeEnd.moveToElementText(end);nativeRange.setEndPoint('EndToEnd',nativeRangeEnd);}else {if(!noFillData && this.startContainer.nodeType != 3){ //使用<span>|x<span>固定住光标\nvar tmpText=this.document.createTextNode(fillChar),tmp=this.document.createElement('span');tmp.appendChild(this.document.createTextNode(fillChar));start.parentNode.insertBefore(tmp,start);start.parentNode.insertBefore(tmpText,start); //当点b,i,u时，不能清除i上边的b\nremoveFillData(this.document,tmpText);fillData = tmpText;mergeSibling(tmp,'previousSibling');mergeSibling(start,'nextSibling');nativeRange.moveStart('character',-1);nativeRange.collapse(true);}}this.moveToBookmark(bookmark);tmp && domUtils.remove(tmp); //IE在隐藏状态下不支持range操作，catch一下\ntry{nativeRange.select();}catch(e) {}return this;}:function(notInsertFillData){function checkOffset(rng){function check(node,offset,dir){if(node.nodeType == 3 && node.nodeValue.length < offset){rng[dir + 'Offset'] = node.nodeValue.length;}}check(rng.startContainer,rng.startOffset,'start');check(rng.endContainer,rng.endOffset,'end');}var win=domUtils.getWindow(this.document),sel=win.getSelection(),txtNode; //FF下关闭自动长高时滚动条在关闭dialog时会跳\n//ff下如果不body.focus将不能定位闭合光标到编辑器内\nbrowser.gecko?this.document.body.focus():win.focus();if(sel){sel.removeAllRanges(); // trace:870 chrome/safari后边是br对于闭合得range不能定位 所以去掉了判断\n// this.startContainer.nodeType != 3 &&! ((child = this.startContainer.childNodes[this.startOffset]) && child.nodeType == 1 && child.tagName == 'BR'\nif(this.collapsed && !notInsertFillData){ //                    //opear如果没有节点接着，原生的不能够定位,不能在body的第一级插入空白节点\n//                    if (notInsertFillData && browser.opera && !domUtils.isBody(this.startContainer) && this.startContainer.nodeType == 1) {\n//                        var tmp = this.document.createTextNode('');\n//                        this.insertNode(tmp).setStart(tmp, 0).collapse(true);\n//                    }\n//\n//处理光标落在文本节点的情况\n//处理以下的情况\n//<b>|xxxx</b>\n//<b>xxxx</b>|xxxx\n//xxxx<b>|</b>\nvar start=this.startContainer,child=start;if(start.nodeType == 1){child = start.childNodes[this.startOffset];}if(!(start.nodeType == 3 && this.startOffset) && (child?!child.previousSibling || child.previousSibling.nodeType != 3:!start.lastChild || start.lastChild.nodeType != 3)){txtNode = this.document.createTextNode(fillChar); //跟着前边走\nthis.insertNode(txtNode);removeFillData(this.document,txtNode);mergeSibling(txtNode,'previousSibling');mergeSibling(txtNode,'nextSibling');fillData = txtNode;this.setStart(txtNode,browser.webkit?1:0).collapse(true);}}var nativeRange=this.document.createRange();if(this.collapsed && browser.opera && this.startContainer.nodeType == 1){var child=this.startContainer.childNodes[this.startOffset];if(!child){ //往前靠拢\nchild = this.startContainer.lastChild;if(child && domUtils.isBr(child)){this.setStartBefore(child).collapse(true);}}else { //向后靠拢\nwhile(child && domUtils.isBlockElm(child)) {if(child.nodeType == 1 && child.childNodes[0]){child = child.childNodes[0];}else {break;}}child && this.setStartBefore(child).collapse(true);}} //是createAddress最后一位算的不准，现在这里进行微调\ncheckOffset(this);nativeRange.setStart(this.startContainer,this.startOffset);nativeRange.setEnd(this.endContainer,this.endOffset);sel.addRange(nativeRange);}return this;}, /**\r\n         * 滚动到当前range开始的位置\r\n         * @method scrollToView\r\n         * @param { Window } win 当前range对象所属的window对象\r\n         * @return { UE.dom.Range } 当前Range对象\r\n         */ /**\r\n         * 滚动到距离当前range开始位置 offset 的位置处\r\n         * @method scrollToView\r\n         * @param { Window } win 当前range对象所属的window对象\r\n         * @param { Number } offset 距离range开始位置处的偏移量， 如果为正数， 则向下偏移， 反之， 则向上偏移\r\n         * @return { UE.dom.Range } 当前Range对象\r\n         */scrollToView:function scrollToView(win,offset){win = win?window:domUtils.getWindow(this.document);var me=this,span=me.document.createElement('span'); //trace:717\nspan.innerHTML = '&nbsp;';me.cloneRange().insertNode(span);domUtils.scrollToView(span,win,offset);domUtils.remove(span);return me;}, /**\r\n         * 判断当前选区内容是否占位符\r\n         * @private\r\n         * @method inFillChar\r\n         * @return { Boolean } 如果是占位符返回true，否则返回false\r\n         */inFillChar:function inFillChar(){var start=this.startContainer;if(this.collapsed && start.nodeType == 3 && start.nodeValue.replace(new RegExp('^' + domUtils.fillChar),'').length + 1 == start.nodeValue.length){return true;}return false;}, /**\r\n         * 保存\r\n         * @method createAddress\r\n         * @private\r\n         * @return { Boolean } 返回开始和结束的位置\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *     <p>\r\n         *         aaaa\r\n         *         <em>\r\n         *             <!-- 选区开始 -->\r\n         *             bbbb\r\n         *             <!-- 选区结束 -->\r\n         *         </em>\r\n         *     </p>\r\n         *\r\n         *     <script>\r\n         *         //output: {startAddress:[0,1,0,0],endAddress:[0,1,0,4]}\r\n         *         console.log( range.createAddress() );\r\n         *     </script>\r\n         * </body>\r\n         * ```\r\n         */createAddress:function createAddress(ignoreEnd,ignoreTxt){var addr={},me=this;function getAddress(isStart){var node=isStart?me.startContainer:me.endContainer;var parents=domUtils.findParents(node,true,function(node){return !domUtils.isBody(node);}),addrs=[];for(var i=0,ci;ci = parents[i++];) {addrs.push(domUtils.getNodeIndex(ci,ignoreTxt));}var firstIndex=0;if(ignoreTxt){if(node.nodeType == 3){var tmpNode=node.previousSibling;while(tmpNode && tmpNode.nodeType == 3) {firstIndex += tmpNode.nodeValue.replace(fillCharReg,'').length;tmpNode = tmpNode.previousSibling;}firstIndex += isStart?me.startOffset:me.endOffset; // - (fillCharReg.test(node.nodeValue) ? 1 : 0 )\n}else {node = node.childNodes[isStart?me.startOffset:me.endOffset];if(node){firstIndex = domUtils.getNodeIndex(node,ignoreTxt);}else {node = isStart?me.startContainer:me.endContainer;var first=node.firstChild;while(first) {if(domUtils.isFillChar(first)){first = first.nextSibling;continue;}firstIndex++;if(first.nodeType == 3){while(first && first.nodeType == 3) {first = first.nextSibling;}}else {first = first.nextSibling;}}}}}else {firstIndex = isStart?domUtils.isFillChar(node)?0:me.startOffset:me.endOffset;}if(firstIndex < 0){firstIndex = 0;}addrs.push(firstIndex);return addrs;}addr.startAddress = getAddress(true);if(!ignoreEnd){addr.endAddress = me.collapsed?[].concat(addr.startAddress):getAddress();}return addr;}, /**\r\n         * 保存\r\n         * @method createAddress\r\n         * @private\r\n         * @return { Boolean } 返回开始和结束的位置\r\n         * @example\r\n         * ```html\r\n         * <body>\r\n         *     <p>\r\n         *         aaaa\r\n         *         <em>\r\n         *             <!-- 选区开始 -->\r\n         *             bbbb\r\n         *             <!-- 选区结束 -->\r\n         *         </em>\r\n         *     </p>\r\n         *\r\n         *     <script>\r\n         *         var range = editor.selection.getRange();\r\n         *         range.moveToAddress({startAddress:[0,1,0,0],endAddress:[0,1,0,4]});\r\n         *         range.select();\r\n         *         //output: 'bbbb'\r\n         *         console.log(editor.selection.getText());\r\n         *     </script>\r\n         * </body>\r\n         * ```\r\n         */moveToAddress:function moveToAddress(addr,ignoreEnd){var me=this;function getNode(address,isStart){var tmpNode=me.document.body,parentNode,offset;for(var i=0,ci,l=address.length;i < l;i++) {ci = address[i];parentNode = tmpNode;tmpNode = tmpNode.childNodes[ci];if(!tmpNode){offset = ci;break;}}if(isStart){if(tmpNode){me.setStartBefore(tmpNode);}else {me.setStart(parentNode,offset);}}else {if(tmpNode){me.setEndBefore(tmpNode);}else {me.setEnd(parentNode,offset);}}}getNode(addr.startAddress,true);!ignoreEnd && addr.endAddress && getNode(addr.endAddress);return me;}, /**\r\n         * 判断给定的Range对象是否和当前Range对象表示的是同一个选区\r\n         * @method equals\r\n         * @param { UE.dom.Range } 需要判断的Range对象\r\n         * @return { Boolean } 如果给定的Range对象与当前Range对象表示的是同一个选区， 则返回true， 否则返回false\r\n         */equals:function equals(rng){for(var p in this) {if(this.hasOwnProperty(p)){if(this[p] !== rng[p])return false;}}return true;}, /**\r\n         * 遍历range内的节点。每当遍历一个节点时， 都会执行参数项 doFn 指定的函数， 该函数的接受当前遍历的节点\r\n         * 作为其参数。\r\n         * @method traversal\r\n         * @param { Function }  doFn 对每个遍历的节点要执行的方法， 该方法接受当前遍历的节点作为其参数\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @example\r\n         * ```html\r\n         *\r\n         * <body>\r\n         *\r\n         *     <!-- 选区开始 -->\r\n         *     <span></span>\r\n         *     <a></a>\r\n         *     <!-- 选区结束 -->\r\n         * </body>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: <span></span><a></a>\r\n         *     console.log( range.cloneContents() );\r\n         *\r\n         *     range.traversal( function ( node ) {\r\n         *\r\n         *         if ( node.nodeType === 1 ) {\r\n         *             node.className = \"test\";\r\n         *         }\r\n         *\r\n         *     } );\r\n         *\r\n         *     //output: <span class=\"test\"></span><a class=\"test\"></a>\r\n         *     console.log( range.cloneContents() );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */ /**\r\n         * 遍历range内的节点。\r\n         * 每当遍历一个节点时， 都会执行参数项 doFn 指定的函数， 该函数的接受当前遍历的节点\r\n         * 作为其参数。\r\n         * 可以通过参数项 filterFn 来指定一个过滤器， 只有符合该过滤器过滤规则的节点才会触\r\n         * 发doFn函数的执行\r\n         * @method traversal\r\n         * @param { Function } doFn 对每个遍历的节点要执行的方法， 该方法接受当前遍历的节点作为其参数\r\n         * @param { Function } filterFn 过滤器， 该函数接受当前遍历的节点作为参数， 如果该节点满足过滤\r\n         *                      规则， 请返回true， 该节点会触发doFn， 否则， 请返回false， 则该节点不\r\n         *                      会触发doFn。\r\n         * @return { UE.dom.Range } 当前range对象\r\n         * @see UE.dom.Range:traversal(Function)\r\n         * @example\r\n         * ```html\r\n         *\r\n         * <body>\r\n         *\r\n         *     <!-- 选区开始 -->\r\n         *     <span></span>\r\n         *     <a></a>\r\n         *     <!-- 选区结束 -->\r\n         * </body>\r\n         *\r\n         * <script>\r\n         *\r\n         *     //output: <span></span><a></a>\r\n         *     console.log( range.cloneContents() );\r\n         *\r\n         *     range.traversal( function ( node ) {\r\n         *\r\n         *         node.className = \"test\";\r\n         *\r\n         *     }, function ( node ) {\r\n         *          return node.nodeType === 1;\r\n         *     } );\r\n         *\r\n         *     //output: <span class=\"test\"></span><a class=\"test\"></a>\r\n         *     console.log( range.cloneContents() );\r\n         *\r\n         * </script>\r\n         * ```\r\n         */traversal:function traversal(doFn,filterFn){if(this.collapsed)return this;var bookmark=this.createBookmark(),end=bookmark.end,current=domUtils.getNextDomNode(bookmark.start,false,filterFn);while(current && current !== end && domUtils.getPosition(current,end) & domUtils.POSITION_PRECEDING) {var tmpNode=domUtils.getNextDomNode(current,false,filterFn);doFn(current);current = tmpNode;}return this.moveToBookmark(bookmark);}};})(); // core/Selection.js\n/**\r\n * 选集\r\n * @file\r\n * @module UE.dom\r\n * @class Selection\r\n * @since 1.2.6.1\r\n */ /**\r\n * 选区集合\r\n * @unfile\r\n * @module UE.dom\r\n * @class Selection\r\n */(function(){function getBoundaryInformation(range,start){var getIndex=domUtils.getNodeIndex;range = range.duplicate();range.collapse(start);var parent=range.parentElement(); //如果节点里没有子节点，直接退出\nif(!parent.hasChildNodes()){return {container:parent,offset:0};}var siblings=parent.children,child,testRange=range.duplicate(),startIndex=0,endIndex=siblings.length - 1,index=-1,distance;while(startIndex <= endIndex) {index = Math.floor((startIndex + endIndex) / 2);child = siblings[index];testRange.moveToElementText(child);var position=testRange.compareEndPoints('StartToStart',range);if(position > 0){endIndex = index - 1;}else if(position < 0){startIndex = index + 1;}else { //trace:1043\nreturn {container:parent,offset:getIndex(child)};}}if(index == -1){testRange.moveToElementText(parent);testRange.setEndPoint('StartToStart',range);distance = testRange.text.replace(/(\\r\\n|\\r)/g,'\\n').length;siblings = parent.childNodes;if(!distance){child = siblings[siblings.length - 1];return {container:child,offset:child.nodeValue.length};}var i=siblings.length;while(distance > 0) {distance -= siblings[--i].nodeValue.length;}return {container:siblings[i],offset:-distance};}testRange.collapse(position > 0);testRange.setEndPoint(position > 0?'StartToStart':'EndToStart',range);distance = testRange.text.replace(/(\\r\\n|\\r)/g,'\\n').length;if(!distance){return dtd.$empty[child.tagName] || dtd.$nonChild[child.tagName]?{container:parent,offset:getIndex(child) + (position > 0?0:1)}:{container:child,offset:position > 0?0:child.childNodes.length};}while(distance > 0) {try{var pre=child;child = child[position > 0?'previousSibling':'nextSibling'];distance -= child.nodeValue.length;}catch(e) {return {container:parent,offset:getIndex(pre)};}}return {container:child,offset:position > 0?-distance:child.nodeValue.length + distance};} /**\r\n     * 将ieRange转换为Range对象\r\n     * @param {Range}   ieRange    ieRange对象\r\n     * @param {Range}   range      Range对象\r\n     * @return  {Range}  range       返回转换后的Range对象\r\n     */function transformIERangeToRange(ieRange,range){if(ieRange.item){range.selectNode(ieRange.item(0));}else {var bi=getBoundaryInformation(ieRange,true);range.setStart(bi.container,bi.offset);if(ieRange.compareEndPoints('StartToEnd',ieRange) != 0){bi = getBoundaryInformation(ieRange,false);range.setEnd(bi.container,bi.offset);}}return range;} /**\r\n     * 获得ieRange\r\n     * @param {Selection} sel    Selection对象\r\n     * @return {ieRange}    得到ieRange\r\n     */function _getIERange(sel){var ieRange; //ie下有可能报错\ntry{ieRange = sel.getNative().createRange();}catch(e) {return null;}var el=ieRange.item?ieRange.item(0):ieRange.parentElement();if((el.ownerDocument || el) === sel.document){return ieRange;}return null;}var Selection=dom.Selection = function(doc){var me=this,iframe;me.document = doc;if(browser.ie9below){iframe = domUtils.getWindow(doc).frameElement;domUtils.on(iframe,'beforedeactivate',function(){me._bakIERange = me.getIERange();});domUtils.on(iframe,'activate',function(){try{if(!_getIERange(me) && me._bakIERange){me._bakIERange.select();}}catch(ex) {}me._bakIERange = null;});}iframe = doc = null;};Selection.prototype = {rangeInBody:function rangeInBody(rng,txtRange){var node=browser.ie9below || txtRange?rng.item?rng.item():rng.parentElement():rng.startContainer;return node === this.document.body || domUtils.inDoc(node,this.document);}, /**\r\n         * 获取原生seleciton对象\r\n         * @method getNative\r\n         * @return { Object } 获得selection对象\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.getNative();\r\n         * ```\r\n         */getNative:function getNative(){var doc=this.document;try{return !doc?null:browser.ie9below?doc.selection:domUtils.getWindow(doc).getSelection();}catch(e) {return null;}}, /**\r\n         * 获得ieRange\r\n         * @method getIERange\r\n         * @return { Object } 返回ie原生的Range\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.getIERange();\r\n         * ```\r\n         */getIERange:function getIERange(){var ieRange=_getIERange(this);if(!ieRange){if(this._bakIERange){return this._bakIERange;}}return ieRange;}, /**\r\n         * 缓存当前选区的range和选区的开始节点\r\n         * @method cache\r\n         */cache:function cache(){this.clear();this._cachedRange = this.getRange();this._cachedStartElement = this.getStart();this._cachedStartElementPath = this.getStartElementPath();}, /**\r\n         * 获取选区开始位置的父节点到body\r\n         * @method getStartElementPath\r\n         * @return { Array } 返回父节点集合\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.getStartElementPath();\r\n         * ```\r\n         */getStartElementPath:function getStartElementPath(){if(this._cachedStartElementPath){return this._cachedStartElementPath;}var start=this.getStart();if(start){return domUtils.findParents(start,true,null,true);}return [];}, /**\r\n         * 清空缓存\r\n         * @method clear\r\n         */clear:function clear(){this._cachedStartElementPath = this._cachedRange = this._cachedStartElement = null;}, /**\r\n         * 编辑器是否得到了选区\r\n         * @method isFocus\r\n         */isFocus:function isFocus(){try{if(browser.ie9below){var nativeRange=_getIERange(this);return !!(nativeRange && this.rangeInBody(nativeRange));}else {return !!this.getNative().rangeCount;}}catch(e) {return false;}}, /**\r\n         * 获取选区对应的Range\r\n         * @method getRange\r\n         * @return { Object } 得到Range对象\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.getRange();\r\n         * ```\r\n         */getRange:function getRange(){var me=this;function optimze(range){var child=me.document.body.firstChild,collapsed=range.collapsed;while(child && child.firstChild) {range.setStart(child,0);child = child.firstChild;}if(!range.startContainer){range.setStart(me.document.body,0);}if(collapsed){range.collapse(true);}}if(me._cachedRange != null){return this._cachedRange;}var range=new baidu.editor.dom.Range(me.document);if(browser.ie9below){var nativeRange=me.getIERange();if(nativeRange){ //备份的_bakIERange可能已经实效了，dom树发生了变化比如从源码模式切回来，所以try一下，实效就放到body开始位置\ntry{transformIERangeToRange(nativeRange,range);}catch(e) {optimze(range);}}else {optimze(range);}}else {var sel=me.getNative();if(sel && sel.rangeCount){var firstRange=sel.getRangeAt(0);var lastRange=sel.getRangeAt(sel.rangeCount - 1);range.setStart(firstRange.startContainer,firstRange.startOffset).setEnd(lastRange.endContainer,lastRange.endOffset);if(range.collapsed && domUtils.isBody(range.startContainer) && !range.startOffset){optimze(range);}}else { //trace:1734 有可能已经不在dom树上了，标识的节点\nif(this._bakRange && domUtils.inDoc(this._bakRange.startContainer,this.document)){return this._bakRange;}optimze(range);}}return this._bakRange = range;}, /**\r\n         * 获取开始元素，用于状态反射\r\n         * @method getStart\r\n         * @return { Element } 获得开始元素\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.getStart();\r\n         * ```\r\n         */getStart:function getStart(){if(this._cachedStartElement){return this._cachedStartElement;}var range=browser.ie9below?this.getIERange():this.getRange(),tmpRange,start,tmp,parent;if(browser.ie9below){if(!range){ //todo 给第一个值可能会有问题\nreturn this.document.body.firstChild;} //control元素\nif(range.item){return range.item(0);}tmpRange = range.duplicate(); //修正ie下<b>x</b>[xx] 闭合后 <b>x|</b>xx\ntmpRange.text.length > 0 && tmpRange.moveStart('character',1);tmpRange.collapse(1);start = tmpRange.parentElement();parent = tmp = range.parentElement();while(tmp = tmp.parentNode) {if(tmp == start){start = parent;break;}}}else {range.shrinkBoundary();start = range.startContainer;if(start.nodeType == 1 && start.hasChildNodes()){start = start.childNodes[Math.min(start.childNodes.length - 1,range.startOffset)];}if(start.nodeType == 3){return start.parentNode;}}return start;}, /**\r\n         * 得到选区中的文本\r\n         * @method getText\r\n         * @return { String } 选区中包含的文本\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.getText();\r\n         * ```\r\n         */getText:function getText(){var nativeSel,nativeRange;if(this.isFocus() && (nativeSel = this.getNative())){nativeRange = browser.ie9below?nativeSel.createRange():nativeSel.getRangeAt(0);return browser.ie9below?nativeRange.text:nativeRange.toString();}return '';}, /**\r\n         * 清除选区\r\n         * @method clearRange\r\n         * @example\r\n         * ```javascript\r\n         * editor.selection.clearRange();\r\n         * ```\r\n         */clearRange:function clearRange(){this.getNative()[browser.ie9below?'empty':'removeAllRanges']();}};})(); // core/Editor.js\n/**\r\n * 编辑器主类，包含编辑器提供的大部分公用接口\r\n * @file\r\n * @module UE\r\n * @class Editor\r\n * @since 1.2.6.1\r\n */ /**\r\n * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n * @unfile\r\n * @module UE\r\n */ /**\r\n * UEditor的核心类，为用户提供与编辑器交互的接口。\r\n * @unfile\r\n * @module UE\r\n * @class Editor\r\n */(function(){var uid=0,_selectionChangeTimer; /**\r\n     * 获取编辑器的html内容，赋值到编辑器所在表单的textarea文本域里面\r\n     * @private\r\n     * @method setValue\r\n     * @param { UE.Editor } editor 编辑器事例\r\n     */function setValue(form,editor){var textarea;if(editor.textarea){if(utils.isString(editor.textarea)){for(var i=0,ti,tis=domUtils.getElementsByTagName(form,'textarea');ti = tis[i++];) {if(ti.id == 'ueditor_textarea_' + editor.options.textarea){textarea = ti;break;}}}else {textarea = editor.textarea;}}if(!textarea){form.appendChild(textarea = domUtils.createElement(document,'textarea',{'name':editor.options.textarea,'id':'ueditor_textarea_' + editor.options.textarea,'style':\"display:none\"})); //不要产生多个textarea\neditor.textarea = textarea;}!textarea.getAttribute('name') && textarea.setAttribute('name',editor.options.textarea);textarea.value = editor.hasContents()?editor.options.allHtmlEnabled?editor.getAllHtml():editor.getContent(null,null,true):'';}function loadPlugins(me){ //初始化插件\nfor(var pi in UE.plugins) {UE.plugins[pi].call(me);}}function checkCurLang(I18N){for(var lang in I18N) {return lang;}}function langReadied(me){me.langIsReady = true;me.fireEvent(\"langReady\");} /**\r\n     * 编辑器准备就绪后会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event ready\r\n     * @remind render方法执行完成之后,会触发该事件\r\n     * @remind\r\n     * @example\r\n     * ```javascript\r\n     * editor.addListener( 'ready', function( editor ) {\r\n     *     editor.execCommand( 'focus' ); //编辑器家在完成后，让编辑器拿到焦点\r\n     * } );\r\n     * ```\r\n     */ /**\r\n     * 执行destroy方法,会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event destroy\r\n     * @see UE.Editor:destroy()\r\n     */ /**\r\n     * 执行reset方法,会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event reset\r\n     * @see UE.Editor:reset()\r\n     */ /**\r\n     * 执行focus方法,会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event focus\r\n     * @see UE.Editor:focus(Boolean)\r\n     */ /**\r\n     * 语言加载完成会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event langReady\r\n     */ /**\r\n     * 运行命令之后会触发该命令\r\n     * @module UE\r\n     * @class Editor\r\n     * @event beforeExecCommand\r\n     */ /**\r\n     * 运行命令之后会触发该命令\r\n     * @module UE\r\n     * @class Editor\r\n     * @event afterExecCommand\r\n     */ /**\r\n     * 运行命令之前会触发该命令\r\n     * @module UE\r\n     * @class Editor\r\n     * @event firstBeforeExecCommand\r\n     */ /**\r\n     * 在getContent方法执行之前会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event beforeGetContent\r\n     * @see UE.Editor:getContent()\r\n     */ /**\r\n     * 在getContent方法执行之后会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event afterGetContent\r\n     * @see UE.Editor:getContent()\r\n     */ /**\r\n     * 在getAllHtml方法执行时会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event getAllHtml\r\n     * @see UE.Editor:getAllHtml()\r\n     */ /**\r\n     * 在setContent方法执行之前会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event beforeSetContent\r\n     * @see UE.Editor:setContent(String)\r\n     */ /**\r\n     * 在setContent方法执行之后会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event afterSetContent\r\n     * @see UE.Editor:setContent(String)\r\n     */ /**\r\n     * 每当编辑器内部选区发生改变时，将触发该事件\r\n     * @event selectionchange\r\n     * @warning 该事件的触发非常频繁，不建议在该事件的处理过程中做重量级的处理\r\n     * @example\r\n     * ```javascript\r\n     * editor.addListener( 'selectionchange', function( editor ) {\r\n     *     console.log('选区发生改变');\r\n     * }\r\n     */ /**\r\n     * 在所有selectionchange的监听函数执行之前，会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event beforeSelectionChange\r\n     * @see UE.Editor:selectionchange\r\n     */ /**\r\n     * 在所有selectionchange的监听函数执行完之后，会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event afterSelectionChange\r\n     * @see UE.Editor:selectionchange\r\n     */ /**\r\n     * 编辑器内容发生改变时会触发该事件\r\n     * @module UE\r\n     * @class Editor\r\n     * @event contentChange\r\n     */ /**\r\n     * 以默认参数构建一个编辑器实例\r\n     * @constructor\r\n     * @remind 通过 改构造方法实例化的编辑器,不带ui层.需要render到一个容器,编辑器实例才能正常渲染到页面\r\n     * @example\r\n     * ```javascript\r\n     * var editor = new UE.Editor();\r\n     * editor.execCommand('blod');\r\n     * ```\r\n     * @see UE.Config\r\n     */ /**\r\n     * 以给定的参数集合创建一个编辑器实例，对于未指定的参数，将应用默认参数。\r\n     * @constructor\r\n     * @remind 通过 改构造方法实例化的编辑器,不带ui层.需要render到一个容器,编辑器实例才能正常渲染到页面\r\n     * @param { Object } setting 创建编辑器的参数\r\n     * @example\r\n     * ```javascript\r\n     * var editor = new UE.Editor();\r\n     * editor.execCommand('blod');\r\n     * ```\r\n     * @see UE.Config\r\n     */var Editor=UE.Editor = function(options){var me=this;me.uid = uid++;EventBase.call(me);me.commands = {};me.options = utils.extend(utils.clone(options || {}),UEDITOR_CONFIG,true);me.shortcutkeys = {};me.inputRules = [];me.outputRules = []; //设置默认的常用属性\nme.setOpt(Editor.defaultOptions(me)); /* 尝试异步加载后台配置 */me.loadServerConfig();if(!utils.isEmptyObject(UE.I18N)){ //修改默认的语言类型\nme.options.lang = checkCurLang(UE.I18N);UE.plugin.load(me);langReadied(me);}else {utils.loadFile(document,{src:me.options.langPath + me.options.lang + \"/\" + me.options.lang + \".js\",tag:\"script\",type:\"text/javascript\",defer:\"defer\"},function(){UE.plugin.load(me);langReadied(me);});}UE.instants['ueditorInstant' + me.uid] = me;};Editor.prototype = {registerCommand:function registerCommand(name,obj){this.commands[name] = obj;}, /**\r\n         * 编辑器对外提供的监听ready事件的接口， 通过调用该方法，达到的效果与监听ready事件是一致的\r\n         * @method ready\r\n         * @param { Function } fn 编辑器ready之后所执行的回调, 如果在注册事件之前编辑器已经ready，将会\r\n         * 立即触发该回调。\r\n         * @remind 需要等待编辑器加载完成后才能执行的代码,可以使用该方法传入\r\n         * @example\r\n         * ```javascript\r\n         * editor.ready( function( editor ) {\r\n         *     editor.setContent('初始化完毕');\r\n         * } );\r\n         * ```\r\n         * @see UE.Editor.event:ready\r\n         */ready:function ready(fn){var me=this;if(fn){me.isReady?fn.apply(me):me.addListener('ready',fn);}}, /**\r\n         * 该方法是提供给插件里面使用，设置配置项默认值\r\n         * @method setOpt\r\n         * @warning 三处设置配置项的优先级: 实例化时传入参数 > setOpt()设置 > config文件里设置\r\n         * @warning 该方法仅供编辑器插件内部和编辑器初始化时调用，其他地方不能调用。\r\n         * @param { String } key 编辑器的可接受的选项名称\r\n         * @param { * } val  该选项可接受的值\r\n         * @example\r\n         * ```javascript\r\n         * editor.setOpt( 'initContent', '欢迎使用编辑器' );\r\n         * ```\r\n         */ /**\r\n         * 该方法是提供给插件里面使用，以{key:value}集合的方式设置插件内用到的配置项默认值\r\n         * @method setOpt\r\n         * @warning 三处设置配置项的优先级: 实例化时传入参数 > setOpt()设置 > config文件里设置\r\n         * @warning 该方法仅供编辑器插件内部和编辑器初始化时调用，其他地方不能调用。\r\n         * @param { Object } options 将要设置的选项的键值对对象\r\n         * @example\r\n         * ```javascript\r\n         * editor.setOpt( {\r\n         *     'initContent': '欢迎使用编辑器'\r\n         * } );\r\n         * ```\r\n         */setOpt:function setOpt(key,val){var obj={};if(utils.isString(key)){obj[key] = val;}else {obj = key;}utils.extend(this.options,obj,true);},getOpt:function getOpt(key){return this.options[key];}, /**\r\n         * 销毁编辑器实例，使用textarea代替\r\n         * @method destroy\r\n         * @example\r\n         * ```javascript\r\n         * editor.destroy();\r\n         * ```\r\n         */destroy:function destroy(){var me=this;me.fireEvent('destroy');var container=me.container.parentNode;var textarea=me.textarea;if(!textarea){textarea = document.createElement('textarea');container.parentNode.insertBefore(textarea,container);}else {textarea.style.display = '';}textarea.style.width = me.iframe.offsetWidth + 'px';textarea.style.height = me.iframe.offsetHeight + 'px';textarea.value = me.getContent();textarea.id = me.key;container.innerHTML = '';domUtils.remove(container);var key=me.key; //trace:2004\nfor(var p in me) {if(me.hasOwnProperty(p)){delete this[p];}}UE.delEditor(key);}, /**\r\n         * 渲染编辑器的DOM到指定容器\r\n         * @method render\r\n         * @param { String } containerId 指定一个容器ID\r\n         * @remind 执行该方法,会触发ready事件\r\n         * @warning 必须且只能调用一次\r\n         */ /**\r\n         * 渲染编辑器的DOM到指定容器\r\n         * @method render\r\n         * @param { Element } containerDom 直接指定容器对象\r\n         * @remind 执行该方法,会触发ready事件\r\n         * @warning 必须且只能调用一次\r\n         */render:function render(container){var me=this,options=me.options,getStyleValue=function getStyleValue(attr){return parseInt(domUtils.getComputedStyle(container,attr));};if(utils.isString(container)){container = document.getElementById(container);}if(container){if(options.initialFrameWidth){options.minFrameWidth = options.initialFrameWidth;}else {options.minFrameWidth = options.initialFrameWidth = container.offsetWidth;}if(options.initialFrameHeight){options.minFrameHeight = options.initialFrameHeight;}else {options.initialFrameHeight = options.minFrameHeight = container.offsetHeight;}container.style.width = /%$/.test(options.initialFrameWidth)?'100%':options.initialFrameWidth - getStyleValue(\"padding-left\") - getStyleValue(\"padding-right\") + 'px';container.style.height = /%$/.test(options.initialFrameHeight)?'100%':options.initialFrameHeight - getStyleValue(\"padding-top\") - getStyleValue(\"padding-bottom\") + 'px';container.style.zIndex = options.zIndex;var html=(ie && browser.version < 9?'':'<!DOCTYPE html>') + '<html xmlns=\\'http://www.w3.org/1999/xhtml\\' class=\\'view\\' ><head>' + '<style type=\\'text/css\\'>' +  //设置四周的留边\n'.view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\\n' +  //设置默认字体和字号\n//font-family不能呢随便改，在safari下fillchar会有解析问题\n'body{margin:8px;font-family:sans-serif;font-size:16px;}' +  //设置段落间距\n'p{margin:5px 0;}</style>' + (options.iframeCssUrl?'<link rel=\\'stylesheet\\' type=\\'text/css\\' href=\\'' + utils.unhtml(options.iframeCssUrl) + '\\'/>':'') + (options.initialStyle?'<style>' + options.initialStyle + '</style>':'') + '</head><body class=\\'view\\' ></body>' + '<script type=\\'text/javascript\\' ' + (ie?'defer=\\'defer\\'':'') + ' id=\\'_initialScript\\'>' + 'setTimeout(function(){editor = window.parent.UE.instants[\\'ueditorInstant' + me.uid + '\\'];editor._setup(document);},0);' + 'var _tmpScript = document.getElementById(\\'_initialScript\\');_tmpScript.parentNode.removeChild(_tmpScript);</script></html>';container.appendChild(domUtils.createElement(document,'iframe',{id:'ueditor_' + me.uid,width:\"100%\",height:\"100%\",frameborder:\"0\", //先注释掉了，加的原因忘记了，但开启会直接导致全屏模式下内容多时不会出现滚动条\n//                    scrolling :'no',\nsrc:'javascript:void(function(){document.open();' + (options.customDomain && document.domain != location.hostname?'document.domain=\"' + document.domain + '\";':'') + 'document.write(\"' + html + '\");document.close();}())'}));container.style.overflow = 'hidden'; //解决如果是给定的百分比，会导致高度算不对的问题\nsetTimeout(function(){if(/%$/.test(options.initialFrameWidth)){options.minFrameWidth = options.initialFrameWidth = container.offsetWidth; //如果这里给定宽度，会导致ie在拖动窗口大小时，编辑区域不随着变化\n//                        container.style.width = options.initialFrameWidth + 'px';\n}if(/%$/.test(options.initialFrameHeight)){options.minFrameHeight = options.initialFrameHeight = container.offsetHeight;container.style.height = options.initialFrameHeight + 'px';}});}}, /**\r\n         * 编辑器初始化\r\n         * @method _setup\r\n         * @private\r\n         * @param { Element } doc 编辑器Iframe中的文档对象\r\n         */_setup:function _setup(doc){var me=this,options=me.options;if(ie){doc.body.disabled = true;doc.body.contentEditable = true;doc.body.disabled = false;}else {doc.body.contentEditable = true;}doc.body.spellcheck = false;me.document = doc;me.window = doc.defaultView || doc.parentWindow;me.iframe = me.window.frameElement;me.body = doc.body;me.selection = new dom.Selection(doc); //gecko初始化就能得到range,无法判断isFocus了\nvar geckoSel;if(browser.gecko && (geckoSel = this.selection.getNative())){geckoSel.removeAllRanges();}this._initEvents(); //为form提交提供一个隐藏的textarea\nfor(var form=this.iframe.parentNode;!domUtils.isBody(form);form = form.parentNode) {if(form.tagName == 'FORM'){me.form = form;if(me.options.autoSyncData){domUtils.on(me.window,'blur',function(){setValue(form,me);});}else {domUtils.on(form,'submit',function(){setValue(this,me);});}break;}}if(options.initialContent){if(options.autoClearinitialContent){var oldExecCommand=me.execCommand;me.execCommand = function(){me.fireEvent('firstBeforeExecCommand');return oldExecCommand.apply(me,arguments);};this._setDefaultContent(options.initialContent);}else this.setContent(options.initialContent,false,true);} //编辑器不能为空内容\nif(domUtils.isEmptyNode(me.body)){me.body.innerHTML = '<p>' + (browser.ie?'':'<br/>') + '</p>';} //如果要求focus, 就把光标定位到内容开始\nif(options.focus){setTimeout(function(){me.focus(me.options.focusInEnd); //如果自动清除开着，就不需要做selectionchange;\n!me.options.autoClearinitialContent && me._selectionChange();},0);}if(!me.container){me.container = this.iframe.parentNode;}if(options.fullscreen && me.ui){me.ui.setFullScreen(true);}try{me.document.execCommand('2D-position',false,false);}catch(e) {}try{me.document.execCommand('enableInlineTableEditing',false,false);}catch(e) {}try{me.document.execCommand('enableObjectResizing',false,false);}catch(e) {} //挂接快捷键\nme._bindshortcutKeys();me.isReady = 1;me.fireEvent('ready');options.onready && options.onready.call(me);if(!browser.ie9below){domUtils.on(me.window,['blur','focus'],function(e){ //chrome下会出现alt+tab切换时，导致选区位置不对\nif(e.type == 'blur'){me._bakRange = me.selection.getRange();try{me._bakNativeRange = me.selection.getNative().getRangeAt(0);me.selection.getNative().removeAllRanges();}catch(e) {me._bakNativeRange = null;}}else {try{me._bakRange && me._bakRange.select();}catch(e) {}}});} //trace:1518 ff3.6body不够寛，会导致点击空白处无法获得焦点\nif(browser.gecko && browser.version <= 10902){ //修复ff3.6初始化进来，不能点击获得焦点\nme.body.contentEditable = false;setTimeout(function(){me.body.contentEditable = true;},100);setInterval(function(){me.body.style.height = me.iframe.offsetHeight - 20 + 'px';},100);}!options.isShow && me.setHide();options.readonly && me.setDisabled();}, /**\r\n         * 同步数据到编辑器所在的form\r\n         * 从编辑器的容器节点向上查找form元素，若找到，就同步编辑内容到找到的form里，为提交数据做准备，主要用于是手动提交的情况\r\n         * 后台取得数据的键值，使用你容器上的name属性，如果没有就使用参数里的textarea项\r\n         * @method sync\r\n         * @example\r\n         * ```javascript\r\n         * editor.sync();\r\n         * form.sumbit(); //form变量已经指向了form元素\r\n         * ```\r\n         */ /**\r\n         * 根据传入的formId，在页面上查找要同步数据的表单，若找到，就同步编辑内容到找到的form里，为提交数据做准备\r\n         * 后台取得数据的键值，该键值默认使用给定的编辑器容器的name属性，如果没有name属性则使用参数项里给定的“textarea”项\r\n         * @method sync\r\n         * @param { String } formID 指定一个要同步数据的form的id,编辑器的数据会同步到你指定form下\r\n         */sync:function sync(formId){var me=this,form=formId?document.getElementById(formId):domUtils.findParent(me.iframe.parentNode,function(node){return node.tagName == 'FORM';},true);form && setValue(form,me);}, /**\r\n         * 设置编辑器高度\r\n         * @method setHeight\r\n         * @remind 当配置项autoHeightEnabled为真时,该方法无效\r\n         * @param { Number } number 设置的高度值，纯数值，不带单位\r\n         * @example\r\n         * ```javascript\r\n         * editor.setHeight(number);\r\n         * ```\r\n         */setHeight:function setHeight(height,notSetHeight){if(height !== parseInt(this.iframe.parentNode.style.height)){this.iframe.parentNode.style.height = height + 'px';}!notSetHeight && (this.options.minFrameHeight = this.options.initialFrameHeight = height);this.body.style.height = height + 'px';!notSetHeight && this.trigger('setHeight');}, /**\r\n         * 为编辑器的编辑命令提供快捷键\r\n         * 这个接口是为插件扩展提供的接口,主要是为新添加的插件，如果需要添加快捷键，所提供的接口\r\n         * @method addshortcutkey\r\n         * @param { Object } keyset 命令名和快捷键键值对对象，多个按钮的快捷键用“＋”分隔\r\n         * @example\r\n         * ```javascript\r\n         * editor.addshortcutkey({\r\n         *     \"Bold\" : \"ctrl+66\",//^B\r\n         *     \"Italic\" : \"ctrl+73\", //^I\r\n         * });\r\n         * ```\r\n         */ /**\r\n         * 这个接口是为插件扩展提供的接口,主要是为新添加的插件，如果需要添加快捷键，所提供的接口\r\n         * @method addshortcutkey\r\n         * @param { String } cmd 触发快捷键时，响应的命令\r\n         * @param { String } keys 快捷键的字符串，多个按钮用“＋”分隔\r\n         * @example\r\n         * ```javascript\r\n         * editor.addshortcutkey(\"Underline\", \"ctrl+85\"); //^U\r\n         * ```\r\n         */addshortcutkey:function addshortcutkey(cmd,keys){var obj={};if(keys){obj[cmd] = keys;}else {obj = cmd;}utils.extend(this.shortcutkeys,obj);}, /**\r\n         * 对编辑器设置keydown事件监听，绑定快捷键和命令，当快捷键组合触发成功，会响应对应的命令\r\n         * @method _bindshortcutKeys\r\n         * @private\r\n         */_bindshortcutKeys:function _bindshortcutKeys(){var me=this,shortcutkeys=this.shortcutkeys;me.addListener('keydown',function(type,e){var keyCode=e.keyCode || e.which;for(var i in shortcutkeys) {var tmp=shortcutkeys[i].split(',');for(var t=0,ti;ti = tmp[t++];) {ti = ti.split(':');var key=ti[0],param=ti[1];if(/^(ctrl)(\\+shift)?\\+(\\d+)$/.test(key.toLowerCase()) || /^(\\d+)$/.test(key)){if((RegExp.$1 == 'ctrl'?e.ctrlKey || e.metaKey:0) && (RegExp.$2 != \"\"?e[RegExp.$2.slice(1) + \"Key\"]:1) && keyCode == RegExp.$3 || keyCode == RegExp.$1){if(me.queryCommandState(i,param) != -1)me.execCommand(i,param);domUtils.preventDefault(e);}}}}});}, /**\r\n         * 获取编辑器的内容\r\n         * @method getContent\r\n         * @warning 该方法获取到的是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n         * @return { String } 编辑器的内容字符串, 如果编辑器的内容为空，或者是空的标签内容（如:”&lt;p&gt;&lt;br/&gt;&lt;/p&gt;“）， 则返回空字符串\r\n         * @example\r\n         * ```javascript\r\n         * //编辑器html内容:<p>1<strong>2<em>34</em>5</strong>6</p>\r\n         * var content = editor.getContent(); //返回值:<p>1<strong>2<em>34</em>5</strong>6</p>\r\n         * ```\r\n         */ /**\r\n         * 获取编辑器的内容。 可以通过参数定义编辑器内置的判空规则\r\n         * @method getContent\r\n         * @param { Function } fn 自定的判空规则， 要求该方法返回一个boolean类型的值，\r\n         *                      代表当前编辑器的内容是否空，\r\n         *                      如果返回true， 则该方法将直接返回空字符串；如果返回false，则编辑器将返回\r\n         *                      经过内置过滤规则处理后的内容。\r\n         * @remind 该方法在处理包含有初始化内容的时候能起到很好的作用。\r\n         * @warning 该方法获取到的是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n         * @return { String } 编辑器的内容字符串\r\n         * @example\r\n         * ```javascript\r\n         * // editor 是一个编辑器的实例\r\n         * var content = editor.getContent( function ( editor ) {\r\n         *      return editor.body.innerHTML === '欢迎使用UEditor'; //返回空字符串\r\n         * } );\r\n         * ```\r\n         */getContent:function getContent(cmd,fn,notSetCursor,ignoreBlank,formatter){var me=this;if(cmd && utils.isFunction(cmd)){fn = cmd;cmd = '';}if(fn?!fn():!this.hasContents()){return '';}me.fireEvent('beforegetcontent');var root=UE.htmlparser(me.body.innerHTML,ignoreBlank);me.filterOutputRule(root);me.fireEvent('aftergetcontent',cmd,root);return root.toHtml(formatter);}, /**\r\n         * 取得完整的html代码，可以直接显示成完整的html文档\r\n         * @method getAllHtml\r\n         * @return { String } 编辑器的内容html文档字符串\r\n         * @eaxmple\r\n         * ```javascript\r\n         * editor.getAllHtml(); //返回格式大致是: <html><head>...</head><body>...</body></html>\r\n         * ```\r\n         */getAllHtml:function getAllHtml(){var me=this,headHtml=[],html='';me.fireEvent('getAllHtml',headHtml);if(browser.ie && browser.version > 8){var headHtmlForIE9='';utils.each(me.document.styleSheets,function(si){headHtmlForIE9 += si.href?'<link rel=\"stylesheet\" type=\"text/css\" href=\"' + si.href + '\" />':'<style>' + si.cssText + '</style>';});utils.each(me.document.getElementsByTagName('script'),function(si){headHtmlForIE9 += si.outerHTML;});}return '<html><head>' + (me.options.charset?'<meta http-equiv=\"Content-Type\" content=\"text/html; charset=' + me.options.charset + '\"/>':'') + (headHtmlForIE9 || me.document.getElementsByTagName('head')[0].innerHTML) + headHtml.join('\\n') + '</head>' + '<body ' + (ie && browser.version < 9?'class=\"view\"':'') + '>' + me.getContent(null,null,true) + '</body></html>';}, /**\r\n         * 得到编辑器的纯文本内容，但会保留段落格式\r\n         * @method getPlainTxt\r\n         * @return { String } 编辑器带段落格式的纯文本内容字符串\r\n         * @example\r\n         * ```javascript\r\n         * //编辑器html内容:<p><strong>1</strong></p><p><strong>2</strong></p>\r\n         * console.log(editor.getPlainTxt()); //输出:\"1\\n2\\n\r\n         * ```\r\n         */getPlainTxt:function getPlainTxt(){var reg=new RegExp(domUtils.fillChar,'g'),html=this.body.innerHTML.replace(/[\\n\\r]/g,''); //ie要先去了\\n在处理\nhtml = html.replace(/<(p|div)[^>]*>(<br\\/?>|&nbsp;)<\\/\\1>/gi,'\\n').replace(/<br\\/?>/gi,'\\n').replace(/<[^>/]+>/g,'').replace(/(\\n)?<\\/([^>]+)>/g,function(a,b,c){return dtd.$block[c]?'\\n':b?b:'';}); //取出来的空格会有c2a0会变成乱码，处理这种情况\\u00a0\nreturn html.replace(reg,'').replace(/\\u00a0/g,' ').replace(/&nbsp;/g,' ');}, /**\r\n         * 获取编辑器中的纯文本内容,没有段落格式\r\n         * @method getContentTxt\r\n         * @return { String } 编辑器不带段落格式的纯文本内容字符串\r\n         * @example\r\n         * ```javascript\r\n         * //编辑器html内容:<p><strong>1</strong></p><p><strong>2</strong></p>\r\n         * console.log(editor.getPlainTxt()); //输出:\"12\r\n         * ```\r\n         */getContentTxt:function getContentTxt(){var reg=new RegExp(domUtils.fillChar,'g'); //取出来的空格会有c2a0会变成乱码，处理这种情况\\u00a0\nreturn this.body[browser.ie?'innerText':'textContent'].replace(reg,'').replace(/\\u00a0/g,' ');}, /**\r\n         * 设置编辑器的内容，可修改编辑器当前的html内容\r\n         * @method setContent\r\n         * @warning 通过该方法插入的内容，是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n         * @warning 该方法会触发selectionchange事件\r\n         * @param { String } html 要插入的html内容\r\n         * @example\r\n         * ```javascript\r\n         * editor.getContent('<p>test</p>');\r\n         * ```\r\n         */ /**\r\n         * 设置编辑器的内容，可修改编辑器当前的html内容\r\n         * @method setContent\r\n         * @warning 通过该方法插入的内容，是经过编辑器内置的过滤规则进行过滤后得到的内容\r\n         * @warning 该方法会触发selectionchange事件\r\n         * @param { String } html 要插入的html内容\r\n         * @param { Boolean } isAppendTo 若传入true，不清空原来的内容，在最后插入内容，否则，清空内容再插入\r\n         * @example\r\n         * ```javascript\r\n         * //假设设置前的编辑器内容是 <p>old text</p>\r\n         * editor.setContent('<p>new text</p>', true); //插入的结果是<p>old text</p><p>new text</p>\r\n         * ```\r\n         */setContent:function setContent(html,isAppendTo,notFireSelectionchange){var me=this;me.fireEvent('beforesetcontent',html);var root=UE.htmlparser(html);me.filterInputRule(root);html = root.toHtml();me.body.innerHTML = (isAppendTo?me.body.innerHTML:'') + html;function isCdataDiv(node){return node.tagName == 'DIV' && node.getAttribute('cdata_tag');} //给文本或者inline节点套p标签\nif(me.options.enterTag == 'p'){var child=this.body.firstChild,tmpNode;if(!child || child.nodeType == 1 && (dtd.$cdata[child.tagName] || isCdataDiv(child) || domUtils.isCustomeNode(child)) && child === this.body.lastChild){this.body.innerHTML = '<p>' + (browser.ie?'&nbsp;':'<br/>') + '</p>' + this.body.innerHTML;}else {var p=me.document.createElement('p');while(child) {while(child && (child.nodeType == 3 || child.nodeType == 1 && dtd.p[child.tagName] && !dtd.$cdata[child.tagName])) {tmpNode = child.nextSibling;p.appendChild(child);child = tmpNode;}if(p.firstChild){if(!child){me.body.appendChild(p);break;}else {child.parentNode.insertBefore(p,child);p = me.document.createElement('p');}}child = child.nextSibling;}}}me.fireEvent('aftersetcontent');me.fireEvent('contentchange');!notFireSelectionchange && me._selectionChange(); //清除保存的选区\nme._bakRange = me._bakIERange = me._bakNativeRange = null; //trace:1742 setContent后gecko能得到焦点问题\nvar geckoSel;if(browser.gecko && (geckoSel = this.selection.getNative())){geckoSel.removeAllRanges();}if(me.options.autoSyncData){me.form && setValue(me.form,me);}}, /**\r\n         * 让编辑器获得焦点，默认focus到编辑器头部\r\n         * @method focus\r\n         * @example\r\n         * ```javascript\r\n         * editor.focus()\r\n         * ```\r\n         */ /**\r\n         * 让编辑器获得焦点，toEnd确定focus位置\r\n         * @method focus\r\n         * @param { Boolean } toEnd 默认focus到编辑器头部，toEnd为true时focus到内容尾部\r\n         * @example\r\n         * ```javascript\r\n         * editor.focus(true)\r\n         * ```\r\n         */focus:function focus(toEnd){try{var me=this,rng=me.selection.getRange();if(toEnd){var node=me.body.lastChild;if(node && node.nodeType == 1 && !dtd.$empty[node.tagName]){if(domUtils.isEmptyBlock(node)){rng.setStartAtFirst(node);}else {rng.setStartAtLast(node);}rng.collapse(true);}rng.setCursor(true);}else {if(!rng.collapsed && domUtils.isBody(rng.startContainer) && rng.startOffset == 0){var node=me.body.firstChild;if(node && node.nodeType == 1 && !dtd.$empty[node.tagName]){rng.setStartAtFirst(node).collapse(true);}}rng.select(true);}this.fireEvent('focus selectionchange');}catch(e) {}},isFocus:function isFocus(){return this.selection.isFocus();},blur:function blur(){var sel=this.selection.getNative();if(sel.empty && browser.ie){var nativeRng=document.body.createTextRange();nativeRng.moveToElementText(document.body);nativeRng.collapse(true);nativeRng.select();sel.empty();}else {sel.removeAllRanges();} //this.fireEvent('blur selectionchange');\n}, /**\r\n         * 初始化UE事件及部分事件代理\r\n         * @method _initEvents\r\n         * @private\r\n         */_initEvents:function _initEvents(){var me=this,doc=me.document,win=me.window;me._proxyDomEvent = utils.bind(me._proxyDomEvent,me);domUtils.on(doc,['click','contextmenu','mousedown','keydown','keyup','keypress','mouseup','mouseover','mouseout','selectstart'],me._proxyDomEvent);domUtils.on(win,['focus','blur'],me._proxyDomEvent);domUtils.on(me.body,'drop',function(e){ //阻止ff下默认的弹出新页面打开图片\nif(browser.gecko && e.stopPropagation){e.stopPropagation();}me.fireEvent('contentchange');});domUtils.on(doc,['mouseup','keydown'],function(evt){ //特殊键不触发selectionchange\nif(evt.type == 'keydown' && (evt.ctrlKey || evt.metaKey || evt.shiftKey || evt.altKey)){return;}if(evt.button == 2)return;me._selectionChange(250,evt);});}, /**\r\n         * 触发事件代理\r\n         * @method _proxyDomEvent\r\n         * @private\r\n         * @return { * } fireEvent的返回值\r\n         * @see UE.EventBase:fireEvent(String)\r\n         */_proxyDomEvent:function _proxyDomEvent(evt){if(this.fireEvent('before' + evt.type.replace(/^on/,'').toLowerCase()) === false){return false;}if(this.fireEvent(evt.type.replace(/^on/,''),evt) === false){return false;}return this.fireEvent('after' + evt.type.replace(/^on/,'').toLowerCase());}, /**\r\n         * 变化选区\r\n         * @method _selectionChange\r\n         * @private\r\n         */_selectionChange:function _selectionChange(delay,evt){var me=this; //有光标才做selectionchange 为了解决未focus时点击source不能触发更改工具栏状态的问题（source命令notNeedUndo=1）\n//            if ( !me.selection.isFocus() ){\n//                return;\n//            }\nvar hackForMouseUp=false;var mouseX,mouseY;if(browser.ie && browser.version < 9 && evt && evt.type == 'mouseup'){var range=this.selection.getRange();if(!range.collapsed){hackForMouseUp = true;mouseX = evt.clientX;mouseY = evt.clientY;}}clearTimeout(_selectionChangeTimer);_selectionChangeTimer = setTimeout(function(){if(!me.selection || !me.selection.getNative()){return;} //修复一个IE下的bug: 鼠标点击一段已选择的文本中间时，可能在mouseup后的一段时间内取到的range是在selection的type为None下的错误值.\n//IE下如果用户是拖拽一段已选择文本，则不会触发mouseup事件，所以这里的特殊处理不会对其有影响\nvar ieRange;if(hackForMouseUp && me.selection.getNative().type == 'None'){ieRange = me.document.body.createTextRange();try{ieRange.moveToPoint(mouseX,mouseY);}catch(ex) {ieRange = null;}}var bakGetIERange;if(ieRange){bakGetIERange = me.selection.getIERange;me.selection.getIERange = function(){return ieRange;};}me.selection.cache();if(bakGetIERange){me.selection.getIERange = bakGetIERange;}if(me.selection._cachedRange && me.selection._cachedStartElement){me.fireEvent('beforeselectionchange'); // 第二个参数causeByUi为true代表由用户交互造成的selectionchange.\nme.fireEvent('selectionchange',!!evt);me.fireEvent('afterselectionchange');me.selection.clear();}},delay || 50);}, /**\r\n         * 执行编辑命令\r\n         * @method _callCmdFn\r\n         * @private\r\n         * @param { String } fnName 函数名称\r\n         * @param { * } args 传给命令函数的参数\r\n         * @return { * } 返回命令函数运行的返回值\r\n         */_callCmdFn:function _callCmdFn(fnName,args){var cmdName=args[0].toLowerCase(),cmd,cmdFn;cmd = this.commands[cmdName] || UE.commands[cmdName];cmdFn = cmd && cmd[fnName]; //没有querycommandstate或者没有command的都默认返回0\nif((!cmd || !cmdFn) && fnName == 'queryCommandState'){return 0;}else if(cmdFn){return cmdFn.apply(this,args);}}, /**\r\n         * 执行编辑命令cmdName，完成富文本编辑效果\r\n         * @method execCommand\r\n         * @param { String } cmdName 需要执行的命令\r\n         * @remind 具体命令的使用请参考<a href=\"#COMMAND.LIST\">命令列表</a>\r\n         * @return { * } 返回命令函数运行的返回值\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand(cmdName);\r\n         * ```\r\n         */execCommand:function execCommand(cmdName){cmdName = cmdName.toLowerCase();var me=this,result,cmd=me.commands[cmdName] || UE.commands[cmdName];if(!cmd || !cmd.execCommand){return null;}if(!cmd.notNeedUndo && !me.__hasEnterExecCommand){me.__hasEnterExecCommand = true;if(me.queryCommandState.apply(me,arguments) != -1){me.fireEvent('saveScene');me.fireEvent.apply(me,['beforeexeccommand',cmdName].concat(arguments));result = this._callCmdFn('execCommand',arguments); //保存场景时，做了内容对比，再看是否进行contentchange触发，这里多触发了一次，去掉\n//                    (!cmd.ignoreContentChange && !me._ignoreContentChange) && me.fireEvent('contentchange');\nme.fireEvent.apply(me,['afterexeccommand',cmdName].concat(arguments));me.fireEvent('saveScene');}me.__hasEnterExecCommand = false;}else {result = this._callCmdFn('execCommand',arguments);!me.__hasEnterExecCommand && !cmd.ignoreContentChange && !me._ignoreContentChange && me.fireEvent('contentchange');}!me.__hasEnterExecCommand && !cmd.ignoreContentChange && !me._ignoreContentChange && me._selectionChange();return result;}, /**\r\n         * 根据传入的command命令，查选编辑器当前的选区，返回命令的状态\r\n         * @method  queryCommandState\r\n         * @param { String } cmdName 需要查询的命令名称\r\n         * @remind 具体命令的使用请参考<a href=\"#COMMAND.LIST\">命令列表</a>\r\n         * @return { Number } number 返回放前命令的状态，返回值三种情况：(-1|0|1)\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandState(cmdName)  => (-1|0|1)\r\n         * ```\r\n         * @see COMMAND.LIST\r\n         */queryCommandState:function queryCommandState(cmdName){return this._callCmdFn('queryCommandState',arguments);}, /**\r\n         * 根据传入的command命令，查选编辑器当前的选区，根据命令返回相关的值\r\n         * @method queryCommandValue\r\n         * @param { String } cmdName 需要查询的命令名称\r\n         * @remind 具体命令的使用请参考<a href=\"#COMMAND.LIST\">命令列表</a>\r\n         * @remind 只有部分插件有此方法\r\n         * @return { * } 返回每个命令特定的当前状态值\r\n         * @grammar editor.queryCommandValue(cmdName)  =>  {*}\r\n         * @see COMMAND.LIST\r\n         */queryCommandValue:function queryCommandValue(cmdName){return this._callCmdFn('queryCommandValue',arguments);}, /**\r\n         * 检查编辑区域中是否有内容\r\n         * @method  hasContents\r\n         * @remind 默认有文本内容，或者有以下节点都不认为是空\r\n         * table,ul,ol,dl,iframe,area,base,col,hr,img,embed,input,link,meta,param\r\n         * @return { Boolean } 检查有内容返回true，否则返回false\r\n         * @example\r\n         * ```javascript\r\n         * editor.hasContents()\r\n         * ```\r\n         */ /**\r\n         * 检查编辑区域中是否有内容，若包含参数tags中的节点类型，直接返回true\r\n         * @method  hasContents\r\n         * @param { Array } tags 传入数组判断时用到的节点类型\r\n         * @return { Boolean } 若文档中包含tags数组里对应的tag，返回true，否则返回false\r\n         * @example\r\n         * ```javascript\r\n         * editor.hasContents(['span']);\r\n         * ```\r\n         */hasContents:function hasContents(tags){if(tags){for(var i=0,ci;ci = tags[i++];) {if(this.document.getElementsByTagName(ci).length > 0){return true;}}}if(!domUtils.isEmptyBlock(this.body)){return true;} //随时添加,定义的特殊标签如果存在，不能认为是空\ntags = ['div'];for(i = 0;ci = tags[i++];) {var nodes=domUtils.getElementsByTagName(this.document,ci);for(var n=0,cn;cn = nodes[n++];) {if(domUtils.isCustomeNode(cn)){return true;}}}return false;}, /**\r\n         * 重置编辑器，可用来做多个tab使用同一个编辑器实例\r\n         * @method  reset\r\n         * @remind 此方法会清空编辑器内容，清空回退列表，会触发reset事件\r\n         * @example\r\n         * ```javascript\r\n         * editor.reset()\r\n         * ```\r\n         */reset:function reset(){this.fireEvent('reset');}, /**\r\n         * 设置当前编辑区域可以编辑\r\n         * @method setEnabled\r\n         * @example\r\n         * ```javascript\r\n         * editor.setEnabled()\r\n         * ```\r\n         */setEnabled:function setEnabled(){var me=this,range;if(me.body.contentEditable == 'false'){me.body.contentEditable = true;range = me.selection.getRange(); //有可能内容丢失了\ntry{range.moveToBookmark(me.lastBk);delete me.lastBk;}catch(e) {range.setStartAtFirst(me.body).collapse(true);}range.select(true);if(me.bkqueryCommandState){me.queryCommandState = me.bkqueryCommandState;delete me.bkqueryCommandState;}if(me.bkqueryCommandValue){me.queryCommandValue = me.bkqueryCommandValue;delete me.bkqueryCommandValue;}me.fireEvent('selectionchange');}},enable:function enable(){return this.setEnabled();}, /** 设置当前编辑区域不可编辑\r\n         * @method setDisabled\r\n         */ /** 设置当前编辑区域不可编辑,except中的命令除外\r\n         * @method setDisabled\r\n         * @param { String } except 例外命令的字符串\r\n         * @remind 即使设置了disable，此处配置的例外命令仍然可以执行\r\n         * @example\r\n         * ```javascript\r\n         * editor.setDisabled('bold'); //禁用工具栏中除加粗之外的所有功能\r\n         * ```\r\n         */ /** 设置当前编辑区域不可编辑,except中的命令除外\r\n         * @method setDisabled\r\n         * @param { Array } except 例外命令的字符串数组，数组中的命令仍然可以执行\r\n         * @remind 即使设置了disable，此处配置的例外命令仍然可以执行\r\n         * @example\r\n         * ```javascript\r\n         * editor.setDisabled(['bold','insertimage']); //禁用工具栏中除加粗和插入图片之外的所有功能\r\n         * ```\r\n         */setDisabled:function setDisabled(except){var me=this;except = except?utils.isArray(except)?except:[except]:[];if(me.body.contentEditable == 'true'){if(!me.lastBk){me.lastBk = me.selection.getRange().createBookmark(true);}me.body.contentEditable = false;me.bkqueryCommandState = me.queryCommandState;me.bkqueryCommandValue = me.queryCommandValue;me.queryCommandState = function(type){if(utils.indexOf(except,type) != -1){return me.bkqueryCommandState.apply(me,arguments);}return -1;};me.queryCommandValue = function(type){if(utils.indexOf(except,type) != -1){return me.bkqueryCommandValue.apply(me,arguments);}return null;};me.fireEvent('selectionchange');}},disable:function disable(except){return this.setDisabled(except);}, /**\r\n         * 设置默认内容\r\n         * @method _setDefaultContent\r\n         * @private\r\n         * @param  { String } cont 要存入的内容\r\n         */_setDefaultContent:(function(){function clear(){var me=this;if(me.document.getElementById('initContent')){me.body.innerHTML = '<p>' + (ie?'':'<br/>') + '</p>';me.removeListener('firstBeforeExecCommand focus',clear);setTimeout(function(){me.focus();me._selectionChange();},0);}}return function(cont){var me=this;me.body.innerHTML = '<p id=\"initContent\">' + cont + '</p>';me.addListener('firstBeforeExecCommand focus',clear);};})(), /**\r\n         * 显示编辑器\r\n         * @method setShow\r\n         * @example\r\n         * ```javascript\r\n         * editor.setShow()\r\n         * ```\r\n         */setShow:function setShow(){var me=this,range=me.selection.getRange();if(me.container.style.display == 'none'){ //有可能内容丢失了\ntry{range.moveToBookmark(me.lastBk);delete me.lastBk;}catch(e) {range.setStartAtFirst(me.body).collapse(true);} //ie下focus实效，所以做了个延迟\nsetTimeout(function(){range.select(true);},100);me.container.style.display = '';}},show:function show(){return this.setShow();}, /**\r\n         * 隐藏编辑器\r\n         * @method setHide\r\n         * @example\r\n         * ```javascript\r\n         * editor.setHide()\r\n         * ```\r\n         */setHide:function setHide(){var me=this;if(!me.lastBk){me.lastBk = me.selection.getRange().createBookmark(true);}me.container.style.display = 'none';},hide:function hide(){return this.setHide();}, /**\r\n         * 根据指定的路径，获取对应的语言资源\r\n         * @method getLang\r\n         * @param { String } path 路径根据的是lang目录下的语言文件的路径结构\r\n         * @return { Object | String } 根据路径返回语言资源的Json格式对象或者语言字符串\r\n         * @example\r\n         * ```javascript\r\n         * editor.getLang('contextMenu.delete'); //如果当前是中文，那返回是的是'删除'\r\n         * ```\r\n         */getLang:function getLang(path){var lang=UE.I18N[this.options.lang];if(!lang){throw Error(\"not import language file\");}path = (path || \"\").split(\".\");for(var i=0,ci;ci = path[i++];) {lang = lang[ci];if(!lang)break;}return lang;}, /**\r\n         * 计算编辑器html内容字符串的长度\r\n         * @method  getContentLength\r\n         * @return { Number } 返回计算的长度\r\n         * @example\r\n         * ```javascript\r\n         * //编辑器html内容<p><strong>132</strong></p>\r\n         * editor.getContentLength() //返回27\r\n         * ```\r\n         */ /**\r\n         * 计算编辑器当前纯文本内容的长度\r\n         * @method  getContentLength\r\n         * @param { Boolean } ingoneHtml 传入true时，只按照纯文本来计算\r\n         * @return { Number } 返回计算的长度，内容中有hr/img/iframe标签，长度加1\r\n         * @example\r\n         * ```javascript\r\n         * //编辑器html内容<p><strong>132</strong></p>\r\n         * editor.getContentLength() //返回3\r\n         * ```\r\n         */getContentLength:function getContentLength(ingoneHtml,tagNames){var count=this.getContent(false,false,true).length;if(ingoneHtml){tagNames = (tagNames || []).concat(['hr','img','iframe']);count = this.getContentTxt().replace(/[\\t\\r\\n]+/g,'').length;for(var i=0,ci;ci = tagNames[i++];) {count += this.document.getElementsByTagName(ci).length;}}return count;}, /**\r\n         * 注册输入过滤规则\r\n         * @method  addInputRule\r\n         * @param { Function } rule 要添加的过滤规则\r\n         * @example\r\n         * ```javascript\r\n         * editor.addInputRule(function(root){\r\n         *   $.each(root.getNodesByTagName('div'),function(i,node){\r\n         *       node.tagName=\"p\";\r\n         *   });\r\n         * });\r\n         * ```\r\n         */addInputRule:function addInputRule(rule){this.inputRules.push(rule);}, /**\r\n         * 执行注册的过滤规则\r\n         * @method  filterInputRule\r\n         * @param { UE.uNode } root 要过滤的uNode节点\r\n         * @remind 执行editor.setContent方法和执行'inserthtml'命令后，会运行该过滤函数\r\n         * @example\r\n         * ```javascript\r\n         * editor.filterInputRule(editor.body);\r\n         * ```\r\n         * @see UE.Editor:addInputRule\r\n         */filterInputRule:function filterInputRule(root){for(var i=0,ci;ci = this.inputRules[i++];) {ci.call(this,root);}}, /**\r\n         * 注册输出过滤规则\r\n         * @method  addOutputRule\r\n         * @param { Function } rule 要添加的过滤规则\r\n         * @example\r\n         * ```javascript\r\n         * editor.addOutputRule(function(root){\r\n         *   $.each(root.getNodesByTagName('p'),function(i,node){\r\n         *       node.tagName=\"div\";\r\n         *   });\r\n         * });\r\n         * ```\r\n         */addOutputRule:function addOutputRule(rule){this.outputRules.push(rule);}, /**\r\n         * 根据输出过滤规则，过滤编辑器内容\r\n         * @method  filterOutputRule\r\n         * @remind 执行editor.getContent方法的时候，会先运行该过滤函数\r\n         * @param { UE.uNode } root 要过滤的uNode节点\r\n         * @example\r\n         * ```javascript\r\n         * editor.filterOutputRule(editor.body);\r\n         * ```\r\n         * @see UE.Editor:addOutputRule\r\n         */filterOutputRule:function filterOutputRule(root){for(var i=0,ci;ci = this.outputRules[i++];) {ci.call(this,root);}}, /**\r\n         * 根据action名称获取请求的路径\r\n         * @method  getActionUrl\r\n         * @remind 假如没有设置serverUrl,会根据imageUrl设置默认的controller路径\r\n         * @param { String } action action名称\r\n         * @example\r\n         * ```javascript\r\n         * editor.getActionUrl('config'); //返回 \"/ueditor/php/controller.php?action=config\"\r\n         * editor.getActionUrl('image'); //返回 \"/ueditor/php/controller.php?action=uplaodimage\"\r\n         * editor.getActionUrl('scrawl'); //返回 \"/ueditor/php/controller.php?action=uplaodscrawl\"\r\n         * editor.getActionUrl('imageManager'); //返回 \"/ueditor/php/controller.php?action=listimage\"\r\n         * ```\r\n         */getActionUrl:function getActionUrl(action){var actionName=this.getOpt(action) || action,imageUrl=this.getOpt('imageUrl'),serverUrl=this.getOpt('serverUrl');if(!serverUrl && imageUrl){serverUrl = imageUrl.replace(/^(.*[\\/]).+([\\.].+)$/,'$1controller$2');}if(serverUrl){serverUrl = serverUrl + (serverUrl.indexOf('?') == -1?'?':'&') + 'action=' + (actionName || '');return utils.formatUrl(serverUrl);}else {return '';}}};utils.inherits(Editor,EventBase);})(); // core/Editor.defaultoptions.js\n//维护编辑器一下默认的不在插件中的配置项\nUE.Editor.defaultOptions = function(editor){var _url=editor.options.UEDITOR_HOME_URL;return {isShow:true,initialContent:'',initialStyle:'',autoClearinitialContent:false,iframeCssUrl:_url + 'themes/iframe.css',textarea:'editorValue',focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:999,imagePopup:true,enterTag:'p',customDomain:false,lang:'zh-cn',langPath:_url + 'lang/',theme:'default',themePath:_url + 'themes/',allHtmlEnabled:false,scaleEnabled:false,tableNativeEditInFF:false,autoSyncData:true,fileNameFormat:'{time}{rand:6}'};}; // core/loadconfig.js\n(function(){UE.Editor.prototype.loadServerConfig = function(){var me=this;setTimeout(function(){try{me.options.imageUrl && me.setOpt('serverUrl',me.options.imageUrl.replace(/^(.*[\\/]).+([\\.].+)$/,'$1controller$2'));var configUrl=me.getActionUrl('config'),isJsonp=utils.isCrossDomainUrl(configUrl); /* 发出ajax请求 */me._serverConfigLoaded = false;configUrl && UE.ajax.request(configUrl,{'method':'GET','dataType':isJsonp?'jsonp':'','onsuccess':function onsuccess(r){try{var config=isJsonp?r:eval(\"(\" + r.responseText + \")\");utils.extend(me.options,config);me.fireEvent('serverConfigLoaded');me._serverConfigLoaded = true;}catch(e) {showErrorMsg(me.getLang('loadconfigFormatError'));}},'onerror':function onerror(){showErrorMsg(me.getLang('loadconfigHttpError'));}});}catch(e) {showErrorMsg(me.getLang('loadconfigError'));}});function showErrorMsg(msg){console && console.error(msg); //me.fireEvent('showMessage', {\n//    'title': msg,\n//    'type': 'error'\n//});\n}};UE.Editor.prototype.isServerConfigLoaded = function(){var me=this;return me._serverConfigLoaded || false;};UE.Editor.prototype.afterConfigReady = function(handler){if(!handler || !utils.isFunction(handler))return;var me=this;var readyHandler=function readyHandler(){handler.apply(me,arguments);me.removeListener('serverConfigLoaded',readyHandler);};if(me.isServerConfigLoaded()){handler.call(me,'serverConfigLoaded');}else {me.addListener('serverConfigLoaded',readyHandler);}};})(); // core/ajax.js\n/**\r\n * @file\r\n * @module UE.ajax\r\n * @since 1.2.6.1\r\n */ /**\r\n * 提供对ajax请求的支持\r\n * @module UE.ajax\r\n */UE.ajax = (function(){ //创建一个ajaxRequest对象\nvar fnStr='XMLHttpRequest()';try{new ActiveXObject(\"Msxml2.XMLHTTP\");fnStr = 'ActiveXObject(\\'Msxml2.XMLHTTP\\')';}catch(e) {try{new ActiveXObject(\"Microsoft.XMLHTTP\");fnStr = 'ActiveXObject(\\'Microsoft.XMLHTTP\\')';}catch(e) {}}var creatAjaxRequest=new Function('return new ' + fnStr); /**\r\n     * 将json参数转化成适合ajax提交的参数列表\r\n     * @param json\r\n     */function json2str(json){var strArr=[];for(var i in json) { //忽略默认的几个参数\nif(i == \"method\" || i == \"timeout\" || i == \"async\" || i == \"dataType\" || i == \"callback\")continue; //忽略控制\nif(json[i] == undefined || json[i] == null)continue; //传递过来的对象和函数不在提交之列\nif(!((typeof json[i]).toLowerCase() == \"function\" || (typeof json[i]).toLowerCase() == \"object\")){strArr.push(encodeURIComponent(i) + \"=\" + encodeURIComponent(json[i]));}else if(utils.isArray(json[i])){ //支持传数组内容\nfor(var j=0;j < json[i].length;j++) {strArr.push(encodeURIComponent(i) + \"[]=\" + encodeURIComponent(json[i][j]));}}}return strArr.join(\"&\");}function doAjax(url,ajaxOptions){var xhr=creatAjaxRequest(), //是否超时\ntimeIsOut=false, //默认参数\ndefaultAjaxOptions={method:\"POST\",timeout:5000,async:true,data:{}, //需要传递对象的话只能覆盖\nonsuccess:function onsuccess(){},onerror:function onerror(){}};if(typeof url === \"object\"){ajaxOptions = url;url = ajaxOptions.url;}if(!xhr || !url)return;var ajaxOpts=ajaxOptions?utils.extend(defaultAjaxOptions,ajaxOptions):defaultAjaxOptions;var submitStr=json2str(ajaxOpts); // { name:\"Jim\",city:\"Beijing\" } --> \"name=Jim&city=Beijing\"\n//如果用户直接通过data参数传递json对象过来，则也要将此json对象转化为字符串\nif(!utils.isEmptyObject(ajaxOpts.data)){submitStr += (submitStr?\"&\":\"\") + json2str(ajaxOpts.data);} //超时检测\nvar timerID=setTimeout(function(){if(xhr.readyState != 4){timeIsOut = true;xhr.abort();clearTimeout(timerID);}},ajaxOpts.timeout);var method=ajaxOpts.method.toUpperCase();var str=url + (url.indexOf(\"?\") == -1?\"?\":\"&\") + (method == \"POST\"?\"\":submitStr + \"&noCache=\" + +new Date());xhr.open(method,str,ajaxOpts.async);xhr.onreadystatechange = function(){if(xhr.readyState == 4){if(!timeIsOut && xhr.status == 200){ajaxOpts.onsuccess(xhr);}else {ajaxOpts.onerror(xhr);}}};if(method == \"POST\"){xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');xhr.send(submitStr);}else {xhr.send(null);}}function doJsonp(url,opts){var successhandler=opts.onsuccess || function(){},scr=document.createElement('SCRIPT'),options=opts || {},charset=options['charset'],callbackField=options['jsonp'] || 'callback',callbackFnName,timeOut=options['timeOut'] || 0,timer,reg=new RegExp('(\\\\?|&)' + callbackField + '=([^&]*)'),matches;if(utils.isFunction(successhandler)){callbackFnName = 'bd__editor__' + Math.floor(Math.random() * 2147483648).toString(36);window[callbackFnName] = getCallBack(0);}else if(utils.isString(successhandler)){callbackFnName = successhandler;}else {if(matches = reg.exec(url)){callbackFnName = matches[2];}}url = url.replace(reg,'\\x241' + callbackField + '=' + callbackFnName);if(url.search(reg) < 0){url += (url.indexOf('?') < 0?'?':'&') + callbackField + '=' + callbackFnName;}var queryStr=json2str(opts); // { name:\"Jim\",city:\"Beijing\" } --> \"name=Jim&city=Beijing\"\n//如果用户直接通过data参数传递json对象过来，则也要将此json对象转化为字符串\nif(!utils.isEmptyObject(opts.data)){queryStr += (queryStr?\"&\":\"\") + json2str(opts.data);}if(queryStr){url = url.replace(/\\?/,'?' + queryStr + '&');}scr.onerror = getCallBack(1);if(timeOut){timer = setTimeout(getCallBack(1),timeOut);}createScriptTag(scr,url,charset);function createScriptTag(scr,url,charset){scr.setAttribute('type','text/javascript');scr.setAttribute('defer','defer');charset && scr.setAttribute('charset',charset);scr.setAttribute('src',url);document.getElementsByTagName('head')[0].appendChild(scr);}function getCallBack(onTimeOut){return function(){try{if(onTimeOut){options.onerror && options.onerror();}else {try{clearTimeout(timer);successhandler.apply(window,arguments);}catch(e) {}}}catch(exception) {options.onerror && options.onerror.call(window,exception);}finally {options.oncomplete && options.oncomplete.apply(window,arguments);scr.parentNode && scr.parentNode.removeChild(scr);window[callbackFnName] = null;try{delete window[callbackFnName];}catch(e) {}}};}}return { /**\r\n         * 根据给定的参数项，向指定的url发起一个ajax请求。 ajax请求完成后，会根据请求结果调用相应回调： 如果请求\r\n         * 成功， 则调用onsuccess回调， 失败则调用 onerror 回调\r\n         * @method request\r\n         * @param { URLString } url ajax请求的url地址\r\n         * @param { Object } ajaxOptions ajax请求选项的键值对，支持的选项如下：\r\n         * @example\r\n         * ```javascript\r\n         * //向sayhello.php发起一个异步的Ajax GET请求, 请求超时时间为10s， 请求完成后执行相应的回调。\r\n         * UE.ajax.requeset( 'sayhello.php', {\r\n         *\r\n         *     //请求方法。可选值： 'GET', 'POST'，默认值是'POST'\r\n         *     method: 'GET',\r\n         *\r\n         *     //超时时间。 默认为5000， 单位是ms\r\n         *     timeout: 10000,\r\n         *\r\n         *     //是否是异步请求。 true为异步请求， false为同步请求\r\n         *     async: true,\r\n         *\r\n         *     //请求携带的数据。如果请求为GET请求， data会经过stringify后附加到请求url之后。\r\n         *     data: {\r\n         *         name: 'ueditor'\r\n         *     },\r\n         *\r\n         *     //请求成功后的回调， 该回调接受当前的XMLHttpRequest对象作为参数。\r\n         *     onsuccess: function ( xhr ) {\r\n         *         console.log( xhr.responseText );\r\n         *     },\r\n         *\r\n         *     //请求失败或者超时后的回调。\r\n         *     onerror: function ( xhr ) {\r\n         *          alert( 'Ajax请求失败' );\r\n         *     }\r\n         *\r\n         * } );\r\n         * ```\r\n         */ /**\r\n         * 根据给定的参数项发起一个ajax请求， 参数项里必须包含一个url地址。 ajax请求完成后，会根据请求结果调用相应回调： 如果请求\r\n         * 成功， 则调用onsuccess回调， 失败则调用 onerror 回调。\r\n         * @method request\r\n         * @warning 如果在参数项里未提供一个key为“url”的地址值，则该请求将直接退出。\r\n         * @param { Object } ajaxOptions ajax请求选项的键值对，支持的选项如下：\r\n         * @example\r\n         * ```javascript\r\n         *\r\n         * //向sayhello.php发起一个异步的Ajax POST请求, 请求超时时间为5s， 请求完成后不执行任何回调。\r\n         * UE.ajax.requeset( 'sayhello.php', {\r\n         *\r\n         *     //请求的地址， 该项是必须的。\r\n         *     url: 'sayhello.php'\r\n         *\r\n         * } );\r\n         * ```\r\n         */request:function request(url,opts){if(opts && opts.dataType == 'jsonp'){doJsonp(url,opts);}else {doAjax(url,opts);}},getJSONP:function getJSONP(url,data,fn){var opts={'data':data,'oncomplete':fn};doJsonp(url,opts);}};})(); // core/filterword.js\n/**\r\n * UE过滤word的静态方法\r\n * @file\r\n */ /**\r\n * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n * @module UE\r\n */ /**\r\n * 根据传入html字符串过滤word\r\n * @module UE\r\n * @since 1.2.6.1\r\n * @method filterWord\r\n * @param { String } html html字符串\r\n * @return { String } 已过滤后的结果字符串\r\n * @example\r\n * ```javascript\r\n * UE.filterWord(html);\r\n * ```\r\n */var filterWord=UE.filterWord = (function(){ //是否是word过来的内容\nfunction isWordDocument(str){return (/(class=\"?Mso|style=\"[^\"]*\\bmso\\-|w:WordDocument|<(v|o):|lang=)/ig.test(str));} //去掉小数\nfunction transUnit(v){v = v.replace(/[\\d.]+\\w+/g,function(m){return utils.transUnitToPx(m);});return v;}function filterPasteWord(str){return str.replace(/[\\t\\r\\n]+/g,' ').replace(/<!--[\\s\\S]*?-->/ig,\"\") //转换图片\n.replace(/<v:shape [^>]*>[\\s\\S]*?.<\\/v:shape>/gi,function(str){ //opera能自己解析出image所这里直接返回空\nif(browser.opera){return '';}try{ //有可能是bitmap占为图，无用，直接过滤掉，主要体现在粘贴excel表格中\nif(/Bitmap/i.test(str)){return '';}var width=str.match(/width:([ \\d.]*p[tx])/i)[1],height=str.match(/height:([ \\d.]*p[tx])/i)[1],src=str.match(/src=\\s*\"([^\"]*)\"/i)[1];return '<img width=\"' + transUnit(width) + '\" height=\"' + transUnit(height) + '\" src=\"' + src + '\" />';}catch(e) {return '';}}) //针对wps添加的多余标签处理\n.replace(/<\\/?div[^>]*>/g,'') //去掉多余的属性\n.replace(/v:\\w+=([\"']?)[^'\"]+\\1/g,'').replace(/<(!|script[^>]*>.*?<\\/script(?=[>\\s])|\\/?(\\?xml(:\\w+)?|xml|meta|link|style|\\w+:\\w+)(?=[\\s\\/>]))[^>]*>/gi,\"\").replace(/<p [^>]*class=\"?MsoHeading\"?[^>]*>(.*?)<\\/p>/gi,\"<p><strong>$1</strong></p>\") //去掉多余的属性\n.replace(/\\s+(class|lang|align)\\s*=\\s*(['\"]?)([\\w-]+)\\2/ig,function(str,name,marks,val){ //保留list的标示\nreturn name == 'class' && val == 'MsoListParagraph'?str:'';}) //清除多余的font/span不能匹配&nbsp;有可能是空格\n.replace(/<(font|span)[^>]*>(\\s*)<\\/\\1>/gi,function(a,b,c){return c.replace(/[\\t\\r\\n ]+/g,' ');}) //处理style的问题\n.replace(/(<[a-z][^>]*)\\sstyle=([\"'])([^\\2]*?)\\2/gi,function(str,tag,tmp,style){var n=[],s=style.replace(/^\\s+|\\s+$/,'').replace(/&#39;/g,'\\'').replace(/&quot;/gi,\"'\").replace(/[\\d.]+(cm|pt)/g,function(str){return utils.transUnitToPx(str);}).split(/;\\s*/g);for(var i=0,v;v = s[i];i++) {var name,value,parts=v.split(\":\");if(parts.length == 2){name = parts[0].toLowerCase();value = parts[1].toLowerCase();if(/^(background)\\w*/.test(name) && value.replace(/(initial|\\s)/g,'').length == 0 || /^(margin)\\w*/.test(name) && /^0\\w+$/.test(value)){continue;}switch(name){case \"mso-padding-alt\":case \"mso-padding-top-alt\":case \"mso-padding-right-alt\":case \"mso-padding-bottom-alt\":case \"mso-padding-left-alt\":case \"mso-margin-alt\":case \"mso-margin-top-alt\":case \"mso-margin-right-alt\":case \"mso-margin-bottom-alt\":case \"mso-margin-left-alt\": //ie下会出现挤到一起的情况\n//case \"mso-table-layout-alt\":\ncase \"mso-height\":case \"mso-width\":case \"mso-vertical-align-alt\": //trace:1819 ff下会解析出padding在table上\nif(!/<table/.test(tag))n[i] = name.replace(/^mso-|-alt$/g,\"\") + \":\" + transUnit(value);continue;case \"horiz-align\":n[i] = \"text-align:\" + value;continue;case \"vert-align\":n[i] = \"vertical-align:\" + value;continue;case \"font-color\":case \"mso-foreground\":n[i] = \"color:\" + value;continue;case \"mso-background\":case \"mso-highlight\":n[i] = \"background:\" + value;continue;case \"mso-default-height\":n[i] = \"min-height:\" + transUnit(value);continue;case \"mso-default-width\":n[i] = \"min-width:\" + transUnit(value);continue;case \"mso-padding-between-alt\":n[i] = \"border-collapse:separate;border-spacing:\" + transUnit(value);continue;case \"text-line-through\":if(value == \"single\" || value == \"double\"){n[i] = \"text-decoration:line-through\";}continue;case \"mso-zero-height\":if(value == \"yes\"){n[i] = \"display:none\";}continue; //                                case 'background':\n//                                    break;\ncase 'margin':if(!/[1-9]/.test(value)){continue;}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(name) || /text\\-indent|padding|margin/.test(name) && /\\-[\\d.]+/.test(value)){continue;}n[i] = name + \":\" + parts[1];}}return tag + (n.length?' style=\"' + n.join(';').replace(/;{2,}/g,';') + '\"':'');});}return function(html){return isWordDocument(html)?filterPasteWord(html):html;};})(); // core/node.js\n/**\r\n * 编辑器模拟的节点类\r\n * @file\r\n * @module UE\r\n * @class uNode\r\n * @since 1.2.6.1\r\n */ /**\r\n * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n * @unfile\r\n * @module UE\r\n */(function(){ /**\r\n     * 编辑器模拟的节点类\r\n     * @unfile\r\n     * @module UE\r\n     * @class uNode\r\n     */ /**\r\n     * 通过一个键值对，创建一个uNode对象\r\n     * @constructor\r\n     * @param { Object } attr 传入要创建的uNode的初始属性\r\n     * @example\r\n     * ```javascript\r\n     * var node = new uNode({\r\n     *     type:'element',\r\n     *     tagName:'span',\r\n     *     attrs:{style:'font-size:14px;'}\r\n     * }\r\n     * ```\r\n     */var uNode=UE.uNode = function(obj){this.type = obj.type;this.data = obj.data;this.tagName = obj.tagName;this.parentNode = obj.parentNode;this.attrs = obj.attrs || {};this.children = obj.children;};var notTransAttrs={'href':1,'src':1,'_src':1,'_href':1,'cdata_data':1};var notTransTagName={style:1,script:1};var indentChar='    ',breakChar='\\n';function insertLine(arr,current,begin){arr.push(breakChar);return current + (begin?1:-1);}function insertIndent(arr,current){ //插入缩进\nfor(var i=0;i < current;i++) {arr.push(indentChar);}} //创建uNode的静态方法\n//支持标签和html\nuNode.createElement = function(html){if(/[<>]/.test(html)){return UE.htmlparser(html).children[0];}else {return new uNode({type:'element',children:[],tagName:html});}};uNode.createText = function(data,noTrans){return new UE.uNode({type:'text','data':noTrans?data:utils.unhtml(data || '')});};function nodeToHtml(node,arr,formatter,current){switch(node.type){case 'root':for(var i=0,ci;ci = node.children[i++];) { //插入新行\nif(formatter && ci.type == 'element' && !dtd.$inlineWithA[ci.tagName] && i > 1){insertLine(arr,current,true);insertIndent(arr,current);}nodeToHtml(ci,arr,formatter,current);}break;case 'text':isText(node,arr);break;case 'element':isElement(node,arr,formatter,current);break;case 'comment':isComment(node,arr,formatter);}return arr;}function isText(node,arr){if(node.parentNode.tagName == 'pre'){ //源码模式下输入html标签，不能做转换处理，直接输出\narr.push(node.data);}else {arr.push(notTransTagName[node.parentNode.tagName]?utils.html(node.data):node.data.replace(/[ ]{2}/g,' &nbsp;'));}}function isElement(node,arr,formatter,current){var attrhtml='';if(node.attrs){attrhtml = [];var attrs=node.attrs;for(var a in attrs) { //这里就针对\n//<p>'<img src='http://nsclick.baidu.com/u.gif?&asdf=\\\"sdf&asdfasdfs;asdf'></p>\n//这里边的\\\"做转换，要不用innerHTML直接被截断了，属性src\n//有可能做的不够\nattrhtml.push(a + (attrs[a] !== undefined?'=\"' + (notTransAttrs[a]?utils.html(attrs[a]).replace(/[\"]/g,function(a){return '&quot;';}):utils.unhtml(attrs[a])) + '\"':''));}attrhtml = attrhtml.join(' ');}arr.push('<' + node.tagName + (attrhtml?' ' + attrhtml:'') + (dtd.$empty[node.tagName]?'\\/':'') + '>'); //插入新行\nif(formatter && !dtd.$inlineWithA[node.tagName] && node.tagName != 'pre'){if(node.children && node.children.length){current = insertLine(arr,current,true);insertIndent(arr,current);}}if(node.children && node.children.length){for(var i=0,ci;ci = node.children[i++];) {if(formatter && ci.type == 'element' && !dtd.$inlineWithA[ci.tagName] && i > 1){insertLine(arr,current);insertIndent(arr,current);}nodeToHtml(ci,arr,formatter,current);}}if(!dtd.$empty[node.tagName]){if(formatter && !dtd.$inlineWithA[node.tagName] && node.tagName != 'pre'){if(node.children && node.children.length){current = insertLine(arr,current);insertIndent(arr,current);}}arr.push('<\\/' + node.tagName + '>');}}function isComment(node,arr){arr.push('<!--' + node.data + '-->');}function _getNodeById(root,id){var node;if(root.type == 'element' && root.getAttr('id') == id){return root;}if(root.children && root.children.length){for(var i=0,ci;ci = root.children[i++];) {if(node = _getNodeById(ci,id)){return node;}}}}function _getNodesByTagName(node,tagName,arr){if(node.type == 'element' && node.tagName == tagName){arr.push(node);}if(node.children && node.children.length){for(var i=0,ci;ci = node.children[i++];) {_getNodesByTagName(ci,tagName,arr);}}}function nodeTraversal(root,fn){if(root.children && root.children.length){for(var i=0,ci;ci = root.children[i];) {nodeTraversal(ci,fn); //ci被替换的情况，这里就不再走 fn了\nif(ci.parentNode){if(ci.children && ci.children.length){fn(ci);}if(ci.parentNode)i++;}}}else {fn(root);}}uNode.prototype = { /**\r\n         * 当前节点对象，转换成html文本\r\n         * @method toHtml\r\n         * @return { String } 返回转换后的html字符串\r\n         * @example\r\n         * ```javascript\r\n         * node.toHtml();\r\n         * ```\r\n         */ /**\r\n         * 当前节点对象，转换成html文本\r\n         * @method toHtml\r\n         * @param { Boolean } formatter 是否格式化返回值\r\n         * @return { String } 返回转换后的html字符串\r\n         * @example\r\n         * ```javascript\r\n         * node.toHtml( true );\r\n         * ```\r\n         */toHtml:function toHtml(formatter){var arr=[];nodeToHtml(this,arr,formatter,0);return arr.join('');}, /**\r\n         * 获取节点的html内容\r\n         * @method innerHTML\r\n         * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n         * @return { String } 返回节点的html内容\r\n         * @example\r\n         * ```javascript\r\n         * var htmlstr = node.innerHTML();\r\n         * ```\r\n         */ /**\r\n         * 设置节点的html内容\r\n         * @method innerHTML\r\n         * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n         * @param { String } htmlstr 传入要设置的html内容\r\n         * @return { UE.uNode } 返回节点本身\r\n         * @example\r\n         * ```javascript\r\n         * node.innerHTML('<span>text</span>');\r\n         * ```\r\n         */innerHTML:function innerHTML(htmlstr){if(this.type != 'element' || dtd.$empty[this.tagName]){return this;}if(utils.isString(htmlstr)){if(this.children){for(var i=0,ci;ci = this.children[i++];) {ci.parentNode = null;}}this.children = [];var tmpRoot=UE.htmlparser(htmlstr);for(var i=0,ci;ci = tmpRoot.children[i++];) {this.children.push(ci);ci.parentNode = this;}return this;}else {var tmpRoot=new UE.uNode({type:'root',children:this.children});return tmpRoot.toHtml();}}, /**\r\n         * 获取节点的纯文本内容\r\n         * @method innerText\r\n         * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n         * @return { String } 返回节点的存文本内容\r\n         * @example\r\n         * ```javascript\r\n         * var textStr = node.innerText();\r\n         * ```\r\n         */ /**\r\n         * 设置节点的纯文本内容\r\n         * @method innerText\r\n         * @warning 假如节点的type不是'element'，或节点的标签名称不在dtd列表里，直接返回当前节点\r\n         * @param { String } textStr 传入要设置的文本内容\r\n         * @return { UE.uNode } 返回节点本身\r\n         * @example\r\n         * ```javascript\r\n         * node.innerText('<span>text</span>');\r\n         * ```\r\n         */innerText:function innerText(textStr,noTrans){if(this.type != 'element' || dtd.$empty[this.tagName]){return this;}if(textStr){if(this.children){for(var i=0,ci;ci = this.children[i++];) {ci.parentNode = null;}}this.children = [];this.appendChild(uNode.createText(textStr,noTrans));return this;}else {return this.toHtml().replace(/<[^>]+>/g,'');}}, /**\r\n         * 获取当前对象的data属性\r\n         * @method getData\r\n         * @return { Object } 若节点的type值是elemenet，返回空字符串，否则返回节点的data属性\r\n         * @example\r\n         * ```javascript\r\n         * node.getData();\r\n         * ```\r\n         */getData:function getData(){if(this.type == 'element')return '';return this.data;}, /**\r\n         * 获取当前节点下的第一个子节点\r\n         * @method firstChild\r\n         * @return { UE.uNode } 返回第一个子节点\r\n         * @example\r\n         * ```javascript\r\n         * node.firstChild(); //返回第一个子节点\r\n         * ```\r\n         */firstChild:function firstChild(){ //            if (this.type != 'element' || dtd.$empty[this.tagName]) {\n//                return this;\n//            }\nreturn this.children?this.children[0]:null;}, /**\r\n         * 获取当前节点下的最后一个子节点\r\n         * @method lastChild\r\n         * @return { UE.uNode } 返回最后一个子节点\r\n         * @example\r\n         * ```javascript\r\n         * node.lastChild(); //返回最后一个子节点\r\n         * ```\r\n         */lastChild:function lastChild(){ //            if (this.type != 'element' || dtd.$empty[this.tagName] ) {\n//                return this;\n//            }\nreturn this.children?this.children[this.children.length - 1]:null;}, /**\r\n         * 获取和当前节点有相同父亲节点的前一个节点\r\n         * @method previousSibling\r\n         * @return { UE.uNode } 返回前一个节点\r\n         * @example\r\n         * ```javascript\r\n         * node.children[2].previousSibling(); //返回子节点node.children[1]\r\n         * ```\r\n         */previousSibling:function previousSibling(){var parent=this.parentNode;for(var i=0,ci;ci = parent.children[i];i++) {if(ci === this){return i == 0?null:parent.children[i - 1];}}}, /**\r\n         * 获取和当前节点有相同父亲节点的后一个节点\r\n         * @method nextSibling\r\n         * @return { UE.uNode } 返回后一个节点,找不到返回null\r\n         * @example\r\n         * ```javascript\r\n         * node.children[2].nextSibling(); //如果有，返回子节点node.children[3]\r\n         * ```\r\n         */nextSibling:function nextSibling(){var parent=this.parentNode;for(var i=0,ci;ci = parent.children[i++];) {if(ci === this){return parent.children[i];}}}, /**\r\n         * 用新的节点替换当前节点\r\n         * @method replaceChild\r\n         * @param { UE.uNode } target 要替换成该节点参数\r\n         * @param { UE.uNode } source 要被替换掉的节点\r\n         * @return { UE.uNode } 返回替换之后的节点对象\r\n         * @example\r\n         * ```javascript\r\n         * node.replaceChild(newNode, childNode); //用newNode替换childNode,childNode是node的子节点\r\n         * ```\r\n         */replaceChild:function replaceChild(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci = this.children[i];i++) {if(ci === source){this.children.splice(i,1,target);source.parentNode = null;target.parentNode = this;return target;}}}}, /**\r\n         * 在节点的子节点列表最后位置插入一个节点\r\n         * @method appendChild\r\n         * @param { UE.uNode } node 要插入的节点\r\n         * @return { UE.uNode } 返回刚插入的子节点\r\n         * @example\r\n         * ```javascript\r\n         * node.appendChild( newNode ); //在node内插入子节点newNode\r\n         * ```\r\n         */appendChild:function appendChild(node){if(this.type == 'root' || this.type == 'element' && !dtd.$empty[this.tagName]){if(!this.children){this.children = [];}if(node.parentNode){node.parentNode.removeChild(node);}for(var i=0,ci;ci = this.children[i];i++) {if(ci === node){this.children.splice(i,1);break;}}this.children.push(node);node.parentNode = this;return node;}}, /**\r\n         * 在传入节点的前面插入一个节点\r\n         * @method insertBefore\r\n         * @param { UE.uNode } target 要插入的节点\r\n         * @param { UE.uNode } source 在该参数节点前面插入\r\n         * @return { UE.uNode } 返回刚插入的子节点\r\n         * @example\r\n         * ```javascript\r\n         * node.parentNode.insertBefore(newNode, node); //在node节点后面插入newNode\r\n         * ```\r\n         */insertBefore:function insertBefore(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci = this.children[i];i++) {if(ci === source){this.children.splice(i,0,target);target.parentNode = this;return target;}}}}, /**\r\n         * 在传入节点的后面插入一个节点\r\n         * @method insertAfter\r\n         * @param { UE.uNode } target 要插入的节点\r\n         * @param { UE.uNode } source 在该参数节点后面插入\r\n         * @return { UE.uNode } 返回刚插入的子节点\r\n         * @example\r\n         * ```javascript\r\n         * node.parentNode.insertAfter(newNode, node); //在node节点后面插入newNode\r\n         * ```\r\n         */insertAfter:function insertAfter(target,source){if(this.children){if(target.parentNode){target.parentNode.removeChild(target);}for(var i=0,ci;ci = this.children[i];i++) {if(ci === source){this.children.splice(i + 1,0,target);target.parentNode = this;return target;}}}}, /**\r\n         * 从当前节点的子节点列表中，移除节点\r\n         * @method removeChild\r\n         * @param { UE.uNode } node 要移除的节点引用\r\n         * @param { Boolean } keepChildren 是否保留移除节点的子节点，若传入true，自动把移除节点的子节点插入到移除的位置\r\n         * @return { * } 返回刚移除的子节点\r\n         * @example\r\n         * ```javascript\r\n         * node.removeChild(childNode,true); //在node的子节点列表中移除child节点，并且吧child的子节点插入到移除的位置\r\n         * ```\r\n         */removeChild:function removeChild(node,keepChildren){if(this.children){for(var i=0,ci;ci = this.children[i];i++) {if(ci === node){this.children.splice(i,1);ci.parentNode = null;if(keepChildren && ci.children && ci.children.length){for(var j=0,cj;cj = ci.children[j];j++) {this.children.splice(i + j,0,cj);cj.parentNode = this;}}return ci;}}}}, /**\r\n         * 获取当前节点所代表的元素属性，即获取attrs对象下的属性值\r\n         * @method getAttr\r\n         * @param { String } attrName 要获取的属性名称\r\n         * @return { * } 返回attrs对象下的属性值\r\n         * @example\r\n         * ```javascript\r\n         * node.getAttr('title');\r\n         * ```\r\n         */getAttr:function getAttr(attrName){return this.attrs && this.attrs[attrName.toLowerCase()];}, /**\r\n         * 设置当前节点所代表的元素属性，即设置attrs对象下的属性值\r\n         * @method setAttr\r\n         * @param { String } attrName 要设置的属性名称\r\n         * @param { * } attrVal 要设置的属性值，类型视设置的属性而定\r\n         * @return { * } 返回attrs对象下的属性值\r\n         * @example\r\n         * ```javascript\r\n         * node.setAttr('title','标题');\r\n         * ```\r\n         */setAttr:function setAttr(attrName,attrVal){if(!attrName){delete this.attrs;return;}if(!this.attrs){this.attrs = {};}if(utils.isObject(attrName)){for(var a in attrName) {if(!attrName[a]){delete this.attrs[a];}else {this.attrs[a.toLowerCase()] = attrName[a];}}}else {if(!attrVal){delete this.attrs[attrName];}else {this.attrs[attrName.toLowerCase()] = attrVal;}}}, /**\r\n         * 获取当前节点在父节点下的位置索引\r\n         * @method getIndex\r\n         * @return { Number } 返回索引数值，如果没有父节点，返回-1\r\n         * @example\r\n         * ```javascript\r\n         * node.getIndex();\r\n         * ```\r\n         */getIndex:function getIndex(){var parent=this.parentNode;for(var i=0,ci;ci = parent.children[i];i++) {if(ci === this){return i;}}return -1;}, /**\r\n         * 在当前节点下，根据id查找节点\r\n         * @method getNodeById\r\n         * @param { String } id 要查找的id\r\n         * @return { UE.uNode } 返回找到的节点\r\n         * @example\r\n         * ```javascript\r\n         * node.getNodeById('textId');\r\n         * ```\r\n         */getNodeById:function getNodeById(id){var node;if(this.children && this.children.length){for(var i=0,ci;ci = this.children[i++];) {if(node = _getNodeById(ci,id)){return node;}}}}, /**\r\n         * 在当前节点下，根据元素名称查找节点列表\r\n         * @method getNodesByTagName\r\n         * @param { String } tagNames 要查找的元素名称\r\n         * @return { Array } 返回找到的节点列表\r\n         * @example\r\n         * ```javascript\r\n         * node.getNodesByTagName('span');\r\n         * ```\r\n         */getNodesByTagName:function getNodesByTagName(tagNames){tagNames = utils.trim(tagNames).replace(/[ ]{2,}/g,' ').split(' ');var arr=[],me=this;utils.each(tagNames,function(tagName){if(me.children && me.children.length){for(var i=0,ci;ci = me.children[i++];) {_getNodesByTagName(ci,tagName,arr);}}});return arr;}, /**\r\n         * 根据样式名称，获取节点的样式值\r\n         * @method getStyle\r\n         * @param { String } name 要获取的样式名称\r\n         * @return { String } 返回样式值\r\n         * @example\r\n         * ```javascript\r\n         * node.getStyle('font-size');\r\n         * ```\r\n         */getStyle:function getStyle(name){var cssStyle=this.getAttr('style');if(!cssStyle){return '';}var reg=new RegExp('(^|;)\\\\s*' + name + ':([^;]+)','i');var match=cssStyle.match(reg);if(match && match[0]){return match[2];}return '';}, /**\r\n         * 给节点设置样式\r\n         * @method setStyle\r\n         * @param { String } name 要设置的的样式名称\r\n         * @param { String } val 要设置的的样值\r\n         * @example\r\n         * ```javascript\r\n         * node.setStyle('font-size', '12px');\r\n         * ```\r\n         */setStyle:function setStyle(name,val){function exec(name,val){var reg=new RegExp('(^|;)\\\\s*' + name + ':([^;]+;?)','gi');cssStyle = cssStyle.replace(reg,'$1');if(val){cssStyle = name + ':' + utils.unhtml(val) + ';' + cssStyle;}}var cssStyle=this.getAttr('style');if(!cssStyle){cssStyle = '';}if(utils.isObject(name)){for(var a in name) {exec(a,name[a]);}}else {exec(name,val);}this.setAttr('style',utils.trim(cssStyle));}, /**\r\n         * 传入一个函数，递归遍历当前节点下的所有节点\r\n         * @method traversal\r\n         * @param { Function } fn 遍历到节点的时，传入节点作为参数，运行此函数\r\n         * @example\r\n         * ```javascript\r\n         * traversal(node, function(){\r\n         *     console.log(node.type);\r\n         * });\r\n         * ```\r\n         */traversal:function traversal(fn){if(this.children && this.children.length){nodeTraversal(this,fn);}return this;}};})(); // core/htmlparser.js\n/**\r\n * html字符串转换成uNode节点\r\n * @file\r\n * @module UE\r\n * @since 1.2.6.1\r\n */ /**\r\n * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n * @unfile\r\n * @module UE\r\n */ /**\r\n * html字符串转换成uNode节点的静态方法\r\n * @method htmlparser\r\n * @param { String } htmlstr 要转换的html代码\r\n * @param { Boolean } ignoreBlank 若设置为true，转换的时候忽略\\n\\r\\t等空白字符\r\n * @return { uNode } 给定的html片段转换形成的uNode对象\r\n * @example\r\n * ```javascript\r\n * var root = UE.htmlparser('<p><b>htmlparser</b></p>', true);\r\n * ```\r\n */var htmlparser=UE.htmlparser = function(htmlstr,ignoreBlank){ //todo 原来的方式  [^\"'<>\\/] 有\\/就不能配对上 <TD vAlign=top background=../AAA.JPG> 这样的标签了\n//先去掉了，加上的原因忘了，这里先记录\nvar re_tag=/<(?:(?:\\/([^>]+)>)|(?:!--([\\S|\\s]*?)-->)|(?:([^\\s\\/<>]+)\\s*((?:(?:\"[^\"]*\")|(?:'[^']*')|[^\"'<>])*)\\/?>))/g,re_attr=/([\\w\\-:.]+)(?:(?:\\s*=\\s*(?:(?:\"([^\"]*)\")|(?:'([^']*)')|([^\\s>]+)))|(?=\\s|$))/g; //ie下取得的html可能会有\\n存在，要去掉，在处理replace(/[\\t\\r\\n]*/g,'');代码高量的\\n不能去除\nvar allowEmptyTags={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};htmlstr = htmlstr.replace(new RegExp(domUtils.fillChar,'g'),'');if(!ignoreBlank){htmlstr = htmlstr.replace(new RegExp('[\\\\r\\\\t\\\\n' + (ignoreBlank?'':' ') + ']*<\\/?(\\\\w+)\\\\s*(?:[^>]*)>[\\\\r\\\\t\\\\n' + (ignoreBlank?'':' ') + ']*','g'),function(a,b){ //br暂时单独处理\nif(b && allowEmptyTags[b.toLowerCase()]){return a.replace(/(^[\\n\\r]+)|([\\n\\r]+$)/g,'');}return a.replace(new RegExp('^[\\\\r\\\\n' + (ignoreBlank?'':' ') + ']+'),'').replace(new RegExp('[\\\\r\\\\n' + (ignoreBlank?'':' ') + ']+$'),'');});}var notTransAttrs={'href':1,'src':1};var uNode=UE.uNode,needParentNode={'td':'tr','tr':['tbody','thead','tfoot'],'tbody':'table','th':'tr','thead':'table','tfoot':'table','caption':'table','li':['ul','ol'],'dt':'dl','dd':'dl','option':'select'},needChild={'ol':'li','ul':'li'};function text(parent,data){if(needChild[parent.tagName]){var tmpNode=uNode.createElement(needChild[parent.tagName]);parent.appendChild(tmpNode);tmpNode.appendChild(uNode.createText(data));parent = tmpNode;}else {parent.appendChild(uNode.createText(data));}}function element(parent,tagName,htmlattr){var needParentTag;if(needParentTag = needParentNode[tagName]){var tmpParent=parent,hasParent;while(tmpParent.type != 'root') {if(utils.isArray(needParentTag)?utils.indexOf(needParentTag,tmpParent.tagName) != -1:needParentTag == tmpParent.tagName){parent = tmpParent;hasParent = true;break;}tmpParent = tmpParent.parentNode;}if(!hasParent){parent = element(parent,utils.isArray(needParentTag)?needParentTag[0]:needParentTag);}} //按dtd处理嵌套\n//        if(parent.type != 'root' && !dtd[parent.tagName][tagName])\n//            parent = parent.parentNode;\nvar elm=new uNode({parentNode:parent,type:'element',tagName:tagName.toLowerCase(), //是自闭合的处理一下\nchildren:dtd.$empty[tagName]?null:[]}); //如果属性存在，处理属性\nif(htmlattr){var attrs={},match;while(match = re_attr.exec(htmlattr)) {attrs[match[1].toLowerCase()] = notTransAttrs[match[1].toLowerCase()]?match[2] || match[3] || match[4]:utils.unhtml(match[2] || match[3] || match[4]);}elm.attrs = attrs;} //trace:3970\n//        //如果parent下不能放elm\n//        if(dtd.$inline[parent.tagName] && dtd.$block[elm.tagName] && !dtd[parent.tagName][elm.tagName]){\n//            parent = parent.parentNode;\n//            elm.parentNode = parent;\n//        }\nparent.children.push(elm); //如果是自闭合节点返回父亲节点\nreturn dtd.$empty[tagName]?parent:elm;}function comment(parent,data){parent.children.push(new uNode({type:'comment',data:data,parentNode:parent}));}var match,currentIndex=0,nextIndex=0; //设置根节点\nvar root=new uNode({type:'root',children:[]});var currentParent=root;while(match = re_tag.exec(htmlstr)) {currentIndex = match.index;try{if(currentIndex > nextIndex){ //text node\ntext(currentParent,htmlstr.slice(nextIndex,currentIndex));}if(match[3]){if(dtd.$cdata[currentParent.tagName]){text(currentParent,match[0]);}else { //start tag\ncurrentParent = element(currentParent,match[3].toLowerCase(),match[4]);}}else if(match[1]){if(currentParent.type != 'root'){if(dtd.$cdata[currentParent.tagName] && !dtd.$cdata[match[1]]){text(currentParent,match[0]);}else {var tmpParent=currentParent;while(currentParent.type == 'element' && currentParent.tagName != match[1].toLowerCase()) {currentParent = currentParent.parentNode;if(currentParent.type == 'root'){currentParent = tmpParent;throw 'break';}} //end tag\ncurrentParent = currentParent.parentNode;}}}else if(match[2]){ //comment\ncomment(currentParent,match[2]);}}catch(e) {}nextIndex = re_tag.lastIndex;} //如果结束是文本，就有可能丢掉，所以这里手动判断一下\n//例如 <li>sdfsdfsdf<li>sdfsdfsdfsdf\nif(nextIndex < htmlstr.length){text(currentParent,htmlstr.slice(nextIndex));}return root;}; // core/filternode.js\n/**\r\n * UE过滤节点的静态方法\r\n * @file\r\n */ /**\r\n * UEditor公用空间，UEditor所有的功能都挂载在该空间下\r\n * @module UE\r\n */ /**\r\n * 根据传入节点和过滤规则过滤相应节点\r\n * @module UE\r\n * @since 1.2.6.1\r\n * @method filterNode\r\n * @param { Object } root 指定root节点\r\n * @param { Object } rules 过滤规则json对象\r\n * @example\r\n * ```javascript\r\n * UE.filterNode(root,editor.options.filterRules);\r\n * ```\r\n */var filterNode=UE.filterNode = (function(){function filterNode(node,rules){switch(node.type){case 'text':break;case 'element':var val;if(val = rules[node.tagName]){if(val === '-'){node.parentNode.removeChild(node);}else if(utils.isFunction(val)){var parentNode=node.parentNode,index=node.getIndex();val(node);if(node.parentNode){if(node.children){for(var i=0,ci;ci = node.children[i];) {filterNode(ci,rules);if(ci.parentNode){i++;}}}}else {for(var i=index,ci;ci = parentNode.children[i];) {filterNode(ci,rules);if(ci.parentNode){i++;}}}}else {var attrs=val['$'];if(attrs && node.attrs){var tmpAttrs={},tmpVal;for(var a in attrs) {tmpVal = node.getAttr(a); //todo 只先对style单独处理\nif(a == 'style' && utils.isArray(attrs[a])){var tmpCssStyle=[];utils.each(attrs[a],function(v){var tmp;if(tmp = node.getStyle(v)){tmpCssStyle.push(v + ':' + tmp);}});tmpVal = tmpCssStyle.join(';');}if(tmpVal){tmpAttrs[a] = tmpVal;}}node.attrs = tmpAttrs;}if(node.children){for(var i=0,ci;ci = node.children[i];) {filterNode(ci,rules);if(ci.parentNode){i++;}}}}}else { //如果不在名单里扣出子节点并删除该节点,cdata除外\nif(dtd.$cdata[node.tagName]){node.parentNode.removeChild(node);}else {var parentNode=node.parentNode,index=node.getIndex();node.parentNode.removeChild(node,true);for(var i=index,ci;ci = parentNode.children[i];) {filterNode(ci,rules);if(ci.parentNode){i++;}}}}break;case 'comment':node.parentNode.removeChild(node);}}return function(root,rules){if(utils.isEmptyObject(rules)){return root;}var val;if(val = rules['-']){utils.each(val.split(' '),function(k){rules[k] = '-';});}for(var i=0,ci;ci = root.children[i];) {filterNode(ci,rules);if(ci.parentNode){i++;}}return root;};})(); // core/plugin.js\n/**\r\n * Created with JetBrains PhpStorm.\r\n * User: campaign\r\n * Date: 10/8/13\r\n * Time: 6:15 PM\r\n * To change this template use File | Settings | File Templates.\r\n */UE.plugin = (function(){var _plugins={};return {register:function register(pluginName,fn,oldOptionName,afterDisabled){if(oldOptionName && utils.isFunction(oldOptionName)){afterDisabled = oldOptionName;oldOptionName = null;}_plugins[pluginName] = {optionName:oldOptionName || pluginName,execFn:fn, //当插件被禁用时执行\nafterDisabled:afterDisabled};},load:function load(editor){utils.each(_plugins,function(plugin){var _export=plugin.execFn.call(editor);if(editor.options[plugin.optionName] !== false){if(_export){ //后边需要再做扩展\nutils.each(_export,function(v,k){switch(k.toLowerCase()){case 'shortcutkey':editor.addshortcutkey(v);break;case 'bindevents':utils.each(v,function(fn,eventName){editor.addListener(eventName,fn);});break;case 'bindmultievents':utils.each(utils.isArray(v)?v:[v],function(event){var types=utils.trim(event.type).split(/\\s+/);utils.each(types,function(eventName){editor.addListener(eventName,event.handler);});});break;case 'commands':utils.each(v,function(execFn,execName){editor.commands[execName] = execFn;});break;case 'outputrule':editor.addOutputRule(v);break;case 'inputrule':editor.addInputRule(v);break;case 'defaultoptions':editor.setOpt(v);}});}}else if(plugin.afterDisabled){plugin.afterDisabled.call(editor);}}); //向下兼容\nutils.each(UE.plugins,function(plugin){plugin.call(editor);});},run:function run(pluginName,editor){var plugin=_plugins[pluginName];if(plugin){plugin.exeFn.call(editor);}}};})(); // core/keymap.js\nvar keymap=UE.keymap = {'Backspace':8,'Tab':9,'Enter':13,'Shift':16,'Control':17,'Alt':18,'CapsLock':20,'Esc':27,'Spacebar':32,'PageUp':33,'PageDown':34,'End':35,'Home':36,'Left':37,'Up':38,'Right':39,'Down':40,'Insert':45,'Del':46,'NumLock':144,'Cmd':91,'=':187,'-':189,\"b\":66,'i':73, //回退\n'z':90,'y':89, //粘贴\n'v':86,'x':88,'s':83,'n':78}; // core/localstorage.js\n//存储媒介封装\nvar LocalStorage=UE.LocalStorage = (function(){var storage=window.localStorage || getUserData() || null,LOCAL_FILE='localStorage';return {saveLocalData:function saveLocalData(key,data){if(storage && data){storage.setItem(key,data);return true;}return false;},getLocalData:function getLocalData(key){if(storage){return storage.getItem(key);}return null;},removeItem:function removeItem(key){storage && storage.removeItem(key);}};function getUserData(){var container=document.createElement(\"div\");container.style.display = \"none\";if(!container.addBehavior){return null;}container.addBehavior(\"#default#userdata\");return {getItem:function getItem(key){var result=null;try{document.body.appendChild(container);container.load(LOCAL_FILE);result = container.getAttribute(key);document.body.removeChild(container);}catch(e) {}return result;},setItem:function setItem(key,value){document.body.appendChild(container);container.setAttribute(key,value);container.save(LOCAL_FILE);document.body.removeChild(container);}, //// 暂时没有用到\n//clear: function () {\n//\n//    var expiresTime = new Date();\n//    expiresTime.setFullYear(expiresTime.getFullYear() - 1);\n//    document.body.appendChild(container);\n//    container.expires = expiresTime.toUTCString();\n//    container.save(LOCAL_FILE);\n//    document.body.removeChild(container);\n//\n//},\nremoveItem:function removeItem(key){document.body.appendChild(container);container.removeAttribute(key);container.save(LOCAL_FILE);document.body.removeChild(container);}};}})();(function(){var ROOTKEY='ueditor_preference';UE.Editor.prototype.setPreferences = function(key,value){var obj={};if(utils.isString(key)){obj[key] = value;}else {obj = key;}var data=LocalStorage.getLocalData(ROOTKEY);if(data && (data = utils.str2json(data))){utils.extend(data,obj);}else {data = obj;}data && LocalStorage.saveLocalData(ROOTKEY,utils.json2str(data));};UE.Editor.prototype.getPreferences = function(key){var data=LocalStorage.getLocalData(ROOTKEY);if(data && (data = utils.str2json(data))){return key?data[key]:data;}return null;};UE.Editor.prototype.removePreferences = function(key){var data=LocalStorage.getLocalData(ROOTKEY);if(data && (data = utils.str2json(data))){data[key] = undefined;delete data[key];}data && LocalStorage.saveLocalData(ROOTKEY,utils.json2str(data));};})(); // plugins/defaultfilter.js\n///import core\n///plugin 编辑器默认的过滤转换机制\nUE.plugins['defaultfilter'] = function(){var me=this;me.setOpt({'allowDivTransToP':true,'disabledTableInTable':true}); //默认的过滤处理\n//进入编辑器的内容处理\nme.addInputRule(function(root){var allowDivTransToP=this.options.allowDivTransToP;var val;function tdParent(node){while(node && node.type == 'element') {if(node.tagName == 'td'){return true;}node = node.parentNode;}return false;} //进行默认的处理\nroot.traversal(function(node){if(node.type == 'element'){if(!dtd.$cdata[node.tagName] && me.options.autoClearEmptyNode && dtd.$inline[node.tagName] && !dtd.$empty[node.tagName] && (!node.attrs || utils.isEmptyObject(node.attrs))){if(!node.firstChild())node.parentNode.removeChild(node);else if(node.tagName == 'span' && (!node.attrs || utils.isEmptyObject(node.attrs))){node.parentNode.removeChild(node,true);}return;}switch(node.tagName){case 'style':case 'script':node.setAttr({cdata_tag:node.tagName,cdata_data:node.innerHTML() || '','_ue_custom_node_':'true'});node.tagName = 'div';node.innerHTML('');break;case 'a':if(val = node.getAttr('href')){node.setAttr('_href',val);}break;case 'img': //todo base64暂时去掉，后边做远程图片上传后，干掉这个\nif(val = node.getAttr('src')){if(/^data:/.test(val)){node.parentNode.removeChild(node);break;}}node.setAttr('_src',node.getAttr('src'));break;case 'span':if(browser.webkit && (val = node.getStyle('white-space'))){if(/nowrap|normal/.test(val)){node.setStyle('white-space','');if(me.options.autoClearEmptyNode && utils.isEmptyObject(node.attrs)){node.parentNode.removeChild(node,true);}}}val = node.getAttr('id');if(val && /^_baidu_bookmark_/i.test(val)){node.parentNode.removeChild(node);}break;case 'p':if(val = node.getAttr('align')){node.setAttr('align');node.setStyle('text-align',val);} //trace:3431\n//                        var cssStyle = node.getAttr('style');\n//                        if (cssStyle) {\n//                            cssStyle = cssStyle.replace(/(margin|padding)[^;]+/g, '');\n//                            node.setAttr('style', cssStyle)\n//\n//                        }\n//p标签不允许嵌套\nutils.each(node.children,function(n){if(n.type == 'element' && n.tagName == 'p'){var next=n.nextSibling();node.parentNode.insertAfter(n,node);var last=n;while(next) {var tmp=next.nextSibling();node.parentNode.insertAfter(next,last);last = next;next = tmp;}return false;}});if(!node.firstChild()){node.innerHTML(browser.ie?'&nbsp;':'<br/>');}break;case 'div':if(node.getAttr('cdata_tag')){break;} //针对代码这里不处理插入代码的div\nval = node.getAttr('class');if(val && /^line number\\d+/.test(val)){break;}if(!allowDivTransToP){break;}var tmpNode,p=UE.uNode.createElement('p');while(tmpNode = node.firstChild()) {if(tmpNode.type == 'text' || !UE.dom.dtd.$block[tmpNode.tagName]){p.appendChild(tmpNode);}else {if(p.firstChild()){node.parentNode.insertBefore(p,node);p = UE.uNode.createElement('p');}else {node.parentNode.insertBefore(tmpNode,node);}}}if(p.firstChild()){node.parentNode.insertBefore(p,node);}node.parentNode.removeChild(node);break;case 'dl':node.tagName = 'ul';break;case 'dt':case 'dd':node.tagName = 'li';break;case 'li':var className=node.getAttr('class');if(!className || !/list\\-/.test(className)){node.setAttr();}var tmpNodes=node.getNodesByTagName('ol ul');UE.utils.each(tmpNodes,function(n){node.parentNode.insertAfter(n,node);});break;case 'td':case 'th':case 'caption':if(!node.children || !node.children.length){node.appendChild(browser.ie11below?UE.uNode.createText(' '):UE.uNode.createElement('br'));}break;case 'table':if(me.options.disabledTableInTable && tdParent(node)){node.parentNode.insertBefore(UE.uNode.createText(node.innerText()),node);node.parentNode.removeChild(node);}}} //            if(node.type == 'comment'){\n//                node.parentNode.removeChild(node);\n//            }\n});}); //从编辑器出去的内容处理\nme.addOutputRule(function(root){var val;root.traversal(function(node){if(node.type == 'element'){if(me.options.autoClearEmptyNode && dtd.$inline[node.tagName] && !dtd.$empty[node.tagName] && (!node.attrs || utils.isEmptyObject(node.attrs))){if(!node.firstChild())node.parentNode.removeChild(node);else if(node.tagName == 'span' && (!node.attrs || utils.isEmptyObject(node.attrs))){node.parentNode.removeChild(node,true);}return;}switch(node.tagName){case 'div':if(val = node.getAttr('cdata_tag')){node.tagName = val;node.appendChild(UE.uNode.createText(node.getAttr('cdata_data')));node.setAttr({cdata_tag:'',cdata_data:'','_ue_custom_node_':''});}break;case 'a':if(val = node.getAttr('_href')){node.setAttr({'href':utils.html(val),'_href':''});}break;break;case 'span':val = node.getAttr('id');if(val && /^_baidu_bookmark_/i.test(val)){node.parentNode.removeChild(node);}break;case 'img':if(val = node.getAttr('_src')){node.setAttr({'src':node.getAttr('_src'),'_src':''});}}}});});}; // plugins/inserthtml.js\n/**\r\n * 插入html字符串插件\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 插入html代码\r\n * @command inserthtml\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } html 插入的html字符串\r\n * @remaind 插入的标签内容是在当前的选区位置上插入，如果当前是闭合状态，那直接插入内容， 如果当前是选中状态，将先清除当前选中内容后，再做插入\r\n * @warning 注意:该命令会对当前选区的位置，对插入的内容进行过滤转换处理。 过滤的规则遵循html语意化的原则。\r\n * @example\r\n * ```javascript\r\n * //xxx[BB]xxx 当前选区为非闭合选区，选中BB这两个文本\r\n * //执行命令，插入<b>CC</b>\r\n * //插入后的效果 xxx<b>CC</b>xxx\r\n * //<p>xx|xxx</p> 当前选区为闭合状态\r\n * //插入<p>CC</p>\r\n * //结果 <p>xx</p><p>CC</p><p>xxx</p>\r\n * //<p>xxxx</p>|</p>xxx</p> 当前选区在两个p标签之间\r\n * //插入 xxxx\r\n * //结果 <p>xxxx</p><p>xxxx</p></p>xxx</p>\r\n * ```\r\n */UE.commands['inserthtml'] = {execCommand:function execCommand(command,html,notNeedFilter){var me=this,range,div;if(!html){return;}if(me.fireEvent('beforeinserthtml',html) === true){return;}range = me.selection.getRange();div = range.document.createElement('div');div.style.display = 'inline';if(!notNeedFilter){var root=UE.htmlparser(html); //如果给了过滤规则就先进行过滤\nif(me.options.filterRules){UE.filterNode(root,me.options.filterRules);} //执行默认的处理\nme.filterInputRule(root);html = root.toHtml();}div.innerHTML = utils.trim(html);if(!range.collapsed){var tmpNode=range.startContainer;if(domUtils.isFillChar(tmpNode)){range.setStartBefore(tmpNode);}tmpNode = range.endContainer;if(domUtils.isFillChar(tmpNode)){range.setEndAfter(tmpNode);}range.txtToElmBoundary(); //结束边界可能放到了br的前边，要把br包含进来\n// x[xxx]<br/>\nif(range.endContainer && range.endContainer.nodeType == 1){tmpNode = range.endContainer.childNodes[range.endOffset];if(tmpNode && domUtils.isBr(tmpNode)){range.setEndAfter(tmpNode);}}if(range.startOffset == 0){tmpNode = range.startContainer;if(domUtils.isBoundaryNode(tmpNode,'firstChild')){tmpNode = range.endContainer;if(range.endOffset == (tmpNode.nodeType == 3?tmpNode.nodeValue.length:tmpNode.childNodes.length) && domUtils.isBoundaryNode(tmpNode,'lastChild')){me.body.innerHTML = '<p>' + (browser.ie?'':'<br/>') + '</p>';range.setStart(me.body.firstChild,0).collapse(true);}}}!range.collapsed && range.deleteContents();if(range.startContainer.nodeType == 1){var child=range.startContainer.childNodes[range.startOffset],pre;if(child && domUtils.isBlockElm(child) && (pre = child.previousSibling) && domUtils.isBlockElm(pre)){range.setEnd(pre,pre.childNodes.length).collapse();while(child.firstChild) {pre.appendChild(child.firstChild);}domUtils.remove(child);}}}var child,parent,pre,tmp,hadBreak=0,nextNode; //如果当前位置选中了fillchar要干掉，要不会产生空行\nif(range.inFillChar()){child = range.startContainer;if(domUtils.isFillChar(child)){range.setStartBefore(child).collapse(true);domUtils.remove(child);}else if(domUtils.isFillChar(child,true)){child.nodeValue = child.nodeValue.replace(fillCharReg,'');range.startOffset--;range.collapsed && range.collapse(true);}} //列表单独处理\nvar li=domUtils.findParentByTagName(range.startContainer,'li',true);if(li){var next,last;while(child = div.firstChild) { //针对hr单独处理一下先\nwhile(child && (child.nodeType == 3 || !domUtils.isBlockElm(child) || child.tagName == 'HR')) {next = child.nextSibling;range.insertNode(child).collapse();last = child;child = next;}if(child){if(/^(ol|ul)$/i.test(child.tagName)){while(child.firstChild) {last = child.firstChild;domUtils.insertAfter(li,child.firstChild);li = li.nextSibling;}domUtils.remove(child);}else {var tmpLi;next = child.nextSibling;tmpLi = me.document.createElement('li');domUtils.insertAfter(li,tmpLi);tmpLi.appendChild(child);last = child;child = next;li = tmpLi;}}}li = domUtils.findParentByTagName(range.startContainer,'li',true);if(domUtils.isEmptyBlock(li)){domUtils.remove(li);}if(last){range.setStartAfter(last).collapse(true).select(true);}}else {while(child = div.firstChild) {if(hadBreak){var p=me.document.createElement('p');while(child && (child.nodeType == 3 || !dtd.$block[child.tagName])) {nextNode = child.nextSibling;p.appendChild(child);child = nextNode;}if(p.firstChild){child = p;}}range.insertNode(child);nextNode = child.nextSibling;if(!hadBreak && child.nodeType == domUtils.NODE_ELEMENT && domUtils.isBlockElm(child)){parent = domUtils.findParent(child,function(node){return domUtils.isBlockElm(node);});if(parent && parent.tagName.toLowerCase() != 'body' && !(dtd[parent.tagName][child.nodeName] && child.parentNode === parent)){if(!dtd[parent.tagName][child.nodeName]){pre = parent;}else {tmp = child.parentNode;while(tmp !== parent) {pre = tmp;tmp = tmp.parentNode;}}domUtils.breakParent(child,pre || tmp); //去掉break后前一个多余的节点  <p>|<[p> ==> <p></p><div></div><p>|</p>\nvar pre=child.previousSibling;domUtils.trimWhiteTextNode(pre);if(!pre.childNodes.length){domUtils.remove(pre);} //trace:2012,在非ie的情况，切开后剩下的节点有可能不能点入光标添加br占位\nif(!browser.ie && (next = child.nextSibling) && domUtils.isBlockElm(next) && next.lastChild && !domUtils.isBr(next.lastChild)){next.appendChild(me.document.createElement('br'));}hadBreak = 1;}}var next=child.nextSibling;if(!div.firstChild && next && domUtils.isBlockElm(next)){range.setStart(next,0).collapse(true);break;}range.setEndAfter(child).collapse();}child = range.startContainer;if(nextNode && domUtils.isBr(nextNode)){domUtils.remove(nextNode);} //用chrome可能有空白展位符\nif(domUtils.isBlockElm(child) && domUtils.isEmptyNode(child)){if(nextNode = child.nextSibling){domUtils.remove(child);if(nextNode.nodeType == 1 && dtd.$block[nextNode.tagName]){range.setStart(nextNode,0).collapse(true).shrinkBoundary();}}else {try{child.innerHTML = browser.ie?domUtils.fillChar:'<br/>';}catch(e) {range.setStartBefore(child);domUtils.remove(child);}}} //加上true因为在删除表情等时会删两次，第一次是删的fillData\ntry{range.select(true);}catch(e) {}}setTimeout(function(){range = me.selection.getRange();range.scrollToView(me.autoHeightEnabled,me.autoHeightEnabled?domUtils.getXY(me.iframe).y:0);me.fireEvent('afterinserthtml',html);},200);}}; // plugins/autotypeset.js\n/**\r\n * 自动排版\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 对当前编辑器的内容执行自动排版， 排版的行为根据config配置文件里的“autotypeset”选项进行控制。\r\n * @command autotypeset\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'autotypeset' );\r\n * ```\r\n */UE.plugins['autotypeset'] = function(){this.setOpt({'autotypeset':{mergeEmptyline:true, //合并空行\nremoveClass:true, //去掉冗余的class\nremoveEmptyline:false, //去掉空行\ntextAlign:\"left\", //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版\nimageBlockLine:'center', //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版\npasteFilter:false, //根据规则过滤没事粘贴进来的内容\nclearFontSize:false, //去掉所有的内嵌字号，使用编辑器默认的字号\nclearFontFamily:false, //去掉所有的内嵌字体，使用编辑器默认的字体\nremoveEmptyNode:false, // 去掉空节点\n//可以去掉的标签\nremoveTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:false, // 行首缩进\nindentValue:'2em', //行首缩进的大小\nbdc2sb:false,tobdc:false}});var me=this,opt=me.options.autotypeset,remainClass={'selectTdClass':1,'pagebreak':1,'anchorclass':1},remainTag={'li':1},tags={div:1,p:1, //trace:2183 这些也认为是行\nblockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1},highlightCont; //升级了版本，但配置项目里没有autotypeset\nif(!opt){return;}readLocalOpts();function isLine(node,notEmpty){if(!node || node.nodeType == 3)return 0;if(domUtils.isBr(node))return 1;if(node && node.parentNode && tags[node.tagName.toLowerCase()]){if(highlightCont && highlightCont.contains(node) || node.getAttribute('pagebreak')){return 0;}return notEmpty?!domUtils.isEmptyBlock(node):domUtils.isEmptyBlock(node,new RegExp('[\\\\s' + domUtils.fillChar + ']','g'));}}function removeNotAttributeSpan(node){if(!node.style.cssText){domUtils.removeAttributes(node,['style']);if(node.tagName.toLowerCase() == 'span' && domUtils.hasNoAttributes(node)){domUtils.remove(node,true);}}}function autotype(type,html){var me=this,cont;if(html){if(!opt.pasteFilter){return;}cont = me.document.createElement('div');cont.innerHTML = html.html;}else {cont = me.document.body;}var nodes=domUtils.getElementsByTagName(cont,'*'); // 行首缩进，段落方向，段间距，段内间距\nfor(var i=0,ci;ci = nodes[i++];) {if(me.fireEvent('excludeNodeinautotype',ci) === true){continue;} //font-size\nif(opt.clearFontSize && ci.style.fontSize){domUtils.removeStyle(ci,'font-size');removeNotAttributeSpan(ci);} //font-family\nif(opt.clearFontFamily && ci.style.fontFamily){domUtils.removeStyle(ci,'font-family');removeNotAttributeSpan(ci);}if(isLine(ci)){ //合并空行\nif(opt.mergeEmptyline){var next=ci.nextSibling,tmpNode,isBr=domUtils.isBr(ci);while(isLine(next)) {tmpNode = next;next = tmpNode.nextSibling;if(isBr && (!next || next && !domUtils.isBr(next))){break;}domUtils.remove(tmpNode);}} //去掉空行，保留占位的空行\nif(opt.removeEmptyline && domUtils.inDoc(ci,cont) && !remainTag[ci.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(ci)){next = ci.nextSibling;if(next && !domUtils.isBr(next)){continue;}}domUtils.remove(ci);continue;}}if(isLine(ci,true) && ci.tagName != 'SPAN'){if(opt.indent){ci.style.textIndent = opt.indentValue;}if(opt.textAlign){ci.style.textAlign = opt.textAlign;} // if(opt.lineHeight)\n//     ci.style.lineHeight = opt.lineHeight + 'cm';\n} //去掉class,保留的class不去掉\nif(opt.removeClass && ci.className && !remainClass[ci.className.toLowerCase()]){if(highlightCont && highlightCont.contains(ci)){continue;}domUtils.removeAttributes(ci,['class']);} //表情不处理\nif(opt.imageBlockLine && ci.tagName.toLowerCase() == 'img' && !ci.getAttribute('emotion')){if(html){var img=ci;switch(opt.imageBlockLine){case 'left':case 'right':case 'none':var pN=img.parentNode,tmpNode,pre,next;while(dtd.$inline[pN.tagName] || pN.tagName == 'A') {pN = pN.parentNode;}tmpNode = pN;if(tmpNode.tagName == 'P' && domUtils.getStyle(tmpNode,'text-align') == 'center'){if(!domUtils.isBody(tmpNode) && domUtils.getChildCount(tmpNode,function(node){return !domUtils.isBr(node) && !domUtils.isWhitespace(node);}) == 1){pre = tmpNode.previousSibling;next = tmpNode.nextSibling;if(pre && next && pre.nodeType == 1 && next.nodeType == 1 && pre.tagName == next.tagName && domUtils.isBlockElm(pre)){pre.appendChild(tmpNode.firstChild);while(next.firstChild) {pre.appendChild(next.firstChild);}domUtils.remove(tmpNode);domUtils.remove(next);}else {domUtils.setStyle(tmpNode,'text-align','');}}}domUtils.setStyle(img,'float',opt.imageBlockLine);break;case 'center':if(me.queryCommandValue('imagefloat') != 'center'){pN = img.parentNode;domUtils.setStyle(img,'float','none');tmpNode = img;while(pN && domUtils.getChildCount(pN,function(node){return !domUtils.isBr(node) && !domUtils.isWhitespace(node);}) == 1 && (dtd.$inline[pN.tagName] || pN.tagName == 'A')) {tmpNode = pN;pN = pN.parentNode;}var pNode=me.document.createElement('p');domUtils.setAttributes(pNode,{style:'text-align:center'});tmpNode.parentNode.insertBefore(pNode,tmpNode);pNode.appendChild(tmpNode);domUtils.setStyle(tmpNode,'float','');}}}else {var range=me.selection.getRange();range.selectNode(ci).select();me.execCommand('imagefloat',opt.imageBlockLine);}} //去掉冗余的标签\nif(opt.removeEmptyNode){if(opt.removeTagNames[ci.tagName.toLowerCase()] && domUtils.hasNoAttributes(ci) && domUtils.isEmptyBlock(ci)){domUtils.remove(ci);}}}if(opt.tobdc){var root=UE.htmlparser(cont.innerHTML);root.traversal(function(node){if(node.type == 'text'){node.data = ToDBC(node.data);}});cont.innerHTML = root.toHtml();}if(opt.bdc2sb){var root=UE.htmlparser(cont.innerHTML);root.traversal(function(node){if(node.type == 'text'){node.data = DBC2SB(node.data);}});cont.innerHTML = root.toHtml();}if(html){html.html = cont.innerHTML;}}if(opt.pasteFilter){me.addListener('beforepaste',autotype);}function DBC2SB(str){var result='';for(var i=0;i < str.length;i++) {var code=str.charCodeAt(i); //获取当前字符的unicode编码\nif(code >= 65281 && code <= 65373) //在这个unicode编码范围中的是所有的英文字母已经各种字符\n{result += String.fromCharCode(str.charCodeAt(i) - 65248); //把全角字符的unicode编码转换为对应半角字符的unicode码\n}else if(code == 12288) //空格\n{result += String.fromCharCode(str.charCodeAt(i) - 12288 + 32);}else {result += str.charAt(i);}}return result;}function ToDBC(txtstring){txtstring = utils.html(txtstring);var tmp=\"\";var mark=\"\"; /*用于判断,如果是html尖括里的标记,则不进行全角的转换*/for(var i=0;i < txtstring.length;i++) {if(txtstring.charCodeAt(i) == 32){tmp = tmp + String.fromCharCode(12288);}else if(txtstring.charCodeAt(i) < 127){tmp = tmp + String.fromCharCode(txtstring.charCodeAt(i) + 65248);}else {tmp += txtstring.charAt(i);}}return tmp;}function readLocalOpts(){var cookieOpt=me.getPreferences('autotypeset');utils.extend(me.options.autotypeset,cookieOpt);}me.commands['autotypeset'] = {execCommand:function execCommand(){me.removeListener('beforepaste',autotype);if(opt.pasteFilter){me.addListener('beforepaste',autotype);}autotype.call(me);}};}; // plugins/autosubmit.js\n/**\r\n * 快捷键提交\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 提交表单\r\n * @command autosubmit\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'autosubmit' );\r\n * ```\r\n */UE.plugin.register('autosubmit',function(){return {shortcutkey:{\"autosubmit\":\"ctrl+13\" //手动提交\n},commands:{'autosubmit':{execCommand:function execCommand(){var me=this,form=domUtils.findParentByTagName(me.iframe,\"form\",false);if(form){if(me.fireEvent(\"beforesubmit\") === false){return;}me.sync();form.submit();}}}}};}); // plugins/background.js\n/**\r\n * 背景插件，为UEditor提供设置背景功能\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugin.register('background',function(){var me=this,cssRuleId='editor_background',isSetColored,reg=new RegExp('body[\\\\s]*\\\\{(.+)\\\\}','i');function stringToObj(str){var obj={},styles=str.split(';');utils.each(styles,function(v){var index=v.indexOf(':'),key=utils.trim(v.substr(0,index)).toLowerCase();key && (obj[key] = utils.trim(v.substr(index + 1) || ''));});return obj;}function setBackground(obj){if(obj){var styles=[];for(var name in obj) {if(obj.hasOwnProperty(name)){styles.push(name + \":\" + obj[name] + '; ');}}utils.cssRule(cssRuleId,styles.length?'body{' + styles.join(\"\") + '}':'',me.document);}else {utils.cssRule(cssRuleId,'',me.document);}} //重写editor.hasContent方法\nvar orgFn=me.hasContents;me.hasContents = function(){if(me.queryCommandValue('background')){return true;}return orgFn.apply(me,arguments);};return {bindEvents:{'getAllHtml':function getAllHtml(type,headHtml){var body=this.body,su=domUtils.getComputedStyle(body,\"background-image\"),url=\"\";if(su.indexOf(me.options.imagePath) > 0){url = su.substring(su.indexOf(me.options.imagePath),su.length - 1).replace(/\"|\\(|\\)/ig,\"\");}else {url = su != \"none\"?su.replace(/url\\(\"?|\"?\\)/ig,\"\"):\"\";}var html='<style type=\"text/css\">body{';var bgObj={\"background-color\":domUtils.getComputedStyle(body,\"background-color\") || \"#ffffff\",'background-image':url?'url(' + url + ')':'','background-repeat':domUtils.getComputedStyle(body,\"background-repeat\") || \"\",'background-position':browser.ie?domUtils.getComputedStyle(body,\"background-position-x\") + \" \" + domUtils.getComputedStyle(body,\"background-position-y\"):domUtils.getComputedStyle(body,\"background-position\"),'height':domUtils.getComputedStyle(body,\"height\")};for(var name in bgObj) {if(bgObj.hasOwnProperty(name)){html += name + \":\" + bgObj[name] + \"; \";}}html += '}</style> ';headHtml.push(html);},'aftersetcontent':function aftersetcontent(){if(isSetColored == false)setBackground();}},inputRule:function inputRule(root){isSetColored = false;utils.each(root.getNodesByTagName('p'),function(p){var styles=p.getAttr('data-background');if(styles){isSetColored = true;setBackground(stringToObj(styles));p.parentNode.removeChild(p);}});},outputRule:function outputRule(root){var me=this,styles=(utils.cssRule(cssRuleId,me.document) || '').replace(/[\\n\\r]+/g,'').match(reg);if(styles){root.appendChild(UE.uNode.createElement('<p style=\"display:none;\" data-background=\"' + utils.trim(styles[1].replace(/\"/g,'').replace(/[\\s]+/g,' ')) + '\"><br/></p>'));}},commands:{'background':{execCommand:function execCommand(cmd,obj){setBackground(obj);},queryCommandValue:function queryCommandValue(){var me=this,styles=(utils.cssRule(cssRuleId,me.document) || '').replace(/[\\n\\r]+/g,'').match(reg);return styles?stringToObj(styles[1]):null;},notNeedUndo:true}}};}); // plugins/image.js\n/**\r\n * 图片插入、排版插件\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 图片对齐方式\r\n * @command imagefloat\r\n * @method execCommand\r\n * @remind 值center为独占一行居中\r\n * @param { String } cmd 命令字符串\r\n * @param { String } align 对齐方式，可传left、right、none、center\r\n * @remaind center表示图片独占一行\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'imagefloat', 'center' );\r\n * ```\r\n */ /**\r\n * 如果选区所在位置是图片区域\r\n * @command imagefloat\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 返回图片对齐方式\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'imagefloat' );\r\n * ```\r\n */UE.commands['imagefloat'] = {execCommand:function execCommand(cmd,align){var me=this,range=me.selection.getRange();if(!range.collapsed){var img=range.getClosedNode();if(img && img.tagName == 'IMG'){switch(align){case 'left':case 'right':case 'none':var pN=img.parentNode,tmpNode,pre,next;while(dtd.$inline[pN.tagName] || pN.tagName == 'A') {pN = pN.parentNode;}tmpNode = pN;if(tmpNode.tagName == 'P' && domUtils.getStyle(tmpNode,'text-align') == 'center'){if(!domUtils.isBody(tmpNode) && domUtils.getChildCount(tmpNode,function(node){return !domUtils.isBr(node) && !domUtils.isWhitespace(node);}) == 1){pre = tmpNode.previousSibling;next = tmpNode.nextSibling;if(pre && next && pre.nodeType == 1 && next.nodeType == 1 && pre.tagName == next.tagName && domUtils.isBlockElm(pre)){pre.appendChild(tmpNode.firstChild);while(next.firstChild) {pre.appendChild(next.firstChild);}domUtils.remove(tmpNode);domUtils.remove(next);}else {domUtils.setStyle(tmpNode,'text-align','');}}range.selectNode(img).select();}domUtils.setStyle(img,'float',align == 'none'?'':align);if(align == 'none'){domUtils.removeAttributes(img,'align');}break;case 'center':if(me.queryCommandValue('imagefloat') != 'center'){pN = img.parentNode;domUtils.setStyle(img,'float','');domUtils.removeAttributes(img,'align');tmpNode = img;while(pN && domUtils.getChildCount(pN,function(node){return !domUtils.isBr(node) && !domUtils.isWhitespace(node);}) == 1 && (dtd.$inline[pN.tagName] || pN.tagName == 'A')) {tmpNode = pN;pN = pN.parentNode;}range.setStartBefore(tmpNode).setCursor(false);pN = me.document.createElement('div');pN.appendChild(tmpNode);domUtils.setStyle(tmpNode,'float','');me.execCommand('insertHtml','<p id=\"_img_parent_tmp\" style=\"text-align:center\">' + pN.innerHTML + '</p>');tmpNode = me.document.getElementById('_img_parent_tmp');tmpNode.removeAttribute('id');tmpNode = tmpNode.firstChild;range.selectNode(tmpNode).select(); //去掉后边多余的元素\nnext = tmpNode.parentNode.nextSibling;if(next && domUtils.isEmptyNode(next)){domUtils.remove(next);}}break;}}}},queryCommandValue:function queryCommandValue(){var range=this.selection.getRange(),startNode,floatStyle;if(range.collapsed){return 'none';}startNode = range.getClosedNode();if(startNode && startNode.nodeType == 1 && startNode.tagName == 'IMG'){floatStyle = domUtils.getComputedStyle(startNode,'float') || startNode.getAttribute('align');if(floatStyle == 'none'){floatStyle = domUtils.getComputedStyle(startNode.parentNode,'text-align') == 'center'?'center':floatStyle;}return ({left:1,right:1,center:1})[floatStyle]?floatStyle:'none';}return 'none';},queryCommandState:function queryCommandState(){var range=this.selection.getRange(),startNode;if(range.collapsed)return -1;startNode = range.getClosedNode();if(startNode && startNode.nodeType == 1 && startNode.tagName == 'IMG'){return 0;}return -1;}}; /**\r\n * 插入图片\r\n * @command insertimage\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { Object } opt 属性键值对，这些属性都将被复制到当前插入图片\r\n * @remind 该命令第二个参数可接受一个图片配置项对象的数组，可以插入多张图片，\r\n * 此时数组的每一个元素都是一个Object类型的图片属性集合。\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'insertimage', {\r\n *     src:'a/b/c.jpg',\r\n *     width:'100',\r\n *     height:'100'\r\n * } );\r\n * ```\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'insertimage', [{\r\n *     src:'a/b/c.jpg',\r\n *     width:'100',\r\n *     height:'100'\r\n * },{\r\n *     src:'a/b/d.jpg',\r\n *     width:'100',\r\n *     height:'100'\r\n * }] );\r\n * ```\r\n */UE.commands['insertimage'] = {execCommand:function execCommand(cmd,opt){opt = utils.isArray(opt)?opt:[opt];if(!opt.length){return;}var me=this,range=me.selection.getRange(),img=range.getClosedNode();if(me.fireEvent('beforeinsertimage',opt) === true){return;}if(img && /img/i.test(img.tagName) && (img.className != \"edui-faked-video\" || img.className.indexOf(\"edui-upload-video\") != -1) && !img.getAttribute(\"word_img\")){var first=opt.shift();var floatStyle=first['floatStyle'];delete first['floatStyle']; ////                img.style.border = (first.border||0) +\"px solid #000\";\n////                img.style.margin = (first.margin||0) +\"px\";\n//                img.style.cssText += ';margin:' + (first.margin||0) +\"px;\" + 'border:' + (first.border||0) +\"px solid #000\";\ndomUtils.setAttributes(img,first);me.execCommand('imagefloat',floatStyle);if(opt.length > 0){range.setStartAfter(img).setCursor(false,true);me.execCommand('insertimage',opt);}}else {var html=[],str='',ci;ci = opt[0];if(opt.length == 1){str = '<img src=\"' + ci.src + '\" ' + (ci._src?' _src=\"' + ci._src + '\" ':'') + (ci.width?'width=\"' + ci.width + '\" ':'') + (ci.height?' height=\"' + ci.height + '\" ':'') + (ci['floatStyle'] == 'left' || ci['floatStyle'] == 'right'?' style=\"float:' + ci['floatStyle'] + ';\"':'') + (ci.title && ci.title != \"\"?' title=\"' + ci.title + '\"':'') + (ci.border && ci.border != \"0\"?' border=\"' + ci.border + '\"':'') + (ci.alt && ci.alt != \"\"?' alt=\"' + ci.alt + '\"':'') + (ci.hspace && ci.hspace != \"0\"?' hspace = \"' + ci.hspace + '\"':'') + (ci.vspace && ci.vspace != \"0\"?' vspace = \"' + ci.vspace + '\"':'') + '/>';if(ci['floatStyle'] == 'center'){str = '<p style=\"text-align: center\">' + str + '</p>';}html.push(str);}else {for(var i=0;ci = opt[i++];) {str = '<p ' + (ci['floatStyle'] == 'center'?'style=\"text-align: center\" ':'') + '><img src=\"' + ci.src + '\" ' + (ci.width?'width=\"' + ci.width + '\" ':'') + (ci._src?' _src=\"' + ci._src + '\" ':'') + (ci.height?' height=\"' + ci.height + '\" ':'') + ' style=\"' + (ci['floatStyle'] && ci['floatStyle'] != 'center'?'float:' + ci['floatStyle'] + ';':'') + (ci.border || '') + '\" ' + (ci.title?' title=\"' + ci.title + '\"':'') + ' /></p>';html.push(str);}}me.execCommand('insertHtml',html.join(''));}me.fireEvent('afterinsertimage',opt);}}; // plugins/justify.js\n/**\r\n * 段落格式\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 段落对齐方式\r\n * @command justify\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } align 对齐方式：left => 居左，right => 居右，center => 居中，justify => 两端对齐\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'justify', 'center' );\r\n * ```\r\n */ /**\r\n * 如果选区所在位置是段落区域，返回当前段落对齐方式\r\n * @command justify\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 返回段落对齐方式\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'justify' );\r\n * ```\r\n */UE.plugins['justify'] = function(){var me=this,block=domUtils.isBlockElm,defaultValue={left:1,right:1,center:1,justify:1},doJustify=function doJustify(range,style){var bookmark=range.createBookmark(),filterFn=function filterFn(node){return node.nodeType == 1?node.tagName.toLowerCase() != 'br' && !domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node);};range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current && !(domUtils.getPosition(current,bookmark2.end) & domUtils.POSITION_FOLLOWING)) {if(current.nodeType == 3 || !block(current)){tmpRange.setStartBefore(current);while(current && current !== bookmark2.end && !block(current)) {tmpNode = current;current = domUtils.getNextDomNode(current,false,null,function(node){return !block(node);});}tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(!domUtils.isBody(common) && block(common)){domUtils.setStyles(common,utils.isString(style)?{'text-align':style}:style);current = common;}else {var p=range.document.createElement('p');domUtils.setStyles(p,utils.isString(style)?{'text-align':style}:style);var frag=tmpRange.extractContents();p.appendChild(frag);tmpRange.insertNode(p);current = p;}current = domUtils.getNextDomNode(current,false,filterFn);}else {current = domUtils.getNextDomNode(current,true,filterFn);}}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark);};UE.commands['justify'] = {execCommand:function execCommand(cmdName,align){var range=this.selection.getRange(),txt; //闭合时单独处理\nif(range.collapsed){txt = this.document.createTextNode('p');range.insertNode(txt);}doJustify(range,align);if(txt){range.setStartBefore(txt).collapse(true);domUtils.remove(txt);}range.select();return true;},queryCommandValue:function queryCommandValue(){var startNode=this.selection.getStart(),value=domUtils.getComputedStyle(startNode,'text-align');return defaultValue[value]?value:'left';},queryCommandState:function queryCommandState(){var start=this.selection.getStart(),cell=start && domUtils.findParentByTagName(start,[\"td\",\"th\",\"caption\"],true);return cell?-1:0;}};}; // plugins/font.js\n/**\r\n * 字体颜色,背景色,字号,字体,下划线,删除线\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 字体颜色\r\n * @command forecolor\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } value 色值(必须十六进制)\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'forecolor', '#000' );\r\n * ```\r\n */ /**\r\n * 返回选区字体颜色\r\n * @command forecolor\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 返回字体颜色\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'forecolor' );\r\n * ```\r\n */ /**\r\n * 字体背景颜色\r\n * @command backcolor\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } value 色值(必须十六进制)\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'backcolor', '#000' );\r\n * ```\r\n */ /**\r\n * 返回选区字体颜色\r\n * @command backcolor\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 返回字体背景颜色\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'backcolor' );\r\n * ```\r\n */ /**\r\n * 字体大小\r\n * @command fontsize\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } value 字体大小\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'fontsize', '14px' );\r\n * ```\r\n */ /**\r\n * 返回选区字体大小\r\n * @command fontsize\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 返回字体大小\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'fontsize' );\r\n * ```\r\n */ /**\r\n * 字体样式\r\n * @command fontfamily\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } value 字体样式\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'fontfamily', '微软雅黑' );\r\n * ```\r\n */ /**\r\n * 返回选区字体样式\r\n * @command fontfamily\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 返回字体样式\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'fontfamily' );\r\n * ```\r\n */ /**\r\n * 字体下划线,与删除线互斥\r\n * @command underline\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'underline' );\r\n * ```\r\n */ /**\r\n * 字体删除线,与下划线互斥\r\n * @command strikethrough\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'strikethrough' );\r\n * ```\r\n */ /**\r\n * 字体边框\r\n * @command fontborder\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'fontborder' );\r\n * ```\r\n */UE.plugins['font'] = function(){var me=this,fonts={'forecolor':'color','backcolor':'background-color','fontsize':'font-size','fontfamily':'font-family','underline':'text-decoration','strikethrough':'text-decoration','fontborder':'border'},needCmd={'underline':1,'strikethrough':1,'fontborder':1},needSetChild={'forecolor':'color','backcolor':'background-color','fontsize':'font-size','fontfamily':'font-family'};me.setOpt({'fontfamily':[{name:'songti',val:'宋体,SimSun'},{name:'yahei',val:'微软雅黑,Microsoft YaHei'},{name:'kaiti',val:'楷体,楷体_GB2312, SimKai'},{name:'heiti',val:'黑体, SimHei'},{name:'lishu',val:'隶书, SimLi'},{name:'andaleMono',val:'andale mono'},{name:'arial',val:'arial, helvetica,sans-serif'},{name:'arialBlack',val:'arial black,avant garde'},{name:'comicSansMs',val:'comic sans ms'},{name:'impact',val:'impact,chicago'},{name:'timesNewRoman',val:'times new roman'}],'fontsize':[10,11,12,14,16,18,20,24,36]});function mergeWithParent(node){var parent;while(parent = node.parentNode) {if(parent.tagName == 'SPAN' && domUtils.getChildCount(parent,function(child){return !domUtils.isBookmarkNode(child) && !domUtils.isBr(child);}) == 1){parent.style.cssText += node.style.cssText;domUtils.remove(node,true);node = parent;}else {break;}}}function mergeChild(rng,cmdName,value){if(needSetChild[cmdName]){rng.adjustmentBoundary();if(!rng.collapsed && rng.startContainer.nodeType == 1){var start=rng.startContainer.childNodes[rng.startOffset];if(start && domUtils.isTagNode(start,'span')){var bk=rng.createBookmark();utils.each(domUtils.getElementsByTagName(start,'span'),function(span){if(!span.parentNode || domUtils.isBookmarkNode(span))return;if(cmdName == 'backcolor' && domUtils.getComputedStyle(span,'background-color').toLowerCase() === value){return;}domUtils.removeStyle(span,needSetChild[cmdName]);if(span.style.cssText.replace(/^\\s+$/,'').length == 0){domUtils.remove(span,true);}});rng.moveToBookmark(bk);}}}}function mergesibling(rng,cmdName,value){var collapsed=rng.collapsed,bk=rng.createBookmark(),common;if(collapsed){common = bk.start.parentNode;while(dtd.$inline[common.tagName]) {common = common.parentNode;}}else {common = domUtils.getCommonAncestor(bk.start,bk.end);}utils.each(domUtils.getElementsByTagName(common,'span'),function(span){if(!span.parentNode || domUtils.isBookmarkNode(span))return;if(/\\s*border\\s*:\\s*none;?\\s*/i.test(span.style.cssText)){if(/^\\s*border\\s*:\\s*none;?\\s*$/.test(span.style.cssText)){domUtils.remove(span,true);}else {domUtils.removeStyle(span,'border');}return;}if(/border/i.test(span.style.cssText) && span.parentNode.tagName == 'SPAN' && /border/i.test(span.parentNode.style.cssText)){span.style.cssText = span.style.cssText.replace(/border[^:]*:[^;]+;?/gi,'');}if(!(cmdName == 'fontborder' && value == 'none')){var next=span.nextSibling;while(next && next.nodeType == 1 && next.tagName == 'SPAN') {if(domUtils.isBookmarkNode(next) && cmdName == 'fontborder'){span.appendChild(next);next = span.nextSibling;continue;}if(next.style.cssText == span.style.cssText){domUtils.moveChild(next,span);domUtils.remove(next);}if(span.nextSibling === next)break;next = span.nextSibling;}}mergeWithParent(span);if(browser.ie && browser.version > 8){ //拷贝父亲们的特别的属性,这里只做背景颜色的处理\nvar parent=domUtils.findParent(span,function(n){return n.tagName == 'SPAN' && /background-color/.test(n.style.cssText);});if(parent && !/background-color/.test(span.style.cssText)){span.style.backgroundColor = parent.style.backgroundColor;}}});rng.moveToBookmark(bk);mergeChild(rng,cmdName,value);}me.addInputRule(function(root){utils.each(root.getNodesByTagName('u s del font strike'),function(node){if(node.tagName == 'font'){var cssStyle=[];for(var p in node.attrs) {switch(p){case 'size':cssStyle.push('font-size:' + (({'1':'10','2':'12','3':'16','4':'18','5':'24','6':'32','7':'48'})[node.attrs[p]] || node.attrs[p]) + 'px');break;case 'color':cssStyle.push('color:' + node.attrs[p]);break;case 'face':cssStyle.push('font-family:' + node.attrs[p]);break;case 'style':cssStyle.push(node.attrs[p]);}}node.attrs = {'style':cssStyle.join(';')};}else {var val=node.tagName == 'u'?'underline':'line-through';node.attrs = {'style':(node.getAttr('style') || '') + 'text-decoration:' + val + ';'};}node.tagName = 'span';}); //        utils.each(root.getNodesByTagName('span'), function (node) {\n//            var val;\n//            if(val = node.getAttr('class')){\n//                if(/fontstrikethrough/.test(val)){\n//                    node.setStyle('text-decoration','line-through');\n//                    if(node.attrs['class']){\n//                        node.attrs['class'] = node.attrs['class'].replace(/fontstrikethrough/,'');\n//                    }else{\n//                        node.setAttr('class')\n//                    }\n//                }\n//                if(/fontborder/.test(val)){\n//                    node.setStyle('border','1px solid #000');\n//                    if(node.attrs['class']){\n//                        node.attrs['class'] = node.attrs['class'].replace(/fontborder/,'');\n//                    }else{\n//                        node.setAttr('class')\n//                    }\n//                }\n//            }\n//        });\n}); //    me.addOutputRule(function(root){\n//        utils.each(root.getNodesByTagName('span'), function (node) {\n//            var val;\n//            if(val = node.getStyle('text-decoration')){\n//                if(/line-through/.test(val)){\n//                    if(node.attrs['class']){\n//                        node.attrs['class'] += ' fontstrikethrough';\n//                    }else{\n//                        node.setAttr('class','fontstrikethrough')\n//                    }\n//                }\n//\n//                node.setStyle('text-decoration')\n//            }\n//            if(val = node.getStyle('border')){\n//                if(/1px/.test(val) && /solid/.test(val)){\n//                    if(node.attrs['class']){\n//                        node.attrs['class'] += ' fontborder';\n//\n//                    }else{\n//                        node.setAttr('class','fontborder')\n//                    }\n//                }\n//                node.setStyle('border')\n//\n//            }\n//        });\n//    });\nfor(var p in fonts) {(function(cmd,style){UE.commands[cmd] = {execCommand:function execCommand(cmdName,value){value = value || (this.queryCommandState(cmdName)?'none':cmdName == 'underline'?'underline':cmdName == 'fontborder'?'1px solid #000':'line-through');var me=this,range=this.selection.getRange(),text;if(value == 'default'){if(range.collapsed){text = me.document.createTextNode('font');range.insertNode(text).select();}me.execCommand('removeFormat','span,a',style);if(text){range.setStartBefore(text).collapse(true);domUtils.remove(text);}mergesibling(range,cmdName,value);range.select();}else {if(!range.collapsed){if(needCmd[cmd] && me.queryCommandValue(cmd)){me.execCommand('removeFormat','span,a',style);}range = me.selection.getRange();range.applyInlineStyle('span',{'style':style + ':' + value});mergesibling(range,cmdName,value);range.select();}else {var span=domUtils.findParentByTagName(range.startContainer,'span',true);text = me.document.createTextNode('font');if(span && !span.children.length && !span[browser.ie?'innerText':'textContent'].replace(fillCharReg,'').length){ //for ie hack when enter\nrange.insertNode(text);if(needCmd[cmd]){range.selectNode(text).select();me.execCommand('removeFormat','span,a',style,null);span = domUtils.findParentByTagName(text,'span',true);range.setStartBefore(text);}span && (span.style.cssText += ';' + style + ':' + value);range.collapse(true).select();}else {range.insertNode(text);range.selectNode(text).select();span = range.document.createElement('span');if(needCmd[cmd]){ //a标签内的不处理跳过\nif(domUtils.findParentByTagName(text,'a',true)){range.setStartBefore(text).setCursor();domUtils.remove(text);return;}me.execCommand('removeFormat','span,a',style);}span.style.cssText = style + ':' + value;text.parentNode.insertBefore(span,text); //修复，span套span 但样式不继承的问题\nif(!browser.ie || browser.ie && browser.version == 9){var spanParent=span.parentNode;while(!domUtils.isBlockElm(spanParent)) {if(spanParent.tagName == 'SPAN'){ //opera合并style不会加入\";\"\nspan.style.cssText = spanParent.style.cssText + \";\" + span.style.cssText;}spanParent = spanParent.parentNode;}}if(opera){setTimeout(function(){range.setStart(span,0).collapse(true);mergesibling(range,cmdName,value);range.select();});}else {range.setStart(span,0).collapse(true);mergesibling(range,cmdName,value);range.select();} //trace:981\n//domUtils.mergeToParent(span)\n}domUtils.remove(text);}}return true;},queryCommandValue:function queryCommandValue(cmdName){var startNode=this.selection.getStart(); //trace:946\nif(cmdName == 'underline' || cmdName == 'strikethrough'){var tmpNode=startNode,value;while(tmpNode && !domUtils.isBlockElm(tmpNode) && !domUtils.isBody(tmpNode)) {if(tmpNode.nodeType == 1){value = domUtils.getComputedStyle(tmpNode,style);if(value != 'none'){return value;}}tmpNode = tmpNode.parentNode;}return 'none';}if(cmdName == 'fontborder'){var tmp=startNode,val;while(tmp && dtd.$inline[tmp.tagName]) {if(val = domUtils.getComputedStyle(tmp,'border')){if(/1px/.test(val) && /solid/.test(val)){return val;}}tmp = tmp.parentNode;}return '';}if(cmdName == 'FontSize'){var styleVal=domUtils.getComputedStyle(startNode,style),tmp=/^([\\d\\.]+)(\\w+)$/.exec(styleVal);if(tmp){return Math.floor(tmp[1]) + tmp[2];}return styleVal;}return domUtils.getComputedStyle(startNode,style);},queryCommandState:function queryCommandState(cmdName){if(!needCmd[cmdName])return 0;var val=this.queryCommandValue(cmdName);if(cmdName == 'fontborder'){return (/1px/.test(val) && /solid/.test(val));}else {return cmdName == 'underline'?/underline/.test(val):/line\\-through/.test(val);}}};})(p,fonts[p]);}}; // plugins/link.js\n/**\r\n * 超链接\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 插入超链接\r\n * @command link\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { Object } options   设置自定义属性，例如：url、title、target\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'link', '{\r\n *     url:'ueditor.baidu.com',\r\n *     title:'ueditor',\r\n *     target:'_blank'\r\n * }' );\r\n * ```\r\n */ /**\r\n * 返回当前选中的第一个超链接节点\r\n * @command link\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { Element } 超链接节点\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'link' );\r\n * ```\r\n */ /**\r\n * 取消超链接\r\n * @command unlink\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'unlink');\r\n * ```\r\n */UE.plugins['link'] = function(){function optimize(range){var start=range.startContainer,end=range.endContainer;if(start = domUtils.findParentByTagName(start,'a',true)){range.setStartBefore(start);}if(end = domUtils.findParentByTagName(end,'a',true)){range.setEndAfter(end);}}UE.commands['unlink'] = {execCommand:function execCommand(){var range=this.selection.getRange(),bookmark;if(range.collapsed && !domUtils.findParentByTagName(range.startContainer,'a',true)){return;}bookmark = range.createBookmark();optimize(range);range.removeInlineStyle('a').moveToBookmark(bookmark).select();},queryCommandState:function queryCommandState(){return !this.highlight && this.queryCommandValue('link')?0:-1;}};function doLink(range,opt,me){var rngClone=range.cloneRange(),link=me.queryCommandValue('link');optimize(range = range.adjustmentBoundary());var start=range.startContainer;if(start.nodeType == 1 && link){start = start.childNodes[range.startOffset];if(start && start.nodeType == 1 && start.tagName == 'A' && /^(?:https?|ftp|file)\\s*:\\s*\\/\\//.test(start[browser.ie?'innerText':'textContent'])){start[browser.ie?'innerText':'textContent'] = utils.html(opt.textValue || opt.href);}}if(!rngClone.collapsed || link){range.removeInlineStyle('a');rngClone = range.cloneRange();}if(rngClone.collapsed){var a=range.document.createElement('a'),text='';if(opt.textValue){text = utils.html(opt.textValue);delete opt.textValue;}else {text = utils.html(opt.href);}domUtils.setAttributes(a,opt);start = domUtils.findParentByTagName(rngClone.startContainer,'a',true);if(start && domUtils.isInNodeEndBoundary(rngClone,start)){range.setStartAfter(start).collapse(true);}a[browser.ie?'innerText':'textContent'] = text;range.insertNode(a).selectNode(a);}else {range.applyInlineStyle('a',opt);}}UE.commands['link'] = {execCommand:function execCommand(cmdName,opt){var range;opt._href && (opt._href = utils.unhtml(opt._href,/[<\">]/g));opt.href && (opt.href = utils.unhtml(opt.href,/[<\">]/g));opt.textValue && (opt.textValue = utils.unhtml(opt.textValue,/[<\">]/g));doLink(range = this.selection.getRange(),opt,this); //闭合都不加占位符，如果加了会在a后边多个占位符节点，导致a是图片背景组成的列表，出现空白问题\nrange.collapse().select(true);},queryCommandValue:function queryCommandValue(){var range=this.selection.getRange(),node;if(range.collapsed){ //                    node = this.selection.getStart();\n//在ie下getstart()取值偏上了\nnode = range.startContainer;node = node.nodeType == 1?node:node.parentNode;if(node && (node = domUtils.findParentByTagName(node,'a',true)) && !domUtils.isInNodeEndBoundary(range,node)){return node;}}else { //trace:1111  如果是<p><a>xx</a></p> startContainer是p就会找不到a\nrange.shrinkBoundary();var start=range.startContainer.nodeType == 3 || !range.startContainer.childNodes[range.startOffset]?range.startContainer:range.startContainer.childNodes[range.startOffset],end=range.endContainer.nodeType == 3 || range.endOffset == 0?range.endContainer:range.endContainer.childNodes[range.endOffset - 1],common=range.getCommonAncestor();node = domUtils.findParentByTagName(common,'a',true);if(!node && common.nodeType == 1){var as=common.getElementsByTagName('a'),ps,pe;for(var i=0,ci;ci = as[i++];) {ps = domUtils.getPosition(ci,start),pe = domUtils.getPosition(ci,end);if((ps & domUtils.POSITION_FOLLOWING || ps & domUtils.POSITION_CONTAINS) && (pe & domUtils.POSITION_PRECEDING || pe & domUtils.POSITION_CONTAINS)){node = ci;break;}}}return node;}},queryCommandState:function queryCommandState(){ //判断如果是视频的话连接不可用\n//fix 853\nvar img=this.selection.getRange().getClosedNode(),flag=img && (img.className == \"edui-faked-video\" || img.className.indexOf(\"edui-upload-video\") != -1);return flag?-1:0;}};}; // plugins/iframe.js\n///import core\n///import plugins\\inserthtml.js\n///commands 插入框架\n///commandsName  InsertFrame\n///commandsTitle  插入Iframe\n///commandsDialog  dialogs\\insertframe\nUE.plugins['insertframe'] = function(){var me=this;function deleteIframe(){me._iframe && delete me._iframe;}me.addListener(\"selectionchange\",function(){deleteIframe();});}; // plugins/scrawl.js\n///import core\n///commands 涂鸦\n///commandsName  Scrawl\n///commandsTitle  涂鸦\n///commandsDialog  dialogs\\scrawl\nUE.commands['scrawl'] = {queryCommandState:function queryCommandState(){return browser.ie && browser.version <= 8?-1:0;}}; // plugins/removeformat.js\n/**\r\n * 清除格式\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 清除文字样式\r\n * @command removeformat\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param   {String}   tags     以逗号隔开的标签。如：strong\r\n * @param   {String}   style    样式如：color\r\n * @param   {String}   attrs    属性如:width\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'removeformat', 'strong','color','width' );\r\n * ```\r\n */UE.plugins['removeformat'] = function(){var me=this;me.setOpt({'removeFormatTags':'b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var','removeFormatAttributes':'class,style,lang,width,height,align,hspace,valign'});me.commands['removeformat'] = {execCommand:function execCommand(cmdName,tags,style,attrs,notIncludeA){var tagReg=new RegExp('^(?:' + (tags || this.options.removeFormatTags).replace(/,/g,'|') + ')$','i'),removeFormatAttributes=style?[]:(attrs || this.options.removeFormatAttributes).split(','),range=new dom.Range(this.document),bookmark,node,parent,filter=function filter(node){return node.nodeType == 1;};function isRedundantSpan(node){if(node.nodeType == 3 || node.tagName.toLowerCase() != 'span'){return 0;}if(browser.ie){ //ie 下判断实效，所以只能简单用style来判断\n//return node.style.cssText == '' ? 1 : 0;\nvar attrs=node.attributes;if(attrs.length){for(var i=0,l=attrs.length;i < l;i++) {if(attrs[i].specified){return 0;}}return 1;}}return !node.attributes.length;}function doRemove(range){var bookmark1=range.createBookmark();if(range.collapsed){range.enlarge(true);} //不能把a标签切了\nif(!notIncludeA){var aNode=domUtils.findParentByTagName(range.startContainer,'a',true);if(aNode){range.setStartBefore(aNode);}aNode = domUtils.findParentByTagName(range.endContainer,'a',true);if(aNode){range.setEndAfter(aNode);}}bookmark = range.createBookmark();node = bookmark.start; //切开始\nwhile((parent = node.parentNode) && !domUtils.isBlockElm(parent)) {domUtils.breakParent(node,parent);domUtils.clearEmptySibling(node);}if(bookmark.end){ //切结束\nnode = bookmark.end;while((parent = node.parentNode) && !domUtils.isBlockElm(parent)) {domUtils.breakParent(node,parent);domUtils.clearEmptySibling(node);} //开始去除样式\nvar current=domUtils.getNextDomNode(bookmark.start,false,filter),next;while(current) {if(current == bookmark.end){break;}next = domUtils.getNextDomNode(current,true,filter);if(!dtd.$empty[current.tagName.toLowerCase()] && !domUtils.isBookmarkNode(current)){if(tagReg.test(current.tagName)){if(style){domUtils.removeStyle(current,style);if(isRedundantSpan(current) && style != 'text-decoration'){domUtils.remove(current,true);}}else {domUtils.remove(current,true);}}else { //trace:939  不能把list上的样式去掉\nif(!dtd.$tableContent[current.tagName] && !dtd.$list[current.tagName]){domUtils.removeAttributes(current,removeFormatAttributes);if(isRedundantSpan(current)){domUtils.remove(current,true);}}}}current = next;}} //trace:1035\n//trace:1096 不能把td上的样式去掉，比如边框\nvar pN=bookmark.start.parentNode;if(domUtils.isBlockElm(pN) && !dtd.$tableContent[pN.tagName] && !dtd.$list[pN.tagName]){domUtils.removeAttributes(pN,removeFormatAttributes);}pN = bookmark.end.parentNode;if(bookmark.end && domUtils.isBlockElm(pN) && !dtd.$tableContent[pN.tagName] && !dtd.$list[pN.tagName]){domUtils.removeAttributes(pN,removeFormatAttributes);}range.moveToBookmark(bookmark).moveToBookmark(bookmark1); //清除冗余的代码 <b><bookmark></b>\nvar node=range.startContainer,tmp,collapsed=range.collapsed;while(node.nodeType == 1 && domUtils.isEmptyNode(node) && dtd.$removeEmpty[node.tagName]) {tmp = node.parentNode;range.setStartBefore(node); //trace:937\n//更新结束边界\nif(range.startContainer === range.endContainer){range.endOffset--;}domUtils.remove(node);node = tmp;}if(!collapsed){node = range.endContainer;while(node.nodeType == 1 && domUtils.isEmptyNode(node) && dtd.$removeEmpty[node.tagName]) {tmp = node.parentNode;range.setEndBefore(node);domUtils.remove(node);node = tmp;}}}range = this.selection.getRange();doRemove(range);range.select();}};}; // plugins/blockquote.js\n/**\r\n * 添加引用\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 添加引用\r\n * @command blockquote\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'blockquote' );\r\n * ```\r\n */ /**\r\n * 添加引用\r\n * @command blockquote\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { Object } attrs 节点属性\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'blockquote',{\r\n *     style: \"color: red;\"\r\n * } );\r\n * ```\r\n */UE.plugins['blockquote'] = function(){var me=this;function getObj(editor){return domUtils.filterNodeList(editor.selection.getStartElementPath(),'blockquote');}me.commands['blockquote'] = {execCommand:function execCommand(cmdName,attrs){var range=this.selection.getRange(),obj=getObj(this),blockquote=dtd.blockquote,bookmark=range.createBookmark();if(obj){var start=range.startContainer,startBlock=domUtils.isBlockElm(start)?start:domUtils.findParent(start,function(node){return domUtils.isBlockElm(node);}),end=range.endContainer,endBlock=domUtils.isBlockElm(end)?end:domUtils.findParent(end,function(node){return domUtils.isBlockElm(node);}); //处理一下li\nstartBlock = domUtils.findParentByTagName(startBlock,'li',true) || startBlock;endBlock = domUtils.findParentByTagName(endBlock,'li',true) || endBlock;if(startBlock.tagName == 'LI' || startBlock.tagName == 'TD' || startBlock === obj || domUtils.isBody(startBlock)){domUtils.remove(obj,true);}else {domUtils.breakParent(startBlock,obj);}if(startBlock !== endBlock){obj = domUtils.findParentByTagName(endBlock,'blockquote');if(obj){if(endBlock.tagName == 'LI' || endBlock.tagName == 'TD' || domUtils.isBody(endBlock)){obj.parentNode && domUtils.remove(obj,true);}else {domUtils.breakParent(endBlock,obj);}}}var blockquotes=domUtils.getElementsByTagName(this.document,'blockquote');for(var i=0,bi;bi = blockquotes[i++];) {if(!bi.childNodes.length){domUtils.remove(bi);}else if(domUtils.getPosition(bi,startBlock) & domUtils.POSITION_FOLLOWING && domUtils.getPosition(bi,endBlock) & domUtils.POSITION_PRECEDING){domUtils.remove(bi,true);}}}else {var tmpRange=range.cloneRange(),node=tmpRange.startContainer.nodeType == 1?tmpRange.startContainer:tmpRange.startContainer.parentNode,preNode=node,doEnd=1; //调整开始\nwhile(1) {if(domUtils.isBody(node)){if(preNode !== node){if(range.collapsed){tmpRange.selectNode(preNode);doEnd = 0;}else {tmpRange.setStartBefore(preNode);}}else {tmpRange.setStart(node,0);}break;}if(!blockquote[node.tagName]){if(range.collapsed){tmpRange.selectNode(preNode);}else {tmpRange.setStartBefore(preNode);}break;}preNode = node;node = node.parentNode;} //调整结束\nif(doEnd){preNode = node = node = tmpRange.endContainer.nodeType == 1?tmpRange.endContainer:tmpRange.endContainer.parentNode;while(1) {if(domUtils.isBody(node)){if(preNode !== node){tmpRange.setEndAfter(preNode);}else {tmpRange.setEnd(node,node.childNodes.length);}break;}if(!blockquote[node.tagName]){tmpRange.setEndAfter(preNode);break;}preNode = node;node = node.parentNode;}}node = range.document.createElement('blockquote');domUtils.setAttributes(node,attrs);node.appendChild(tmpRange.extractContents());tmpRange.insertNode(node); //去除重复的\nvar childs=domUtils.getElementsByTagName(node,'blockquote');for(var i=0,ci;ci = childs[i++];) {if(ci.parentNode){domUtils.remove(ci,true);}}}range.moveToBookmark(bookmark).select();},queryCommandState:function queryCommandState(){return getObj(this)?1:0;}};}; // plugins/convertcase.js\n/**\r\n * 大小写转换\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 把选区内文本变大写，与“tolowercase”命令互斥\r\n * @command touppercase\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'touppercase' );\r\n * ```\r\n */ /**\r\n * 把选区内文本变小写，与“touppercase”命令互斥\r\n * @command tolowercase\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'tolowercase' );\r\n * ```\r\n */UE.commands['touppercase'] = UE.commands['tolowercase'] = {execCommand:function execCommand(cmd){var me=this;var rng=me.selection.getRange();if(rng.collapsed){return rng;}var bk=rng.createBookmark(),bkEnd=bk.end,filterFn=function filterFn(node){return !domUtils.isBr(node) && !domUtils.isWhitespace(node);},curNode=domUtils.getNextDomNode(bk.start,false,filterFn);while(curNode && domUtils.getPosition(curNode,bkEnd) & domUtils.POSITION_PRECEDING) {if(curNode.nodeType == 3){curNode.nodeValue = curNode.nodeValue[cmd == 'touppercase'?'toUpperCase':'toLowerCase']();}curNode = domUtils.getNextDomNode(curNode,true,filterFn);if(curNode === bkEnd){break;}}rng.moveToBookmark(bk).select();}}; // plugins/indent.js\n/**\r\n * 首行缩进\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 缩进\r\n * @command indent\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'indent' );\r\n * ```\r\n */UE.commands['indent'] = {execCommand:function execCommand(){var me=this,value=me.queryCommandState(\"indent\")?\"0em\":me.options.indentValue || '2em';me.execCommand('Paragraph','p',{style:'text-indent:' + value});},queryCommandState:function queryCommandState(){var pN=domUtils.filterNodeList(this.selection.getStartElementPath(),'p h1 h2 h3 h4 h5 h6');return pN && pN.style.textIndent && parseInt(pN.style.textIndent)?1:0;}}; // plugins/print.js\n/**\r\n * 打印\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 打印\r\n * @command print\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'print' );\r\n * ```\r\n */UE.commands['print'] = {execCommand:function execCommand(){this.window.print();},notNeedUndo:1}; // plugins/preview.js\n/**\r\n * 预览\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 预览\r\n * @command preview\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'preview' );\r\n * ```\r\n */UE.commands['preview'] = {execCommand:function execCommand(){var w=window.open('','_blank',''),d=w.document;d.open();d.write('<!DOCTYPE html><html><head><meta charset=\"utf-8\"/><script src=\"' + this.options.UEDITOR_HOME_URL + 'ueditor.parse.js\"></script><script>' + \"setTimeout(function(){uParse('div',{rootPath: '\" + this.options.UEDITOR_HOME_URL + \"'})},300)\" + '</script></head><body><div>' + this.getContent(null,null,true) + '</div></body></html>');d.close();},notNeedUndo:1}; // plugins/selectall.js\n/**\r\n * 全选\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 选中所有内容\r\n * @command selectall\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'selectall' );\r\n * ```\r\n */UE.plugins['selectall'] = function(){var me=this;me.commands['selectall'] = {execCommand:function execCommand(){ //去掉了原生的selectAll,因为会出现报错和当内容为空时，不能出现闭合状态的光标\nvar me=this,body=me.body,range=me.selection.getRange();range.selectNodeContents(body);if(domUtils.isEmptyBlock(body)){ //opera不能自动合并到元素的里边，要手动处理一下\nif(browser.opera && body.firstChild && body.firstChild.nodeType == 1){range.setStartAtFirst(body.firstChild);}range.collapse(true);}range.select(true);},notNeedUndo:1}; //快捷键\nme.addshortcutkey({\"selectAll\":\"ctrl+65\"});}; // plugins/paragraph.js\n/**\r\n * 段落样式\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 段落格式\r\n * @command paragraph\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param {String}   style               标签值为：'p', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6'\r\n * @param {Object}   attrs               标签的属性\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'Paragraph','h1','{\r\n *     class:'test'\r\n * }' );\r\n * ```\r\n */ /**\r\n * 返回选区内节点标签名\r\n * @command paragraph\r\n * @method queryCommandValue\r\n * @param { String } cmd 命令字符串\r\n * @return { String } 节点标签名\r\n * @example\r\n * ```javascript\r\n * editor.queryCommandValue( 'Paragraph' );\r\n * ```\r\n */UE.plugins['paragraph'] = function(){var me=this,block=domUtils.isBlockElm,notExchange=['TD','LI','PRE'],doParagraph=function doParagraph(range,style,attrs,sourceCmdName){var bookmark=range.createBookmark(),filterFn=function filterFn(node){return node.nodeType == 1?node.tagName.toLowerCase() != 'br' && !domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node);},para;range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current && !(domUtils.getPosition(current,bookmark2.end) & domUtils.POSITION_FOLLOWING)) {if(current.nodeType == 3 || !block(current)){tmpRange.setStartBefore(current);while(current && current !== bookmark2.end && !block(current)) {tmpNode = current;current = domUtils.getNextDomNode(current,false,null,function(node){return !block(node);});}tmpRange.setEndAfter(tmpNode);para = range.document.createElement(style);if(attrs){domUtils.setAttributes(para,attrs);if(sourceCmdName && sourceCmdName == 'customstyle' && attrs.style){para.style.cssText = attrs.style;}}para.appendChild(tmpRange.extractContents()); //需要内容占位\nif(domUtils.isEmptyNode(para)){domUtils.fillChar(range.document,para);}tmpRange.insertNode(para);var parent=para.parentNode; //如果para上一级是一个block元素且不是body,td就删除它\nif(block(parent) && !domUtils.isBody(para.parentNode) && utils.indexOf(notExchange,parent.tagName) == -1){ //存储dir,style\nif(!(sourceCmdName && sourceCmdName == 'customstyle')){parent.getAttribute('dir') && para.setAttribute('dir',parent.getAttribute('dir')); //trace:1070\nparent.style.cssText && (para.style.cssText = parent.style.cssText + ';' + para.style.cssText); //trace:1030\nparent.style.textAlign && !para.style.textAlign && (para.style.textAlign = parent.style.textAlign);parent.style.textIndent && !para.style.textIndent && (para.style.textIndent = parent.style.textIndent);parent.style.padding && !para.style.padding && (para.style.padding = parent.style.padding);} //trace:1706 选择的就是h1-6要删除\nif(attrs && /h\\d/i.test(parent.tagName) && !/h\\d/i.test(para.tagName)){domUtils.setAttributes(parent,attrs);if(sourceCmdName && sourceCmdName == 'customstyle' && attrs.style){parent.style.cssText = attrs.style;}domUtils.remove(para,true);para = parent;}else {domUtils.remove(para.parentNode,true);}}if(utils.indexOf(notExchange,parent.tagName) != -1){current = parent;}else {current = para;}current = domUtils.getNextDomNode(current,false,filterFn);}else {current = domUtils.getNextDomNode(current,true,filterFn);}}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark);};me.setOpt('paragraph',{'p':'','h1':'','h2':'','h3':'','h4':'','h5':'','h6':''});me.commands['paragraph'] = {execCommand:function execCommand(cmdName,style,attrs,sourceCmdName){var range=this.selection.getRange(); //闭合时单独处理\nif(range.collapsed){var txt=this.document.createTextNode('p');range.insertNode(txt); //去掉冗余的fillchar\nif(browser.ie){var node=txt.previousSibling;if(node && domUtils.isWhitespace(node)){domUtils.remove(node);}node = txt.nextSibling;if(node && domUtils.isWhitespace(node)){domUtils.remove(node);}}}range = doParagraph(range,style,attrs,sourceCmdName);if(txt){range.setStartBefore(txt).collapse(true);pN = txt.parentNode;domUtils.remove(txt);if(domUtils.isBlockElm(pN) && domUtils.isEmptyNode(pN)){domUtils.fillNode(this.document,pN);}}if(browser.gecko && range.collapsed && range.startContainer.nodeType == 1){var child=range.startContainer.childNodes[range.startOffset];if(child && child.nodeType == 1 && child.tagName.toLowerCase() == style){range.setStart(child,0).collapse(true);}} //trace:1097 原来有true，原因忘了，但去了就不能清除多余的占位符了\nrange.select();return true;},queryCommandValue:function queryCommandValue(){var node=domUtils.filterNodeList(this.selection.getStartElementPath(),'p h1 h2 h3 h4 h5 h6');return node?node.tagName.toLowerCase():'';}};}; // plugins/directionality.js\n/**\r\n * 设置文字输入的方向的插件\r\n * @file\r\n * @since 1.2.6.1\r\n */(function(){var block=domUtils.isBlockElm,getObj=function getObj(editor){ //            var startNode = editor.selection.getStart(),\n//                parents;\n//            if ( startNode ) {\n//                //查找所有的是block的父亲节点\n//                parents = domUtils.findParents( startNode, true, block, true );\n//                for ( var i = 0,ci; ci = parents[i++]; ) {\n//                    if ( ci.getAttribute( 'dir' ) ) {\n//                        return ci;\n//                    }\n//                }\n//            }\nreturn domUtils.filterNodeList(editor.selection.getStartElementPath(),function(n){return n && n.nodeType == 1 && n.getAttribute('dir');});},doDirectionality=function doDirectionality(range,editor,forward){var bookmark,filterFn=function filterFn(node){return node.nodeType == 1?!domUtils.isBookmarkNode(node):!domUtils.isWhitespace(node);},obj=getObj(editor);if(obj && range.collapsed){obj.setAttribute('dir',forward);return range;}bookmark = range.createBookmark();range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode;while(current && !(domUtils.getPosition(current,bookmark2.end) & domUtils.POSITION_FOLLOWING)) {if(current.nodeType == 3 || !block(current)){tmpRange.setStartBefore(current);while(current && current !== bookmark2.end && !block(current)) {tmpNode = current;current = domUtils.getNextDomNode(current,false,null,function(node){return !block(node);});}tmpRange.setEndAfter(tmpNode);var common=tmpRange.getCommonAncestor();if(!domUtils.isBody(common) && block(common)){ //遍历到了block节点\ncommon.setAttribute('dir',forward);current = common;}else { //没有遍历到，添加一个block节点\nvar p=range.document.createElement('p');p.setAttribute('dir',forward);var frag=tmpRange.extractContents();p.appendChild(frag);tmpRange.insertNode(p);current = p;}current = domUtils.getNextDomNode(current,false,filterFn);}else {current = domUtils.getNextDomNode(current,true,filterFn);}}return range.moveToBookmark(bookmark2).moveToBookmark(bookmark);}; /**\r\n     * 文字输入方向\r\n     * @command directionality\r\n     * @method execCommand\r\n     * @param { String } cmdName 命令字符串\r\n     * @param { String } forward 传入'ltr'表示从左向右输入，传入'rtl'表示从右向左输入\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'directionality', 'ltr');\r\n     * ```\r\n     */ /**\r\n     * 查询当前选区的文字输入方向\r\n     * @command directionality\r\n     * @method queryCommandValue\r\n     * @param { String } cmdName 命令字符串\r\n     * @return { String } 返回'ltr'表示从左向右输入，返回'rtl'表示从右向左输入\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'directionality');\r\n     * ```\r\n     */UE.commands['directionality'] = {execCommand:function execCommand(cmdName,forward){var range=this.selection.getRange(); //闭合时单独处理\nif(range.collapsed){var txt=this.document.createTextNode('d');range.insertNode(txt);}doDirectionality(range,this,forward);if(txt){range.setStartBefore(txt).collapse(true);domUtils.remove(txt);}range.select();return true;},queryCommandValue:function queryCommandValue(){var node=getObj(this);return node?node.getAttribute('dir'):'ltr';}};})(); // plugins/horizontal.js\n/**\r\n * 插入分割线插件\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 插入分割线\r\n * @command horizontal\r\n * @method execCommand\r\n * @param { String } cmdName 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'horizontal' );\r\n * ```\r\n */UE.plugins['horizontal'] = function(){var me=this;me.commands['horizontal'] = {execCommand:function execCommand(cmdName){var me=this;if(me.queryCommandState(cmdName) !== -1){me.execCommand('insertHtml','<hr>');var range=me.selection.getRange(),start=range.startContainer;if(start.nodeType == 1 && !start.childNodes[range.startOffset]){var tmp;if(tmp = start.childNodes[range.startOffset - 1]){if(tmp.nodeType == 1 && tmp.tagName == 'HR'){if(me.options.enterTag == 'p'){tmp = me.document.createElement('p');range.insertNode(tmp);range.setStart(tmp,0).setCursor();}else {tmp = me.document.createElement('br');range.insertNode(tmp);range.setStartBefore(tmp).setCursor();}}}}return true;}}, //边界在table里不能加分隔线\nqueryCommandState:function queryCommandState(){return domUtils.filterNodeList(this.selection.getStartElementPath(),'table')?-1:0;}}; //    me.addListener('delkeyup',function(){\n//        var rng = this.selection.getRange();\n//        if(browser.ie && browser.version > 8){\n//            rng.txtToElmBoundary(true);\n//            if(domUtils.isStartInblock(rng)){\n//                var tmpNode = rng.startContainer;\n//                var pre = tmpNode.previousSibling;\n//                if(pre && domUtils.isTagNode(pre,'hr')){\n//                    domUtils.remove(pre);\n//                    rng.select();\n//                    return;\n//                }\n//            }\n//        }\n//        if(domUtils.isBody(rng.startContainer)){\n//            var hr = rng.startContainer.childNodes[rng.startOffset -1];\n//            if(hr && hr.nodeName == 'HR'){\n//                var next = hr.nextSibling;\n//                if(next){\n//                    rng.setStart(next,0)\n//                }else if(hr.previousSibling){\n//                    rng.setStartAtLast(hr.previousSibling)\n//                }else{\n//                    var p = this.document.createElement('p');\n//                    hr.parentNode.insertBefore(p,hr);\n//                    domUtils.fillNode(this.document,p);\n//                    rng.setStart(p,0);\n//                }\n//                domUtils.remove(hr);\n//                rng.setCursor(false,true);\n//            }\n//        }\n//    })\nme.addListener('delkeydown',function(name,evt){var rng=this.selection.getRange();rng.txtToElmBoundary(true);if(domUtils.isStartInblock(rng)){var tmpNode=rng.startContainer;var pre=tmpNode.previousSibling;if(pre && domUtils.isTagNode(pre,'hr')){domUtils.remove(pre);rng.select();domUtils.preventDefault(evt);return true;}}});}; // plugins/time.js\n/**\r\n * 插入时间和日期\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 插入时间，默认格式：12:59:59\r\n * @command time\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'time');\r\n * ```\r\n */ /**\r\n * 插入日期，默认格式：2013-08-30\r\n * @command date\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'date');\r\n * ```\r\n */UE.commands['time'] = UE.commands[\"date\"] = {execCommand:function execCommand(cmd,format){var date=new Date();function formatTime(date,format){var hh=('0' + date.getHours()).slice(-2),ii=('0' + date.getMinutes()).slice(-2),ss=('0' + date.getSeconds()).slice(-2);format = format || 'hh:ii:ss';return format.replace(/hh/ig,hh).replace(/ii/ig,ii).replace(/ss/ig,ss);}function formatDate(date,format){var yyyy=('000' + date.getFullYear()).slice(-4),yy=yyyy.slice(-2),mm=('0' + (date.getMonth() + 1)).slice(-2),dd=('0' + date.getDate()).slice(-2);format = format || 'yyyy-mm-dd';return format.replace(/yyyy/ig,yyyy).replace(/yy/ig,yy).replace(/mm/ig,mm).replace(/dd/ig,dd);}this.execCommand('insertHtml',cmd == \"time\"?formatTime(date,format):formatDate(date,format));}}; // plugins/rowspacing.js\n/**\r\n * 段前段后间距插件\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 设置段间距\r\n * @command rowspacing\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @param { String } value 段间距的值，以px为单位\r\n * @param { String } dir 间距位置，top或bottom，分别表示段前和段后\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'rowspacing', '10', 'top' );\r\n * ```\r\n */UE.plugins['rowspacing'] = function(){var me=this;me.setOpt({'rowspacingtop':['5','10','15','20','25'],'rowspacingbottom':['5','10','15','20','25']});me.commands['rowspacing'] = {execCommand:function execCommand(cmdName,value,dir){this.execCommand('paragraph','p',{style:'margin-' + dir + ':' + value + 'px'});return true;},queryCommandValue:function queryCommandValue(cmdName,dir){var pN=domUtils.filterNodeList(this.selection.getStartElementPath(),function(node){return domUtils.isBlockElm(node);}),value; //trace:1026\nif(pN){value = domUtils.getComputedStyle(pN,'margin-' + dir).replace(/[^\\d]/g,'');return !value?0:value;}return 0;}};}; // plugins/lineheight.js\n/**\r\n * 设置行内间距\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['lineheight'] = function(){var me=this;me.setOpt({'lineheight':['1','1.5','1.75','2','3','4','5']}); /**\r\n     * 行距\r\n     * @command lineheight\r\n     * @method execCommand\r\n     * @param { String } cmdName 命令字符串\r\n     * @param { String } value 传入的行高值， 该值是当前字体的倍数， 例如： 1.5, 1.75\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'lineheight', 1.5);\r\n     * ```\r\n     */ /**\r\n     * 查询当前选区内容的行高大小\r\n     * @command lineheight\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回当前行高大小\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'lineheight' );\r\n     * ```\r\n     */me.commands['lineheight'] = {execCommand:function execCommand(cmdName,value){this.execCommand('paragraph','p',{style:'line-height:' + (value == \"1\"?\"normal\":value + 'em')});return true;},queryCommandValue:function queryCommandValue(){var pN=domUtils.filterNodeList(this.selection.getStartElementPath(),function(node){return domUtils.isBlockElm(node);});if(pN){var value=domUtils.getComputedStyle(pN,'line-height');return value == 'normal'?1:value.replace(/[^\\d.]*/ig,\"\");}}};}; // plugins/insertcode.js\n/**\r\n * 插入代码插件\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['insertcode'] = function(){var me=this;me.ready(function(){utils.cssRule('pre','pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}',me.document);});me.setOpt('insertcode',{'as3':'ActionScript3','bash':'Bash/Shell','cpp':'C/C++','css':'Css','cf':'CodeFunction','c#':'C#','delphi':'Delphi','diff':'Diff','erlang':'Erlang','groovy':'Groovy','html':'Html','java':'Java','jfx':'JavaFx','js':'Javascript','pl':'Perl','php':'Php','plain':'Plain Text','ps':'PowerShell','python':'Python','ruby':'Ruby','scala':'Scala','sql':'Sql','vb':'Vb','xml':'Xml'}); /**\r\n     * 插入代码\r\n     * @command insertcode\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { String } lang 插入代码的语言\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'insertcode', 'javascript' );\r\n     * ```\r\n     */ /**\r\n     * 如果选区所在位置是插入插入代码区域，返回代码的语言\r\n     * @command insertcode\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回代码的语言\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'insertcode' );\r\n     * ```\r\n     */me.commands['insertcode'] = {execCommand:function execCommand(cmd,lang){var me=this,rng=me.selection.getRange(),pre=domUtils.findParentByTagName(rng.startContainer,'pre',true);if(pre){pre.className = 'brush:' + lang + ';toolbar:false;';}else {var code='';if(rng.collapsed){code = browser.ie && browser.ie11below?browser.version <= 8?'&nbsp;':'':'<br/>';}else {var frag=rng.extractContents();var div=me.document.createElement('div');div.appendChild(frag);utils.each(UE.filterNode(UE.htmlparser(div.innerHTML.replace(/[\\r\\t]/g,'')),me.options.filterTxtRules).children,function(node){if(browser.ie && browser.ie11below && browser.version > 8){if(node.type == 'element'){if(node.tagName == 'br'){code += '\\n';}else if(!dtd.$empty[node.tagName]){utils.each(node.children,function(cn){if(cn.type == 'element'){if(cn.tagName == 'br'){code += '\\n';}else if(!dtd.$empty[node.tagName]){code += cn.innerText();}}else {code += cn.data;}});if(!/\\n$/.test(code)){code += '\\n';}}}else {code += node.data + '\\n';}if(!node.nextSibling() && /\\n$/.test(code)){code = code.replace(/\\n$/,'');}}else {if(browser.ie && browser.ie11below){if(node.type == 'element'){if(node.tagName == 'br'){code += '<br>';}else if(!dtd.$empty[node.tagName]){utils.each(node.children,function(cn){if(cn.type == 'element'){if(cn.tagName == 'br'){code += '<br>';}else if(!dtd.$empty[node.tagName]){code += cn.innerText();}}else {code += cn.data;}});if(!/br>$/.test(code)){code += '<br>';}}}else {code += node.data + '<br>';}if(!node.nextSibling() && /<br>$/.test(code)){code = code.replace(/<br>$/,'');}}else {code += node.type == 'element'?dtd.$empty[node.tagName]?'':node.innerText():node.data;if(!/br\\/?\\s*>$/.test(code)){if(!node.nextSibling())return;code += '<br>';}}}});}me.execCommand('inserthtml','<pre id=\"coder\"class=\"brush:' + lang + ';toolbar:false\">' + code + '</pre>',true);pre = me.document.getElementById('coder');domUtils.removeAttributes(pre,'id');var tmpNode=pre.previousSibling;if(tmpNode && (tmpNode.nodeType == 3 && tmpNode.nodeValue.length == 1 && browser.ie && browser.version == 6 || domUtils.isEmptyBlock(tmpNode))){domUtils.remove(tmpNode);}var rng=me.selection.getRange();if(domUtils.isEmptyBlock(pre)){rng.setStart(pre,0).setCursor(false,true);}else {rng.selectNodeContents(pre).select();}}},queryCommandValue:function queryCommandValue(){var path=this.selection.getStartElementPath();var lang='';utils.each(path,function(node){if(node.nodeName == 'PRE'){var match=node.className.match(/brush:([^;]+)/);lang = match && match[1]?match[1]:'';return false;}});return lang;}};me.addInputRule(function(root){utils.each(root.getNodesByTagName('pre'),function(pre){var brs=pre.getNodesByTagName('br');if(brs.length){browser.ie && browser.ie11below && browser.version > 8 && utils.each(brs,function(br){var txt=UE.uNode.createText('\\n');br.parentNode.insertBefore(txt,br);br.parentNode.removeChild(br);});return;}if(browser.ie && browser.ie11below && browser.version > 8)return;var code=pre.innerText().split(/\\n/);pre.innerHTML('');utils.each(code,function(c){if(c.length){pre.appendChild(UE.uNode.createText(c));}pre.appendChild(UE.uNode.createElement('br'));});});});me.addOutputRule(function(root){utils.each(root.getNodesByTagName('pre'),function(pre){var code='';utils.each(pre.children,function(n){if(n.type == 'text'){ //在ie下文本内容有可能末尾带有\\n要去掉\n//trace:3396\ncode += n.data.replace(/[ ]/g,'&nbsp;').replace(/\\n$/,'');}else {if(n.tagName == 'br'){code += '\\n';}else {code += !dtd.$empty[n.tagName]?'':n.innerText();}}});pre.innerText(code.replace(/(&nbsp;|\\n)+$/,''));});}); //不需要判断highlight的command列表\nme.notNeedCodeQuery = {help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,selectall:1}; //将queyCommamndState重置\nvar orgQuery=me.queryCommandState;me.queryCommandState = function(cmd){var me=this;if(!me.notNeedCodeQuery[cmd.toLowerCase()] && me.selection && me.queryCommandValue('insertcode')){return -1;}return UE.Editor.prototype.queryCommandState.apply(this,arguments);};me.addListener('beforeenterkeydown',function(){var rng=me.selection.getRange();var pre=domUtils.findParentByTagName(rng.startContainer,'pre',true);if(pre){me.fireEvent('saveScene');if(!rng.collapsed){rng.deleteContents();}if(!browser.ie || browser.ie9above){var tmpNode=me.document.createElement('br'),pre;rng.insertNode(tmpNode).setStartAfter(tmpNode).collapse(true);var next=tmpNode.nextSibling;if(!next && (!browser.ie || browser.version > 10)){rng.insertNode(tmpNode.cloneNode(false));}else {rng.setStartAfter(tmpNode);}pre = tmpNode.previousSibling;var tmp;while(pre) {tmp = pre;pre = pre.previousSibling;if(!pre || pre.nodeName == 'BR'){pre = tmp;break;}}if(pre){var str='';while(pre && pre.nodeName != 'BR' && new RegExp('^[\\\\s' + domUtils.fillChar + ']*$').test(pre.nodeValue)) {str += pre.nodeValue;pre = pre.nextSibling;}if(pre.nodeName != 'BR'){var match=pre.nodeValue.match(new RegExp('^([\\\\s' + domUtils.fillChar + ']+)'));if(match && match[1]){str += match[1];}}if(str){str = me.document.createTextNode(str);rng.insertNode(str).setStartAfter(str);}}rng.collapse(true).select(true);}else {if(browser.version > 8){var txt=me.document.createTextNode('\\n');var start=rng.startContainer;if(rng.startOffset == 0){var preNode=start.previousSibling;if(preNode){rng.insertNode(txt);var fillchar=me.document.createTextNode(' ');rng.setStartAfter(txt).insertNode(fillchar).setStart(fillchar,0).collapse(true).select(true);}}else {rng.insertNode(txt).setStartAfter(txt);var fillchar=me.document.createTextNode(' ');start = rng.startContainer.childNodes[rng.startOffset];if(start && !/^\\n/.test(start.nodeValue)){rng.setStartBefore(txt);}rng.insertNode(fillchar).setStart(fillchar,0).collapse(true).select(true);}}else {var tmpNode=me.document.createElement('br');rng.insertNode(tmpNode);rng.insertNode(me.document.createTextNode(domUtils.fillChar));rng.setStartAfter(tmpNode);pre = tmpNode.previousSibling;var tmp;while(pre) {tmp = pre;pre = pre.previousSibling;if(!pre || pre.nodeName == 'BR'){pre = tmp;break;}}if(pre){var str='';while(pre && pre.nodeName != 'BR' && new RegExp('^[ ' + domUtils.fillChar + ']*$').test(pre.nodeValue)) {str += pre.nodeValue;pre = pre.nextSibling;}if(pre.nodeName != 'BR'){var match=pre.nodeValue.match(new RegExp('^([ ' + domUtils.fillChar + ']+)'));if(match && match[1]){str += match[1];}}str = me.document.createTextNode(str);rng.insertNode(str).setStartAfter(str);}rng.collapse(true).select();}}me.fireEvent('saveScene');return true;}});me.addListener('tabkeydown',function(cmd,evt){var rng=me.selection.getRange();var pre=domUtils.findParentByTagName(rng.startContainer,'pre',true);if(pre){me.fireEvent('saveScene');if(evt.shiftKey){}else {if(!rng.collapsed){var bk=rng.createBookmark();var start=bk.start.previousSibling;while(start) {if(pre.firstChild === start && !domUtils.isBr(start)){pre.insertBefore(me.document.createTextNode('    '),start);break;}if(domUtils.isBr(start)){pre.insertBefore(me.document.createTextNode('    '),start.nextSibling);break;}start = start.previousSibling;}var end=bk.end;start = bk.start.nextSibling;if(pre.firstChild === bk.start){pre.insertBefore(me.document.createTextNode('    '),start.nextSibling);}while(start && start !== end) {if(domUtils.isBr(start) && start.nextSibling){if(start.nextSibling === end){break;}pre.insertBefore(me.document.createTextNode('    '),start.nextSibling);}start = start.nextSibling;}rng.moveToBookmark(bk).select();}else {var tmpNode=me.document.createTextNode('    ');rng.insertNode(tmpNode).setStartAfter(tmpNode).collapse(true).select(true);}}me.fireEvent('saveScene');return true;}});me.addListener('beforeinserthtml',function(evtName,html){var me=this,rng=me.selection.getRange(),pre=domUtils.findParentByTagName(rng.startContainer,'pre',true);if(pre){if(!rng.collapsed){rng.deleteContents();}var htmlstr='';if(browser.ie && browser.version > 8){utils.each(UE.filterNode(UE.htmlparser(html),me.options.filterTxtRules).children,function(node){if(node.type == 'element'){if(node.tagName == 'br'){htmlstr += '\\n';}else if(!dtd.$empty[node.tagName]){utils.each(node.children,function(cn){if(cn.type == 'element'){if(cn.tagName == 'br'){htmlstr += '\\n';}else if(!dtd.$empty[node.tagName]){htmlstr += cn.innerText();}}else {htmlstr += cn.data;}});if(!/\\n$/.test(htmlstr)){htmlstr += '\\n';}}}else {htmlstr += node.data + '\\n';}if(!node.nextSibling() && /\\n$/.test(htmlstr)){htmlstr = htmlstr.replace(/\\n$/,'');}});var tmpNode=me.document.createTextNode(utils.html(htmlstr.replace(/&nbsp;/g,' ')));rng.insertNode(tmpNode).selectNode(tmpNode).select();}else {var frag=me.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(html),me.options.filterTxtRules).children,function(node){if(node.type == 'element'){if(node.tagName == 'br'){frag.appendChild(me.document.createElement('br'));}else if(!dtd.$empty[node.tagName]){utils.each(node.children,function(cn){if(cn.type == 'element'){if(cn.tagName == 'br'){frag.appendChild(me.document.createElement('br'));}else if(!dtd.$empty[node.tagName]){frag.appendChild(me.document.createTextNode(utils.html(cn.innerText().replace(/&nbsp;/g,' '))));}}else {frag.appendChild(me.document.createTextNode(utils.html(cn.data.replace(/&nbsp;/g,' '))));}});if(frag.lastChild.nodeName != 'BR'){frag.appendChild(me.document.createElement('br'));}}}else {frag.appendChild(me.document.createTextNode(utils.html(node.data.replace(/&nbsp;/g,' '))));}if(!node.nextSibling() && frag.lastChild.nodeName == 'BR'){frag.removeChild(frag.lastChild);}});rng.insertNode(frag).select();}return true;}}); //方向键的处理\nme.addListener('keydown',function(cmd,evt){var me=this,keyCode=evt.keyCode || evt.which;if(keyCode == 40){var rng=me.selection.getRange(),pre,start=rng.startContainer;if(rng.collapsed && (pre = domUtils.findParentByTagName(rng.startContainer,'pre',true)) && !pre.nextSibling){var last=pre.lastChild;while(last && last.nodeName == 'BR') {last = last.previousSibling;}if(last === start || rng.startContainer === pre && rng.startOffset == pre.childNodes.length){me.execCommand('insertparagraph');domUtils.preventDefault(evt);}}}}); //trace:3395\nme.addListener('delkeydown',function(type,evt){var rng=this.selection.getRange();rng.txtToElmBoundary(true);var start=rng.startContainer;if(domUtils.isTagNode(start,'pre') && rng.collapsed && domUtils.isStartInblock(rng)){var p=me.document.createElement('p');domUtils.fillNode(me.document,p);start.parentNode.insertBefore(p,start);domUtils.remove(start);rng.setStart(p,0).setCursor(false,true);domUtils.preventDefault(evt);return true;}});}; // plugins/cleardoc.js\n/**\r\n * 清空文档插件\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 清空文档\r\n * @command cleardoc\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * //editor 是编辑器实例\r\n * editor.execCommand('cleardoc');\r\n * ```\r\n */UE.commands['cleardoc'] = {execCommand:function execCommand(cmdName){var me=this,enterTag=me.options.enterTag,range=me.selection.getRange();if(enterTag == \"br\"){me.body.innerHTML = \"<br/>\";range.setStart(me.body,0).setCursor();}else {me.body.innerHTML = \"<p>\" + (ie?\"\":\"<br/>\") + \"</p>\";range.setStart(me.body.firstChild,0).setCursor(false,true);}setTimeout(function(){me.fireEvent(\"clearDoc\");},0);}}; // plugins/anchor.js\n/**\r\n * 锚点插件，为UEditor提供插入锚点支持\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugin.register('anchor',function(){return {bindEvents:{'ready':function ready(){utils.cssRule('anchor','.anchorclass{background: url(\\'' + this.options.themePath + this.options.theme + '/images/anchor.gif\\') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}',this.document);}},outputRule:function outputRule(root){utils.each(root.getNodesByTagName('img'),function(a){var val;if(val = a.getAttr('anchorname')){a.tagName = 'a';a.setAttr({anchorname:'',name:val,'class':''});}});},inputRule:function inputRule(root){utils.each(root.getNodesByTagName('a'),function(a){var val;if((val = a.getAttr('name')) && !a.getAttr('href')){a.tagName = 'img';a.setAttr({anchorname:a.getAttr('name'),'class':'anchorclass'});a.setAttr('name');}});},commands:{ /**\r\n            * 插入锚点\r\n            * @command anchor\r\n            * @method execCommand\r\n            * @param { String } cmd 命令字符串\r\n            * @param { String } name 锚点名称字符串\r\n            * @example\r\n            * ```javascript\r\n            * //editor 是编辑器实例\r\n            * editor.execCommand('anchor', 'anchor1');\r\n            * ```\r\n            */'anchor':{execCommand:function execCommand(cmd,name){var range=this.selection.getRange(),img=range.getClosedNode();if(img && img.getAttribute('anchorname')){if(name){img.setAttribute('anchorname',name);}else {range.setStartBefore(img).setCursor();domUtils.remove(img);}}else {if(name){ //只在选区的开始插入\nvar anchor=this.document.createElement('img');range.collapse(true);domUtils.setAttributes(anchor,{'anchorname':name,'class':'anchorclass'});range.insertNode(anchor).setStartAfter(anchor).setCursor(false,true);}}}}}};}); // plugins/wordcount.js\n///import core\n///commands 字数统计\n///commandsName  WordCount,wordCount\n///commandsTitle  字数统计\n/*\r\n * Created by JetBrains WebStorm.\r\n * User: taoqili\r\n * Date: 11-9-7\r\n * Time: 下午8:18\r\n * To change this template use File | Settings | File Templates.\r\n */UE.plugins['wordcount'] = function(){var me=this;me.setOpt('wordCount',true);me.addListener('contentchange',function(){me.fireEvent('wordcount');});var timer;me.addListener('ready',function(){var me=this;domUtils.on(me.body,\"keyup\",function(evt){var code=evt.keyCode || evt.which, //忽略的按键,ctr,alt,shift,方向键\nignores={\"16\":1,\"18\":1,\"20\":1,\"37\":1,\"38\":1,\"39\":1,\"40\":1};if(code in ignores)return;clearTimeout(timer);timer = setTimeout(function(){me.fireEvent('wordcount');},200);});});}; // plugins/pagebreak.js\n/**\r\n * 分页功能插件\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['pagebreak'] = function(){var me=this,notBreakTags=['td'];me.setOpt('pageBreakTag','_ueditor_page_break_tag_');function fillNode(node){if(domUtils.isEmptyBlock(node)){var firstChild=node.firstChild,tmpNode;while(firstChild && firstChild.nodeType == 1 && domUtils.isEmptyBlock(firstChild)) {tmpNode = firstChild;firstChild = firstChild.firstChild;}!tmpNode && (tmpNode = node);domUtils.fillNode(me.document,tmpNode);}} //分页符样式添加\nme.ready(function(){utils.cssRule('pagebreak','.pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}',me.document);});function isHr(node){return node && node.nodeType == 1 && node.tagName == 'HR' && node.className == 'pagebreak';}me.addInputRule(function(root){root.traversal(function(node){if(node.type == 'text' && node.data == me.options.pageBreakTag){var hr=UE.uNode.createElement('<hr class=\"pagebreak\" noshade=\"noshade\" size=\"5\" style=\"-webkit-user-select: none;\">');node.parentNode.insertBefore(hr,node);node.parentNode.removeChild(node);}});});me.addOutputRule(function(node){utils.each(node.getNodesByTagName('hr'),function(n){if(n.getAttr('class') == 'pagebreak'){var txt=UE.uNode.createText(me.options.pageBreakTag);n.parentNode.insertBefore(txt,n);n.parentNode.removeChild(n);}});}); /**\r\n     * 插入分页符\r\n     * @command pagebreak\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @remind 在表格中插入分页符会把表格切分成两部分\r\n     * @remind 获取编辑器内的数据时， 编辑器会把分页符转换成“_ueditor_page_break_tag_”字符串，\r\n     *          以便于提交数据到服务器端后处理分页。\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'pagebreak'); //插入一个hr标签，带有样式类名pagebreak\r\n     * ```\r\n     */me.commands['pagebreak'] = {execCommand:function execCommand(){var range=me.selection.getRange(),hr=me.document.createElement('hr');domUtils.setAttributes(hr,{'class':'pagebreak',noshade:\"noshade\",size:\"5\"});domUtils.unSelectable(hr); //table单独处理\nvar node=domUtils.findParentByTagName(range.startContainer,notBreakTags,true),parents=[],pN;if(node){switch(node.tagName){case 'TD':pN = node.parentNode;if(!pN.previousSibling){var table=domUtils.findParentByTagName(pN,'table'); //                            var tableWrapDiv = table.parentNode;\n//                            if(tableWrapDiv && tableWrapDiv.nodeType == 1\n//                                && tableWrapDiv.tagName == 'DIV'\n//                                && tableWrapDiv.getAttribute('dropdrag')\n//                                ){\n//                                domUtils.remove(tableWrapDiv,true);\n//                            }\ntable.parentNode.insertBefore(hr,table);parents = domUtils.findParents(hr,true);}else {pN.parentNode.insertBefore(hr,pN);parents = domUtils.findParents(hr);}pN = parents[1];if(hr !== pN){domUtils.breakParent(hr,pN);} //table要重写绑定一下拖拽\nme.fireEvent('afteradjusttable',me.document);}}else {if(!range.collapsed){range.deleteContents();var start=range.startContainer;while(!domUtils.isBody(start) && domUtils.isBlockElm(start) && domUtils.isEmptyNode(start)) {range.setStartBefore(start).collapse(true);domUtils.remove(start);start = range.startContainer;}}range.insertNode(hr);var pN=hr.parentNode,nextNode;while(!domUtils.isBody(pN)) {domUtils.breakParent(hr,pN);nextNode = hr.nextSibling;if(nextNode && domUtils.isEmptyBlock(nextNode)){domUtils.remove(nextNode);}pN = hr.parentNode;}nextNode = hr.nextSibling;var pre=hr.previousSibling;if(isHr(pre)){domUtils.remove(pre);}else {pre && fillNode(pre);}if(!nextNode){var p=me.document.createElement('p');hr.parentNode.appendChild(p);domUtils.fillNode(me.document,p);range.setStart(p,0).collapse(true);}else {if(isHr(nextNode)){domUtils.remove(nextNode);}else {fillNode(nextNode);}range.setEndAfter(hr).collapse(false);}range.select(true);}}};}; // plugins/wordimage.js\n///import core\n///commands 本地图片引导上传\n///commandsName  WordImage\n///commandsTitle  本地图片引导上传\n///commandsDialog  dialogs\\wordimage\nUE.plugin.register('wordimage',function(){var me=this,images=[];return {commands:{'wordimage':{execCommand:function execCommand(){var images=domUtils.getElementsByTagName(me.body,\"img\");var urlList=[];for(var i=0,ci;ci = images[i++];) {var url=ci.getAttribute(\"word_img\");url && urlList.push(url);}return urlList;},queryCommandState:function queryCommandState(){images = domUtils.getElementsByTagName(me.body,\"img\");for(var i=0,ci;ci = images[i++];) {if(ci.getAttribute(\"word_img\")){return 1;}}return -1;},notNeedUndo:true}},inputRule:function inputRule(root){utils.each(root.getNodesByTagName('img'),function(img){var attrs=img.attrs,flag=parseInt(attrs.width) < 128 || parseInt(attrs.height) < 43,opt=me.options,src=opt.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif';if(attrs['src'] && /^(?:(file:\\/+))/.test(attrs['src'])){img.setAttr({width:attrs.width,height:attrs.height,alt:attrs.alt,word_img:attrs.src,src:src,'style':'background:url(' + (flag?opt.themePath + opt.theme + '/images/word.gif':opt.langPath + opt.lang + '/images/localimage.png') + ') no-repeat center center;border:1px solid #ddd'});}});}};}); // plugins/dragdrop.js\nUE.plugins['dragdrop'] = function(){var me=this;me.ready(function(){domUtils.on(this.body,'dragend',function(){var rng=me.selection.getRange();var node=rng.getClosedNode() || me.selection.getStart();if(node && node.tagName == 'IMG'){var pre=node.previousSibling,next;while(next = node.nextSibling) {if(next.nodeType == 1 && next.tagName == 'SPAN' && !next.firstChild){domUtils.remove(next);}else {break;}}if((pre && pre.nodeType == 1 && !domUtils.isEmptyBlock(pre) || !pre) && (!next || next && !domUtils.isEmptyBlock(next))){if(pre && pre.tagName == 'P' && !domUtils.isEmptyBlock(pre)){pre.appendChild(node);domUtils.moveChild(next,pre);domUtils.remove(next);}else if(next && next.tagName == 'P' && !domUtils.isEmptyBlock(next)){next.insertBefore(node,next.firstChild);}if(pre && pre.tagName == 'P' && domUtils.isEmptyBlock(pre)){domUtils.remove(pre);}if(next && next.tagName == 'P' && domUtils.isEmptyBlock(next)){domUtils.remove(next);}rng.selectNode(node).select();me.fireEvent('saveScene');}}});});me.addListener('keyup',function(type,evt){var keyCode=evt.keyCode || evt.which;if(keyCode == 13){var rng=me.selection.getRange(),node;if(node = domUtils.findParentByTagName(rng.startContainer,'p',true)){if(domUtils.getComputedStyle(node,'text-align') == 'center'){domUtils.removeStyle(node,'text-align');}}}});}; // plugins/undo.js\n/**\r\n * undo redo\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 撤销上一次执行的命令\r\n * @command undo\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'undo' );\r\n * ```\r\n */ /**\r\n * 重做上一次执行的命令\r\n * @command redo\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'redo' );\r\n * ```\r\n */UE.plugins['undo'] = function(){var saveSceneTimer;var me=this,maxUndoCount=me.options.maxUndoCount || 20,maxInputCount=me.options.maxInputCount || 20,fillchar=new RegExp(domUtils.fillChar + '|<\\/hr>','gi'); // ie会产生多余的</hr>\nvar noNeedFillCharTags={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var orgState=me.options.autoClearEmptyNode;function compareAddr(indexA,indexB){if(indexA.length != indexB.length)return 0;for(var i=0,l=indexA.length;i < l;i++) {if(indexA[i] != indexB[i])return 0;}return 1;}function compareRangeAddress(rngAddrA,rngAddrB){if(rngAddrA.collapsed != rngAddrB.collapsed){return 0;}if(!compareAddr(rngAddrA.startAddress,rngAddrB.startAddress) || !compareAddr(rngAddrA.endAddress,rngAddrB.endAddress)){return 0;}return 1;}function UndoManager(){this.list = [];this.index = 0;this.hasUndo = false;this.hasRedo = false;this.undo = function(){if(this.hasUndo){if(!this.list[this.index - 1] && this.list.length == 1){this.reset();return;}while(this.list[this.index].content == this.list[this.index - 1].content) {this.index--;if(this.index == 0){return this.restore(0);}}this.restore(--this.index);}};this.redo = function(){if(this.hasRedo){while(this.list[this.index].content == this.list[this.index + 1].content) {this.index++;if(this.index == this.list.length - 1){return this.restore(this.index);}}this.restore(++this.index);}};this.restore = function(){var me=this.editor;var scene=this.list[this.index];var root=UE.htmlparser(scene.content.replace(fillchar,''));me.options.autoClearEmptyNode = false;me.filterInputRule(root);me.options.autoClearEmptyNode = orgState; //trace:873\n//去掉展位符\nme.document.body.innerHTML = root.toHtml();me.fireEvent('afterscencerestore'); //处理undo后空格不展位的问题\nif(browser.ie){utils.each(domUtils.getElementsByTagName(me.document,'td th caption p'),function(node){if(domUtils.isEmptyNode(node)){domUtils.fillNode(me.document,node);}});}try{var rng=new dom.Range(me.document).moveToAddress(scene.address);rng.select(noNeedFillCharTags[rng.startContainer.nodeName.toLowerCase()]);}catch(e) {}this.update();this.clearKey(); //不能把自己reset了\nme.fireEvent('reset',true);};this.getScene = function(){var me=this.editor;var rng=me.selection.getRange(),rngAddress=rng.createAddress(false,true);me.fireEvent('beforegetscene');var root=UE.htmlparser(me.body.innerHTML);me.options.autoClearEmptyNode = false;me.filterOutputRule(root);me.options.autoClearEmptyNode = orgState;var cont=root.toHtml(); //trace:3461\n//这个会引起回退时导致空格丢失的情况\n//            browser.ie && (cont = cont.replace(/>&nbsp;</g, '><').replace(/\\s*</g, '<').replace(/>\\s*/g, '>'));\nme.fireEvent('aftergetscene');return {address:rngAddress,content:cont};};this.save = function(notCompareRange,notSetCursor){clearTimeout(saveSceneTimer);var currentScene=this.getScene(notSetCursor),lastScene=this.list[this.index];if(lastScene && lastScene.content != currentScene.content){me.trigger('contentchange');} //内容相同位置相同不存\nif(lastScene && lastScene.content == currentScene.content && (notCompareRange?1:compareRangeAddress(lastScene.address,currentScene.address))){return;}this.list = this.list.slice(0,this.index + 1);this.list.push(currentScene); //如果大于最大数量了，就把最前的剔除\nif(this.list.length > maxUndoCount){this.list.shift();}this.index = this.list.length - 1;this.clearKey(); //跟新undo/redo状态\nthis.update();};this.update = function(){this.hasRedo = !!this.list[this.index + 1];this.hasUndo = !!this.list[this.index - 1];};this.reset = function(){this.list = [];this.index = 0;this.hasUndo = false;this.hasRedo = false;this.clearKey();};this.clearKey = function(){keycont = 0;lastKeyCode = null;};}me.undoManger = new UndoManager();me.undoManger.editor = me;function saveScene(){this.undoManger.save();}me.addListener('saveScene',function(){var args=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,args);}); //    me.addListener('beforeexeccommand', saveScene);\n//    me.addListener('afterexeccommand', saveScene);\nme.addListener('reset',function(type,exclude){if(!exclude){this.undoManger.reset();}});me.commands['redo'] = me.commands['undo'] = {execCommand:function execCommand(cmdName){this.undoManger[cmdName]();},queryCommandState:function queryCommandState(cmdName){return this.undoManger['has' + (cmdName.toLowerCase() == 'undo'?'Undo':'Redo')]?0:-1;},notNeedUndo:1};var keys={ //  /*Backspace*/ 8:1, /*Delete*/ 46:1,\n/*Shift*/16:1, /*Ctrl*/17:1, /*Alt*/18:1,37:1,38:1,39:1,40:1},keycont=0,lastKeyCode; //输入法状态下不计算字符数\nvar inputType=false;me.addListener('ready',function(){domUtils.on(this.body,'compositionstart',function(){inputType = true;});domUtils.on(this.body,'compositionend',function(){inputType = false;});}); //快捷键\nme.addshortcutkey({\"Undo\":\"ctrl+90\", //undo\n\"Redo\":\"ctrl+89\" //redo\n});var isCollapsed=true;me.addListener('keydown',function(type,evt){var me=this;var keyCode=evt.keyCode || evt.which;if(!keys[keyCode] && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey){var _ret2=(function(){var save=function save(cont){cont.undoManger.save(false,true);cont.fireEvent('selectionchange');};if(inputType)return {v:undefined};if(!me.selection.getRange().collapsed){me.undoManger.save(false,true);isCollapsed = false;return {v:undefined};}if(me.undoManger.list.length == 0){me.undoManger.save(true);}clearTimeout(saveSceneTimer);saveSceneTimer = setTimeout(function(){if(inputType){var interalTimer=setInterval(function(){if(!inputType){save(me);clearInterval(interalTimer);}},300);return;}save(me);},200);lastKeyCode = keyCode;keycont++;if(keycont >= maxInputCount){save(me);}})();if(typeof _ret2 === 'object')return _ret2.v;}});me.addListener('keyup',function(type,evt){var keyCode=evt.keyCode || evt.which;if(!keys[keyCode] && !evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey){if(inputType)return;if(!isCollapsed){this.undoManger.save(false,true);isCollapsed = true;}}}); //扩展实例，添加关闭和开启命令undo\nme.stopCmdUndo = function(){me.__hasEnterExecCommand = true;};me.startCmdUndo = function(){me.__hasEnterExecCommand = false;};}; // plugins/copy.js\nUE.plugin.register('copy',function(){var me=this;function initZeroClipboard(){ZeroClipboard.config({debug:false,swfPath:me.options.UEDITOR_HOME_URL + 'third-party/zeroclipboard/ZeroClipboard.swf'});var client=me.zeroclipboard = new ZeroClipboard(); // 复制内容\nclient.on('copy',function(e){var client=e.client,rng=me.selection.getRange(),div=document.createElement('div');div.appendChild(rng.cloneContents());client.setText(div.innerText || div.textContent);client.setHtml(div.innerHTML);rng.select();}); // hover事件传递到target\nclient.on('mouseover mouseout',function(e){var target=e.target;if(e.type == 'mouseover'){domUtils.addClass(target,'edui-state-hover');}else if(e.type == 'mouseout'){domUtils.removeClasses(target,'edui-state-hover');}}); // flash加载不成功\nclient.on('wrongflash noflash',function(){ZeroClipboard.destroy();});}return {bindEvents:{'ready':function ready(){if(!browser.ie){if(window.ZeroClipboard){initZeroClipboard();}else {utils.loadFile(document,{src:me.options.UEDITOR_HOME_URL + \"third-party/zeroclipboard/ZeroClipboard.js\",tag:\"script\",type:\"text/javascript\",defer:\"defer\"},function(){initZeroClipboard();});}}}},commands:{'copy':{execCommand:function execCommand(cmd){if(!me.document.execCommand('copy')){alert(me.getLang('copymsg'));}}}}};}); // plugins/paste.js\n///import core\n///import plugins/inserthtml.js\n///import plugins/undo.js\n///import plugins/serialize.js\n///commands 粘贴\n///commandsName  PastePlain\n///commandsTitle  纯文本粘贴模式\n/**\r\n * @description 粘贴\r\n * @author zhanyi\r\n */UE.plugins['paste'] = function(){function getClipboardData(callback){var doc=this.document;if(doc.getElementById('baidu_pastebin')){return;}var range=this.selection.getRange(),bk=range.createBookmark(), //创建剪贴的容器div\npastebin=doc.createElement('div');pastebin.id = 'baidu_pastebin'; // Safari 要求div必须有内容，才能粘贴内容进来\nbrowser.webkit && pastebin.appendChild(doc.createTextNode(domUtils.fillChar + domUtils.fillChar));doc.body.appendChild(pastebin); //trace:717 隐藏的span不能得到top\n//bk.start.innerHTML = '&nbsp;';\nbk.start.style.display = '';pastebin.style.cssText = \"position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:\" +  //要在现在光标平行的位置加入，否则会出现跳动的问题\ndomUtils.getXY(bk.start).y + 'px';range.selectNodeContents(pastebin).select(true);setTimeout(function(){if(browser.webkit){for(var i=0,pastebins=doc.querySelectorAll('#baidu_pastebin'),pi;pi = pastebins[i++];) {if(domUtils.isEmptyNode(pi)){domUtils.remove(pi);}else {pastebin = pi;break;}}}try{pastebin.parentNode.removeChild(pastebin);}catch(e) {}range.moveToBookmark(bk).select(true);callback(pastebin);},0);}var me=this;me.setOpt({retainOnlyLabelPasted:false});var txtContent,htmlContent,address;function getPureHtml(html){return html.replace(/<(\\/?)([\\w\\-]+)([^>]*)>/gi,function(a,b,tagName,attrs){tagName = tagName.toLowerCase();if(({img:1})[tagName]){return a;}attrs = attrs.replace(/([\\w\\-]*?)\\s*=\\s*((\"([^\"]*)\")|('([^']*)')|([^\\s>]+))/gi,function(str,atr,val){if(({'src':1,'href':1,'name':1})[atr.toLowerCase()]){return atr + '=' + val + ' ';}return '';});if(({'span':1,'div':1})[tagName]){return '';}else {return '<' + b + tagName + ' ' + utils.trim(attrs) + '>';}});}function filter(div){var html;if(div.firstChild){ //去掉cut中添加的边界值\nvar nodes=domUtils.getElementsByTagName(div,'span');for(var i=0,ni;ni = nodes[i++];) {if(ni.id == '_baidu_cut_start' || ni.id == '_baidu_cut_end'){domUtils.remove(ni);}}if(browser.webkit){var brs=div.querySelectorAll('div br');for(var i=0,bi;bi = brs[i++];) {var pN=bi.parentNode;if(pN.tagName == 'DIV' && pN.childNodes.length == 1){pN.innerHTML = '<p><br/></p>';domUtils.remove(pN);}}var divs=div.querySelectorAll('#baidu_pastebin');for(var i=0,di;di = divs[i++];) {var tmpP=me.document.createElement('p');di.parentNode.insertBefore(tmpP,di);while(di.firstChild) {tmpP.appendChild(di.firstChild);}domUtils.remove(di);}var metas=div.querySelectorAll('meta');for(var i=0,ci;ci = metas[i++];) {domUtils.remove(ci);}var brs=div.querySelectorAll('br');for(i = 0;ci = brs[i++];) {if(/^apple-/i.test(ci.className)){domUtils.remove(ci);}}}if(browser.gecko){var dirtyNodes=div.querySelectorAll('[_moz_dirty]');for(i = 0;ci = dirtyNodes[i++];) {ci.removeAttribute('_moz_dirty');}}if(!browser.ie){var spans=div.querySelectorAll('span.Apple-style-span');for(var i=0,ci;ci = spans[i++];) {domUtils.remove(ci,true);}} //ie下使用innerHTML会产生多余的\\r\\n字符，也会产生&nbsp;这里过滤掉\nhtml = div.innerHTML; //.replace(/>(?:(\\s|&nbsp;)*?)</g,'><');\n//过滤word粘贴过来的冗余属性\nhtml = UE.filterWord(html); //取消了忽略空白的第二个参数，粘贴过来的有些是有空白的，会被套上相关的标签\nvar root=UE.htmlparser(html); //如果给了过滤规则就先进行过滤\nif(me.options.filterRules){UE.filterNode(root,me.options.filterRules);} //执行默认的处理\nme.filterInputRule(root); //针对chrome的处理\nif(browser.webkit){var br=root.lastChild();if(br && br.type == 'element' && br.tagName == 'br'){root.removeChild(br);}utils.each(me.body.querySelectorAll('div'),function(node){if(domUtils.isEmptyBlock(node)){domUtils.remove(node,true);}});}html = {'html':root.toHtml()};me.fireEvent('beforepaste',html,root); //抢了默认的粘贴，那后边的内容就不执行了，比如表格粘贴\nif(!html.html){return;}root = UE.htmlparser(html.html,true); //如果开启了纯文本模式\nif(me.queryCommandState('pasteplain') === 1){me.execCommand('insertHtml',UE.filterNode(root,me.options.filterTxtRules).toHtml(),true);}else { //文本模式\nUE.filterNode(root,me.options.filterTxtRules);txtContent = root.toHtml(); //完全模式\nhtmlContent = html.html;address = me.selection.getRange().createAddress(true);me.execCommand('insertHtml',me.getOpt('retainOnlyLabelPasted') === true?getPureHtml(htmlContent):htmlContent,true);}me.fireEvent(\"afterpaste\",html);}}me.addListener('pasteTransfer',function(cmd,plainType){if(address && txtContent && htmlContent && txtContent != htmlContent){var range=me.selection.getRange();range.moveToAddress(address,true);if(!range.collapsed){while(!domUtils.isBody(range.startContainer)) {var start=range.startContainer;if(start.nodeType == 1){start = start.childNodes[range.startOffset];if(!start){range.setStartBefore(range.startContainer);continue;}var pre=start.previousSibling;if(pre && pre.nodeType == 3 && new RegExp('^[\\n\\r\\t ' + domUtils.fillChar + ']*$').test(pre.nodeValue)){range.setStartBefore(pre);}}if(range.startOffset == 0){range.setStartBefore(range.startContainer);}else {break;}}while(!domUtils.isBody(range.endContainer)) {var end=range.endContainer;if(end.nodeType == 1){end = end.childNodes[range.endOffset];if(!end){range.setEndAfter(range.endContainer);continue;}var next=end.nextSibling;if(next && next.nodeType == 3 && new RegExp('^[\\n\\r\\t' + domUtils.fillChar + ']*$').test(next.nodeValue)){range.setEndAfter(next);}}if(range.endOffset == range.endContainer[range.endContainer.nodeType == 3?'nodeValue':'childNodes'].length){range.setEndAfter(range.endContainer);}else {break;}}}range.deleteContents();range.select(true);me.__hasEnterExecCommand = true;var html=htmlContent;if(plainType === 2){html = getPureHtml(html);}else if(plainType){html = txtContent;}me.execCommand('inserthtml',html,true);me.__hasEnterExecCommand = false;var rng=me.selection.getRange();while(!domUtils.isBody(rng.startContainer) && !rng.startOffset && rng.startContainer[rng.startContainer.nodeType == 3?'nodeValue':'childNodes'].length) {rng.setStartBefore(rng.startContainer);}var tmpAddress=rng.createAddress(true);address.endAddress = tmpAddress.startAddress;}});me.addListener('ready',function(){domUtils.on(me.body,'cut',function(){var range=me.selection.getRange();if(!range.collapsed && me.undoManger){me.undoManger.save();}}); //ie下beforepaste在点击右键时也会触发，所以用监控键盘才处理\ndomUtils.on(me.body,browser.ie || browser.opera?'keydown':'paste',function(e){if((browser.ie || browser.opera) && (!e.ctrlKey && !e.metaKey || e.keyCode != '86')){return;}getClipboardData.call(me,function(div){filter(div);});});});me.commands['paste'] = {execCommand:function execCommand(cmd){if(browser.ie){getClipboardData.call(me,function(div){filter(div);});me.document.execCommand('paste');}else {alert(me.getLang('pastemsg'));}}};}; // plugins/puretxtpaste.js\n/**\r\n * 纯文本粘贴插件\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['pasteplain'] = function(){var me=this;me.setOpt({'pasteplain':false,'filterTxtRules':(function(){function transP(node){node.tagName = 'p';node.setStyle();}function removeNode(node){node.parentNode.removeChild(node,true);}return { //直接删除及其字节点内容\n'-':'script style object iframe embed input select','p':{$:{}},'br':{$:{}},div:function div(node){var tmpNode,p=UE.uNode.createElement('p');while(tmpNode = node.firstChild()) {if(tmpNode.type == 'text' || !UE.dom.dtd.$block[tmpNode.tagName]){p.appendChild(tmpNode);}else {if(p.firstChild()){node.parentNode.insertBefore(p,node);p = UE.uNode.createElement('p');}else {node.parentNode.insertBefore(tmpNode,node);}}}if(p.firstChild()){node.parentNode.insertBefore(p,node);}node.parentNode.removeChild(node);},ol:removeNode,ul:removeNode,dl:removeNode,dt:removeNode,dd:removeNode,'li':removeNode,'caption':transP,'th':transP,'tr':transP,'h1':transP,'h2':transP,'h3':transP,'h4':transP,'h5':transP,'h6':transP,'td':function td(node){ //没有内容的td直接删掉\nvar txt=!!node.innerText();if(txt){node.parentNode.insertAfter(UE.uNode.createText(' &nbsp; &nbsp;'),node);}node.parentNode.removeChild(node,node.innerText());}};})()}); //暂时这里支持一下老版本的属性\nvar pasteplain=me.options.pasteplain; /**\r\n     * 启用或取消纯文本粘贴模式\r\n     * @command pasteplain\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandState( 'pasteplain' );\r\n     * ```\r\n     */ /**\r\n     * 查询当前是否处于纯文本粘贴模式\r\n     * @command pasteplain\r\n     * @method queryCommandState\r\n     * @param { String } cmd 命令字符串\r\n     * @return { int } 如果处于纯文本模式，返回1，否则，返回0\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandState( 'pasteplain' );\r\n     * ```\r\n     */me.commands['pasteplain'] = {queryCommandState:function queryCommandState(){return pasteplain?1:0;},execCommand:function execCommand(){pasteplain = !pasteplain | 0;},notNeedUndo:1};}; // plugins/list.js\n/**\r\n * 有序列表,无序列表插件\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['list'] = function(){var me=this,notExchange={'TD':1,'PRE':1,'BLOCKQUOTE':1};var customStyle={'cn':'cn-1-','cn1':'cn-2-','cn2':'cn-3-','num':'num-1-','num1':'num-2-','num2':'num-3-','dash':'dash','dot':'dot'};me.setOpt({'autoTransWordToList':false,'insertorderedlist':{'num':'','num1':'','num2':'','cn':'','cn1':'','cn2':'','decimal':'','lower-alpha':'','lower-roman':'','upper-alpha':'','upper-roman':''},'insertunorderedlist':{'circle':'','disc':'','square':'','dash':'','dot':''},listDefaultPaddingLeft:'30',listiconpath:'http://bs.baidu.com/listicon/',maxListLevel:-1, //-1不限制\ndisablePInList:false});function listToArray(list){var arr=[];for(var p in list) {arr.push(p);}return arr;}var listStyle={'OL':listToArray(me.options.insertorderedlist),'UL':listToArray(me.options.insertunorderedlist)};var liiconpath=me.options.listiconpath; //根据用户配置，调整customStyle\nfor(var s in customStyle) {if(!me.options.insertorderedlist.hasOwnProperty(s) && !me.options.insertunorderedlist.hasOwnProperty(s)){delete customStyle[s];}}me.ready(function(){var customCss=[];for(var p in customStyle) {if(p == 'dash' || p == 'dot'){customCss.push('li.list-' + customStyle[p] + '{background-image:url(' + liiconpath + customStyle[p] + '.gif)}');customCss.push('ul.custom_' + p + '{list-style:none;}ul.custom_' + p + ' li{background-position:0 3px;background-repeat:no-repeat}');}else {for(var i=0;i < 99;i++) {customCss.push('li.list-' + customStyle[p] + i + '{background-image:url(' + liiconpath + 'list-' + customStyle[p] + i + '.gif)}');}customCss.push('ol.custom_' + p + '{list-style:none;}ol.custom_' + p + ' li{background-position:0 3px;background-repeat:no-repeat}');}switch(p){case 'cn':customCss.push('li.list-' + p + '-paddingleft-1{padding-left:25px}');customCss.push('li.list-' + p + '-paddingleft-2{padding-left:40px}');customCss.push('li.list-' + p + '-paddingleft-3{padding-left:55px}');break;case 'cn1':customCss.push('li.list-' + p + '-paddingleft-1{padding-left:30px}');customCss.push('li.list-' + p + '-paddingleft-2{padding-left:40px}');customCss.push('li.list-' + p + '-paddingleft-3{padding-left:55px}');break;case 'cn2':customCss.push('li.list-' + p + '-paddingleft-1{padding-left:40px}');customCss.push('li.list-' + p + '-paddingleft-2{padding-left:55px}');customCss.push('li.list-' + p + '-paddingleft-3{padding-left:68px}');break;case 'num':case 'num1':customCss.push('li.list-' + p + '-paddingleft-1{padding-left:25px}');break;case 'num2':customCss.push('li.list-' + p + '-paddingleft-1{padding-left:35px}');customCss.push('li.list-' + p + '-paddingleft-2{padding-left:40px}');break;case 'dash':customCss.push('li.list-' + p + '-paddingleft{padding-left:35px}');break;case 'dot':customCss.push('li.list-' + p + '-paddingleft{padding-left:20px}');}}customCss.push('.list-paddingleft-1{padding-left:0}');customCss.push('.list-paddingleft-2{padding-left:' + me.options.listDefaultPaddingLeft + 'px}');customCss.push('.list-paddingleft-3{padding-left:' + me.options.listDefaultPaddingLeft * 2 + 'px}'); //如果不给宽度会在自定应样式里出现滚动条\nutils.cssRule('list','ol,ul{margin:0;pading:0;' + (browser.ie?'':'width:95%') + '}li{clear:both;}' + customCss.join('\\n'),me.document);}); //单独处理剪切的问题\nme.ready(function(){domUtils.on(me.body,'cut',function(){setTimeout(function(){var rng=me.selection.getRange(),li; //trace:3416\nif(!rng.collapsed){if(li = domUtils.findParentByTagName(rng.startContainer,'li',true)){if(!li.nextSibling && domUtils.isEmptyBlock(li)){var pn=li.parentNode,node;if(node = pn.previousSibling){domUtils.remove(pn);rng.setStartAtLast(node).collapse(true);rng.select(true);}else if(node = pn.nextSibling){domUtils.remove(pn);rng.setStartAtFirst(node).collapse(true);rng.select(true);}else {var tmpNode=me.document.createElement('p');domUtils.fillNode(me.document,tmpNode);pn.parentNode.insertBefore(tmpNode,pn);domUtils.remove(pn);rng.setStart(tmpNode,0).collapse(true);rng.select(true);}}}}});});});function getStyle(node){var cls=node.className;if(domUtils.hasClass(node,/custom_/)){return cls.match(/custom_(\\w+)/)[1];}return domUtils.getStyle(node,'list-style-type');}me.addListener('beforepaste',function(type,html){var me=this,rng=me.selection.getRange(),li;var root=UE.htmlparser(html.html,true);if(li = domUtils.findParentByTagName(rng.startContainer,'li',true)){var list=li.parentNode,tagName=list.tagName == 'OL'?'ul':'ol';utils.each(root.getNodesByTagName(tagName),function(n){n.tagName = list.tagName;n.setAttr();if(n.parentNode === root){type = getStyle(list) || (list.tagName == 'OL'?'decimal':'disc');}else {var className=n.parentNode.getAttr('class');if(className && /custom_/.test(className)){type = className.match(/custom_(\\w+)/)[1];}else {type = n.parentNode.getStyle('list-style-type');}if(!type){type = list.tagName == 'OL'?'decimal':'disc';}}var index=utils.indexOf(listStyle[list.tagName],type);if(n.parentNode !== root)index = index + 1 == listStyle[list.tagName].length?0:index + 1;var currentStyle=listStyle[list.tagName][index];if(customStyle[currentStyle]){n.setAttr('class','custom_' + currentStyle);}else {n.setStyle('list-style-type',currentStyle);}});}html.html = root.toHtml();}); //导出时，去掉p标签\nme.getOpt('disablePInList') === true && me.addOutputRule(function(root){utils.each(root.getNodesByTagName('li'),function(li){var newChildrens=[],index=0;utils.each(li.children,function(n){if(n.tagName == 'p'){var tmpNode;while(tmpNode = n.children.pop()) {newChildrens.splice(index,0,tmpNode);tmpNode.parentNode = li;lastNode = tmpNode;}tmpNode = newChildrens[newChildrens.length - 1];if(!tmpNode || tmpNode.type != 'element' || tmpNode.tagName != 'br'){var br=UE.uNode.createElement('br');br.parentNode = li;newChildrens.push(br);}index = newChildrens.length;}});if(newChildrens.length){li.children = newChildrens;}});}); //进入编辑器的li要套p标签\nme.addInputRule(function(root){utils.each(root.getNodesByTagName('li'),function(li){var tmpP=UE.uNode.createElement('p');for(var i=0,ci;ci = li.children[i];) {if(ci.type == 'text' || dtd.p[ci.tagName]){tmpP.appendChild(ci);}else {if(tmpP.firstChild()){li.insertBefore(tmpP,ci);tmpP = UE.uNode.createElement('p');i = i + 2;}else {i++;}}}if(tmpP.firstChild() && !tmpP.parentNode || !li.firstChild()){li.appendChild(tmpP);} //trace:3357\n//p不能为空\nif(!tmpP.firstChild()){tmpP.innerHTML(browser.ie?'&nbsp;':'<br/>');} //去掉末尾的空白\nvar p=li.firstChild();var lastChild=p.lastChild();if(lastChild && lastChild.type == 'text' && /^\\s*$/.test(lastChild.data)){p.removeChild(lastChild);}});if(me.options.autoTransWordToList){var orderlisttype,unorderlisttype;(function(){var checkListType=function checkListType(content,container){var span=container.firstChild();if(span && span.type == 'element' && span.tagName == 'span' && /Wingdings|Symbol/.test(span.getStyle('font-family'))){for(var p in unorderlisttype) {if(unorderlisttype[p] == span.data){return p;}}return 'disc';}for(var p in orderlisttype) {if(orderlisttype[p].test(content)){return p;}}};orderlisttype = {'num1':/^\\d+\\)/,'decimal':/^\\d+\\./,'lower-alpha':/^[a-z]+\\)/,'upper-alpha':/^[A-Z]+\\./,'cn':/^[\\u4E00\\u4E8C\\u4E09\\u56DB\\u516d\\u4e94\\u4e03\\u516b\\u4e5d]+[\\u3001]/,'cn2':/^\\([\\u4E00\\u4E8C\\u4E09\\u56DB\\u516d\\u4e94\\u4e03\\u516b\\u4e5d]+\\)/};unorderlisttype = {'square':'n'};utils.each(root.getNodesByTagName('p'),function(node){if(node.getAttr('class') != 'MsoListParagraph'){return;} //word粘贴过来的会带有margin要去掉,但这样也可能会误命中一些央视\nnode.setStyle('margin','');node.setStyle('margin-left','');node.setAttr('class','');function appendLi(list,p,type){if(list.tagName == 'ol'){if(browser.ie){var first=p.firstChild();if(first.type == 'element' && first.tagName == 'span' && orderlisttype[type].test(first.innerText())){p.removeChild(first);}}else {p.innerHTML(p.innerHTML().replace(orderlisttype[type],''));}}else {p.removeChild(p.firstChild());}var li=UE.uNode.createElement('li');li.appendChild(p);list.appendChild(li);}var tmp=node,type,cacheNode=node;if(node.parentNode.tagName != 'li' && (type = checkListType(node.innerText(),node))){var list=UE.uNode.createElement(me.options.insertorderedlist.hasOwnProperty(type)?'ol':'ul');if(customStyle[type]){list.setAttr('class','custom_' + type);}else {list.setStyle('list-style-type',type);}while(node && node.parentNode.tagName != 'li' && checkListType(node.innerText(),node)) {tmp = node.nextSibling();if(!tmp){node.parentNode.insertBefore(list,node);}appendLi(list,node,type);node = tmp;}if(!list.parentNode && node && node.parentNode){node.parentNode.insertBefore(list,node);}}var span=cacheNode.firstChild();if(span && span.type == 'element' && span.tagName == 'span' && /^\\s*(&nbsp;)+\\s*$/.test(span.innerText())){span.parentNode.removeChild(span);}});})();}}); //调整索引标签\nme.addListener('contentchange',function(){adjustListStyle(me.document);});function adjustListStyle(doc,ignore){utils.each(domUtils.getElementsByTagName(doc,'ol ul'),function(node){if(!domUtils.inDoc(node,doc))return;var parent=node.parentNode;if(parent.tagName == node.tagName){var nodeStyleType=getStyle(node) || (node.tagName == 'OL'?'decimal':'disc'),parentStyleType=getStyle(parent) || (parent.tagName == 'OL'?'decimal':'disc');if(nodeStyleType == parentStyleType){var styleIndex=utils.indexOf(listStyle[node.tagName],nodeStyleType);styleIndex = styleIndex + 1 == listStyle[node.tagName].length?0:styleIndex + 1;setListStyle(node,listStyle[node.tagName][styleIndex]);}}var index=0,type=2;if(domUtils.hasClass(node,/custom_/)){if(!(/[ou]l/i.test(parent.tagName) && domUtils.hasClass(parent,/custom_/))){type = 1;}}else {if(/[ou]l/i.test(parent.tagName) && domUtils.hasClass(parent,/custom_/)){type = 3;}}var style=domUtils.getStyle(node,'list-style-type');style && (node.style.cssText = 'list-style-type:' + style);node.className = utils.trim(node.className.replace(/list-paddingleft-\\w+/,'')) + ' list-paddingleft-' + type;utils.each(domUtils.getElementsByTagName(node,'li'),function(li){li.style.cssText && (li.style.cssText = '');if(!li.firstChild){domUtils.remove(li);return;}if(li.parentNode !== node){return;}index++;if(domUtils.hasClass(node,/custom_/)){var paddingLeft=1,currentStyle=getStyle(node);if(node.tagName == 'OL'){if(currentStyle){switch(currentStyle){case 'cn':case 'cn1':case 'cn2':if(index > 10 && (index % 10 == 0 || index > 10 && index < 20)){paddingLeft = 2;}else if(index > 20){paddingLeft = 3;}break;case 'num2':if(index > 9){paddingLeft = 2;}}}li.className = 'list-' + customStyle[currentStyle] + index + ' ' + 'list-' + currentStyle + '-paddingleft-' + paddingLeft;}else {li.className = 'list-' + customStyle[currentStyle] + ' ' + 'list-' + currentStyle + '-paddingleft';}}else {li.className = li.className.replace(/list-[\\w\\-]+/gi,'');}var className=li.getAttribute('class');if(className !== null && !className.replace(/\\s/g,'')){domUtils.removeAttributes(li,'class');}});!ignore && adjustList(node,node.tagName.toLowerCase(),getStyle(node) || domUtils.getStyle(node,'list-style-type'),true);});}function adjustList(list,tag,style,ignoreEmpty){var nextList=list.nextSibling;if(nextList && nextList.nodeType == 1 && nextList.tagName.toLowerCase() == tag && (getStyle(nextList) || domUtils.getStyle(nextList,'list-style-type') || (tag == 'ol'?'decimal':'disc')) == style){domUtils.moveChild(nextList,list);if(nextList.childNodes.length == 0){domUtils.remove(nextList);}}if(nextList && domUtils.isFillChar(nextList)){domUtils.remove(nextList);}var preList=list.previousSibling;if(preList && preList.nodeType == 1 && preList.tagName.toLowerCase() == tag && (getStyle(preList) || domUtils.getStyle(preList,'list-style-type') || (tag == 'ol'?'decimal':'disc')) == style){domUtils.moveChild(list,preList);}if(preList && domUtils.isFillChar(preList)){domUtils.remove(preList);}!ignoreEmpty && domUtils.isEmptyBlock(list) && domUtils.remove(list);if(getStyle(list)){adjustListStyle(list.ownerDocument,true);}}function setListStyle(list,style){if(customStyle[style]){list.className = 'custom_' + style;}try{domUtils.setStyle(list,'list-style-type',style);}catch(e) {}}function clearEmptySibling(node){var tmpNode=node.previousSibling;if(tmpNode && domUtils.isEmptyBlock(tmpNode)){domUtils.remove(tmpNode);}tmpNode = node.nextSibling;if(tmpNode && domUtils.isEmptyBlock(tmpNode)){domUtils.remove(tmpNode);}}me.addListener('keydown',function(type,evt){function preventAndSave(){evt.preventDefault?evt.preventDefault():evt.returnValue = false;me.fireEvent('contentchange');me.undoManger && me.undoManger.save();}function findList(node,filterFn){while(node && !domUtils.isBody(node)) {if(filterFn(node)){return null;}if(node.nodeType == 1 && /[ou]l/i.test(node.tagName)){return node;}node = node.parentNode;}return null;}var keyCode=evt.keyCode || evt.which;if(keyCode == 13 && !evt.shiftKey){ //回车\nvar rng=me.selection.getRange(),parent=domUtils.findParent(rng.startContainer,function(node){return domUtils.isBlockElm(node);},true),li=domUtils.findParentByTagName(rng.startContainer,'li',true);if(parent && parent.tagName != 'PRE' && !li){var html=parent.innerHTML.replace(new RegExp(domUtils.fillChar,'g'),'');if(/^\\s*1\\s*\\.[^\\d]/.test(html)){parent.innerHTML = html.replace(/^\\s*1\\s*\\./,'');rng.setStartAtLast(parent).collapse(true).select();me.__hasEnterExecCommand = true;me.execCommand('insertorderedlist');me.__hasEnterExecCommand = false;}}var range=me.selection.getRange(),start=findList(range.startContainer,function(node){return node.tagName == 'TABLE';}),end=range.collapsed?start:findList(range.endContainer,function(node){return node.tagName == 'TABLE';});if(start && end && start === end){if(!range.collapsed){start = domUtils.findParentByTagName(range.startContainer,'li',true);end = domUtils.findParentByTagName(range.endContainer,'li',true);if(start && end && start === end){range.deleteContents();li = domUtils.findParentByTagName(range.startContainer,'li',true);if(li && domUtils.isEmptyBlock(li)){pre = li.previousSibling;next = li.nextSibling;p = me.document.createElement('p');domUtils.fillNode(me.document,p);parentList = li.parentNode;if(pre && next){range.setStart(next,0).collapse(true).select(true);domUtils.remove(li);}else {if(!pre && !next || !pre){parentList.parentNode.insertBefore(p,parentList);}else {li.parentNode.parentNode.insertBefore(p,parentList.nextSibling);}domUtils.remove(li);if(!parentList.firstChild){domUtils.remove(parentList);}range.setStart(p,0).setCursor();}preventAndSave();return;}}else {var tmpRange=range.cloneRange(),bk=tmpRange.collapse(false).createBookmark();range.deleteContents();tmpRange.moveToBookmark(bk);var li=domUtils.findParentByTagName(tmpRange.startContainer,'li',true);clearEmptySibling(li);tmpRange.select();preventAndSave();return;}}li = domUtils.findParentByTagName(range.startContainer,'li',true);if(li){if(domUtils.isEmptyBlock(li)){bk = range.createBookmark();var parentList=li.parentNode;if(li !== parentList.lastChild){domUtils.breakParent(li,parentList);clearEmptySibling(li);}else {parentList.parentNode.insertBefore(li,parentList.nextSibling);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList);}} //嵌套不处理\nif(!dtd.$list[li.parentNode.tagName]){if(!domUtils.isBlockElm(li.firstChild)){p = me.document.createElement('p');li.parentNode.insertBefore(p,li);while(li.firstChild) {p.appendChild(li.firstChild);}domUtils.remove(li);}else {domUtils.remove(li,true);}}range.moveToBookmark(bk).select();}else {var first=li.firstChild;if(!first || !domUtils.isBlockElm(first)){var p=me.document.createElement('p');!li.firstChild && domUtils.fillNode(me.document,p);while(li.firstChild) {p.appendChild(li.firstChild);}li.appendChild(p);first = p;}var span=me.document.createElement('span');range.insertNode(span);domUtils.breakParent(span,li);var nextLi=span.nextSibling;first = nextLi.firstChild;if(!first){p = me.document.createElement('p');domUtils.fillNode(me.document,p);nextLi.appendChild(p);first = p;}if(domUtils.isEmptyNode(first)){first.innerHTML = '';domUtils.fillNode(me.document,first);}range.setStart(first,0).collapse(true).shrinkBoundary().select();domUtils.remove(span);var pre=nextLi.previousSibling;if(pre && domUtils.isEmptyBlock(pre)){pre.innerHTML = '<p></p>';domUtils.fillNode(me.document,pre.firstChild);}} //                        }\npreventAndSave();}}}if(keyCode == 8){ //修中ie中li下的问题\nrange = me.selection.getRange();if(range.collapsed && domUtils.isStartInblock(range)){tmpRange = range.cloneRange().trimBoundary();li = domUtils.findParentByTagName(range.startContainer,'li',true); //要在li的最左边，才能处理\nif(li && domUtils.isStartInblock(tmpRange)){start = domUtils.findParentByTagName(range.startContainer,'p',true);if(start && start !== li.firstChild){var parentList=domUtils.findParentByTagName(start,['ol','ul']);domUtils.breakParent(start,parentList);clearEmptySibling(start);me.fireEvent('contentchange');range.setStart(start,0).setCursor(false,true);me.fireEvent('saveScene');domUtils.preventDefault(evt);return;}if(li && (pre = li.previousSibling)){if(keyCode == 46 && li.childNodes.length){return;} //有可能上边的兄弟节点是个2级菜单，要追加到2级菜单的最后的li\nif(dtd.$list[pre.tagName]){pre = pre.lastChild;}me.undoManger && me.undoManger.save();first = li.firstChild;if(domUtils.isBlockElm(first)){if(domUtils.isEmptyNode(first)){ //                                    range.setEnd(pre, pre.childNodes.length).shrinkBoundary().collapse().select(true);\npre.appendChild(first);range.setStart(first,0).setCursor(false,true); //first不是唯一的节点\nwhile(li.firstChild) {pre.appendChild(li.firstChild);}}else {span = me.document.createElement('span');range.insertNode(span); //判断pre是否是空的节点,如果是<p><br/></p>类型的空节点，干掉p标签防止它占位\nif(domUtils.isEmptyBlock(pre)){pre.innerHTML = '';}domUtils.moveChild(li,pre);range.setStartBefore(span).collapse(true).select(true);domUtils.remove(span);}}else {if(domUtils.isEmptyNode(li)){var p=me.document.createElement('p');pre.appendChild(p);range.setStart(p,0).setCursor(); //                                    range.setEnd(pre, pre.childNodes.length).shrinkBoundary().collapse().select(true);\n}else {range.setEnd(pre,pre.childNodes.length).collapse().select(true);while(li.firstChild) {pre.appendChild(li.firstChild);}}}domUtils.remove(li);me.fireEvent('contentchange');me.fireEvent('saveScene');domUtils.preventDefault(evt);return;} //trace:980\nif(li && !li.previousSibling){var parentList=li.parentNode;var bk=range.createBookmark();if(domUtils.isTagNode(parentList.parentNode,'ol ul')){parentList.parentNode.insertBefore(li,parentList);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList);}}else {while(li.firstChild) {parentList.parentNode.insertBefore(li.firstChild,parentList);}domUtils.remove(li);if(domUtils.isEmptyNode(parentList)){domUtils.remove(parentList);}}range.moveToBookmark(bk).setCursor(false,true);me.fireEvent('contentchange');me.fireEvent('saveScene');domUtils.preventDefault(evt);return;}}}}});me.addListener('keyup',function(type,evt){var keyCode=evt.keyCode || evt.which;if(keyCode == 8){var rng=me.selection.getRange(),list;if(list = domUtils.findParentByTagName(rng.startContainer,['ol','ul'],true)){adjustList(list,list.tagName.toLowerCase(),getStyle(list) || domUtils.getComputedStyle(list,'list-style-type'),true);}}}); //处理tab键\nme.addListener('tabkeydown',function(){var range=me.selection.getRange(); //控制级数\nfunction checkLevel(li){if(me.options.maxListLevel != -1){var level=li.parentNode,levelNum=0;while(/[ou]l/i.test(level.tagName)) {levelNum++;level = level.parentNode;}if(levelNum >= me.options.maxListLevel){return true;}}} //只以开始为准\n//todo 后续改进\nvar li=domUtils.findParentByTagName(range.startContainer,'li',true);if(li){var bk;if(range.collapsed){if(checkLevel(li))return true;var parentLi=li.parentNode,list=me.document.createElement(parentLi.tagName),index=utils.indexOf(listStyle[list.tagName],getStyle(parentLi) || domUtils.getComputedStyle(parentLi,'list-style-type'));index = index + 1 == listStyle[list.tagName].length?0:index + 1;var currentStyle=listStyle[list.tagName][index];setListStyle(list,currentStyle);if(domUtils.isStartInblock(range)){me.fireEvent('saveScene');bk = range.createBookmark();parentLi.insertBefore(list,li);list.appendChild(li);adjustList(list,list.tagName.toLowerCase(),currentStyle);me.fireEvent('contentchange');range.moveToBookmark(bk).select(true);return true;}}else {me.fireEvent('saveScene');bk = range.createBookmark();for(var i=0,closeList,parents=domUtils.findParents(li),ci;ci = parents[i++];) {if(domUtils.isTagNode(ci,'ol ul')){closeList = ci;break;}}var current=li;if(bk.end){while(current && !(domUtils.getPosition(current,bk.end) & domUtils.POSITION_FOLLOWING)) {if(checkLevel(current)){current = domUtils.getNextDomNode(current,false,null,function(node){return node !== closeList;});continue;}var parentLi=current.parentNode,list=me.document.createElement(parentLi.tagName),index=utils.indexOf(listStyle[list.tagName],getStyle(parentLi) || domUtils.getComputedStyle(parentLi,'list-style-type'));var currentIndex=index + 1 == listStyle[list.tagName].length?0:index + 1;var currentStyle=listStyle[list.tagName][currentIndex];setListStyle(list,currentStyle);parentLi.insertBefore(list,current);while(current && !(domUtils.getPosition(current,bk.end) & domUtils.POSITION_FOLLOWING)) {li = current.nextSibling;list.appendChild(current);if(!li || domUtils.isTagNode(li,'ol ul')){if(li){while(li = li.firstChild) {if(li.tagName == 'LI'){break;}}}else {li = domUtils.getNextDomNode(current,false,null,function(node){return node !== closeList;});}break;}current = li;}adjustList(list,list.tagName.toLowerCase(),currentStyle);current = li;}}me.fireEvent('contentchange');range.moveToBookmark(bk).select();return true;}}});function getLi(start){while(start && !domUtils.isBody(start)) {if(start.nodeName == 'TABLE'){return null;}if(start.nodeName == 'LI'){return start;}start = start.parentNode;}} /**\r\n     * 有序列表，与“insertunorderedlist”命令互斥\r\n     * @command insertorderedlist\r\n     * @method execCommand\r\n     * @param { String } command 命令字符串\r\n     * @param { String } style 插入的有序列表类型，值为：decimal,lower-alpha,lower-roman,upper-alpha,upper-roman,cn,cn1,cn2,num,num1,num2\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'insertorderedlist','decimal');\r\n     * ```\r\n     */ /**\r\n     * 查询当前选区内容是否有序列表\r\n     * @command insertorderedlist\r\n     * @method queryCommandState\r\n     * @param { String } cmd 命令字符串\r\n     * @return { int } 如果当前选区是有序列表返回1，否则返回0\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandState( 'insertorderedlist' );\r\n     * ```\r\n     */ /**\r\n     * 查询当前选区内容是否有序列表\r\n     * @command insertorderedlist\r\n     * @method queryCommandValue\r\n     * @param { String } cmd 命令字符串\r\n     * @return { String } 返回当前有序列表的类型，值为null或decimal,lower-alpha,lower-roman,upper-alpha,upper-roman,cn,cn1,cn2,num,num1,num2\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'insertorderedlist' );\r\n     * ```\r\n     */ /**\r\n     * 无序列表，与“insertorderedlist”命令互斥\r\n     * @command insertunorderedlist\r\n     * @method execCommand\r\n     * @param { String } command 命令字符串\r\n     * @param { String } style 插入的无序列表类型，值为：circle,disc,square,dash,dot\r\n     * @example\r\n     * ```javascript\r\n     * editor.execCommand( 'insertunorderedlist','circle');\r\n     * ```\r\n     */ /**\r\n     * 查询当前是否有word文档粘贴进来的图片\r\n     * @command insertunorderedlist\r\n     * @method insertunorderedlist\r\n     * @param { String } command 命令字符串\r\n     * @return { int } 如果当前选区是无序列表返回1，否则返回0\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandState( 'insertunorderedlist' );\r\n     * ```\r\n     */ /**\r\n     * 查询当前选区内容是否有序列表\r\n     * @command insertunorderedlist\r\n     * @method queryCommandValue\r\n     * @param { String } command 命令字符串\r\n     * @return { String } 返回当前无序列表的类型，值为null或circle,disc,square,dash,dot\r\n     * @example\r\n     * ```javascript\r\n     * editor.queryCommandValue( 'insertunorderedlist' );\r\n     * ```\r\n     */me.commands['insertorderedlist'] = me.commands['insertunorderedlist'] = {execCommand:function execCommand(command,style){if(!style){style = command.toLowerCase() == 'insertorderedlist'?'decimal':'disc';}var me=this,range=this.selection.getRange(),filterFn=function filterFn(node){return node.nodeType == 1?node.tagName.toLowerCase() != 'br':!domUtils.isWhitespace(node);},tag=command.toLowerCase() == 'insertorderedlist'?'ol':'ul',frag=me.document.createDocumentFragment(); //去掉是因为会出现选到末尾，导致adjustmentBoundary缩到ol/ul的位置\n//range.shrinkBoundary();//.adjustmentBoundary();\nrange.adjustmentBoundary().shrinkBoundary();var bko=range.createBookmark(true),start=getLi(me.document.getElementById(bko.start)),modifyStart=0,end=getLi(me.document.getElementById(bko.end)),modifyEnd=0,startParent,endParent,list,tmp;if(start || end){start && (startParent = start.parentNode);if(!bko.end){end = start;}end && (endParent = end.parentNode);if(startParent === endParent){while(start !== end) {tmp = start;start = start.nextSibling;if(!domUtils.isBlockElm(tmp.firstChild)){var p=me.document.createElement('p');while(tmp.firstChild) {p.appendChild(tmp.firstChild);}tmp.appendChild(p);}frag.appendChild(tmp);}tmp = me.document.createElement('span');startParent.insertBefore(tmp,end);if(!domUtils.isBlockElm(end.firstChild)){p = me.document.createElement('p');while(end.firstChild) {p.appendChild(end.firstChild);}end.appendChild(p);}frag.appendChild(end);domUtils.breakParent(tmp,startParent);if(domUtils.isEmptyNode(tmp.previousSibling)){domUtils.remove(tmp.previousSibling);}if(domUtils.isEmptyNode(tmp.nextSibling)){domUtils.remove(tmp.nextSibling);}var nodeStyle=getStyle(startParent) || domUtils.getComputedStyle(startParent,'list-style-type') || (command.toLowerCase() == 'insertorderedlist'?'decimal':'disc');if(startParent.tagName.toLowerCase() == tag && nodeStyle == style){for(var i=0,ci,tmpFrag=me.document.createDocumentFragment();ci = frag.firstChild;) {if(domUtils.isTagNode(ci,'ol ul')){ //                                  删除时，子列表不处理\n//                                  utils.each(domUtils.getElementsByTagName(ci,'li'),function(li){\n//                                        while(li.firstChild){\n//                                            tmpFrag.appendChild(li.firstChild);\n//                                        }\n//\n//                                    });\ntmpFrag.appendChild(ci);}else {while(ci.firstChild) {tmpFrag.appendChild(ci.firstChild);domUtils.remove(ci);}}}tmp.parentNode.insertBefore(tmpFrag,tmp);}else {list = me.document.createElement(tag);setListStyle(list,style);list.appendChild(frag);tmp.parentNode.insertBefore(list,tmp);}domUtils.remove(tmp);list && adjustList(list,tag,style);range.moveToBookmark(bko).select();return;} //开始\nif(start){while(start) {tmp = start.nextSibling;if(domUtils.isTagNode(start,'ol ul')){frag.appendChild(start);}else {var tmpfrag=me.document.createDocumentFragment(),hasBlock=0;while(start.firstChild) {if(domUtils.isBlockElm(start.firstChild)){hasBlock = 1;}tmpfrag.appendChild(start.firstChild);}if(!hasBlock){var tmpP=me.document.createElement('p');tmpP.appendChild(tmpfrag);frag.appendChild(tmpP);}else {frag.appendChild(tmpfrag);}domUtils.remove(start);}start = tmp;}startParent.parentNode.insertBefore(frag,startParent.nextSibling);if(domUtils.isEmptyNode(startParent)){range.setStartBefore(startParent);domUtils.remove(startParent);}else {range.setStartAfter(startParent);}modifyStart = 1;}if(end && domUtils.inDoc(endParent,me.document)){ //结束\nstart = endParent.firstChild;while(start && start !== end) {tmp = start.nextSibling;if(domUtils.isTagNode(start,'ol ul')){frag.appendChild(start);}else {tmpfrag = me.document.createDocumentFragment();hasBlock = 0;while(start.firstChild) {if(domUtils.isBlockElm(start.firstChild)){hasBlock = 1;}tmpfrag.appendChild(start.firstChild);}if(!hasBlock){tmpP = me.document.createElement('p');tmpP.appendChild(tmpfrag);frag.appendChild(tmpP);}else {frag.appendChild(tmpfrag);}domUtils.remove(start);}start = tmp;}var tmpDiv=domUtils.createElement(me.document,'div',{'tmpDiv':1});domUtils.moveChild(end,tmpDiv);frag.appendChild(tmpDiv);domUtils.remove(end);endParent.parentNode.insertBefore(frag,endParent);range.setEndBefore(endParent);if(domUtils.isEmptyNode(endParent)){domUtils.remove(endParent);}modifyEnd = 1;}}if(!modifyStart){range.setStartBefore(me.document.getElementById(bko.start));}if(bko.end && !modifyEnd){range.setEndAfter(me.document.getElementById(bko.end));}range.enlarge(true,function(node){return notExchange[node.tagName];});frag = me.document.createDocumentFragment();var bk=range.createBookmark(),current=domUtils.getNextDomNode(bk.start,false,filterFn),tmpRange=range.cloneRange(),tmpNode,block=domUtils.isBlockElm;while(current && current !== bk.end && domUtils.getPosition(current,bk.end) & domUtils.POSITION_PRECEDING) {if(current.nodeType == 3 || dtd.li[current.tagName]){if(current.nodeType == 1 && dtd.$list[current.tagName]){while(current.firstChild) {frag.appendChild(current.firstChild);}tmpNode = domUtils.getNextDomNode(current,false,filterFn);domUtils.remove(current);current = tmpNode;continue;}tmpNode = current;tmpRange.setStartBefore(current);while(current && current !== bk.end && (!block(current) || domUtils.isBookmarkNode(current))) {tmpNode = current;current = domUtils.getNextDomNode(current,false,null,function(node){return !notExchange[node.tagName];});}if(current && block(current)){tmp = domUtils.getNextDomNode(tmpNode,false,filterFn);if(tmp && domUtils.isBookmarkNode(tmp)){current = domUtils.getNextDomNode(tmp,false,filterFn);tmpNode = tmp;}}tmpRange.setEndAfter(tmpNode);current = domUtils.getNextDomNode(tmpNode,false,filterFn);var li=range.document.createElement('li');li.appendChild(tmpRange.extractContents());if(domUtils.isEmptyNode(li)){var tmpNode=range.document.createElement('p');while(li.firstChild) {tmpNode.appendChild(li.firstChild);}li.appendChild(tmpNode);}frag.appendChild(li);}else {current = domUtils.getNextDomNode(current,true,filterFn);}}range.moveToBookmark(bk).collapse(true);list = me.document.createElement(tag);setListStyle(list,style);list.appendChild(frag);range.insertNode(list); //当前list上下看能否合并\nadjustList(list,tag,style); //去掉冗余的tmpDiv\nfor(var i=0,ci,tmpDivs=domUtils.getElementsByTagName(list,'div');ci = tmpDivs[i++];) {if(ci.getAttribute('tmpDiv')){domUtils.remove(ci,true);}}range.moveToBookmark(bko).select();},queryCommandState:function queryCommandState(command){var tag=command.toLowerCase() == 'insertorderedlist'?'ol':'ul';var path=this.selection.getStartElementPath();for(var i=0,ci;ci = path[i++];) {if(ci.nodeName == 'TABLE'){return 0;}if(tag == ci.nodeName.toLowerCase()){return 1;};}return 0;},queryCommandValue:function queryCommandValue(command){var tag=command.toLowerCase() == 'insertorderedlist'?'ol':'ul';var path=this.selection.getStartElementPath(),node;for(var i=0,ci;ci = path[i++];) {if(ci.nodeName == 'TABLE'){node = null;break;}if(tag == ci.nodeName.toLowerCase()){node = ci;break;};}return node?getStyle(node) || domUtils.getComputedStyle(node,'list-style-type'):null;}};}; // plugins/source.js\n/**\r\n * 源码编辑插件\r\n * @file\r\n * @since 1.2.6.1\r\n */(function(){var sourceEditors={textarea:function textarea(editor,holder){var textarea=holder.ownerDocument.createElement('textarea');textarea.style.cssText = 'position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;'; // todo: IE下只有onresize属性可用... 很纠结\nif(browser.ie && browser.version < 8){textarea.style.width = holder.offsetWidth + 'px';textarea.style.height = holder.offsetHeight + 'px';holder.onresize = function(){textarea.style.width = holder.offsetWidth + 'px';textarea.style.height = holder.offsetHeight + 'px';};}holder.appendChild(textarea);return {setContent:function setContent(content){textarea.value = content;},getContent:function getContent(){return textarea.value;},select:function select(){var range;if(browser.ie){range = textarea.createTextRange();range.collapse(true);range.select();}else { //todo: chrome下无法设置焦点\ntextarea.setSelectionRange(0,0);textarea.focus();}},dispose:function dispose(){holder.removeChild(textarea); // todo\nholder.onresize = null;textarea = null;holder = null;}};},codemirror:function codemirror(editor,holder){var codeEditor=window.CodeMirror(holder,{mode:\"text/html\",tabMode:\"indent\",lineNumbers:true,lineWrapping:true});var dom=codeEditor.getWrapperElement();dom.style.cssText = 'position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,\"Courier new\",monospace;font-size:13px;';codeEditor.getScrollerElement().style.cssText = 'position:absolute;left:0;top:0;width:100%;height:100%;';codeEditor.refresh();return {getCodeMirror:function getCodeMirror(){return codeEditor;},setContent:function setContent(content){codeEditor.setValue(content);},getContent:function getContent(){return codeEditor.getValue();},select:function select(){codeEditor.focus();},dispose:function dispose(){holder.removeChild(dom);dom = null;codeEditor = null;}};}};UE.plugins['source'] = function(){var me=this;var opt=this.options;var sourceMode=false;var sourceEditor;var orgSetContent;opt.sourceEditor = browser.ie?'textarea':opt.sourceEditor || 'codemirror';me.setOpt({sourceEditorFirst:false});function createSourceEditor(holder){return sourceEditors[opt.sourceEditor == 'codemirror' && window.CodeMirror?'codemirror':'textarea'](me,holder);}var bakCssText; //解决在源码模式下getContent不能得到最新的内容问题\nvar oldGetContent,bakAddress; /**\r\n         * 切换源码模式和编辑模式\r\n         * @command source\r\n         * @method execCommand\r\n         * @param { String } cmd 命令字符串\r\n         * @example\r\n         * ```javascript\r\n         * editor.execCommand( 'source');\r\n         * ```\r\n         */ /**\r\n         * 查询当前编辑区域的状态是源码模式还是可视化模式\r\n         * @command source\r\n         * @method queryCommandState\r\n         * @param { String } cmd 命令字符串\r\n         * @return { int } 如果当前是源码编辑模式，返回1，否则返回0\r\n         * @example\r\n         * ```javascript\r\n         * editor.queryCommandState( 'source' );\r\n         * ```\r\n         */me.commands['source'] = {execCommand:function execCommand(){sourceMode = !sourceMode;if(sourceMode){bakAddress = me.selection.getRange().createAddress(false,true);me.undoManger && me.undoManger.save(true);if(browser.gecko){me.body.contentEditable = false;}bakCssText = me.iframe.style.cssText;me.iframe.style.cssText += 'position:absolute;left:-32768px;top:-32768px;';me.fireEvent('beforegetcontent');var root=UE.htmlparser(me.body.innerHTML);me.filterOutputRule(root);root.traversal(function(node){if(node.type == 'element'){switch(node.tagName){case 'td':case 'th':case 'caption':if(node.children && node.children.length == 1){if(node.firstChild().tagName == 'br'){node.removeChild(node.firstChild());}};break;case 'pre':node.innerText(node.innerText().replace(/&nbsp;/g,' '));}}});me.fireEvent('aftergetcontent');var content=root.toHtml(true);sourceEditor = createSourceEditor(me.iframe.parentNode);sourceEditor.setContent(content);orgSetContent = me.setContent;me.setContent = function(html){ //这里暂时不触发事件，防止报错\nvar root=UE.htmlparser(html);me.filterInputRule(root);html = root.toHtml();sourceEditor.setContent(html);};setTimeout(function(){sourceEditor.select();me.addListener('fullscreenchanged',function(){try{sourceEditor.getCodeMirror().refresh();}catch(e) {}});}); //重置getContent，源码模式下取值也能是最新的数据\noldGetContent = me.getContent;me.getContent = function(){return sourceEditor.getContent() || '<p>' + (browser.ie?'':'<br/>') + '</p>';};}else {me.iframe.style.cssText = bakCssText;var cont=sourceEditor.getContent() || '<p>' + (browser.ie?'':'<br/>') + '</p>'; //处理掉block节点前后的空格,有可能会误命中，暂时不考虑\ncont = cont.replace(new RegExp('[\\\\r\\\\t\\\\n ]*<\\/?(\\\\w+)\\\\s*(?:[^>]*)>','g'),function(a,b){if(b && !dtd.$inlineWithA[b.toLowerCase()]){return a.replace(/(^[\\n\\r\\t ]*)|([\\n\\r\\t ]*$)/g,'');}return a.replace(/(^[\\n\\r\\t]*)|([\\n\\r\\t]*$)/g,'');});me.setContent = orgSetContent;me.setContent(cont);sourceEditor.dispose();sourceEditor = null; //还原getContent方法\nme.getContent = oldGetContent;var first=me.body.firstChild; //trace:1106 都删除空了，下边会报错，所以补充一个p占位\nif(!first){me.body.innerHTML = '<p>' + (browser.ie?'':'<br/>') + '</p>';first = me.body.firstChild;} //要在ifm为显示时ff才能取到selection,否则报错\n//这里不能比较位置了\nme.undoManger && me.undoManger.save(true);if(browser.gecko){var input=document.createElement('input');input.style.cssText = 'position:absolute;left:0;top:-32768px';document.body.appendChild(input);me.body.contentEditable = false;setTimeout(function(){domUtils.setViewportOffset(input,{left:-32768,top:0});input.focus();setTimeout(function(){me.body.contentEditable = true;me.selection.getRange().moveToAddress(bakAddress).select(true);domUtils.remove(input);});});}else { //ie下有可能报错，比如在代码顶头的情况\ntry{me.selection.getRange().moveToAddress(bakAddress).select(true);}catch(e) {}}}this.fireEvent('sourcemodechanged',sourceMode);},queryCommandState:function queryCommandState(){return sourceMode | 0;},notNeedUndo:1};var oldQueryCommandState=me.queryCommandState;me.queryCommandState = function(cmdName){cmdName = cmdName.toLowerCase();if(sourceMode){ //源码模式下可以开启的命令\nreturn cmdName in {'source':1,'fullscreen':1}?1:-1;}return oldQueryCommandState.apply(this,arguments);};if(opt.sourceEditor == \"codemirror\"){me.addListener(\"ready\",function(){utils.loadFile(document,{src:opt.codeMirrorJsUrl || opt.UEDITOR_HOME_URL + \"third-party/codemirror/codemirror.js\",tag:\"script\",type:\"text/javascript\",defer:\"defer\"},function(){if(opt.sourceEditorFirst){setTimeout(function(){me.execCommand(\"source\");},0);}});utils.loadFile(document,{tag:\"link\",rel:\"stylesheet\",type:\"text/css\",href:opt.codeMirrorCssUrl || opt.UEDITOR_HOME_URL + \"third-party/codemirror/codemirror.css\"});});}};})(); // plugins/enterkey.js\n///import core\n///import plugins/undo.js\n///commands 设置回车标签p或br\n///commandsName  EnterKey\n///commandsTitle  设置回车标签p或br\n/**\r\n * @description 处理回车\r\n * @author zhanyi\r\n */UE.plugins['enterkey'] = function(){var hTag,me=this,tag=me.options.enterTag;me.addListener('keyup',function(type,evt){var keyCode=evt.keyCode || evt.which;if(keyCode == 13){var range=me.selection.getRange(),start=range.startContainer,doSave; //修正在h1-h6里边回车后不能嵌套p的问题\nif(!browser.ie){if(/h\\d/i.test(hTag)){if(browser.gecko){var h=domUtils.findParentByTagName(start,['h1','h2','h3','h4','h5','h6','blockquote','caption','table'],true);if(!h){me.document.execCommand('formatBlock',false,'<p>');doSave = 1;}}else { //chrome remove div\nif(start.nodeType == 1){var tmp=me.document.createTextNode(''),div;range.insertNode(tmp);div = domUtils.findParentByTagName(tmp,'div',true);if(div){var p=me.document.createElement('p');while(div.firstChild) {p.appendChild(div.firstChild);}div.parentNode.insertBefore(p,div);domUtils.remove(div);range.setStartBefore(tmp).setCursor();doSave = 1;}domUtils.remove(tmp);}}if(me.undoManger && doSave){me.undoManger.save();}} //没有站位符，会出现多行的问题\nbrowser.opera && range.select();}else {me.fireEvent('saveScene',true,true);}}});me.addListener('keydown',function(type,evt){var keyCode=evt.keyCode || evt.which;if(keyCode == 13){ //回车\nif(me.fireEvent('beforeenterkeydown')){domUtils.preventDefault(evt);return;}me.fireEvent('saveScene',true,true);hTag = '';var range=me.selection.getRange();if(!range.collapsed){ //跨td不能删\nvar start=range.startContainer,end=range.endContainer,startTd=domUtils.findParentByTagName(start,'td',true),endTd=domUtils.findParentByTagName(end,'td',true);if(startTd && endTd && startTd !== endTd || !startTd && endTd || startTd && !endTd){evt.preventDefault?evt.preventDefault():evt.returnValue = false;return;}}if(tag == 'p'){if(!browser.ie){start = domUtils.findParentByTagName(range.startContainer,['ol','ul','p','h1','h2','h3','h4','h5','h6','blockquote','caption'],true); //opera下执行formatblock会在table的场景下有问题，回车在opera原生支持很好，所以暂时在opera去掉调用这个原生的command\n//trace:2431\nif(!start && !browser.opera){me.document.execCommand('formatBlock',false,'<p>');if(browser.gecko){range = me.selection.getRange();start = domUtils.findParentByTagName(range.startContainer,'p',true);start && domUtils.removeDirtyAttr(start);}}else {hTag = start.tagName;start.tagName.toLowerCase() == 'p' && browser.gecko && domUtils.removeDirtyAttr(start);}}}else {evt.preventDefault?evt.preventDefault():evt.returnValue = false;if(!range.collapsed){range.deleteContents();start = range.startContainer;if(start.nodeType == 1 && (start = start.childNodes[range.startOffset])){while(start.nodeType == 1) {if(dtd.$empty[start.tagName]){range.setStartBefore(start).setCursor();if(me.undoManger){me.undoManger.save();}return false;}if(!start.firstChild){var br=range.document.createElement('br');start.appendChild(br);range.setStart(start,0).setCursor();if(me.undoManger){me.undoManger.save();}return false;}start = start.firstChild;}if(start === range.startContainer.childNodes[range.startOffset]){br = range.document.createElement('br');range.insertNode(br).setCursor();}else {range.setStart(start,0).setCursor();}}else {br = range.document.createElement('br');range.insertNode(br).setStartAfter(br).setCursor();}}else {br = range.document.createElement('br');range.insertNode(br);var parent=br.parentNode;if(parent.lastChild === br){br.parentNode.insertBefore(br.cloneNode(true),br);range.setStartBefore(br);}else {range.setStartAfter(br);}range.setCursor();}}}});}; // plugins/keystrokes.js\n/* 处理特殊键的兼容性问题 */UE.plugins['keystrokes'] = function(){var me=this;var collapsed=true;me.addListener('keydown',function(type,evt){var keyCode=evt.keyCode || evt.which,rng=me.selection.getRange(); //处理全选的情况\nif(!rng.collapsed && !(evt.ctrlKey || evt.shiftKey || evt.altKey || evt.metaKey) && (keyCode >= 65 && keyCode <= 90 || keyCode >= 48 && keyCode <= 57 || keyCode >= 96 && keyCode <= 111 || ({13:1,8:1,46:1})[keyCode])){var tmpNode=rng.startContainer;if(domUtils.isFillChar(tmpNode)){rng.setStartBefore(tmpNode);}tmpNode = rng.endContainer;if(domUtils.isFillChar(tmpNode)){rng.setEndAfter(tmpNode);}rng.txtToElmBoundary(); //结束边界可能放到了br的前边，要把br包含进来\n// x[xxx]<br/>\nif(rng.endContainer && rng.endContainer.nodeType == 1){tmpNode = rng.endContainer.childNodes[rng.endOffset];if(tmpNode && domUtils.isBr(tmpNode)){rng.setEndAfter(tmpNode);}}if(rng.startOffset == 0){tmpNode = rng.startContainer;if(domUtils.isBoundaryNode(tmpNode,'firstChild')){tmpNode = rng.endContainer;if(rng.endOffset == (tmpNode.nodeType == 3?tmpNode.nodeValue.length:tmpNode.childNodes.length) && domUtils.isBoundaryNode(tmpNode,'lastChild')){me.fireEvent('saveScene');me.body.innerHTML = '<p>' + (browser.ie?'':'<br/>') + '</p>';rng.setStart(me.body.firstChild,0).setCursor(false,true);me._selectionChange();return;}}}} //处理backspace\nif(keyCode == keymap.Backspace){rng = me.selection.getRange();collapsed = rng.collapsed;if(me.fireEvent('delkeydown',evt)){return;}var start,end; //避免按两次删除才能生效的问题\nif(rng.collapsed && rng.inFillChar()){start = rng.startContainer;if(domUtils.isFillChar(start)){rng.setStartBefore(start).shrinkBoundary(true).collapse(true);domUtils.remove(start);}else {start.nodeValue = start.nodeValue.replace(new RegExp('^' + domUtils.fillChar),'');rng.startOffset--;rng.collapse(true).select(true);}} //解决选中control元素不能删除的问题\nif(start = rng.getClosedNode()){me.fireEvent('saveScene');rng.setStartBefore(start);domUtils.remove(start);rng.setCursor();me.fireEvent('saveScene');domUtils.preventDefault(evt);return;} //阻止在table上的删除\nif(!browser.ie){start = domUtils.findParentByTagName(rng.startContainer,'table',true);end = domUtils.findParentByTagName(rng.endContainer,'table',true);if(start && !end || !start && end || start !== end){evt.preventDefault();return;}}} //处理tab键的逻辑\nif(keyCode == keymap.Tab){ //不处理以下标签\nvar excludeTagNameForTabKey={'ol':1,'ul':1,'table':1}; //处理组件里的tab按下事件\nif(me.fireEvent('tabkeydown',evt)){domUtils.preventDefault(evt);return;}var range=me.selection.getRange();me.fireEvent('saveScene');for(var i=0,txt='',tabSize=me.options.tabSize || 4,tabNode=me.options.tabNode || '&nbsp;';i < tabSize;i++) {txt += tabNode;}var span=me.document.createElement('span');span.innerHTML = txt + domUtils.fillChar;if(range.collapsed){range.insertNode(span.cloneNode(true).firstChild).setCursor(true);}else {var filterFn=function filterFn(node){return domUtils.isBlockElm(node) && !excludeTagNameForTabKey[node.tagName.toLowerCase()];}; //普通的情况\nstart = domUtils.findParent(range.startContainer,filterFn,true);end = domUtils.findParent(range.endContainer,filterFn,true);if(start && end && start === end){range.deleteContents();range.insertNode(span.cloneNode(true).firstChild).setCursor(true);}else {var bookmark=range.createBookmark();range.enlarge(true);var bookmark2=range.createBookmark(),current=domUtils.getNextDomNode(bookmark2.start,false,filterFn);while(current && !(domUtils.getPosition(current,bookmark2.end) & domUtils.POSITION_FOLLOWING)) {current.insertBefore(span.cloneNode(true).firstChild,current.firstChild);current = domUtils.getNextDomNode(current,false,filterFn);}range.moveToBookmark(bookmark2).moveToBookmark(bookmark).select();}}domUtils.preventDefault(evt);} //trace:1634\n//ff的del键在容器空的时候，也会删除\nif(browser.gecko && keyCode == 46){range = me.selection.getRange();if(range.collapsed){start = range.startContainer;if(domUtils.isEmptyBlock(start)){var parent=start.parentNode;while(domUtils.getChildCount(parent) == 1 && !domUtils.isBody(parent)) {start = parent;parent = parent.parentNode;}if(start === parent.lastChild)evt.preventDefault();return;}}}});me.addListener('keyup',function(type,evt){var keyCode=evt.keyCode || evt.which,rng,me=this;if(keyCode == keymap.Backspace){if(me.fireEvent('delkeyup')){return;}rng = me.selection.getRange();if(rng.collapsed){var tmpNode,autoClearTagName=['h1','h2','h3','h4','h5','h6'];if(tmpNode = domUtils.findParentByTagName(rng.startContainer,autoClearTagName,true)){if(domUtils.isEmptyBlock(tmpNode)){var pre=tmpNode.previousSibling;if(pre && pre.nodeName != 'TABLE'){domUtils.remove(tmpNode);rng.setStartAtLast(pre).setCursor(false,true);return;}else {var next=tmpNode.nextSibling;if(next && next.nodeName != 'TABLE'){domUtils.remove(tmpNode);rng.setStartAtFirst(next).setCursor(false,true);return;}}}} //处理当删除到body时，要重新给p标签展位\nif(domUtils.isBody(rng.startContainer)){var tmpNode=domUtils.createElement(me.document,'p',{'innerHTML':browser.ie?domUtils.fillChar:'<br/>'});rng.insertNode(tmpNode).setStart(tmpNode,0).setCursor(false,true);}} //chrome下如果删除了inline标签，浏览器会有记忆，在输入文字还是会套上刚才删除的标签，所以这里再选一次就不会了\nif(!collapsed && (rng.startContainer.nodeType == 3 || rng.startContainer.nodeType == 1 && domUtils.isEmptyBlock(rng.startContainer))){if(browser.ie){var span=rng.document.createElement('span');rng.insertNode(span).setStartBefore(span).collapse(true);rng.select();domUtils.remove(span);}else {rng.select();}}}});}; // plugins/fiximgclick.js\n///import core\n///commands 修复chrome下图片不能点击的问题，出现八个角可改变大小\n///commandsName  FixImgClick\n///commandsTitle  修复chrome下图片不能点击的问题，出现八个角可改变大小\n//修复chrome下图片不能点击的问题，出现八个角可改变大小\nUE.plugins['fiximgclick'] = (function(){var elementUpdated=false;function Scale(){this.editor = null;this.resizer = null;this.cover = null;this.doc = document;this.prePos = {x:0,y:0};this.startPos = {x:0,y:0};}(function(){var rect=[ //[left, top, width, height]\n[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];Scale.prototype = {init:function init(editor){var me=this;me.editor = editor;me.startPos = this.prePos = {x:0,y:0};me.dragId = -1;var hands=[],cover=me.cover = document.createElement('div'),resizer=me.resizer = document.createElement('div');cover.id = me.editor.ui.id + '_imagescale_cover';cover.style.cssText = 'position:absolute;display:none;z-index:' + me.editor.options.zIndex + ';filter:alpha(opacity=0); opacity:0;background:#CCC;';domUtils.on(cover,'mousedown click',function(){me.hide();});for(i = 0;i < 8;i++) {hands.push('<span class=\"edui-editor-imagescale-hand' + i + '\"></span>');}resizer.id = me.editor.ui.id + '_imagescale';resizer.className = 'edui-editor-imagescale';resizer.innerHTML = hands.join('');resizer.style.cssText += ';display:none;border:1px solid #3b77ff;z-index:' + me.editor.options.zIndex + ';';me.editor.ui.getDom().appendChild(cover);me.editor.ui.getDom().appendChild(resizer);me.initStyle();me.initEvents();},initStyle:function initStyle(){utils.cssRule('imagescale','.edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}' + '.edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}' + '.edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}');},initEvents:function initEvents(){var me=this;me.startPos.x = me.startPos.y = 0;me.isDraging = false;},_eventHandler:function _eventHandler(e){var me=this;switch(e.type){case 'mousedown':var hand=e.target || e.srcElement,hand;if(hand.className.indexOf('edui-editor-imagescale-hand') != -1 && me.dragId == -1){me.dragId = hand.className.slice(-1);me.startPos.x = me.prePos.x = e.clientX;me.startPos.y = me.prePos.y = e.clientY;domUtils.on(me.doc,'mousemove',me.proxy(me._eventHandler,me));}break;case 'mousemove':if(me.dragId != -1){me.updateContainerStyle(me.dragId,{x:e.clientX - me.prePos.x,y:e.clientY - me.prePos.y});me.prePos.x = e.clientX;me.prePos.y = e.clientY;elementUpdated = true;me.updateTargetElement();}break;case 'mouseup':if(me.dragId != -1){me.updateContainerStyle(me.dragId,{x:e.clientX - me.prePos.x,y:e.clientY - me.prePos.y});me.updateTargetElement();if(me.target.parentNode)me.attachTo(me.target);me.dragId = -1;}domUtils.un(me.doc,'mousemove',me.proxy(me._eventHandler,me)); //修复只是点击挪动点，但没有改变大小，不应该触发contentchange\nif(elementUpdated){elementUpdated = false;me.editor.fireEvent('contentchange');}break;default:break;}},updateTargetElement:function updateTargetElement(){var me=this;domUtils.setStyles(me.target,{'width':me.resizer.style.width,'height':me.resizer.style.height});me.target.width = parseInt(me.resizer.style.width);me.target.height = parseInt(me.resizer.style.height);me.attachTo(me.target);},updateContainerStyle:function updateContainerStyle(dir,offset){var me=this,dom=me.resizer,tmp;if(rect[dir][0] != 0){tmp = parseInt(dom.style.left) + offset.x;dom.style.left = me._validScaledProp('left',tmp) + 'px';}if(rect[dir][1] != 0){tmp = parseInt(dom.style.top) + offset.y;dom.style.top = me._validScaledProp('top',tmp) + 'px';}if(rect[dir][2] != 0){tmp = dom.clientWidth + rect[dir][2] * offset.x;dom.style.width = me._validScaledProp('width',tmp) + 'px';}if(rect[dir][3] != 0){tmp = dom.clientHeight + rect[dir][3] * offset.y;dom.style.height = me._validScaledProp('height',tmp) + 'px';}},_validScaledProp:function _validScaledProp(prop,value){var ele=this.resizer,wrap=document;value = isNaN(value)?0:value;switch(prop){case 'left':return value < 0?0:value + ele.clientWidth > wrap.clientWidth?wrap.clientWidth - ele.clientWidth:value;case 'top':return value < 0?0:value + ele.clientHeight > wrap.clientHeight?wrap.clientHeight - ele.clientHeight:value;case 'width':return value <= 0?1:value + ele.offsetLeft > wrap.clientWidth?wrap.clientWidth - ele.offsetLeft:value;case 'height':return value <= 0?1:value + ele.offsetTop > wrap.clientHeight?wrap.clientHeight - ele.offsetTop:value;}},hideCover:function hideCover(){this.cover.style.display = 'none';},showCover:function showCover(){var me=this,editorPos=domUtils.getXY(me.editor.ui.getDom()),iframePos=domUtils.getXY(me.editor.iframe);domUtils.setStyles(me.cover,{'width':me.editor.iframe.offsetWidth + 'px','height':me.editor.iframe.offsetHeight + 'px','top':iframePos.y - editorPos.y + 'px','left':iframePos.x - editorPos.x + 'px','position':'absolute','display':''});},show:function show(targetObj){var me=this;me.resizer.style.display = 'block';if(targetObj)me.attachTo(targetObj);domUtils.on(this.resizer,'mousedown',me.proxy(me._eventHandler,me));domUtils.on(me.doc,'mouseup',me.proxy(me._eventHandler,me));me.showCover();me.editor.fireEvent('afterscaleshow',me);me.editor.fireEvent('saveScene');},hide:function hide(){var me=this;me.hideCover();me.resizer.style.display = 'none';domUtils.un(me.resizer,'mousedown',me.proxy(me._eventHandler,me));domUtils.un(me.doc,'mouseup',me.proxy(me._eventHandler,me));me.editor.fireEvent('afterscalehide',me);},proxy:function proxy(fn,context){return function(e){return fn.apply(context || this,arguments);};},attachTo:function attachTo(targetObj){var me=this,target=me.target = targetObj,resizer=this.resizer,imgPos=domUtils.getXY(target),iframePos=domUtils.getXY(me.editor.iframe),editorPos=domUtils.getXY(resizer.parentNode);domUtils.setStyles(resizer,{'width':target.width + 'px','height':target.height + 'px','left':iframePos.x + imgPos.x - me.editor.document.body.scrollLeft - editorPos.x - parseInt(resizer.style.borderLeftWidth) + 'px','top':iframePos.y + imgPos.y - me.editor.document.body.scrollTop - editorPos.y - parseInt(resizer.style.borderTopWidth) + 'px'});}};})();return function(){var me=this,imageScale;me.setOpt('imageScaleEnabled',true);if(!browser.ie && me.options.imageScaleEnabled){me.addListener('click',function(type,e){var range=me.selection.getRange(),img=range.getClosedNode();if(img && img.tagName == 'IMG' && me.body.contentEditable != \"false\"){if(img.className.indexOf(\"edui-faked-music\") != -1 || img.getAttribute(\"anchorname\") || domUtils.hasClass(img,'loadingclass') || domUtils.hasClass(img,'loaderrorclass')){return;}if(!imageScale){imageScale = new Scale();imageScale.init(me);me.ui.getDom().appendChild(imageScale.resizer);var _keyDownHandler=function _keyDownHandler(e){imageScale.hide();if(imageScale.target)me.selection.getRange().selectNode(imageScale.target).select();},_mouseDownHandler=function _mouseDownHandler(e){var ele=e.target || e.srcElement;if(ele && (ele.className === undefined || ele.className.indexOf('edui-editor-imagescale') == -1)){_keyDownHandler(e);}},timer;me.addListener('afterscaleshow',function(e){me.addListener('beforekeydown',_keyDownHandler);me.addListener('beforemousedown',_mouseDownHandler);domUtils.on(document,'keydown',_keyDownHandler);domUtils.on(document,'mousedown',_mouseDownHandler);me.selection.getNative().removeAllRanges();});me.addListener('afterscalehide',function(e){me.removeListener('beforekeydown',_keyDownHandler);me.removeListener('beforemousedown',_mouseDownHandler);domUtils.un(document,'keydown',_keyDownHandler);domUtils.un(document,'mousedown',_mouseDownHandler);var target=imageScale.target;if(target.parentNode){me.selection.getRange().selectNode(target).select();}}); //TODO 有iframe的情况，mousedown不能往下传。。\ndomUtils.on(imageScale.resizer,'mousedown',function(e){me.selection.getNative().removeAllRanges();var ele=e.target || e.srcElement;if(ele && ele.className.indexOf('edui-editor-imagescale-hand') == -1){timer = setTimeout(function(){imageScale.hide();if(imageScale.target)me.selection.getRange().selectNode(ele).select();},200);}});domUtils.on(imageScale.resizer,'mouseup',function(e){var ele=e.target || e.srcElement;if(ele && ele.className.indexOf('edui-editor-imagescale-hand') == -1){clearTimeout(timer);}});}imageScale.show(img);}else {if(imageScale && imageScale.resizer.style.display != 'none')imageScale.hide();}});}if(browser.webkit){me.addListener('click',function(type,e){if(e.target.tagName == 'IMG' && me.body.contentEditable != \"false\"){var range=new dom.Range(me.document);range.selectNode(e.target).select();}});}};})(); // plugins/autolink.js\n///import core\n///commands 为非ie浏览器自动添加a标签\n///commandsName  AutoLink\n///commandsTitle  自动增加链接\n/**\r\n * @description 为非ie浏览器自动添加a标签\r\n * @author zhanyi\r\n */UE.plugin.register('autolink',function(){var cont=0;return !browser.ie?{bindEvents:{'reset':function reset(){cont = 0;},'keydown':function keydown(type,evt){var me=this;var keyCode=evt.keyCode || evt.which;if(keyCode == 32 || keyCode == 13){var sel=me.selection.getNative(),range=sel.getRangeAt(0).cloneRange(),offset,charCode;var start=range.startContainer;while(start.nodeType == 1 && range.startOffset > 0) {start = range.startContainer.childNodes[range.startOffset - 1];if(!start){break;}range.setStart(start,start.nodeType == 1?start.childNodes.length:start.nodeValue.length);range.collapse(true);start = range.startContainer;}do {if(range.startOffset == 0){start = range.startContainer.previousSibling;while(start && start.nodeType == 1) {start = start.lastChild;}if(!start || domUtils.isFillChar(start)){break;}offset = start.nodeValue.length;}else {start = range.startContainer;offset = range.startOffset;}range.setStart(start,offset - 1);charCode = range.toString().charCodeAt(0);}while(charCode != 160 && charCode != 32);if(range.toString().replace(new RegExp(domUtils.fillChar,'g'),'').match(/(?:https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|www\\.)/i)){while(range.toString().length) {if(/^(?:https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|www\\.)/i.test(range.toString())){break;}try{range.setStart(range.startContainer,range.startOffset + 1);}catch(e) { //trace:2121\nvar start=range.startContainer;while(!(next = start.nextSibling)) {if(domUtils.isBody(start)){return;}start = start.parentNode;}range.setStart(next,0);}} //range的开始边界已经在a标签里的不再处理\nif(domUtils.findParentByTagName(range.startContainer,'a',true)){return;}var a=me.document.createElement('a'),text=me.document.createTextNode(' '),href;me.undoManger && me.undoManger.save();a.appendChild(range.extractContents());a.href = a.innerHTML = a.innerHTML.replace(/<[^>]+>/g,'');href = a.getAttribute(\"href\").replace(new RegExp(domUtils.fillChar,'g'),'');href = /^(?:https?:\\/\\/)/ig.test(href)?href:\"http://\" + href;a.setAttribute('_src',utils.html(href));a.href = utils.html(href);range.insertNode(a);a.parentNode.insertBefore(text,a.nextSibling);range.setStart(text,0);range.collapse(true);sel.removeAllRanges();sel.addRange(range);me.undoManger && me.undoManger.save();}}}}}:{};},function(){var keyCodes={37:1,38:1,39:1,40:1,13:1,32:1};function checkIsCludeLink(node){if(node.nodeType == 3){return null;}if(node.nodeName == 'A'){return node;}var lastChild=node.lastChild;while(lastChild) {if(lastChild.nodeName == 'A'){return lastChild;}if(lastChild.nodeType == 3){if(domUtils.isWhitespace(lastChild)){lastChild = lastChild.previousSibling;continue;}return null;}lastChild = lastChild.lastChild;}}browser.ie && this.addListener('keyup',function(cmd,evt){var me=this,keyCode=evt.keyCode;if(keyCodes[keyCode]){var rng=me.selection.getRange();var start=rng.startContainer;if(keyCode == 13){while(start && !domUtils.isBody(start) && !domUtils.isBlockElm(start)) {start = start.parentNode;}if(start && !domUtils.isBody(start) && start.nodeName == 'P'){var pre=start.previousSibling;if(pre && pre.nodeType == 1){var pre=checkIsCludeLink(pre);if(pre && !pre.getAttribute('_href')){domUtils.remove(pre,true);}}}}else if(keyCode == 32){if(start.nodeType == 3 && /^\\s$/.test(start.nodeValue)){start = start.previousSibling;if(start && start.nodeName == 'A' && !start.getAttribute('_href')){domUtils.remove(start,true);}}}else {start = domUtils.findParentByTagName(start,'a',true);if(start && !start.getAttribute('_href')){var bk=rng.createBookmark();domUtils.remove(start,true);rng.moveToBookmark(bk).select(true);}}}});}); // plugins/autoheight.js\n///import core\n///commands 当输入内容超过编辑器高度时，编辑器自动增高\n///commandsName  AutoHeight,autoHeightEnabled\n///commandsTitle  自动增高\n/**\r\n * @description 自动伸展\r\n * @author zhanyi\r\n */UE.plugins['autoheight'] = function(){var me=this; //提供开关，就算加载也可以关闭\nme.autoHeightEnabled = me.options.autoHeightEnabled !== false;if(!me.autoHeightEnabled){return;}var bakOverflow,lastHeight=0,options=me.options,currentHeight,timer;function adjustHeight(){var me=this;clearTimeout(timer);if(isFullscreen)return;if(!me.queryCommandState || me.queryCommandState && me.queryCommandState('source') != 1){timer = setTimeout(function(){var node=me.body.lastChild;while(node && node.nodeType != 1) {node = node.previousSibling;}if(node && node.nodeType == 1){node.style.clear = 'both';currentHeight = Math.max(domUtils.getXY(node).y + node.offsetHeight + 25,Math.max(options.minFrameHeight,options.initialFrameHeight));if(currentHeight != lastHeight){if(currentHeight !== parseInt(me.iframe.parentNode.style.height)){me.iframe.parentNode.style.height = currentHeight + 'px';}me.body.style.height = currentHeight + 'px';lastHeight = currentHeight;}domUtils.removeStyle(node,'clear');}},50);}}var isFullscreen;me.addListener('fullscreenchanged',function(cmd,f){isFullscreen = f;});me.addListener('destroy',function(){me.removeListener('contentchange afterinserthtml keyup mouseup',adjustHeight);});me.enableAutoHeight = function(){var me=this;if(!me.autoHeightEnabled){return;}var doc=me.document;me.autoHeightEnabled = true;bakOverflow = doc.body.style.overflowY;doc.body.style.overflowY = 'hidden';me.addListener('contentchange afterinserthtml keyup mouseup',adjustHeight); //ff不给事件算得不对\nsetTimeout(function(){adjustHeight.call(me);},browser.gecko?100:0);me.fireEvent('autoheightchanged',me.autoHeightEnabled);};me.disableAutoHeight = function(){me.body.style.overflowY = bakOverflow || '';me.removeListener('contentchange',adjustHeight);me.removeListener('keyup',adjustHeight);me.removeListener('mouseup',adjustHeight);me.autoHeightEnabled = false;me.fireEvent('autoheightchanged',me.autoHeightEnabled);};me.on('setHeight',function(){me.disableAutoHeight();});me.addListener('ready',function(){me.enableAutoHeight(); //trace:1764\nvar timer;domUtils.on(browser.ie?me.body:me.document,browser.webkit?'dragover':'drop',function(){clearTimeout(timer);timer = setTimeout(function(){ //trace:3681\nadjustHeight.call(me);},100);}); //修复内容过多时，回到顶部，顶部内容被工具栏遮挡问题\nvar lastScrollY;window.onscroll = function(){if(lastScrollY === null){lastScrollY = this.scrollY;}else if(this.scrollY == 0 && lastScrollY != 0){me.window.scrollTo(0,0);lastScrollY = null;}};});}; // plugins/autofloat.js\n///import core\n///commands 悬浮工具栏\n///commandsName  AutoFloat,autoFloatEnabled\n///commandsTitle  悬浮工具栏\n/**\r\n *  modified by chengchao01\r\n *  注意： 引入此功能后，在IE6下会将body的背景图片覆盖掉！\r\n */UE.plugins['autofloat'] = function(){var me=this,lang=me.getLang();me.setOpt({topOffset:0});var optsAutoFloatEnabled=me.options.autoFloatEnabled !== false,topOffset=me.options.topOffset; //如果不固定toolbar的位置，则直接退出\nif(!optsAutoFloatEnabled){return;}var uiUtils=UE.ui.uiUtils,LteIE6=browser.ie && browser.version <= 6,quirks=browser.quirks;function checkHasUI(){if(!UE.ui){alert(lang.autofloatMsg);return 0;}return 1;}function fixIE6FixedPos(){var docStyle=document.body.style;docStyle.backgroundImage = 'url(\"about:blank\")';docStyle.backgroundAttachment = 'fixed';}var bakCssText,placeHolder=document.createElement('div'),toolbarBox,orgTop,getPosition,flag=true; //ie7模式下需要偏移\nfunction setFloating(){var toobarBoxPos=domUtils.getXY(toolbarBox),origalFloat=domUtils.getComputedStyle(toolbarBox,'position'),origalLeft=domUtils.getComputedStyle(toolbarBox,'left');toolbarBox.style.width = toolbarBox.offsetWidth + 'px';toolbarBox.style.zIndex = me.options.zIndex * 1 + 1;toolbarBox.parentNode.insertBefore(placeHolder,toolbarBox);if(LteIE6 || quirks && browser.ie){if(toolbarBox.style.position != 'absolute'){toolbarBox.style.position = 'absolute';}toolbarBox.style.top = (document.body.scrollTop || document.documentElement.scrollTop) - orgTop + topOffset + 'px';}else {if(browser.ie7Compat && flag){flag = false;toolbarBox.style.left = domUtils.getXY(toolbarBox).x - document.documentElement.getBoundingClientRect().left + 2 + 'px';}if(toolbarBox.style.position != 'fixed'){toolbarBox.style.position = 'fixed';toolbarBox.style.top = topOffset + \"px\";(origalFloat == 'absolute' || origalFloat == 'relative') && parseFloat(origalLeft) && (toolbarBox.style.left = toobarBoxPos.x + 'px');}}}function unsetFloating(){flag = true;if(placeHolder.parentNode){placeHolder.parentNode.removeChild(placeHolder);}toolbarBox.style.cssText = bakCssText;}function updateFloating(){var rect3=getPosition(me.container);var offset=me.options.toolbarTopOffset || 0;if(rect3.top < 0 && rect3.bottom - toolbarBox.offsetHeight > offset){setFloating();}else {unsetFloating();}}var defer_updateFloating=utils.defer(function(){updateFloating();},browser.ie?200:100,true);me.addListener('destroy',function(){domUtils.un(window,['scroll','resize'],updateFloating);me.removeListener('keydown',defer_updateFloating);});me.addListener('ready',function(){if(checkHasUI(me)){ //加载了ui组件，但在new时，没有加载ui，导致编辑器实例上没有ui类，所以这里做判断\nif(!me.ui){return;}getPosition = uiUtils.getClientRect;toolbarBox = me.ui.getDom('toolbarbox');orgTop = getPosition(toolbarBox).top;bakCssText = toolbarBox.style.cssText;placeHolder.style.height = toolbarBox.offsetHeight + 'px';if(LteIE6){fixIE6FixedPos();}domUtils.on(window,['scroll','resize'],updateFloating);me.addListener('keydown',defer_updateFloating);me.addListener('beforefullscreenchange',function(t,enabled){if(enabled){unsetFloating();}});me.addListener('fullscreenchanged',function(t,enabled){if(!enabled){updateFloating();}});me.addListener('sourcemodechanged',function(t,enabled){setTimeout(function(){updateFloating();},0);});me.addListener(\"clearDoc\",function(){setTimeout(function(){updateFloating();},0);});}});}; // plugins/video.js\n/**\r\n * video插件， 为UEditor提供视频插入支持\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['video'] = function(){var me=this; /**\r\n     * 创建插入视频字符窜\r\n     * @param url 视频地址\r\n     * @param width 视频宽度\r\n     * @param height 视频高度\r\n     * @param align 视频对齐\r\n     * @param toEmbed 是否以flash代替显示\r\n     * @param addParagraph  是否需要添加P 标签\r\n     */function creatInsertStr(url,width,height,id,align,classname,type){var str;switch(type){case 'image':str = '<img ' + (id?'id=\"' + id + '\"':'') + ' width=\"' + width + '\" height=\"' + height + '\" _url=\"' + url + '\" class=\"' + classname.replace(/\\bvideo-js\\b/,'') + '\"' + ' src=\"' + me.options.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif\" style=\"background:url(' + me.options.UEDITOR_HOME_URL + 'themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;' + (align?'float:' + align + ';':'') + '\" />';break;case 'embed':str = '<embed type=\"application/x-shockwave-flash\" class=\"' + classname + '\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\"' + ' src=\"' + utils.html(url) + '\" width=\"' + width + '\" height=\"' + height + '\"' + (align?' style=\"float:' + align + '\"':'') + ' wmode=\"transparent\" play=\"true\" loop=\"false\" menu=\"false\" allowscriptaccess=\"never\" allowfullscreen=\"true\" >';break;case 'video':var ext=url.substr(url.lastIndexOf('.') + 1);if(ext == 'ogv')ext = 'ogg';str = '<video' + (id?' id=\"' + id + '\"':'') + ' class=\"' + classname + ' video-js\" ' + (align?' style=\"float:' + align + '\"':'') + ' controls preload=\"none\" width=\"' + width + '\" height=\"' + height + '\" src=\"' + url + '\" data-setup=\"{}\">' + '<source src=\"' + url + '\" type=\"video/' + ext + '\" /></video>';break;}return str;}function switchImgAndVideo(root,img2video){utils.each(root.getNodesByTagName(img2video?'img':'embed video'),function(node){var className=node.getAttr('class');if(className && className.indexOf('edui-faked-video') != -1){var html=creatInsertStr(img2video?node.getAttr('_url'):node.getAttr('src'),node.getAttr('width'),node.getAttr('height'),null,node.getStyle('float') || '',className,img2video?'embed':'image');node.parentNode.replaceChild(UE.uNode.createElement(html),node);}if(className && className.indexOf('edui-upload-video') != -1){var html=creatInsertStr(img2video?node.getAttr('_url'):node.getAttr('src'),node.getAttr('width'),node.getAttr('height'),null,node.getStyle('float') || '',className,img2video?'video':'image');node.parentNode.replaceChild(UE.uNode.createElement(html),node);}});}me.addOutputRule(function(root){switchImgAndVideo(root,true);});me.addInputRule(function(root){switchImgAndVideo(root);}); /**\r\n     * 插入视频\r\n     * @command insertvideo\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { Object } videoAttr 键值对对象， 描述一个视频的所有属性\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var videoAttr = {\r\n     *      //视频地址\r\n     *      url: 'http://www.youku.com/xxx',\r\n     *      //视频宽高值， 单位px\r\n     *      width: 200,\r\n     *      height: 100\r\n     * };\r\n     *\r\n     * //editor 是编辑器实例\r\n     * //向编辑器插入单个视频\r\n     * editor.execCommand( 'insertvideo', videoAttr );\r\n     * ```\r\n     */ /**\r\n     * 插入视频\r\n     * @command insertvideo\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @param { Array } videoArr 需要插入的视频的数组， 其中的每一个元素都是一个键值对对象， 描述了一个视频的所有属性\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * var videoAttr1 = {\r\n     *      //视频地址\r\n     *      url: 'http://www.youku.com/xxx',\r\n     *      //视频宽高值， 单位px\r\n     *      width: 200,\r\n     *      height: 100\r\n     * },\r\n     * videoAttr2 = {\r\n     *      //视频地址\r\n     *      url: 'http://www.youku.com/xxx',\r\n     *      //视频宽高值， 单位px\r\n     *      width: 200,\r\n     *      height: 100\r\n     * }\r\n     *\r\n     * //editor 是编辑器实例\r\n     * //该方法将会向编辑器内插入两个视频\r\n     * editor.execCommand( 'insertvideo', [ videoAttr1, videoAttr2 ] );\r\n     * ```\r\n     */ /**\r\n     * 查询当前光标所在处是否是一个视频\r\n     * @command insertvideo\r\n     * @method queryCommandState\r\n     * @param { String } cmd 需要查询的命令字符串\r\n     * @return { int } 如果当前光标所在处的元素是一个视频对象， 则返回1，否则返回0\r\n     * @example\r\n     * ```javascript\r\n     *\r\n     * //editor 是编辑器实例\r\n     * editor.queryCommandState( 'insertvideo' );\r\n     * ```\r\n     */me.commands[\"insertvideo\"] = {execCommand:function execCommand(cmd,videoObjs,type){videoObjs = utils.isArray(videoObjs)?videoObjs:[videoObjs];var html=[],id='tmpVedio',cl;for(var i=0,vi,len=videoObjs.length;i < len;i++) {vi = videoObjs[i];cl = type == 'upload'?'edui-upload-video video-js vjs-default-skin':'edui-faked-video';html.push(creatInsertStr(vi.url,vi.width || 420,vi.height || 280,id + i,null,cl,'image'));}me.execCommand(\"inserthtml\",html.join(\"\"),true);var rng=this.selection.getRange();for(var i=0,len=videoObjs.length;i < len;i++) {var img=this.document.getElementById('tmpVedio' + i);domUtils.removeAttributes(img,'id');rng.selectNode(img).select();me.execCommand('imagefloat',videoObjs[i].align);}},queryCommandState:function queryCommandState(){var img=me.selection.getRange().getClosedNode(),flag=img && (img.className == \"edui-faked-video\" || img.className.indexOf(\"edui-upload-video\") != -1);return flag?1:0;}};}; // plugins/table.core.js\n/**\r\n * Created with JetBrains WebStorm.\r\n * User: taoqili\r\n * Date: 13-1-18\r\n * Time: 上午11:09\r\n * To change this template use File | Settings | File Templates.\r\n */ /**\r\n * UE表格操作类\r\n * @param table\r\n * @constructor\r\n */(function(){var UETable=UE.UETable = function(table){this.table = table;this.indexTable = [];this.selectedTds = [];this.cellsRange = {};this.update(table);}; //===以下为静态工具方法===\nUETable.removeSelectedClass = function(cells){utils.each(cells,function(cell){domUtils.removeClasses(cell,\"selectTdClass\");});};UETable.addSelectedClass = function(cells){utils.each(cells,function(cell){domUtils.addClass(cell,\"selectTdClass\");});};UETable.isEmptyBlock = function(node){var reg=new RegExp(domUtils.fillChar,'g');if(node[browser.ie?'innerText':'textContent'].replace(/^\\s*$/,'').replace(reg,'').length > 0){return 0;}for(var i in dtd.$isNotEmpty) if(dtd.$isNotEmpty.hasOwnProperty(i)){if(node.getElementsByTagName(i).length){return 0;}}return 1;};UETable.getWidth = function(cell){if(!cell)return 0;return parseInt(domUtils.getComputedStyle(cell,\"width\"),10);}; /**\r\n     * 获取单元格或者单元格组的“对齐”状态。 如果当前的检测对象是一个单元格组， 只有在满足所有单元格的 水平和竖直 对齐属性都相同的\r\n     * 条件时才会返回其状态值，否则将返回null； 如果当前只检测了一个单元格， 则直接返回当前单元格的对齐状态；\r\n     * @param table cell or table cells , 支持单个单元格dom对象 或者 单元格dom对象数组\r\n     * @return { align: 'left' || 'right' || 'center', valign: 'top' || 'middle' || 'bottom' } 或者 null\r\n     */UETable.getTableCellAlignState = function(cells){!utils.isArray(cells) && (cells = [cells]);var result={},status=['align','valign'],tempStatus=null,isSame=true; //状态是否相同\nutils.each(cells,function(cellNode){utils.each(status,function(currentState){tempStatus = cellNode.getAttribute(currentState);if(!result[currentState] && tempStatus){result[currentState] = tempStatus;}else if(!result[currentState] || tempStatus !== result[currentState]){isSame = false;return false;}});return isSame;});return isSame?result:null;}; /**\r\n     * 根据当前选区获取相关的table信息\r\n     * @return {Object}\r\n     */UETable.getTableItemsByRange = function(editor){var start=editor.selection.getStart(); //ff下会选中bookmark\nif(start && start.id && start.id.indexOf('_baidu_bookmark_start_') === 0 && start.nextSibling){start = start.nextSibling;} //在table或者td边缘有可能存在选中tr的情况\nvar cell=start && domUtils.findParentByTagName(start,[\"td\",\"th\"],true),tr=cell && cell.parentNode,caption=start && domUtils.findParentByTagName(start,'caption',true),table=caption?caption.parentNode:tr && tr.parentNode.parentNode;return {cell:cell,tr:tr,table:table,caption:caption};};UETable.getUETableBySelected = function(editor){var table=UETable.getTableItemsByRange(editor).table;if(table && table.ueTable && table.ueTable.selectedTds.length){return table.ueTable;}return null;};UETable.getDefaultValue = function(editor,table){var borderMap={thin:'0px',medium:'1px',thick:'2px'},tableBorder,tdPadding,tdBorder,tmpValue;if(!table){table = editor.document.createElement('table');table.insertRow(0).insertCell(0).innerHTML = 'xxx';editor.body.appendChild(table);var td=table.getElementsByTagName('td')[0];tmpValue = domUtils.getComputedStyle(table,'border-left-width');tableBorder = parseInt(borderMap[tmpValue] || tmpValue,10);tmpValue = domUtils.getComputedStyle(td,'padding-left');tdPadding = parseInt(borderMap[tmpValue] || tmpValue,10);tmpValue = domUtils.getComputedStyle(td,'border-left-width');tdBorder = parseInt(borderMap[tmpValue] || tmpValue,10);domUtils.remove(table);return {tableBorder:tableBorder,tdPadding:tdPadding,tdBorder:tdBorder};}else {td = table.getElementsByTagName('td')[0];tmpValue = domUtils.getComputedStyle(table,'border-left-width');tableBorder = parseInt(borderMap[tmpValue] || tmpValue,10);tmpValue = domUtils.getComputedStyle(td,'padding-left');tdPadding = parseInt(borderMap[tmpValue] || tmpValue,10);tmpValue = domUtils.getComputedStyle(td,'border-left-width');tdBorder = parseInt(borderMap[tmpValue] || tmpValue,10);return {tableBorder:tableBorder,tdPadding:tdPadding,tdBorder:tdBorder};}}; /**\r\n     * 根据当前点击的td或者table获取索引对象\r\n     * @param tdOrTable\r\n     */UETable.getUETable = function(tdOrTable){var tag=tdOrTable.tagName.toLowerCase();tdOrTable = tag == \"td\" || tag == \"th\" || tag == 'caption'?domUtils.findParentByTagName(tdOrTable,\"table\",true):tdOrTable;if(!tdOrTable.ueTable){tdOrTable.ueTable = new UETable(tdOrTable);}return tdOrTable.ueTable;};UETable.cloneCell = function(cell,ignoreMerge,keepPro){if(!cell || utils.isString(cell)){return this.table.ownerDocument.createElement(cell || 'td');}var flag=domUtils.hasClass(cell,\"selectTdClass\");flag && domUtils.removeClasses(cell,\"selectTdClass\");var tmpCell=cell.cloneNode(true);if(ignoreMerge){tmpCell.rowSpan = tmpCell.colSpan = 1;} //去掉宽高\n!keepPro && domUtils.removeAttributes(tmpCell,'width height');!keepPro && domUtils.removeAttributes(tmpCell,'style');tmpCell.style.borderLeftStyle = \"\";tmpCell.style.borderTopStyle = \"\";tmpCell.style.borderLeftColor = cell.style.borderRightColor;tmpCell.style.borderLeftWidth = cell.style.borderRightWidth;tmpCell.style.borderTopColor = cell.style.borderBottomColor;tmpCell.style.borderTopWidth = cell.style.borderBottomWidth;flag && domUtils.addClass(cell,\"selectTdClass\");return tmpCell;};UETable.prototype = {getMaxRows:function getMaxRows(){var rows=this.table.rows,maxLen=1;for(var i=0,row;row = rows[i];i++) {var currentMax=1;for(var j=0,cj;cj = row.cells[j++];) {currentMax = Math.max(cj.rowSpan || 1,currentMax);}maxLen = Math.max(currentMax + i,maxLen);}return maxLen;}, /**\r\n         * 获取当前表格的最大列数\r\n         */getMaxCols:function getMaxCols(){var rows=this.table.rows,maxLen=0,cellRows={};for(var i=0,row;row = rows[i];i++) {var cellsNum=0;for(var j=0,cj;cj = row.cells[j++];) {cellsNum += cj.colSpan || 1;if(cj.rowSpan && cj.rowSpan > 1){for(var k=1;k < cj.rowSpan;k++) {if(!cellRows['row_' + (i + k)]){cellRows['row_' + (i + k)] = cj.colSpan || 1;}else {cellRows['row_' + (i + k)]++;}}}}cellsNum += cellRows['row_' + i] || 0;maxLen = Math.max(cellsNum,maxLen);}return maxLen;},getCellColIndex:function getCellColIndex(cell){}, /**\r\n         * 获取当前cell旁边的单元格，\r\n         * @param cell\r\n         * @param right\r\n         */getHSideCell:function getHSideCell(cell,right){try{var cellInfo=this.getCellInfo(cell),previewRowIndex,previewColIndex;var len=this.selectedTds.length,range=this.cellsRange; //首行或者首列没有前置单元格\nif(!right && (!len?!cellInfo.colIndex:!range.beginColIndex) || right && (!len?cellInfo.colIndex == this.colsNum - 1:range.endColIndex == this.colsNum - 1))return null;previewRowIndex = !len?cellInfo.rowIndex:range.beginRowIndex;previewColIndex = !right?!len?cellInfo.colIndex < 1?0:cellInfo.colIndex - 1:range.beginColIndex - 1:!len?cellInfo.colIndex + 1:range.endColIndex + 1;return this.getCell(this.indexTable[previewRowIndex][previewColIndex].rowIndex,this.indexTable[previewRowIndex][previewColIndex].cellIndex);}catch(e) {showError(e);}},getTabNextCell:function getTabNextCell(cell,preRowIndex){var cellInfo=this.getCellInfo(cell),rowIndex=preRowIndex || cellInfo.rowIndex,colIndex=cellInfo.colIndex + 1 + (cellInfo.colSpan - 1),nextCell;try{nextCell = this.getCell(this.indexTable[rowIndex][colIndex].rowIndex,this.indexTable[rowIndex][colIndex].cellIndex);}catch(e) {try{rowIndex = rowIndex * 1 + 1;colIndex = 0;nextCell = this.getCell(this.indexTable[rowIndex][colIndex].rowIndex,this.indexTable[rowIndex][colIndex].cellIndex);}catch(e) {}}return nextCell;}, /**\r\n         * 获取视觉上的后置单元格\r\n         * @param cell\r\n         * @param bottom\r\n         */getVSideCell:function getVSideCell(cell,bottom,ignoreRange){try{var cellInfo=this.getCellInfo(cell),nextRowIndex,nextColIndex;var len=this.selectedTds.length && !ignoreRange,range=this.cellsRange; //末行或者末列没有后置单元格\nif(!bottom && cellInfo.rowIndex == 0 || bottom && (!len?cellInfo.rowIndex + cellInfo.rowSpan > this.rowsNum - 1:range.endRowIndex == this.rowsNum - 1))return null;nextRowIndex = !bottom?!len?cellInfo.rowIndex - 1:range.beginRowIndex - 1:!len?cellInfo.rowIndex + cellInfo.rowSpan:range.endRowIndex + 1;nextColIndex = !len?cellInfo.colIndex:range.beginColIndex;return this.getCell(this.indexTable[nextRowIndex][nextColIndex].rowIndex,this.indexTable[nextRowIndex][nextColIndex].cellIndex);}catch(e) {showError(e);}}, /**\r\n         * 获取相同结束位置的单元格，xOrY指代了是获取x轴相同还是y轴相同\r\n         */getSameEndPosCells:function getSameEndPosCells(cell,xOrY){try{var flag=xOrY.toLowerCase() === \"x\",end=domUtils.getXY(cell)[flag?'x':'y'] + cell[\"offset\" + (flag?'Width':'Height')],rows=this.table.rows,cells=null,returns=[];for(var i=0;i < this.rowsNum;i++) {cells = rows[i].cells;for(var j=0,tmpCell;tmpCell = cells[j++];) {var tmpEnd=domUtils.getXY(tmpCell)[flag?'x':'y'] + tmpCell[\"offset\" + (flag?'Width':'Height')]; //对应行的td已经被上面行rowSpan了\nif(tmpEnd > end && flag)break;if(cell == tmpCell || end == tmpEnd){ //只获取单一的单元格\n//todo 仅获取单一单元格在特定情况下会造成returns为空，从而影响后续的拖拽实现，修正这个。需考虑性能\nif(tmpCell[flag?\"colSpan\":\"rowSpan\"] == 1){returns.push(tmpCell);}if(flag)break;}}}return returns;}catch(e) {showError(e);}},setCellContent:function setCellContent(cell,content){cell.innerHTML = content || (browser.ie?domUtils.fillChar:\"<br />\");},cloneCell:UETable.cloneCell, /**\r\n         * 获取跟当前单元格的右边竖线为左边的所有未合并单元格\r\n         */getSameStartPosXCells:function getSameStartPosXCells(cell){try{var start=domUtils.getXY(cell).x + cell.offsetWidth,rows=this.table.rows,cells,returns=[];for(var i=0;i < this.rowsNum;i++) {cells = rows[i].cells;for(var j=0,tmpCell;tmpCell = cells[j++];) {var tmpStart=domUtils.getXY(tmpCell).x;if(tmpStart > start)break;if(tmpStart == start && tmpCell.colSpan == 1){returns.push(tmpCell);break;}}}return returns;}catch(e) {showError(e);}}, /**\r\n         * 更新table对应的索引表\r\n         */update:function update(table){this.table = table || this.table;this.selectedTds = [];this.cellsRange = {};this.indexTable = [];var rows=this.table.rows,rowsNum=this.getMaxRows(),dNum=rowsNum - rows.length,colsNum=this.getMaxCols();while(dNum--) {this.table.insertRow(rows.length);}this.rowsNum = rowsNum;this.colsNum = colsNum;for(var i=0,len=rows.length;i < len;i++) {this.indexTable[i] = new Array(colsNum);} //填充索引表\nfor(var rowIndex=0,row;row = rows[rowIndex];rowIndex++) {for(var cellIndex=0,cell,cells=row.cells;cell = cells[cellIndex];cellIndex++) { //修正整行被rowSpan时导致的行数计算错误\nif(cell.rowSpan > rowsNum){cell.rowSpan = rowsNum;}var colIndex=cellIndex,rowSpan=cell.rowSpan || 1,colSpan=cell.colSpan || 1; //当已经被上一行rowSpan或者被前一列colSpan了，则跳到下一个单元格进行\nwhile(this.indexTable[rowIndex][colIndex]) colIndex++;for(var j=0;j < rowSpan;j++) {for(var k=0;k < colSpan;k++) {this.indexTable[rowIndex + j][colIndex + k] = {rowIndex:rowIndex,cellIndex:cellIndex,colIndex:colIndex,rowSpan:rowSpan,colSpan:colSpan};}}}} //修复残缺td\nfor(j = 0;j < rowsNum;j++) {for(k = 0;k < colsNum;k++) {if(this.indexTable[j][k] === undefined){row = rows[j];cell = row.cells[row.cells.length - 1];cell = cell?cell.cloneNode(true):this.table.ownerDocument.createElement(\"td\");this.setCellContent(cell);if(cell.colSpan !== 1)cell.colSpan = 1;if(cell.rowSpan !== 1)cell.rowSpan = 1;row.appendChild(cell);this.indexTable[j][k] = {rowIndex:j,cellIndex:cell.cellIndex,colIndex:k,rowSpan:1,colSpan:1};}}} //当框选后删除行或者列后撤销，需要重建选区。\nvar tds=domUtils.getElementsByTagName(this.table,\"td\"),selectTds=[];utils.each(tds,function(td){if(domUtils.hasClass(td,\"selectTdClass\")){selectTds.push(td);}});if(selectTds.length){var start=selectTds[0],end=selectTds[selectTds.length - 1],startInfo=this.getCellInfo(start),endInfo=this.getCellInfo(end);this.selectedTds = selectTds;this.cellsRange = {beginRowIndex:startInfo.rowIndex,beginColIndex:startInfo.colIndex,endRowIndex:endInfo.rowIndex + endInfo.rowSpan - 1,endColIndex:endInfo.colIndex + endInfo.colSpan - 1};} //给第一行设置firstRow的样式名称,在排序图标的样式上使用到\nif(!domUtils.hasClass(this.table.rows[0],\"firstRow\")){domUtils.addClass(this.table.rows[0],\"firstRow\");for(var i=1;i < this.table.rows.length;i++) {domUtils.removeClasses(this.table.rows[i],\"firstRow\");}}}, /**\r\n         * 获取单元格的索引信息\r\n         */getCellInfo:function getCellInfo(cell){if(!cell)return;var cellIndex=cell.cellIndex,rowIndex=cell.parentNode.rowIndex,rowInfo=this.indexTable[rowIndex],numCols=this.colsNum;for(var colIndex=cellIndex;colIndex < numCols;colIndex++) {var cellInfo=rowInfo[colIndex];if(cellInfo.rowIndex === rowIndex && cellInfo.cellIndex === cellIndex){return cellInfo;}}}, /**\r\n         * 根据行列号获取单元格\r\n         */getCell:function getCell(rowIndex,cellIndex){return rowIndex < this.rowsNum && this.table.rows[rowIndex].cells[cellIndex] || null;}, /**\r\n         * 删除单元格\r\n         */deleteCell:function deleteCell(cell,rowIndex){rowIndex = typeof rowIndex == 'number'?rowIndex:cell.parentNode.rowIndex;var row=this.table.rows[rowIndex];row.deleteCell(cell.cellIndex);}, /**\r\n         * 根据始末两个单元格获取被框选的所有单元格范围\r\n         */getCellsRange:function getCellsRange(cellA,cellB){function checkRange(_x7,_x8,_x9,_x10){var _again2=true;_function2: while(_again2) {var beginRowIndex=_x7,beginColIndex=_x8,endRowIndex=_x9,endColIndex=_x10;_again2 = false;var tmpBeginRowIndex=beginRowIndex,tmpBeginColIndex=beginColIndex,tmpEndRowIndex=endRowIndex,tmpEndColIndex=endColIndex,cellInfo,colIndex,rowIndex; // 通过indexTable检查是否存在超出TableRange上边界的情况\nif(beginRowIndex > 0){for(colIndex = beginColIndex;colIndex < endColIndex;colIndex++) {cellInfo = me.indexTable[beginRowIndex][colIndex];rowIndex = cellInfo.rowIndex;if(rowIndex < beginRowIndex){tmpBeginRowIndex = Math.min(rowIndex,tmpBeginRowIndex);}}} // 通过indexTable检查是否存在超出TableRange右边界的情况\nif(endColIndex < me.colsNum){for(rowIndex = beginRowIndex;rowIndex < endRowIndex;rowIndex++) {cellInfo = me.indexTable[rowIndex][endColIndex];colIndex = cellInfo.colIndex + cellInfo.colSpan - 1;if(colIndex > endColIndex){tmpEndColIndex = Math.max(colIndex,tmpEndColIndex);}}} // 检查是否有超出TableRange下边界的情况\nif(endRowIndex < me.rowsNum){for(colIndex = beginColIndex;colIndex < endColIndex;colIndex++) {cellInfo = me.indexTable[endRowIndex][colIndex];rowIndex = cellInfo.rowIndex + cellInfo.rowSpan - 1;if(rowIndex > endRowIndex){tmpEndRowIndex = Math.max(rowIndex,tmpEndRowIndex);}}} // 检查是否有超出TableRange左边界的情况\nif(beginColIndex > 0){for(rowIndex = beginRowIndex;rowIndex < endRowIndex;rowIndex++) {cellInfo = me.indexTable[rowIndex][beginColIndex];colIndex = cellInfo.colIndex;if(colIndex < beginColIndex){tmpBeginColIndex = Math.min(cellInfo.colIndex,tmpBeginColIndex);}}} //递归调用直至所有完成所有框选单元格的扩展\nif(tmpBeginRowIndex != beginRowIndex || tmpBeginColIndex != beginColIndex || tmpEndRowIndex != endRowIndex || tmpEndColIndex != endColIndex){_x7 = tmpBeginRowIndex;_x8 = tmpBeginColIndex;_x9 = tmpEndRowIndex;_x10 = tmpEndColIndex;_again2 = true;tmpBeginRowIndex = tmpBeginColIndex = tmpEndRowIndex = tmpEndColIndex = cellInfo = colIndex = rowIndex = undefined;continue _function2;}else { // 不需要扩展TableRange的情况\nreturn {beginRowIndex:beginRowIndex,beginColIndex:beginColIndex,endRowIndex:endRowIndex,endColIndex:endColIndex};}}}try{var me=this,cellAInfo=me.getCellInfo(cellA);if(cellA === cellB){return {beginRowIndex:cellAInfo.rowIndex,beginColIndex:cellAInfo.colIndex,endRowIndex:cellAInfo.rowIndex + cellAInfo.rowSpan - 1,endColIndex:cellAInfo.colIndex + cellAInfo.colSpan - 1};}var cellBInfo=me.getCellInfo(cellB); // 计算TableRange的四个边\nvar beginRowIndex=Math.min(cellAInfo.rowIndex,cellBInfo.rowIndex),beginColIndex=Math.min(cellAInfo.colIndex,cellBInfo.colIndex),endRowIndex=Math.max(cellAInfo.rowIndex + cellAInfo.rowSpan - 1,cellBInfo.rowIndex + cellBInfo.rowSpan - 1),endColIndex=Math.max(cellAInfo.colIndex + cellAInfo.colSpan - 1,cellBInfo.colIndex + cellBInfo.colSpan - 1);return checkRange(beginRowIndex,beginColIndex,endRowIndex,endColIndex);}catch(e) { //throw e;\n}}, /**\r\n         * 依据cellsRange获取对应的单元格集合\r\n         */getCells:function getCells(range){ //每次获取cells之前必须先清除上次的选择，否则会对后续获取操作造成影响\nthis.clearSelected();var beginRowIndex=range.beginRowIndex,beginColIndex=range.beginColIndex,endRowIndex=range.endRowIndex,endColIndex=range.endColIndex,cellInfo,rowIndex,colIndex,tdHash={},returnTds=[];for(var i=beginRowIndex;i <= endRowIndex;i++) {for(var j=beginColIndex;j <= endColIndex;j++) {cellInfo = this.indexTable[i][j];rowIndex = cellInfo.rowIndex;colIndex = cellInfo.colIndex; // 如果Cells里已经包含了此Cell则跳过\nvar key=rowIndex + '|' + colIndex;if(tdHash[key])continue;tdHash[key] = 1;if(rowIndex < i || colIndex < j || rowIndex + cellInfo.rowSpan - 1 > endRowIndex || colIndex + cellInfo.colSpan - 1 > endColIndex){return null;}returnTds.push(this.getCell(rowIndex,cellInfo.cellIndex));}}return returnTds;}, /**\r\n         * 清理已经选中的单元格\r\n         */clearSelected:function clearSelected(){UETable.removeSelectedClass(this.selectedTds);this.selectedTds = [];this.cellsRange = {};}, /**\r\n         * 根据range设置已经选中的单元格\r\n         */setSelected:function setSelected(range){var cells=this.getCells(range);UETable.addSelectedClass(cells);this.selectedTds = cells;this.cellsRange = range;},isFullRow:function isFullRow(){var range=this.cellsRange;return range.endColIndex - range.beginColIndex + 1 == this.colsNum;},isFullCol:function isFullCol(){var range=this.cellsRange,table=this.table,ths=table.getElementsByTagName(\"th\"),rows=range.endRowIndex - range.beginRowIndex + 1;return !ths.length?rows == this.rowsNum:rows == this.rowsNum || rows == this.rowsNum - 1;}, /**\r\n         * 获取视觉上的前置单元格，默认是左边，top传入时\r\n         * @param cell\r\n         * @param top\r\n         */getNextCell:function getNextCell(cell,bottom,ignoreRange){try{var cellInfo=this.getCellInfo(cell),nextRowIndex,nextColIndex;var len=this.selectedTds.length && !ignoreRange,range=this.cellsRange; //末行或者末列没有后置单元格\nif(!bottom && cellInfo.rowIndex == 0 || bottom && (!len?cellInfo.rowIndex + cellInfo.rowSpan > this.rowsNum - 1:range.endRowIndex == this.rowsNum - 1))return null;nextRowIndex = !bottom?!len?cellInfo.rowIndex - 1:range.beginRowIndex - 1:!len?cellInfo.rowIndex + cellInfo.rowSpan:range.endRowIndex + 1;nextColIndex = !len?cellInfo.colIndex:range.beginColIndex;return this.getCell(this.indexTable[nextRowIndex][nextColIndex].rowIndex,this.indexTable[nextRowIndex][nextColIndex].cellIndex);}catch(e) {showError(e);}},getPreviewCell:function getPreviewCell(cell,top){try{var cellInfo=this.getCellInfo(cell),previewRowIndex,previewColIndex;var len=this.selectedTds.length,range=this.cellsRange; //首行或者首列没有前置单元格\nif(!top && (!len?!cellInfo.colIndex:!range.beginColIndex) || top && (!len?cellInfo.rowIndex > this.colsNum - 1:range.endColIndex == this.colsNum - 1))return null;previewRowIndex = !top?!len?cellInfo.rowIndex:range.beginRowIndex:!len?cellInfo.rowIndex < 1?0:cellInfo.rowIndex - 1:range.beginRowIndex;previewColIndex = !top?!len?cellInfo.colIndex < 1?0:cellInfo.colIndex - 1:range.beginColIndex - 1:!len?cellInfo.colIndex:range.endColIndex + 1;return this.getCell(this.indexTable[previewRowIndex][previewColIndex].rowIndex,this.indexTable[previewRowIndex][previewColIndex].cellIndex);}catch(e) {showError(e);}}, /**\r\n         * 移动单元格中的内容\r\n         */moveContent:function moveContent(cellTo,cellFrom){if(UETable.isEmptyBlock(cellFrom))return;if(UETable.isEmptyBlock(cellTo)){cellTo.innerHTML = cellFrom.innerHTML;return;}var child=cellTo.lastChild;if(child.nodeType == 3 || !dtd.$block[child.tagName]){cellTo.appendChild(cellTo.ownerDocument.createElement('br'));}while(child = cellFrom.firstChild) {cellTo.appendChild(child);}}, /**\r\n         * 向右合并单元格\r\n         */mergeRight:function mergeRight(cell){var cellInfo=this.getCellInfo(cell),rightColIndex=cellInfo.colIndex + cellInfo.colSpan,rightCellInfo=this.indexTable[cellInfo.rowIndex][rightColIndex],rightCell=this.getCell(rightCellInfo.rowIndex,rightCellInfo.cellIndex); //合并\ncell.colSpan = cellInfo.colSpan + rightCellInfo.colSpan; //被合并的单元格不应存在宽度属性\ncell.removeAttribute(\"width\"); //移动内容\nthis.moveContent(cell,rightCell); //删掉被合并的Cell\nthis.deleteCell(rightCell,rightCellInfo.rowIndex);this.update();}, /**\r\n         * 向下合并单元格\r\n         */mergeDown:function mergeDown(cell){var cellInfo=this.getCellInfo(cell),downRowIndex=cellInfo.rowIndex + cellInfo.rowSpan,downCellInfo=this.indexTable[downRowIndex][cellInfo.colIndex],downCell=this.getCell(downCellInfo.rowIndex,downCellInfo.cellIndex);cell.rowSpan = cellInfo.rowSpan + downCellInfo.rowSpan;cell.removeAttribute(\"height\");this.moveContent(cell,downCell);this.deleteCell(downCell,downCellInfo.rowIndex);this.update();}, /**\r\n         * 合并整个range中的内容\r\n         */mergeRange:function mergeRange(){ //由于合并操作可以在任意时刻进行，所以无法通过鼠标位置等信息实时生成range，只能通过缓存实例中的cellsRange对象来访问\nvar range=this.cellsRange,leftTopCell=this.getCell(range.beginRowIndex,this.indexTable[range.beginRowIndex][range.beginColIndex].cellIndex);if(leftTopCell.tagName == \"TH\" && range.endRowIndex !== range.beginRowIndex){var index=this.indexTable,info=this.getCellInfo(leftTopCell);leftTopCell = this.getCell(1,index[1][info.colIndex].cellIndex);range = this.getCellsRange(leftTopCell,this.getCell(index[this.rowsNum - 1][info.colIndex].rowIndex,index[this.rowsNum - 1][info.colIndex].cellIndex));} // 删除剩余的Cells\nvar cells=this.getCells(range);for(var i=0,ci;ci = cells[i++];) {if(ci !== leftTopCell){this.moveContent(leftTopCell,ci);this.deleteCell(ci);}} // 修改左上角Cell的rowSpan和colSpan，并调整宽度属性设置\nleftTopCell.rowSpan = range.endRowIndex - range.beginRowIndex + 1;leftTopCell.rowSpan > 1 && leftTopCell.removeAttribute(\"height\");leftTopCell.colSpan = range.endColIndex - range.beginColIndex + 1;leftTopCell.colSpan > 1 && leftTopCell.removeAttribute(\"width\");if(leftTopCell.rowSpan == this.rowsNum && leftTopCell.colSpan != 1){leftTopCell.colSpan = 1;}if(leftTopCell.colSpan == this.colsNum && leftTopCell.rowSpan != 1){var rowIndex=leftTopCell.parentNode.rowIndex; //解决IE下的表格操作问题\nif(this.table.deleteRow){for(var i=rowIndex + 1,curIndex=rowIndex + 1,len=leftTopCell.rowSpan;i < len;i++) {this.table.deleteRow(curIndex);}}else {for(var i=0,len=leftTopCell.rowSpan - 1;i < len;i++) {var row=this.table.rows[rowIndex + 1];row.parentNode.removeChild(row);}}leftTopCell.rowSpan = 1;}this.update();}, /**\r\n         * 插入一行单元格\r\n         */insertRow:function insertRow(rowIndex,sourceCell){var numCols=this.colsNum,table=this.table,row=table.insertRow(rowIndex),cell,isInsertTitle=typeof sourceCell == 'string' && sourceCell.toUpperCase() == 'TH';function replaceTdToTh(colIndex,cell,tableRow){if(colIndex == 0){var tr=tableRow.nextSibling || tableRow.previousSibling,th=tr.cells[colIndex];if(th.tagName == 'TH'){th = cell.ownerDocument.createElement(\"th\");th.appendChild(cell.firstChild);tableRow.insertBefore(th,cell);domUtils.remove(cell);}}else {if(cell.tagName == 'TH'){var td=cell.ownerDocument.createElement(\"td\");td.appendChild(cell.firstChild);tableRow.insertBefore(td,cell);domUtils.remove(cell);}}} //首行直接插入,无需考虑部分单元格被rowspan的情况\nif(rowIndex == 0 || rowIndex == this.rowsNum){for(var colIndex=0;colIndex < numCols;colIndex++) {cell = this.cloneCell(sourceCell,true);this.setCellContent(cell);cell.getAttribute('vAlign') && cell.setAttribute('vAlign',cell.getAttribute('vAlign'));row.appendChild(cell);if(!isInsertTitle)replaceTdToTh(colIndex,cell,row);}}else {var infoRow=this.indexTable[rowIndex],cellIndex=0;for(colIndex = 0;colIndex < numCols;colIndex++) {var cellInfo=infoRow[colIndex]; //如果存在某个单元格的rowspan穿过待插入行的位置，则修改该单元格的rowspan即可，无需插入单元格\nif(cellInfo.rowIndex < rowIndex){cell = this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);cell.rowSpan = cellInfo.rowSpan + 1;}else {cell = this.cloneCell(sourceCell,true);this.setCellContent(cell);row.appendChild(cell);}if(!isInsertTitle)replaceTdToTh(colIndex,cell,row);}} //框选时插入不触发contentchange，需要手动更新索引。\nthis.update();return row;}, /**\r\n         * 删除一行单元格\r\n         * @param rowIndex\r\n         */deleteRow:function deleteRow(rowIndex){var row=this.table.rows[rowIndex],infoRow=this.indexTable[rowIndex],colsNum=this.colsNum,count=0; //处理计数\nfor(var colIndex=0;colIndex < colsNum;) {var cellInfo=infoRow[colIndex],cell=this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);if(cell.rowSpan > 1){if(cellInfo.rowIndex == rowIndex){var clone=cell.cloneNode(true);clone.rowSpan = cell.rowSpan - 1;clone.innerHTML = \"\";cell.rowSpan = 1;var nextRowIndex=rowIndex + 1,nextRow=this.table.rows[nextRowIndex],insertCellIndex,preMerged=this.getPreviewMergedCellsNum(nextRowIndex,colIndex) - count;if(preMerged < colIndex){insertCellIndex = colIndex - preMerged - 1; //nextRow.insertCell(insertCellIndex);\ndomUtils.insertAfter(nextRow.cells[insertCellIndex],clone);}else {if(nextRow.cells.length)nextRow.insertBefore(clone,nextRow.cells[0]);}count += 1; //cell.parentNode.removeChild(cell);\n}}colIndex += cell.colSpan || 1;}var deleteTds=[],cacheMap={};for(colIndex = 0;colIndex < colsNum;colIndex++) {var tmpRowIndex=infoRow[colIndex].rowIndex,tmpCellIndex=infoRow[colIndex].cellIndex,key=tmpRowIndex + \"_\" + tmpCellIndex;if(cacheMap[key])continue;cacheMap[key] = 1;cell = this.getCell(tmpRowIndex,tmpCellIndex);deleteTds.push(cell);}var mergeTds=[];utils.each(deleteTds,function(td){if(td.rowSpan == 1){td.parentNode.removeChild(td);}else {mergeTds.push(td);}});utils.each(mergeTds,function(td){td.rowSpan--;});row.parentNode.removeChild(row); //浏览器方法本身存在bug,采用自定义方法删除\n//this.table.deleteRow(rowIndex);\nthis.update();},insertCol:function insertCol(colIndex,sourceCell,defaultValue){var rowsNum=this.rowsNum,rowIndex=0,tableRow,cell,backWidth=parseInt((this.table.offsetWidth - (this.colsNum + 1) * 20 - (this.colsNum + 1)) / (this.colsNum + 1),10),isInsertTitleCol=typeof sourceCell == 'string' && sourceCell.toUpperCase() == 'TH';function replaceTdToTh(rowIndex,cell,tableRow){if(rowIndex == 0){var th=cell.nextSibling || cell.previousSibling;if(th.tagName == 'TH'){th = cell.ownerDocument.createElement(\"th\");th.appendChild(cell.firstChild);tableRow.insertBefore(th,cell);domUtils.remove(cell);}}else {if(cell.tagName == 'TH'){var td=cell.ownerDocument.createElement(\"td\");td.appendChild(cell.firstChild);tableRow.insertBefore(td,cell);domUtils.remove(cell);}}}var preCell;if(colIndex == 0 || colIndex == this.colsNum){for(;rowIndex < rowsNum;rowIndex++) {tableRow = this.table.rows[rowIndex];preCell = tableRow.cells[colIndex == 0?colIndex:tableRow.cells.length];cell = this.cloneCell(sourceCell,true); //tableRow.insertCell(colIndex == 0 ? colIndex : tableRow.cells.length);\nthis.setCellContent(cell);cell.setAttribute('vAlign',cell.getAttribute('vAlign'));preCell && cell.setAttribute('width',preCell.getAttribute('width'));if(!colIndex){tableRow.insertBefore(cell,tableRow.cells[0]);}else {domUtils.insertAfter(tableRow.cells[tableRow.cells.length - 1],cell);}if(!isInsertTitleCol)replaceTdToTh(rowIndex,cell,tableRow);}}else {for(;rowIndex < rowsNum;rowIndex++) {var cellInfo=this.indexTable[rowIndex][colIndex];if(cellInfo.colIndex < colIndex){cell = this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);cell.colSpan = cellInfo.colSpan + 1;}else {tableRow = this.table.rows[rowIndex];preCell = tableRow.cells[cellInfo.cellIndex];cell = this.cloneCell(sourceCell,true); //tableRow.insertCell(cellInfo.cellIndex);\nthis.setCellContent(cell);cell.setAttribute('vAlign',cell.getAttribute('vAlign'));preCell && cell.setAttribute('width',preCell.getAttribute('width')); //防止IE下报错\npreCell?tableRow.insertBefore(cell,preCell):tableRow.appendChild(cell);}if(!isInsertTitleCol)replaceTdToTh(rowIndex,cell,tableRow);}} //框选时插入不触发contentchange，需要手动更新索引\nthis.update();this.updateWidth(backWidth,defaultValue || {tdPadding:10,tdBorder:1});},updateWidth:function updateWidth(width,defaultValue){var table=this.table,tmpWidth=UETable.getWidth(table) - defaultValue.tdPadding * 2 - defaultValue.tdBorder + width;if(tmpWidth < table.ownerDocument.body.offsetWidth){table.setAttribute(\"width\",tmpWidth);return;}var tds=domUtils.getElementsByTagName(this.table,\"td th\");utils.each(tds,function(td){td.setAttribute(\"width\",width);});},deleteCol:function deleteCol(colIndex){var indexTable=this.indexTable,tableRows=this.table.rows,backTableWidth=this.table.getAttribute(\"width\"),backTdWidth=0,rowsNum=this.rowsNum,cacheMap={};for(var rowIndex=0;rowIndex < rowsNum;) {var infoRow=indexTable[rowIndex],cellInfo=infoRow[colIndex],key=cellInfo.rowIndex + '_' + cellInfo.colIndex; // 跳过已经处理过的Cell\nif(cacheMap[key])continue;cacheMap[key] = 1;var cell=this.getCell(cellInfo.rowIndex,cellInfo.cellIndex);if(!backTdWidth)backTdWidth = cell && parseInt(cell.offsetWidth / cell.colSpan,10).toFixed(0); // 如果Cell的colSpan大于1, 就修改colSpan, 否则就删掉这个Cell\nif(cell.colSpan > 1){cell.colSpan--;}else {tableRows[rowIndex].deleteCell(cellInfo.cellIndex);}rowIndex += cellInfo.rowSpan || 1;}this.table.setAttribute(\"width\",backTableWidth - backTdWidth);this.update();},splitToCells:function splitToCells(cell){var me=this,cells=this.splitToRows(cell);utils.each(cells,function(cell){me.splitToCols(cell);});},splitToRows:function splitToRows(cell){var cellInfo=this.getCellInfo(cell),rowIndex=cellInfo.rowIndex,colIndex=cellInfo.colIndex,results=[]; // 修改Cell的rowSpan\ncell.rowSpan = 1;results.push(cell); // 补齐单元格\nfor(var i=rowIndex,endRow=rowIndex + cellInfo.rowSpan;i < endRow;i++) {if(i == rowIndex)continue;var tableRow=this.table.rows[i],tmpCell=tableRow.insertCell(colIndex - this.getPreviewMergedCellsNum(i,colIndex));tmpCell.colSpan = cellInfo.colSpan;this.setCellContent(tmpCell);tmpCell.setAttribute('vAlign',cell.getAttribute('vAlign'));tmpCell.setAttribute('align',cell.getAttribute('align'));if(cell.style.cssText){tmpCell.style.cssText = cell.style.cssText;}results.push(tmpCell);}this.update();return results;},getPreviewMergedCellsNum:function getPreviewMergedCellsNum(rowIndex,colIndex){var indexRow=this.indexTable[rowIndex],num=0;for(var i=0;i < colIndex;) {var colSpan=indexRow[i].colSpan,tmpRowIndex=indexRow[i].rowIndex;num += colSpan - (tmpRowIndex == rowIndex?1:0);i += colSpan;}return num;},splitToCols:function splitToCols(cell){var backWidth=(cell.offsetWidth / cell.colSpan - 22).toFixed(0),cellInfo=this.getCellInfo(cell),rowIndex=cellInfo.rowIndex,colIndex=cellInfo.colIndex,results=[]; // 修改Cell的rowSpan\ncell.colSpan = 1;cell.setAttribute(\"width\",backWidth);results.push(cell); // 补齐单元格\nfor(var j=colIndex,endCol=colIndex + cellInfo.colSpan;j < endCol;j++) {if(j == colIndex)continue;var tableRow=this.table.rows[rowIndex],tmpCell=tableRow.insertCell(this.indexTable[rowIndex][j].cellIndex + 1);tmpCell.rowSpan = cellInfo.rowSpan;this.setCellContent(tmpCell);tmpCell.setAttribute('vAlign',cell.getAttribute('vAlign'));tmpCell.setAttribute('align',cell.getAttribute('align'));tmpCell.setAttribute('width',backWidth);if(cell.style.cssText){tmpCell.style.cssText = cell.style.cssText;} //处理th的情况\nif(cell.tagName == 'TH'){var th=cell.ownerDocument.createElement('th');th.appendChild(tmpCell.firstChild);th.setAttribute('vAlign',cell.getAttribute('vAlign'));th.rowSpan = tmpCell.rowSpan;tableRow.insertBefore(th,tmpCell);domUtils.remove(tmpCell);}results.push(tmpCell);}this.update();return results;},isLastCell:function isLastCell(cell,rowsNum,colsNum){rowsNum = rowsNum || this.rowsNum;colsNum = colsNum || this.colsNum;var cellInfo=this.getCellInfo(cell);return cellInfo.rowIndex + cellInfo.rowSpan == rowsNum && cellInfo.colIndex + cellInfo.colSpan == colsNum;},getLastCell:function getLastCell(cells){cells = cells || this.table.getElementsByTagName(\"td\");var firstInfo=this.getCellInfo(cells[0]);var me=this,last=cells[0],tr=last.parentNode,cellsNum=0,cols=0,rows;utils.each(cells,function(cell){if(cell.parentNode == tr)cols += cell.colSpan || 1;cellsNum += cell.rowSpan * cell.colSpan || 1;});rows = cellsNum / cols;utils.each(cells,function(cell){if(me.isLastCell(cell,rows,cols)){last = cell;return false;}});return last;},selectRow:function selectRow(rowIndex){var indexRow=this.indexTable[rowIndex],start=this.getCell(indexRow[0].rowIndex,indexRow[0].cellIndex),end=this.getCell(indexRow[this.colsNum - 1].rowIndex,indexRow[this.colsNum - 1].cellIndex),range=this.getCellsRange(start,end);this.setSelected(range);},selectTable:function selectTable(){var tds=this.table.getElementsByTagName(\"td\"),range=this.getCellsRange(tds[0],tds[tds.length - 1]);this.setSelected(range);},setBackground:function setBackground(cells,value){if(typeof value === \"string\"){utils.each(cells,function(cell){cell.style.backgroundColor = value;});}else if(typeof value === \"object\"){value = utils.extend({repeat:true,colorList:[\"#ddd\",\"#fff\"]},value);var rowIndex=this.getCellInfo(cells[0]).rowIndex,count=0,colors=value.colorList,getColor=function getColor(list,index,repeat){return list[index]?list[index]:repeat?list[index % list.length]:\"\";};for(var i=0,cell;cell = cells[i++];) {var cellInfo=this.getCellInfo(cell);cell.style.backgroundColor = getColor(colors,rowIndex + count == cellInfo.rowIndex?count:++count,value.repeat);}}},removeBackground:function removeBackground(cells){utils.each(cells,function(cell){cell.style.backgroundColor = \"\";});}};function showError(e){}})(); // plugins/table.cmds.js\n/**\r\n * Created with JetBrains PhpStorm.\r\n * User: taoqili\r\n * Date: 13-2-20\r\n * Time: 下午6:25\r\n * To change this template use File | Settings | File Templates.\r\n */;(function(){var UT=UE.UETable,getTableItemsByRange=function getTableItemsByRange(editor){return UT.getTableItemsByRange(editor);},getUETableBySelected=function getUETableBySelected(editor){return UT.getUETableBySelected(editor);},getDefaultValue=function getDefaultValue(editor,table){return UT.getDefaultValue(editor,table);},getUETable=function getUETable(tdOrTable){return UT.getUETable(tdOrTable);};UE.commands['inserttable'] = {queryCommandState:function queryCommandState(){return getTableItemsByRange(this).table?-1:0;},execCommand:function execCommand(cmd,opt){function createTable(opt,tdWidth){var html=[],rowsNum=opt.numRows,colsNum=opt.numCols;for(var r=0;r < rowsNum;r++) {html.push('<tr' + (r == 0?' class=\"firstRow\"':'') + '>');for(var c=0;c < colsNum;c++) {html.push('<td width=\"' + tdWidth + '\"  vAlign=\"' + opt.tdvalign + '\" >' + (browser.ie && browser.version < 11?domUtils.fillChar:'<br/>') + '</td>');}html.push('</tr>');} //禁止指定table-width\nreturn '<table><tbody>' + html.join('') + '</tbody></table>';}if(!opt){opt = utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign});}var me=this;var range=this.selection.getRange(),start=range.startContainer,firstParentBlock=domUtils.findParent(start,function(node){return domUtils.isBlockElm(node);},true) || me.body;var defaultValue=getDefaultValue(me),tableWidth=firstParentBlock.offsetWidth,tdWidth=Math.floor(tableWidth / opt.numCols - defaultValue.tdPadding * 2 - defaultValue.tdBorder); //todo其他属性\n!opt.tdvalign && (opt.tdvalign = me.options.tdvalign);me.execCommand(\"inserthtml\",createTable(opt,tdWidth));}};UE.commands['insertparagraphbeforetable'] = {queryCommandState:function queryCommandState(){return getTableItemsByRange(this).cell?0:-1;},execCommand:function execCommand(){var table=getTableItemsByRange(this).table;if(table){var p=this.document.createElement(\"p\");p.innerHTML = browser.ie?'&nbsp;':'<br />';table.parentNode.insertBefore(p,table);this.selection.getRange().setStart(p,0).setCursor();}}};UE.commands['deletetable'] = {queryCommandState:function queryCommandState(){var rng=this.selection.getRange();return domUtils.findParentByTagName(rng.startContainer,'table',true)?0:-1;},execCommand:function execCommand(cmd,table){var rng=this.selection.getRange();table = table || domUtils.findParentByTagName(rng.startContainer,'table',true);if(table){var next=table.nextSibling;if(!next){next = domUtils.createElement(this.document,'p',{'innerHTML':browser.ie?domUtils.fillChar:'<br/>'});table.parentNode.insertBefore(next,table);}domUtils.remove(table);rng = this.selection.getRange();if(next.nodeType == 3){rng.setStartBefore(next);}else {rng.setStart(next,0);}rng.setCursor(false,true);this.fireEvent(\"tablehasdeleted\");}}};UE.commands['cellalign'] = {queryCommandState:function queryCommandState(){return getSelectedArr(this).length?0:-1;},execCommand:function execCommand(cmd,align){var selectedTds=getSelectedArr(this);if(selectedTds.length){for(var i=0,ci;ci = selectedTds[i++];) {ci.setAttribute('align',align);}}}};UE.commands['cellvalign'] = {queryCommandState:function queryCommandState(){return getSelectedArr(this).length?0:-1;},execCommand:function execCommand(cmd,valign){var selectedTds=getSelectedArr(this);if(selectedTds.length){for(var i=0,ci;ci = selectedTds[i++];) {ci.setAttribute('vAlign',valign);}}}};UE.commands['insertcaption'] = {queryCommandState:function queryCommandState(){var table=getTableItemsByRange(this).table;if(table){return table.getElementsByTagName('caption').length == 0?1:-1;}return -1;},execCommand:function execCommand(){var table=getTableItemsByRange(this).table;if(table){var caption=this.document.createElement('caption');caption.innerHTML = browser.ie?domUtils.fillChar:'<br/>';table.insertBefore(caption,table.firstChild);var range=this.selection.getRange();range.setStart(caption,0).setCursor();}}};UE.commands['deletecaption'] = {queryCommandState:function queryCommandState(){var rng=this.selection.getRange(),table=domUtils.findParentByTagName(rng.startContainer,'table');if(table){return table.getElementsByTagName('caption').length == 0?-1:1;}return -1;},execCommand:function execCommand(){var rng=this.selection.getRange(),table=domUtils.findParentByTagName(rng.startContainer,'table');if(table){domUtils.remove(table.getElementsByTagName('caption')[0]);var range=this.selection.getRange();range.setStart(table.rows[0].cells[0],0).setCursor();}}};UE.commands['inserttitle'] = {queryCommandState:function queryCommandState(){var table=getTableItemsByRange(this).table;if(table){var firstRow=table.rows[0];return firstRow.cells[firstRow.cells.length - 1].tagName.toLowerCase() != 'th'?0:-1;}return -1;},execCommand:function execCommand(){var table=getTableItemsByRange(this).table;if(table){getUETable(table).insertRow(0,'th');}var th=table.getElementsByTagName('th')[0];this.selection.getRange().setStart(th,0).setCursor(false,true);}};UE.commands['deletetitle'] = {queryCommandState:function queryCommandState(){var table=getTableItemsByRange(this).table;if(table){var firstRow=table.rows[0];return firstRow.cells[firstRow.cells.length - 1].tagName.toLowerCase() == 'th'?0:-1;}return -1;},execCommand:function execCommand(){var table=getTableItemsByRange(this).table;if(table){domUtils.remove(table.rows[0]);}var td=table.getElementsByTagName('td')[0];this.selection.getRange().setStart(td,0).setCursor(false,true);}};UE.commands['inserttitlecol'] = {queryCommandState:function queryCommandState(){var table=getTableItemsByRange(this).table;if(table){var lastRow=table.rows[table.rows.length - 1];return lastRow.getElementsByTagName('th').length?-1:0;}return -1;},execCommand:function execCommand(cmd){var table=getTableItemsByRange(this).table;if(table){getUETable(table).insertCol(0,'th');}resetTdWidth(table,this);var th=table.getElementsByTagName('th')[0];this.selection.getRange().setStart(th,0).setCursor(false,true);}};UE.commands['deletetitlecol'] = {queryCommandState:function queryCommandState(){var table=getTableItemsByRange(this).table;if(table){var lastRow=table.rows[table.rows.length - 1];return lastRow.getElementsByTagName('th').length?0:-1;}return -1;},execCommand:function execCommand(){var table=getTableItemsByRange(this).table;if(table){for(var i=0;i < table.rows.length;i++) {domUtils.remove(table.rows[i].children[0]);}}resetTdWidth(table,this);var td=table.getElementsByTagName('td')[0];this.selection.getRange().setStart(td,0).setCursor(false,true);}};UE.commands[\"mergeright\"] = {queryCommandState:function queryCommandState(cmd){var tableItems=getTableItemsByRange(this),table=tableItems.table,cell=tableItems.cell;if(!table || !cell)return -1;var ut=getUETable(table);if(ut.selectedTds.length)return -1;var cellInfo=ut.getCellInfo(cell),rightColIndex=cellInfo.colIndex + cellInfo.colSpan;if(rightColIndex >= ut.colsNum)return -1; // 如果处于最右边则不能向右合并\nvar rightCellInfo=ut.indexTable[cellInfo.rowIndex][rightColIndex],rightCell=table.rows[rightCellInfo.rowIndex].cells[rightCellInfo.cellIndex];if(!rightCell || cell.tagName != rightCell.tagName)return -1; // TH和TD不能相互合并\n// 当且仅当两个Cell的开始列号和结束列号一致时能进行合并\nreturn rightCellInfo.rowIndex == cellInfo.rowIndex && rightCellInfo.rowSpan == cellInfo.rowSpan?0:-1;},execCommand:function execCommand(cmd){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.mergeRight(cell);rng.moveToBookmark(bk).select();}};UE.commands[\"mergedown\"] = {queryCommandState:function queryCommandState(cmd){var tableItems=getTableItemsByRange(this),table=tableItems.table,cell=tableItems.cell;if(!table || !cell)return -1;var ut=getUETable(table);if(ut.selectedTds.length)return -1;var cellInfo=ut.getCellInfo(cell),downRowIndex=cellInfo.rowIndex + cellInfo.rowSpan;if(downRowIndex >= ut.rowsNum)return -1; // 如果处于最下边则不能向下合并\nvar downCellInfo=ut.indexTable[downRowIndex][cellInfo.colIndex],downCell=table.rows[downCellInfo.rowIndex].cells[downCellInfo.cellIndex];if(!downCell || cell.tagName != downCell.tagName)return -1; // TH和TD不能相互合并\n// 当且仅当两个Cell的开始列号和结束列号一致时能进行合并\nreturn downCellInfo.colIndex == cellInfo.colIndex && downCellInfo.colSpan == cellInfo.colSpan?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.mergeDown(cell);rng.moveToBookmark(bk).select();}};UE.commands[\"mergecells\"] = {queryCommandState:function queryCommandState(){return getUETableBySelected(this)?0:-1;},execCommand:function execCommand(){var ut=getUETableBySelected(this);if(ut && ut.selectedTds.length){var cell=ut.selectedTds[0];ut.mergeRange();var rng=this.selection.getRange();if(domUtils.isEmptyBlock(cell)){rng.setStart(cell,0).collapse(true);}else {rng.selectNodeContents(cell);}rng.select();}}};UE.commands[\"insertrow\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;return cell && (cell.tagName == \"TD\" || cell.tagName == 'TH' && tableItems.tr !== tableItems.table.rows[0]) && getUETable(tableItems.table).rowsNum < this.options.maxRowNum?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var tableItems=getTableItemsByRange(this),cell=tableItems.cell,table=tableItems.table,ut=getUETable(table),cellInfo=ut.getCellInfo(cell); //ut.insertRow(!ut.selectedTds.length ? cellInfo.rowIndex:ut.cellsRange.beginRowIndex,'');\nif(!ut.selectedTds.length){ut.insertRow(cellInfo.rowIndex,cell);}else {var range=ut.cellsRange;for(var i=0,len=range.endRowIndex - range.beginRowIndex + 1;i < len;i++) {ut.insertRow(range.beginRowIndex,cell);}}rng.moveToBookmark(bk).select();if(table.getAttribute(\"interlaced\") === \"enabled\")this.fireEvent(\"interlacetable\",table);}}; //后插入行\nUE.commands[\"insertrownext\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;return cell && cell.tagName == \"TD\" && getUETable(tableItems.table).rowsNum < this.options.maxRowNum?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var tableItems=getTableItemsByRange(this),cell=tableItems.cell,table=tableItems.table,ut=getUETable(table),cellInfo=ut.getCellInfo(cell); //ut.insertRow(!ut.selectedTds.length? cellInfo.rowIndex + cellInfo.rowSpan : ut.cellsRange.endRowIndex + 1,'');\nif(!ut.selectedTds.length){ut.insertRow(cellInfo.rowIndex + cellInfo.rowSpan,cell);}else {var range=ut.cellsRange;for(var i=0,len=range.endRowIndex - range.beginRowIndex + 1;i < len;i++) {ut.insertRow(range.endRowIndex + 1,cell);}}rng.moveToBookmark(bk).select();if(table.getAttribute(\"interlaced\") === \"enabled\")this.fireEvent(\"interlacetable\",table);}};UE.commands[\"deleterow\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this);return tableItems.cell?0:-1;},execCommand:function execCommand(){var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),cellsRange=ut.cellsRange,cellInfo=ut.getCellInfo(cell),preCell=ut.getVSideCell(cell),nextCell=ut.getVSideCell(cell,true),rng=this.selection.getRange();if(utils.isEmptyObject(cellsRange)){ut.deleteRow(cellInfo.rowIndex);}else {for(var i=cellsRange.beginRowIndex;i < cellsRange.endRowIndex + 1;i++) {ut.deleteRow(cellsRange.beginRowIndex);}}var table=ut.table;if(!table.getElementsByTagName('td').length){var nextSibling=table.nextSibling;domUtils.remove(table);if(nextSibling){rng.setStart(nextSibling,0).setCursor(false,true);}}else {if(cellInfo.rowSpan == 1 || cellInfo.rowSpan == cellsRange.endRowIndex - cellsRange.beginRowIndex + 1){if(nextCell || preCell)rng.selectNodeContents(nextCell || preCell).setCursor(false,true);}else {var newCell=ut.getCell(cellInfo.rowIndex,ut.indexTable[cellInfo.rowIndex][cellInfo.colIndex].cellIndex);if(newCell)rng.selectNodeContents(newCell).setCursor(false,true);}}if(table.getAttribute(\"interlaced\") === \"enabled\")this.fireEvent(\"interlacetable\",table);}};UE.commands[\"insertcol\"] = {queryCommandState:function queryCommandState(cmd){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;return cell && (cell.tagName == \"TD\" || cell.tagName == 'TH' && cell !== tableItems.tr.cells[0]) && getUETable(tableItems.table).colsNum < this.options.maxColNum?0:-1;},execCommand:function execCommand(cmd){var rng=this.selection.getRange(),bk=rng.createBookmark(true);if(this.queryCommandState(cmd) == -1)return;var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),cellInfo=ut.getCellInfo(cell); //ut.insertCol(!ut.selectedTds.length ? cellInfo.colIndex:ut.cellsRange.beginColIndex);\nif(!ut.selectedTds.length){ut.insertCol(cellInfo.colIndex,cell);}else {var range=ut.cellsRange;for(var i=0,len=range.endColIndex - range.beginColIndex + 1;i < len;i++) {ut.insertCol(range.beginColIndex,cell);}}rng.moveToBookmark(bk).select(true);}};UE.commands[\"insertcolnext\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;return cell && getUETable(tableItems.table).colsNum < this.options.maxColNum?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),cellInfo=ut.getCellInfo(cell); //ut.insertCol(!ut.selectedTds.length ? cellInfo.colIndex + cellInfo.colSpan:ut.cellsRange.endColIndex +1);\nif(!ut.selectedTds.length){ut.insertCol(cellInfo.colIndex + cellInfo.colSpan,cell);}else {var range=ut.cellsRange;for(var i=0,len=range.endColIndex - range.beginColIndex + 1;i < len;i++) {ut.insertCol(range.endColIndex + 1,cell);}}rng.moveToBookmark(bk).select();}};UE.commands[\"deletecol\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this);return tableItems.cell?0:-1;},execCommand:function execCommand(){var cell=getTableItemsByRange(this).cell,ut=getUETable(cell),range=ut.cellsRange,cellInfo=ut.getCellInfo(cell),preCell=ut.getHSideCell(cell),nextCell=ut.getHSideCell(cell,true);if(utils.isEmptyObject(range)){ut.deleteCol(cellInfo.colIndex);}else {for(var i=range.beginColIndex;i < range.endColIndex + 1;i++) {ut.deleteCol(range.beginColIndex);}}var table=ut.table,rng=this.selection.getRange();if(!table.getElementsByTagName('td').length){var nextSibling=table.nextSibling;domUtils.remove(table);if(nextSibling){rng.setStart(nextSibling,0).setCursor(false,true);}}else {if(domUtils.inDoc(cell,this.document)){rng.setStart(cell,0).setCursor(false,true);}else {if(nextCell && domUtils.inDoc(nextCell,this.document)){rng.selectNodeContents(nextCell).setCursor(false,true);}else {if(preCell && domUtils.inDoc(preCell,this.document)){rng.selectNodeContents(preCell).setCursor(true,true);}}}}}};UE.commands[\"splittocells\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell)return -1;var ut=getUETable(tableItems.table);if(ut.selectedTds.length > 0)return -1;return cell && (cell.colSpan > 1 || cell.rowSpan > 1)?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.splitToCells(cell);rng.moveToBookmark(bk).select();}};UE.commands[\"splittorows\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell)return -1;var ut=getUETable(tableItems.table);if(ut.selectedTds.length > 0)return -1;return cell && cell.rowSpan > 1?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.splitToRows(cell);rng.moveToBookmark(bk).select();}};UE.commands[\"splittocols\"] = {queryCommandState:function queryCommandState(){var tableItems=getTableItemsByRange(this),cell=tableItems.cell;if(!cell)return -1;var ut=getUETable(tableItems.table);if(ut.selectedTds.length > 0)return -1;return cell && cell.colSpan > 1?0:-1;},execCommand:function execCommand(){var rng=this.selection.getRange(),bk=rng.createBookmark(true);var cell=getTableItemsByRange(this).cell,ut=getUETable(cell);ut.splitToCols(cell);rng.moveToBookmark(bk).select();}};UE.commands[\"adaptbytext\"] = UE.commands[\"adaptbywindow\"] = {queryCommandState:function queryCommandState(){return getTableItemsByRange(this).table?0:-1;},execCommand:function execCommand(cmd){var tableItems=getTableItemsByRange(this),table=tableItems.table;if(table){if(cmd == 'adaptbywindow'){resetTdWidth(table,this);}else {var cells=domUtils.getElementsByTagName(table,\"td th\");utils.each(cells,function(cell){cell.removeAttribute(\"width\");});table.removeAttribute(\"width\");}}}}; //平均分配各列\nUE.commands['averagedistributecol'] = {queryCommandState:function queryCommandState(){var ut=getUETableBySelected(this);if(!ut)return -1;return ut.isFullRow() || ut.isFullCol()?0:-1;},execCommand:function execCommand(cmd){var me=this,ut=getUETableBySelected(me);function getAverageWidth(){var tb=ut.table,averageWidth,sumWidth=0,colsNum=0,tbAttr=getDefaultValue(me,tb);if(ut.isFullRow()){sumWidth = tb.offsetWidth;colsNum = ut.colsNum;}else {var begin=ut.cellsRange.beginColIndex,end=ut.cellsRange.endColIndex,node;for(var i=begin;i <= end;) {node = ut.selectedTds[i];sumWidth += node.offsetWidth;i += node.colSpan;colsNum += 1;}}averageWidth = Math.ceil(sumWidth / colsNum) - tbAttr.tdBorder * 2 - tbAttr.tdPadding * 2;return averageWidth;}function setAverageWidth(averageWidth){utils.each(domUtils.getElementsByTagName(ut.table,\"th\"),function(node){node.setAttribute(\"width\",\"\");});var cells=ut.isFullRow()?domUtils.getElementsByTagName(ut.table,\"td\"):ut.selectedTds;utils.each(cells,function(node){if(node.colSpan == 1){node.setAttribute(\"width\",averageWidth);}});}if(ut && ut.selectedTds.length){setAverageWidth(getAverageWidth());}}}; //平均分配各行\nUE.commands['averagedistributerow'] = {queryCommandState:function queryCommandState(){var ut=getUETableBySelected(this);if(!ut)return -1;if(ut.selectedTds && /th/ig.test(ut.selectedTds[0].tagName))return -1;return ut.isFullRow() || ut.isFullCol()?0:-1;},execCommand:function execCommand(cmd){var me=this,ut=getUETableBySelected(me);function getAverageHeight(){var averageHeight,rowNum,sumHeight=0,tb=ut.table,tbAttr=getDefaultValue(me,tb),tdpadding=parseInt(domUtils.getComputedStyle(tb.getElementsByTagName('td')[0],\"padding-top\"));if(ut.isFullCol()){var captionArr=domUtils.getElementsByTagName(tb,\"caption\"),thArr=domUtils.getElementsByTagName(tb,\"th\"),captionHeight,thHeight;if(captionArr.length > 0){captionHeight = captionArr[0].offsetHeight;}if(thArr.length > 0){thHeight = thArr[0].offsetHeight;}sumHeight = tb.offsetHeight - (captionHeight || 0) - (thHeight || 0);rowNum = thArr.length == 0?ut.rowsNum:ut.rowsNum - 1;}else {var begin=ut.cellsRange.beginRowIndex,end=ut.cellsRange.endRowIndex,count=0,trs=domUtils.getElementsByTagName(tb,\"tr\");for(var i=begin;i <= end;i++) {sumHeight += trs[i].offsetHeight;count += 1;}rowNum = count;} //ie8下是混杂模式\nif(browser.ie && browser.version < 9){averageHeight = Math.ceil(sumHeight / rowNum);}else {averageHeight = Math.ceil(sumHeight / rowNum) - tbAttr.tdBorder * 2 - tdpadding * 2;}return averageHeight;}function setAverageHeight(averageHeight){var cells=ut.isFullCol()?domUtils.getElementsByTagName(ut.table,\"td\"):ut.selectedTds;utils.each(cells,function(node){if(node.rowSpan == 1){node.setAttribute(\"height\",averageHeight);}});}if(ut && ut.selectedTds.length){setAverageHeight(getAverageHeight());}}}; //单元格对齐方式\nUE.commands['cellalignment'] = {queryCommandState:function queryCommandState(){return getTableItemsByRange(this).table?0:-1;},execCommand:function execCommand(cmd,data){var me=this,ut=getUETableBySelected(me);if(!ut){var start=me.selection.getStart(),cell=start && domUtils.findParentByTagName(start,[\"td\",\"th\",\"caption\"],true);if(!/caption/ig.test(cell.tagName)){domUtils.setAttributes(cell,data);}else {cell.style.textAlign = data.align;cell.style.verticalAlign = data.vAlign;}me.selection.getRange().setCursor(true);}else {utils.each(ut.selectedTds,function(cell){domUtils.setAttributes(cell,data);});}}, /**\r\n         * 查询当前点击的单元格的对齐状态， 如果当前已经选择了多个单元格， 则会返回所有单元格经过统一协调过后的状态\r\n         * @see UE.UETable.getTableCellAlignState\r\n         */queryCommandValue:function queryCommandValue(cmd){var activeMenuCell=getTableItemsByRange(this).cell;if(!activeMenuCell){activeMenuCell = getSelectedArr(this)[0];}if(!activeMenuCell){return null;}else { //获取同时选中的其他单元格\nvar cells=UE.UETable.getUETable(activeMenuCell).selectedTds;!cells.length && (cells = activeMenuCell);return UE.UETable.getTableCellAlignState(cells);}}}; //表格对齐方式\nUE.commands['tablealignment'] = {queryCommandState:function queryCommandState(){if(browser.ie && browser.version < 8){return -1;}return getTableItemsByRange(this).table?0:-1;},execCommand:function execCommand(cmd,value){var me=this,start=me.selection.getStart(),table=start && domUtils.findParentByTagName(start,[\"table\"],true);if(table){table.setAttribute(\"align\",value);}}}; //表格属性\nUE.commands['edittable'] = {queryCommandState:function queryCommandState(){return getTableItemsByRange(this).table?0:-1;},execCommand:function execCommand(cmd,color){var rng=this.selection.getRange(),table=domUtils.findParentByTagName(rng.startContainer,'table');if(table){var arr=domUtils.getElementsByTagName(table,\"td\").concat(domUtils.getElementsByTagName(table,\"th\"),domUtils.getElementsByTagName(table,\"caption\"));utils.each(arr,function(node){node.style.borderColor = color;});}}}; //单元格属性\nUE.commands['edittd'] = {queryCommandState:function queryCommandState(){return getTableItemsByRange(this).table?0:-1;},execCommand:function execCommand(cmd,bkColor){var me=this,ut=getUETableBySelected(me);if(!ut){var start=me.selection.getStart(),cell=start && domUtils.findParentByTagName(start,[\"td\",\"th\",\"caption\"],true);if(cell){cell.style.backgroundColor = bkColor;}}else {utils.each(ut.selectedTds,function(cell){cell.style.backgroundColor = bkColor;});}}};UE.commands[\"settablebackground\"] = {queryCommandState:function queryCommandState(){return getSelectedArr(this).length > 1?0:-1;},execCommand:function execCommand(cmd,value){var cells,ut;cells = getSelectedArr(this);ut = getUETable(cells[0]);ut.setBackground(cells,value);}};UE.commands[\"cleartablebackground\"] = {queryCommandState:function queryCommandState(){var cells=getSelectedArr(this);if(!cells.length)return -1;for(var i=0,cell;cell = cells[i++];) {if(cell.style.backgroundColor !== \"\")return 0;}return -1;},execCommand:function execCommand(){var cells=getSelectedArr(this),ut=getUETable(cells[0]);ut.removeBackground(cells);}};UE.commands[\"interlacetable\"] = UE.commands[\"uninterlacetable\"] = {queryCommandState:function queryCommandState(cmd){var table=getTableItemsByRange(this).table;if(!table)return -1;var interlaced=table.getAttribute(\"interlaced\");if(cmd == \"interlacetable\"){ //TODO 待定\n//是否需要待定，如果设置，则命令只能单次执行成功，但反射具备toggle效果；否则可以覆盖前次命令，但反射将不存在toggle效果\nreturn interlaced === \"enabled\"?-1:0;}else {return !interlaced || interlaced === \"disabled\"?-1:0;}},execCommand:function execCommand(cmd,classList){var table=getTableItemsByRange(this).table;if(cmd == \"interlacetable\"){table.setAttribute(\"interlaced\",\"enabled\");this.fireEvent(\"interlacetable\",table,classList);}else {table.setAttribute(\"interlaced\",\"disabled\");this.fireEvent(\"uninterlacetable\",table);}}};UE.commands[\"setbordervisible\"] = {queryCommandState:function queryCommandState(cmd){var table=getTableItemsByRange(this).table;if(!table)return -1;return 0;},execCommand:function execCommand(){var table=getTableItemsByRange(this).table;utils.each(domUtils.getElementsByTagName(table,'td'),function(td){td.style.borderWidth = '1px';td.style.borderStyle = 'solid';});}};function resetTdWidth(table,editor){var tds=domUtils.getElementsByTagName(table,'td th');utils.each(tds,function(td){td.removeAttribute(\"width\");});table.setAttribute('width',getTableWidth(editor,true,getDefaultValue(editor,table)));var tdsWidths=[];setTimeout(function(){utils.each(tds,function(td){td.colSpan == 1 && tdsWidths.push(td.offsetWidth);});utils.each(tds,function(td,i){td.colSpan == 1 && td.setAttribute(\"width\",tdsWidths[i] + \"\");});},0);}function getTableWidth(editor,needIEHack,defaultValue){var body=editor.body;return body.offsetWidth - (needIEHack?parseInt(domUtils.getComputedStyle(body,'margin-left'),10) * 2:0) - defaultValue.tableBorder * 2 - (editor.options.offsetWidth || 0);}function getSelectedArr(editor){var cell=getTableItemsByRange(editor).cell;if(cell){var ut=getUETable(cell);return ut.selectedTds.length?ut.selectedTds:[cell];}else {return [];}}})(); // plugins/table.action.js\n/**\r\n * Created with JetBrains PhpStorm.\r\n * User: taoqili\r\n * Date: 12-10-12\r\n * Time: 上午10:05\r\n * To change this template use File | Settings | File Templates.\r\n */UE.plugins['table'] = function(){var me=this,tabTimer=null, //拖动计时器\ntableDragTimer=null, //双击计时器\ntableResizeTimer=null, //单元格最小宽度\ncellMinWidth=5,isInResizeBuffer=false, //单元格边框大小\ncellBorderWidth=5, //鼠标偏移距离\noffsetOfTableCell=10, //记录在有限时间内的点击状态， 共有3个取值， 0, 1, 2。 0代表未初始化， 1代表单击了1次，2代表2次\nsingleClickState=0,userActionStatus=null, //双击允许的时间范围\ndblclickTime=360,UT=UE.UETable,getUETable=function getUETable(tdOrTable){return UT.getUETable(tdOrTable);},getUETableBySelected=function getUETableBySelected(editor){return UT.getUETableBySelected(editor);},getDefaultValue=function getDefaultValue(editor,table){return UT.getDefaultValue(editor,table);},removeSelectedClass=function removeSelectedClass(cells){return UT.removeSelectedClass(cells);};function showError(e){ //        throw e;\n}me.ready(function(){var me=this;var orgGetText=me.selection.getText;me.selection.getText = function(){var table=getUETableBySelected(me);if(table){var str='';utils.each(table.selectedTds,function(td){str += td[browser.ie?'innerText':'textContent'];});return str;}else {return orgGetText.call(me.selection);}};}); //处理拖动及框选相关方法\nvar startTd=null, //鼠标按下时的锚点td\ncurrentTd=null, //当前鼠标经过时的td\nonDrag=\"\", //指示当前拖动状态，其值可为\"\",\"h\",\"v\" ,分别表示未拖动状态，横向拖动状态，纵向拖动状态，用于鼠标移动过程中的判断\nonBorder=false, //检测鼠标按下时是否处在单元格边缘位置\ndragButton=null,dragOver=false,dragLine=null, //模拟的拖动线\ndragTd=null; //发生拖动的目标td\nvar mousedown=false, //todo 判断混乱模式\nneedIEHack=true;me.setOpt({'maxColNum':20,'maxRowNum':100,'defaultCols':5,'defaultRows':5,'tdvalign':'top','cursorpath':me.options.UEDITOR_HOME_URL + \"themes/default/images/cursor_\",'tableDragable':false,'classList':[\"ue-table-interlace-color-single\",\"ue-table-interlace-color-double\"]});me.getUETable = getUETable;var commands={'deletetable':1,'inserttable':1,'cellvalign':1,'insertcaption':1,'deletecaption':1,'inserttitle':1,'deletetitle':1,\"mergeright\":1,\"mergedown\":1,\"mergecells\":1,\"insertrow\":1,\"insertrownext\":1,\"deleterow\":1,\"insertcol\":1,\"insertcolnext\":1,\"deletecol\":1,\"splittocells\":1,\"splittorows\":1,\"splittocols\":1,\"adaptbytext\":1,\"adaptbywindow\":1,\"adaptbycustomer\":1,\"insertparagraph\":1,\"insertparagraphbeforetable\":1,\"averagedistributecol\":1,\"averagedistributerow\":1};me.ready(function(){utils.cssRule('table', //选中的td上的样式\n'.selectTdClass{background-color:#edf5fa !important}' + 'table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}' +  //插入的表格的默认样式\n'table{margin-bottom:10px;border-collapse:collapse;display:table;}' + 'td,th{padding: 5px 10px;border: 1px solid #DDD;}' + 'caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}' + 'th{border-top:1px solid #BBB;background-color:#F7F7F7;}' + 'table tr.firstRow th{border-top-width:2px;}' + '.ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }' + 'td p{margin:0;padding:0;}',me.document);var tableCopyList,isFullCol,isFullRow; //注册del/backspace事件\nme.addListener('keydown',function(cmd,evt){var me=this;var keyCode=evt.keyCode || evt.which;if(keyCode == 8){var ut=getUETableBySelected(me);if(ut && ut.selectedTds.length){if(ut.isFullCol()){me.execCommand('deletecol');}else if(ut.isFullRow()){me.execCommand('deleterow');}else {me.fireEvent('delcells');}domUtils.preventDefault(evt);}var caption=domUtils.findParentByTagName(me.selection.getStart(),'caption',true),range=me.selection.getRange();if(range.collapsed && caption && isEmptyBlock(caption)){me.fireEvent('saveScene');var table=caption.parentNode;domUtils.remove(caption);if(table){range.setStart(table.rows[0].cells[0],0).setCursor(false,true);}me.fireEvent('saveScene');}}if(keyCode == 46){ut = getUETableBySelected(me);if(ut){me.fireEvent('saveScene');for(var i=0,ci;ci = ut.selectedTds[i++];) {domUtils.fillNode(me.document,ci);}me.fireEvent('saveScene');domUtils.preventDefault(evt);}}if(keyCode == 13){var rng=me.selection.getRange(),caption=domUtils.findParentByTagName(rng.startContainer,'caption',true);if(caption){var table=domUtils.findParentByTagName(caption,'table');if(!rng.collapsed){rng.deleteContents();me.fireEvent('saveScene');}else {if(caption){rng.setStart(table.rows[0].cells[0],0).setCursor(false,true);}}domUtils.preventDefault(evt);return;}if(rng.collapsed){var table=domUtils.findParentByTagName(rng.startContainer,'table');if(table){var cell=table.rows[0].cells[0],start=domUtils.findParentByTagName(me.selection.getStart(),['td','th'],true),preNode=table.previousSibling;if(cell === start && (!preNode || preNode.nodeType == 1 && preNode.tagName == 'TABLE') && domUtils.isStartInblock(rng)){var first=domUtils.findParent(me.selection.getStart(),function(n){return domUtils.isBlockElm(n);},true);if(first && (/t(h|d)/i.test(first.tagName) || first === start.firstChild)){me.execCommand('insertparagraphbeforetable');domUtils.preventDefault(evt);}}}}}if((evt.ctrlKey || evt.metaKey) && evt.keyCode == '67'){tableCopyList = null;var ut=getUETableBySelected(me);if(ut){var tds=ut.selectedTds;isFullCol = ut.isFullCol();isFullRow = ut.isFullRow();tableCopyList = [[ut.cloneCell(tds[0],null,true)]];for(var i=1,ci;ci = tds[i];i++) {if(ci.parentNode !== tds[i - 1].parentNode){tableCopyList.push([ut.cloneCell(ci,null,true)]);}else {tableCopyList[tableCopyList.length - 1].push(ut.cloneCell(ci,null,true));}}}}});me.addListener(\"tablehasdeleted\",function(){toggleDraggableState(this,false,\"\",null);if(dragButton)domUtils.remove(dragButton);});me.addListener('beforepaste',function(cmd,html){var me=this;var rng=me.selection.getRange();if(domUtils.findParentByTagName(rng.startContainer,'caption',true)){var div=me.document.createElement(\"div\");div.innerHTML = html.html; //trace:3729\nhtml.html = div[browser.ie9below?'innerText':'textContent'];return;}var table=getUETableBySelected(me);if(tableCopyList){me.fireEvent('saveScene');var rng=me.selection.getRange();var td=domUtils.findParentByTagName(rng.startContainer,['td','th'],true),tmpNode,preNode;if(td){var ut=getUETable(td);if(isFullRow){var rowIndex=ut.getCellInfo(td).rowIndex;if(td.tagName == 'TH'){rowIndex++;}for(var i=0,ci;ci = tableCopyList[i++];) {var tr=ut.insertRow(rowIndex++,\"td\");for(var j=0,cj;cj = ci[j];j++) {var cell=tr.cells[j];if(!cell){cell = tr.insertCell(j);}cell.innerHTML = cj.innerHTML;cj.getAttribute('width') && cell.setAttribute('width',cj.getAttribute('width'));cj.getAttribute('vAlign') && cell.setAttribute('vAlign',cj.getAttribute('vAlign'));cj.getAttribute('align') && cell.setAttribute('align',cj.getAttribute('align'));cj.style.cssText && (cell.style.cssText = cj.style.cssText);}for(var j=0,cj;cj = tr.cells[j];j++) {if(!ci[j])break;cj.innerHTML = ci[j].innerHTML;ci[j].getAttribute('width') && cj.setAttribute('width',ci[j].getAttribute('width'));ci[j].getAttribute('vAlign') && cj.setAttribute('vAlign',ci[j].getAttribute('vAlign'));ci[j].getAttribute('align') && cj.setAttribute('align',ci[j].getAttribute('align'));ci[j].style.cssText && (cj.style.cssText = ci[j].style.cssText);}}}else {if(isFullCol){cellInfo = ut.getCellInfo(td);var maxColNum=0;for(var j=0,ci=tableCopyList[0],cj;cj = ci[j++];) {maxColNum += cj.colSpan || 1;}me.__hasEnterExecCommand = true;for(i = 0;i < maxColNum;i++) {me.execCommand('insertcol');}me.__hasEnterExecCommand = false;td = ut.table.rows[0].cells[cellInfo.cellIndex];if(td.tagName == 'TH'){td = ut.table.rows[1].cells[cellInfo.cellIndex];}}for(var i=0,ci;ci = tableCopyList[i++];) {tmpNode = td;for(var j=0,cj;cj = ci[j++];) {if(td){td.innerHTML = cj.innerHTML; //todo 定制处理\ncj.getAttribute('width') && td.setAttribute('width',cj.getAttribute('width'));cj.getAttribute('vAlign') && td.setAttribute('vAlign',cj.getAttribute('vAlign'));cj.getAttribute('align') && td.setAttribute('align',cj.getAttribute('align'));cj.style.cssText && (td.style.cssText = cj.style.cssText);preNode = td;td = td.nextSibling;}else {var cloneTd=cj.cloneNode(true);domUtils.removeAttributes(cloneTd,['class','rowSpan','colSpan']);preNode.parentNode.appendChild(cloneTd);}}td = ut.getNextCell(tmpNode,true,true);if(!tableCopyList[i])break;if(!td){var cellInfo=ut.getCellInfo(tmpNode);ut.table.insertRow(ut.table.rows.length);ut.update();td = ut.getVSideCell(tmpNode,true);}}}ut.update();}else {table = me.document.createElement('table');for(var i=0,ci;ci = tableCopyList[i++];) {var tr=table.insertRow(table.rows.length);for(var j=0,cj;cj = ci[j++];) {cloneTd = UT.cloneCell(cj,null,true);domUtils.removeAttributes(cloneTd,['class']);tr.appendChild(cloneTd);}if(j == 2 && cloneTd.rowSpan > 1){cloneTd.rowSpan = 1;}}var defaultValue=getDefaultValue(me),width=me.body.offsetWidth - (needIEHack?parseInt(domUtils.getComputedStyle(me.body,'margin-left'),10) * 2:0) - defaultValue.tableBorder * 2 - (me.options.offsetWidth || 0);me.execCommand('insertHTML','<table  ' + (isFullCol && isFullRow?'width=\"' + width + '\"':'') + '>' + table.innerHTML.replace(/>\\s*</g,'><').replace(/\\bth\\b/gi,\"td\") + '</table>');}me.fireEvent('contentchange');me.fireEvent('saveScene');html.html = '';return true;}else {var div=me.document.createElement(\"div\"),tables;div.innerHTML = html.html;tables = div.getElementsByTagName(\"table\");if(domUtils.findParentByTagName(me.selection.getStart(),'table')){utils.each(tables,function(t){domUtils.remove(t);});if(domUtils.findParentByTagName(me.selection.getStart(),'caption',true)){div.innerHTML = div[browser.ie?'innerText':'textContent'];}}else {utils.each(tables,function(table){removeStyleSize(table,true);domUtils.removeAttributes(table,['style','border']);utils.each(domUtils.getElementsByTagName(table,\"td\"),function(td){if(isEmptyBlock(td)){domUtils.fillNode(me.document,td);}removeStyleSize(td,true); //                            domUtils.removeAttributes(td, ['style'])\n});});}html.html = div.innerHTML;}});me.addListener('afterpaste',function(){utils.each(domUtils.getElementsByTagName(me.body,\"table\"),function(table){if(table.offsetWidth > me.body.offsetWidth){var defaultValue=getDefaultValue(me,table);table.style.width = me.body.offsetWidth - (needIEHack?parseInt(domUtils.getComputedStyle(me.body,'margin-left'),10) * 2:0) - defaultValue.tableBorder * 2 - (me.options.offsetWidth || 0) + 'px';}});});me.addListener('blur',function(){tableCopyList = null;});var timer;me.addListener('keydown',function(){clearTimeout(timer);timer = setTimeout(function(){var rng=me.selection.getRange(),cell=domUtils.findParentByTagName(rng.startContainer,['th','td'],true);if(cell){var table=cell.parentNode.parentNode.parentNode;if(table.offsetWidth > table.getAttribute(\"width\")){cell.style.wordBreak = \"break-all\";}}},100);});me.addListener(\"selectionchange\",function(){toggleDraggableState(me,false,\"\",null);}); //内容变化时触发索引更新\n//todo 可否考虑标记检测，如果不涉及表格的变化就不进行索引重建和更新\nme.addListener(\"contentchange\",function(){var me=this; //尽可能排除一些不需要更新的状况\nhideDragLine(me);if(getUETableBySelected(me))return;var rng=me.selection.getRange();var start=rng.startContainer;start = domUtils.findParentByTagName(start,['td','th'],true);utils.each(domUtils.getElementsByTagName(me.document,'table'),function(table){if(me.fireEvent(\"excludetable\",table) === true)return;table.ueTable = new UT(table); //trace:3742\n//                utils.each(domUtils.getElementsByTagName(me.document, 'td'), function (td) {\n//\n//                    if (domUtils.isEmptyBlock(td) && td !== start) {\n//                        domUtils.fillNode(me.document, td);\n//                        if (browser.ie && browser.version == 6) {\n//                            td.innerHTML = '&nbsp;'\n//                        }\n//                    }\n//                });\n//                utils.each(domUtils.getElementsByTagName(me.document, 'th'), function (th) {\n//                    if (domUtils.isEmptyBlock(th) && th !== start) {\n//                        domUtils.fillNode(me.document, th);\n//                        if (browser.ie && browser.version == 6) {\n//                            th.innerHTML = '&nbsp;'\n//                        }\n//                    }\n//                });\ntable.onmouseover = function(){me.fireEvent('tablemouseover',table);};table.onmousemove = function(){me.fireEvent('tablemousemove',table);me.options.tableDragable && toggleDragButton(true,this,me);utils.defer(function(){me.fireEvent('contentchange',50);},true);};table.onmouseout = function(){me.fireEvent('tablemouseout',table);toggleDraggableState(me,false,\"\",null);hideDragLine(me);};table.onclick = function(evt){evt = me.window.event || evt;var target=getParentTdOrTh(evt.target || evt.srcElement);if(!target)return;var ut=getUETable(target),table=ut.table,cellInfo=ut.getCellInfo(target),cellsRange,rng=me.selection.getRange(); //                    if (\"topLeft\" == inPosition(table, mouseCoords(evt))) {\n//                        cellsRange = ut.getCellsRange(ut.table.rows[0].cells[0], ut.getLastCell());\n//                        ut.setSelected(cellsRange);\n//                        return;\n//                    }\n//                    if (\"bottomRight\" == inPosition(table, mouseCoords(evt))) {\n//\n//                        return;\n//                    }\nif(inTableSide(table,target,evt,true)){var endTdCol=ut.getCell(ut.indexTable[ut.rowsNum - 1][cellInfo.colIndex].rowIndex,ut.indexTable[ut.rowsNum - 1][cellInfo.colIndex].cellIndex);if(evt.shiftKey && ut.selectedTds.length){if(ut.selectedTds[0] !== endTdCol){cellsRange = ut.getCellsRange(ut.selectedTds[0],endTdCol);ut.setSelected(cellsRange);}else {rng && rng.selectNodeContents(endTdCol).select();}}else {if(target !== endTdCol){cellsRange = ut.getCellsRange(target,endTdCol);ut.setSelected(cellsRange);}else {rng && rng.selectNodeContents(endTdCol).select();}}return;}if(inTableSide(table,target,evt)){var endTdRow=ut.getCell(ut.indexTable[cellInfo.rowIndex][ut.colsNum - 1].rowIndex,ut.indexTable[cellInfo.rowIndex][ut.colsNum - 1].cellIndex);if(evt.shiftKey && ut.selectedTds.length){if(ut.selectedTds[0] !== endTdRow){cellsRange = ut.getCellsRange(ut.selectedTds[0],endTdRow);ut.setSelected(cellsRange);}else {rng && rng.selectNodeContents(endTdRow).select();}}else {if(target !== endTdRow){cellsRange = ut.getCellsRange(target,endTdRow);ut.setSelected(cellsRange);}else {rng && rng.selectNodeContents(endTdRow).select();}}}};});switchBorderColor(me,true);});domUtils.on(me.document,\"mousemove\",mouseMoveEvent);domUtils.on(me.document,\"mouseout\",function(evt){var target=evt.target || evt.srcElement;if(target.tagName == \"TABLE\"){toggleDraggableState(me,false,\"\",null);}}); /**\r\n         * 表格隔行变色\r\n         */me.addListener(\"interlacetable\",function(type,table,classList){if(!table)return;var me=this,rows=table.rows,len=rows.length,getClass=function getClass(list,index,repeat){return list[index]?list[index]:repeat?list[index % list.length]:\"\";};for(var i=0;i < len;i++) {rows[i].className = getClass(classList || me.options.classList,i,true);}});me.addListener(\"uninterlacetable\",function(type,table){if(!table)return;var me=this,rows=table.rows,classList=me.options.classList,len=rows.length;for(var i=0;i < len;i++) {domUtils.removeClasses(rows[i],classList);}});me.addListener(\"mousedown\",mouseDownEvent);me.addListener(\"mouseup\",mouseUpEvent); //拖动的时候触发mouseup\ndomUtils.on(me.body,'dragstart',function(evt){mouseUpEvent.call(me,'dragstart',evt);});me.addOutputRule(function(root){utils.each(root.getNodesByTagName('div'),function(n){if(n.getAttr('id') == 'ue_tableDragLine'){n.parentNode.removeChild(n);}});});var currentRowIndex=0;me.addListener(\"mousedown\",function(){currentRowIndex = 0;});me.addListener('tabkeydown',function(){var range=this.selection.getRange(),common=range.getCommonAncestor(true,true),table=domUtils.findParentByTagName(common,'table');if(table){if(domUtils.findParentByTagName(common,'caption',true)){var cell=domUtils.getElementsByTagName(table,'th td');if(cell && cell.length){range.setStart(cell[0],0).setCursor(false,true);}}else {var cell=domUtils.findParentByTagName(common,['td','th'],true),ua=getUETable(cell);currentRowIndex = cell.rowSpan > 1?currentRowIndex:ua.getCellInfo(cell).rowIndex;var nextCell=ua.getTabNextCell(cell,currentRowIndex);if(nextCell){if(isEmptyBlock(nextCell)){range.setStart(nextCell,0).setCursor(false,true);}else {range.selectNodeContents(nextCell).select();}}else {me.fireEvent('saveScene');me.__hasEnterExecCommand = true;this.execCommand('insertrownext');me.__hasEnterExecCommand = false;range = this.selection.getRange();range.setStart(table.rows[table.rows.length - 1].cells[0],0).setCursor();me.fireEvent('saveScene');}}return true;}});browser.ie && me.addListener('selectionchange',function(){toggleDraggableState(this,false,\"\",null);});me.addListener(\"keydown\",function(type,evt){var me=this; //处理在表格的最后一个输入tab产生新的表格\nvar keyCode=evt.keyCode || evt.which;if(keyCode == 8 || keyCode == 46){return;}var notCtrlKey=!evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey;notCtrlKey && removeSelectedClass(domUtils.getElementsByTagName(me.body,\"td\"));var ut=getUETableBySelected(me);if(!ut)return;notCtrlKey && ut.clearSelected();});me.addListener(\"beforegetcontent\",function(){switchBorderColor(this,false);browser.ie && utils.each(this.document.getElementsByTagName('caption'),function(ci){if(domUtils.isEmptyNode(ci)){ci.innerHTML = '&nbsp;';}});});me.addListener(\"aftergetcontent\",function(){switchBorderColor(this,true);});me.addListener(\"getAllHtml\",function(){removeSelectedClass(me.document.getElementsByTagName(\"td\"));}); //修正全屏状态下插入的表格宽度在非全屏状态下撑开编辑器的情况\nme.addListener(\"fullscreenchanged\",function(type,fullscreen){if(!fullscreen){var ratio=this.body.offsetWidth / document.body.offsetWidth,tables=domUtils.getElementsByTagName(this.body,\"table\");utils.each(tables,function(table){if(table.offsetWidth < me.body.offsetWidth)return false;var tds=domUtils.getElementsByTagName(table,\"td\"),backWidths=[];utils.each(tds,function(td){backWidths.push(td.offsetWidth);});for(var i=0,td;td = tds[i];i++) {td.setAttribute(\"width\",Math.floor(backWidths[i] * ratio));}table.setAttribute(\"width\",Math.floor(getTableWidth(me,needIEHack,getDefaultValue(me))));});}}); //重写execCommand命令，用于处理框选时的处理\nvar oldExecCommand=me.execCommand;me.execCommand = function(cmd,datatat){var me=this,args=arguments;cmd = cmd.toLowerCase();var ut=getUETableBySelected(me),tds,range=new dom.Range(me.document),cmdFun=me.commands[cmd] || UE.commands[cmd],result;if(!cmdFun)return;if(ut && !commands[cmd] && !cmdFun.notNeedUndo && !me.__hasEnterExecCommand){me.__hasEnterExecCommand = true;me.fireEvent(\"beforeexeccommand\",cmd);tds = ut.selectedTds;var lastState=-2,lastValue=-2,value,state;for(var i=0,td;td = tds[i];i++) {if(isEmptyBlock(td)){range.setStart(td,0).setCursor(false,true);}else {range.selectNode(td).select(true);}state = me.queryCommandState(cmd);value = me.queryCommandValue(cmd);if(state != -1){if(lastState !== state || lastValue !== value){me._ignoreContentChange = true;result = oldExecCommand.apply(me,arguments);me._ignoreContentChange = false;}lastState = me.queryCommandState(cmd);lastValue = me.queryCommandValue(cmd);if(domUtils.isEmptyBlock(td)){domUtils.fillNode(me.document,td);}}}range.setStart(tds[0],0).shrinkBoundary(true).setCursor(false,true);me.fireEvent('contentchange');me.fireEvent(\"afterexeccommand\",cmd);me.__hasEnterExecCommand = false;me._selectionChange();}else {result = oldExecCommand.apply(me,arguments);}return result;};}); /**\r\n     * 删除obj的宽高style，改成属性宽高\r\n     * @param obj\r\n     * @param replaceToProperty\r\n     */function removeStyleSize(obj,replaceToProperty){removeStyle(obj,\"width\",true);removeStyle(obj,\"height\",true);}function removeStyle(obj,styleName,replaceToProperty){if(obj.style[styleName]){replaceToProperty && obj.setAttribute(styleName,parseInt(obj.style[styleName],10));obj.style[styleName] = \"\";}}function getParentTdOrTh(ele){if(ele.tagName == \"TD\" || ele.tagName == \"TH\")return ele;var td;if(td = domUtils.findParentByTagName(ele,\"td\",true) || domUtils.findParentByTagName(ele,\"th\",true))return td;return null;}function isEmptyBlock(node){var reg=new RegExp(domUtils.fillChar,'g');if(node[browser.ie?'innerText':'textContent'].replace(/^\\s*$/,'').replace(reg,'').length > 0){return 0;}for(var n in dtd.$isNotEmpty) {if(node.getElementsByTagName(n).length){return 0;}}return 1;}function mouseCoords(evt){if(evt.pageX || evt.pageY){return {x:evt.pageX,y:evt.pageY};}return {x:evt.clientX + me.document.body.scrollLeft - me.document.body.clientLeft,y:evt.clientY + me.document.body.scrollTop - me.document.body.clientTop};}function mouseMoveEvent(evt){if(isEditorDisabled()){return;}try{ //普通状态下鼠标移动\nvar target=getParentTdOrTh(evt.target || evt.srcElement),pos; //区分用户的行为是拖动还是双击\nif(isInResizeBuffer){me.body.style.webkitUserSelect = 'none';if(Math.abs(userActionStatus.x - evt.clientX) > offsetOfTableCell || Math.abs(userActionStatus.y - evt.clientY) > offsetOfTableCell){clearTableDragTimer();isInResizeBuffer = false;singleClickState = 0; //drag action\ntableBorderDrag(evt);}} //修改单元格大小时的鼠标移动\nif(onDrag && dragTd){singleClickState = 0;me.body.style.webkitUserSelect = 'none';me.selection.getNative()[browser.ie9below?'empty':'removeAllRanges']();pos = mouseCoords(evt);toggleDraggableState(me,true,onDrag,pos,target);if(onDrag == \"h\"){dragLine.style.left = getPermissionX(dragTd,evt) + \"px\";}else if(onDrag == \"v\"){dragLine.style.top = getPermissionY(dragTd,evt) + \"px\";}return;} //当鼠标处于table上时，修改移动过程中的光标状态\nif(target){ //针对使用table作为容器的组件不触发拖拽效果\nif(me.fireEvent('excludetable',target) === true)return;pos = mouseCoords(evt);var state=getRelation(target,pos),table=domUtils.findParentByTagName(target,\"table\",true);if(inTableSide(table,target,evt,true)){if(me.fireEvent(\"excludetable\",table) === true)return;me.body.style.cursor = \"url(\" + me.options.cursorpath + \"h.png),pointer\";}else if(inTableSide(table,target,evt)){if(me.fireEvent(\"excludetable\",table) === true)return;me.body.style.cursor = \"url(\" + me.options.cursorpath + \"v.png),pointer\";}else {me.body.style.cursor = \"text\";var curCell=target;if(/\\d/.test(state)){state = state.replace(/\\d/,'');target = getUETable(target).getPreviewCell(target,state == \"v\");} //位于第一行的顶部或者第一列的左边时不可拖动\ntoggleDraggableState(me,target?!!state:false,target?state:'',pos,target);}}else {toggleDragButton(false,table,me);}}catch(e) {showError(e);}}var dragButtonTimer;function toggleDragButton(show,table,editor){if(!show){if(dragOver)return;dragButtonTimer = setTimeout(function(){!dragOver && dragButton && dragButton.parentNode && dragButton.parentNode.removeChild(dragButton);},2000);}else {createDragButton(table,editor);}}function createDragButton(table,editor){var pos=domUtils.getXY(table),doc=table.ownerDocument;if(dragButton && dragButton.parentNode)return dragButton;dragButton = doc.createElement(\"div\");dragButton.contentEditable = false;dragButton.innerHTML = \"\";dragButton.style.cssText = \"width:15px;height:15px;background-image:url(\" + editor.options.UEDITOR_HOME_URL + \"dialogs/table/dragicon.png);position: absolute;cursor:move;top:\" + (pos.y - 15) + \"px;left:\" + pos.x + \"px;\";domUtils.unSelectable(dragButton);dragButton.onmouseover = function(evt){dragOver = true;};dragButton.onmouseout = function(evt){dragOver = false;};domUtils.on(dragButton,'click',function(type,evt){doClick(evt,this);});domUtils.on(dragButton,'dblclick',function(type,evt){doDblClick(evt);});domUtils.on(dragButton,'dragstart',function(type,evt){domUtils.preventDefault(evt);});var timer;function doClick(evt,button){ // 部分浏览器下需要清理\nclearTimeout(timer);timer = setTimeout(function(){editor.fireEvent(\"tableClicked\",table,button);},300);}function doDblClick(evt){clearTimeout(timer);var ut=getUETable(table),start=table.rows[0].cells[0],end=ut.getLastCell(),range=ut.getCellsRange(start,end);editor.selection.getRange().setStart(start,0).setCursor(false,true);ut.setSelected(range);}doc.body.appendChild(dragButton);} //    function inPosition(table, pos) {\n//        var tablePos = domUtils.getXY(table),\n//            width = table.offsetWidth,\n//            height = table.offsetHeight;\n//        if (pos.x - tablePos.x < 5 && pos.y - tablePos.y < 5) {\n//            return \"topLeft\";\n//        } else if (tablePos.x + width - pos.x < 5 && tablePos.y + height - pos.y < 5) {\n//            return \"bottomRight\";\n//        }\n//    }\nfunction inTableSide(table,cell,evt,top){var pos=mouseCoords(evt),state=getRelation(cell,pos);if(top){var caption=table.getElementsByTagName(\"caption\")[0],capHeight=caption?caption.offsetHeight:0;return state == \"v1\" && pos.y - domUtils.getXY(table).y - capHeight < 8;}else {return state == \"h1\" && pos.x - domUtils.getXY(table).x < 8;}} /**\r\n     * 获取拖动时允许的X轴坐标\r\n     * @param dragTd\r\n     * @param evt\r\n     */function getPermissionX(dragTd,evt){var ut=getUETable(dragTd);if(ut){var preTd=ut.getSameEndPosCells(dragTd,\"x\")[0],nextTd=ut.getSameStartPosXCells(dragTd)[0],mouseX=mouseCoords(evt).x,left=(preTd?domUtils.getXY(preTd).x:domUtils.getXY(ut.table).x) + 20,right=nextTd?domUtils.getXY(nextTd).x + nextTd.offsetWidth - 20:me.body.offsetWidth + 5 || parseInt(domUtils.getComputedStyle(me.body,\"width\"),10);left += cellMinWidth;right -= cellMinWidth;return mouseX < left?left:mouseX > right?right:mouseX;}} /**\r\n     * 获取拖动时允许的Y轴坐标\r\n     */function getPermissionY(dragTd,evt){try{var top=domUtils.getXY(dragTd).y,mousePosY=mouseCoords(evt).y;return mousePosY < top?top:mousePosY;}catch(e) {showError(e);}} /**\r\n     * 移动状态切换\r\n     */function toggleDraggableState(editor,draggable,dir,mousePos,cell){try{editor.body.style.cursor = dir == \"h\"?\"col-resize\":dir == \"v\"?\"row-resize\":\"text\";if(browser.ie){if(dir && !mousedown && !getUETableBySelected(editor)){getDragLine(editor,editor.document);showDragLineAt(dir,cell);}else {hideDragLine(editor);}}onBorder = draggable;}catch(e) {showError(e);}} /**\r\n     * 获取与UETable相关的resize line\r\n     * @param uetable UETable对象\r\n     */function getResizeLineByUETable(){var lineId='_UETableResizeLine',line=this.document.getElementById(lineId);if(!line){line = this.document.createElement(\"div\");line.id = lineId;line.contnetEditable = false;line.setAttribute(\"unselectable\",\"on\");var styles={width:2 * cellBorderWidth + 1 + 'px',position:'absolute','z-index':100000,cursor:'col-resize',background:'red',display:'none'}; //切换状态\nline.onmouseout = function(){this.style.display = 'none';};utils.extend(line.style,styles);this.document.body.appendChild(line);}return line;} /**\r\n     * 更新resize-line\r\n     */function updateResizeLine(cell,uetable){var line=getResizeLineByUETable.call(this),table=uetable.table,styles={top:domUtils.getXY(table).y + 'px',left:domUtils.getXY(cell).x + cell.offsetWidth - cellBorderWidth + 'px',display:'block',height:table.offsetHeight + 'px'};utils.extend(line.style,styles);} /**\r\n     * 显示resize-line\r\n     */function showResizeLine(cell){var uetable=getUETable(cell);updateResizeLine.call(this,cell,uetable);} /**\r\n     * 获取鼠标与当前单元格的相对位置\r\n     * @param ele\r\n     * @param mousePos\r\n     */function getRelation(ele,mousePos){var elePos=domUtils.getXY(ele);if(!elePos){return '';}if(elePos.x + ele.offsetWidth - mousePos.x < cellBorderWidth){return \"h\";}if(mousePos.x - elePos.x < cellBorderWidth){return 'h1';}if(elePos.y + ele.offsetHeight - mousePos.y < cellBorderWidth){return \"v\";}if(mousePos.y - elePos.y < cellBorderWidth){return 'v1';}return '';}function mouseDownEvent(type,evt){if(isEditorDisabled()){return;}userActionStatus = {x:evt.clientX,y:evt.clientY}; //右键菜单单独处理\nif(evt.button == 2){var ut=getUETableBySelected(me),flag=false;if(ut){var td=getTargetTd(me,evt);utils.each(ut.selectedTds,function(ti){if(ti === td){flag = true;}});if(!flag){removeSelectedClass(domUtils.getElementsByTagName(me.body,\"th td\"));ut.clearSelected();}else {td = ut.selectedTds[0];setTimeout(function(){me.selection.getRange().setStart(td,0).setCursor(false,true);},0);}}}else {tableClickHander(evt);}} //清除表格的计时器\nfunction clearTableTimer(){tabTimer && clearTimeout(tabTimer);tabTimer = null;} //双击收缩\nfunction tableDbclickHandler(evt){singleClickState = 0;evt = evt || me.window.event;var target=getParentTdOrTh(evt.target || evt.srcElement);if(target){var h;if(h = getRelation(target,mouseCoords(evt))){hideDragLine(me);if(h == 'h1'){h = 'h';if(inTableSide(domUtils.findParentByTagName(target,\"table\"),target,evt)){me.execCommand('adaptbywindow');}else {target = getUETable(target).getPreviewCell(target);if(target){var rng=me.selection.getRange();rng.selectNodeContents(target).setCursor(true,true);}}}if(h == 'h'){var ut=getUETable(target),table=ut.table,cells=getCellsByMoveBorder(target,table,true);cells = extractArray(cells,'left');ut.width = ut.offsetWidth;var oldWidth=[],newWidth=[];utils.each(cells,function(cell){oldWidth.push(cell.offsetWidth);});utils.each(cells,function(cell){cell.removeAttribute(\"width\");});window.setTimeout(function(){ //是否允许改变\nvar changeable=true;utils.each(cells,function(cell,index){var width=cell.offsetWidth;if(width > oldWidth[index]){changeable = false;return false;}newWidth.push(width);});var change=changeable?newWidth:oldWidth;utils.each(cells,function(cell,index){cell.width = change[index] - getTabcellSpace();});},0); //                    minWidth -= cellMinWidth;\n//\n//                    table.removeAttribute(\"width\");\n//                    utils.each(cells, function (cell) {\n//                        cell.style.width = \"\";\n//                        cell.width -= minWidth;\n//                    });\n}}}}function tableClickHander(evt){removeSelectedClass(domUtils.getElementsByTagName(me.body,\"td th\")); //trace:3113\n//选中单元格，点击table外部，不会清掉table上挂的ueTable,会引起getUETableBySelected方法返回值\nutils.each(me.document.getElementsByTagName('table'),function(t){t.ueTable = null;});startTd = getTargetTd(me,evt);if(!startTd)return;var table=domUtils.findParentByTagName(startTd,\"table\",true);ut = getUETable(table);ut && ut.clearSelected(); //判断当前鼠标状态\nif(!onBorder){me.document.body.style.webkitUserSelect = '';mousedown = true;me.addListener('mouseover',mouseOverEvent);}else { //边框上的动作处理\nborderActionHandler(evt);}} //处理表格边框上的动作, 这里做延时处理，避免两种动作互相影响\nfunction borderActionHandler(evt){if(browser.ie){evt = reconstruct(evt);}clearTableDragTimer(); //是否正在等待resize的缓冲中\nisInResizeBuffer = true;tableDragTimer = setTimeout(function(){tableBorderDrag(evt);},dblclickTime);}function extractArray(originArr,key){var result=[],tmp=null;for(var i=0,len=originArr.length;i < len;i++) {tmp = originArr[i][key];if(tmp){result.push(tmp);}}return result;}function clearTableDragTimer(){tableDragTimer && clearTimeout(tableDragTimer);tableDragTimer = null;}function reconstruct(obj){var attrs=['pageX','pageY','clientX','clientY','srcElement','target'],newObj={};if(obj){for(var i=0,key,val;key = attrs[i];i++) {val = obj[key];val && (newObj[key] = val);}}return newObj;} //边框拖动\nfunction tableBorderDrag(evt){isInResizeBuffer = false;startTd = evt.target || evt.srcElement;if(!startTd)return;var state=getRelation(startTd,mouseCoords(evt));if(/\\d/.test(state)){state = state.replace(/\\d/,'');startTd = getUETable(startTd).getPreviewCell(startTd,state == 'v');}hideDragLine(me);getDragLine(me,me.document);me.fireEvent('saveScene');showDragLineAt(state,startTd);mousedown = true; //拖动开始\nonDrag = state;dragTd = startTd;}function mouseUpEvent(type,evt){if(isEditorDisabled()){return;}clearTableDragTimer();isInResizeBuffer = false;if(onBorder){singleClickState = ++singleClickState % 3;userActionStatus = {x:evt.clientX,y:evt.clientY};tableResizeTimer = setTimeout(function(){singleClickState > 0 && singleClickState--;},dblclickTime);if(singleClickState === 2){singleClickState = 0;tableDbclickHandler(evt);return;}}if(evt.button == 2)return;var me=this; //清除表格上原生跨选问题\nvar range=me.selection.getRange(),start=domUtils.findParentByTagName(range.startContainer,'table',true),end=domUtils.findParentByTagName(range.endContainer,'table',true);if(start || end){if(start === end){start = domUtils.findParentByTagName(range.startContainer,['td','th','caption'],true);end = domUtils.findParentByTagName(range.endContainer,['td','th','caption'],true);if(start !== end){me.selection.clearRange();}}else {me.selection.clearRange();}}mousedown = false;me.document.body.style.webkitUserSelect = ''; //拖拽状态下的mouseUP\nif(onDrag && dragTd){me.selection.getNative()[browser.ie9below?'empty':'removeAllRanges']();singleClickState = 0;dragLine = me.document.getElementById('ue_tableDragLine'); // trace 3973\nif(dragLine){var dragTdPos=domUtils.getXY(dragTd),dragLinePos=domUtils.getXY(dragLine);switch(onDrag){case \"h\":changeColWidth(dragTd,dragLinePos.x - dragTdPos.x);break;case \"v\":changeRowHeight(dragTd,dragLinePos.y - dragTdPos.y - dragTd.offsetHeight);break;default:}onDrag = \"\";dragTd = null;hideDragLine(me);me.fireEvent('saveScene');return;}} //正常状态下的mouseup\nif(!startTd){var target=domUtils.findParentByTagName(evt.target || evt.srcElement,\"td\",true);if(!target)target = domUtils.findParentByTagName(evt.target || evt.srcElement,\"th\",true);if(target && (target.tagName == \"TD\" || target.tagName == \"TH\")){if(me.fireEvent(\"excludetable\",target) === true)return;range = new dom.Range(me.document);range.setStart(target,0).setCursor(false,true);}}else {var ut=getUETable(startTd),cell=ut?ut.selectedTds[0]:null;if(cell){range = new dom.Range(me.document);if(domUtils.isEmptyBlock(cell)){range.setStart(cell,0).setCursor(false,true);}else {range.selectNodeContents(cell).shrinkBoundary().setCursor(false,true);}}else {range = me.selection.getRange().shrinkBoundary();if(!range.collapsed){var start=domUtils.findParentByTagName(range.startContainer,['td','th'],true),end=domUtils.findParentByTagName(range.endContainer,['td','th'],true); //在table里边的不能清除\nif(start && !end || !start && end || start && end && start !== end){range.setCursor(false,true);}}}startTd = null;me.removeListener('mouseover',mouseOverEvent);}me._selectionChange(250,evt);}function mouseOverEvent(type,evt){if(isEditorDisabled()){return;}var me=this,tar=evt.target || evt.srcElement;currentTd = domUtils.findParentByTagName(tar,\"td\",true) || domUtils.findParentByTagName(tar,\"th\",true); //需要判断两个TD是否位于同一个表格内\nif(startTd && currentTd && (startTd.tagName == \"TD\" && currentTd.tagName == \"TD\" || startTd.tagName == \"TH\" && currentTd.tagName == \"TH\") && domUtils.findParentByTagName(startTd,'table') == domUtils.findParentByTagName(currentTd,'table')){var ut=getUETable(currentTd);if(startTd != currentTd){me.document.body.style.webkitUserSelect = 'none';me.selection.getNative()[browser.ie9below?'empty':'removeAllRanges']();var range=ut.getCellsRange(startTd,currentTd);ut.setSelected(range);}else {me.document.body.style.webkitUserSelect = '';ut.clearSelected();}}evt.preventDefault?evt.preventDefault():evt.returnValue = false;}function setCellHeight(cell,height,backHeight){var lineHight=parseInt(domUtils.getComputedStyle(cell,\"line-height\"),10),tmpHeight=backHeight + height;height = tmpHeight < lineHight?lineHight:tmpHeight;if(cell.style.height)cell.style.height = \"\";cell.rowSpan == 1?cell.setAttribute(\"height\",height):cell.removeAttribute && cell.removeAttribute(\"height\");}function getWidth(cell){if(!cell)return 0;return parseInt(domUtils.getComputedStyle(cell,\"width\"),10);}function changeColWidth(cell,changeValue){var ut=getUETable(cell);if(ut){ //根据当前移动的边框获取相关的单元格\nvar table=ut.table,cells=getCellsByMoveBorder(cell,table);table.style.width = \"\";table.removeAttribute(\"width\"); //修正改变量\nchangeValue = correctChangeValue(changeValue,cell,cells);if(cell.nextSibling){var i=0;utils.each(cells,function(cellGroup){cellGroup.left.width = +cellGroup.left.width + changeValue;cellGroup.right && (cellGroup.right.width = +cellGroup.right.width - changeValue);});}else {utils.each(cells,function(cellGroup){cellGroup.left.width -= -changeValue;});}}}function isEditorDisabled(){return me.body.contentEditable === \"false\";}function changeRowHeight(td,changeValue){if(Math.abs(changeValue) < 10)return;var ut=getUETable(td);if(ut){var cells=ut.getSameEndPosCells(td,\"y\"), //备份需要连带变化的td的原始高度，否则后期无法获取正确的值\nbackHeight=cells[0]?cells[0].offsetHeight:0;for(var i=0,cell;cell = cells[i++];) {setCellHeight(cell,changeValue,backHeight);}}} /**\r\n     * 获取调整单元格大小的相关单元格\r\n     * @isContainMergeCell 返回的结果中是否包含发生合并后的单元格\r\n     */function getCellsByMoveBorder(cell,table,isContainMergeCell){if(!table){table = domUtils.findParentByTagName(cell,'table');}if(!table){return null;} //获取到该单元格所在行的序列号\nvar index=domUtils.getNodeIndex(cell),temp=cell,rows=table.rows,colIndex=0;while(temp) { //获取到当前单元格在未发生单元格合并时的序列\nif(temp.nodeType === 1){colIndex += temp.colSpan || 1;}temp = temp.previousSibling;}temp = null; //记录想关的单元格\nvar borderCells=[];utils.each(rows,function(tabRow){var cells=tabRow.cells,currIndex=0;utils.each(cells,function(tabCell){currIndex += tabCell.colSpan || 1;if(currIndex === colIndex){borderCells.push({left:tabCell,right:tabCell.nextSibling || null});return false;}else if(currIndex > colIndex){if(isContainMergeCell){borderCells.push({left:tabCell});}return false;}});});return borderCells;} /**\r\n     * 通过给定的单元格集合获取最小的单元格width\r\n     */function getMinWidthByTableCells(cells){var minWidth=Number.MAX_VALUE;for(var i=0,curCell;curCell = cells[i];i++) {minWidth = Math.min(minWidth,curCell.width || getTableCellWidth(curCell));}return minWidth;}function correctChangeValue(changeValue,relatedCell,cells){ //为单元格的paading预留空间\nchangeValue -= getTabcellSpace();if(changeValue < 0){return 0;}changeValue -= getTableCellWidth(relatedCell); //确定方向\nvar direction=changeValue < 0?'left':'right';changeValue = Math.abs(changeValue); //只关心非最后一个单元格就可以\nutils.each(cells,function(cellGroup){var curCell=cellGroup[direction]; //为单元格保留最小空间\nif(curCell){changeValue = Math.min(changeValue,getTableCellWidth(curCell) - cellMinWidth);}}); //修正越界\nchangeValue = changeValue < 0?0:changeValue;return direction === 'left'?-changeValue:changeValue;}function getTableCellWidth(cell){var width=0, //偏移纠正量\noffset=0,width=cell.offsetWidth - getTabcellSpace(); //最后一个节点纠正一下\nif(!cell.nextSibling){width -= getTableCellOffset(cell);}width = width < 0?0:width;try{cell.width = width;}catch(e) {}return width;} /**\r\n     * 获取单元格所在表格的最末单元格的偏移量\r\n     */function getTableCellOffset(cell){tab = domUtils.findParentByTagName(cell,\"table\",false);if(tab.offsetVal === undefined){var prev=cell.previousSibling;if(prev){ //最后一个单元格和前一个单元格的width diff结果 如果恰好为一个border width， 则条件成立\ntab.offsetVal = cell.offsetWidth - prev.offsetWidth === UT.borderWidth?UT.borderWidth:0;}else {tab.offsetVal = 0;}}return tab.offsetVal;}function getTabcellSpace(){if(UT.tabcellSpace === undefined){var cell=null,tab=me.document.createElement(\"table\"),tbody=me.document.createElement(\"tbody\"),trow=me.document.createElement(\"tr\"),tabcell=me.document.createElement(\"td\"),mirror=null;tabcell.style.cssText = 'border: 0;';tabcell.width = 1;trow.appendChild(tabcell);trow.appendChild(mirror = tabcell.cloneNode(false));tbody.appendChild(trow);tab.appendChild(tbody);tab.style.cssText = \"visibility: hidden;\";me.body.appendChild(tab);UT.paddingSpace = tabcell.offsetWidth - 1;var tmpTabWidth=tab.offsetWidth;tabcell.style.cssText = '';mirror.style.cssText = '';UT.borderWidth = (tab.offsetWidth - tmpTabWidth) / 3;UT.tabcellSpace = UT.paddingSpace + UT.borderWidth;me.body.removeChild(tab);}getTabcellSpace = function(){return UT.tabcellSpace;};return UT.tabcellSpace;}function getDragLine(editor,doc){if(mousedown)return;dragLine = editor.document.createElement(\"div\");domUtils.setAttributes(dragLine,{id:\"ue_tableDragLine\",unselectable:'on',contenteditable:false,'onresizestart':'return false','ondragstart':'return false','onselectstart':'return false',style:\"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)\"});editor.body.appendChild(dragLine);}function hideDragLine(editor){if(mousedown)return;var line;while(line = editor.document.getElementById('ue_tableDragLine')) {domUtils.remove(line);}} /**\r\n     * 依据state（v|h）在cell位置显示横线\r\n     * @param state\r\n     * @param cell\r\n     */function showDragLineAt(state,cell){if(!cell)return;var table=domUtils.findParentByTagName(cell,\"table\"),caption=table.getElementsByTagName('caption'),width=table.offsetWidth,height=table.offsetHeight - (caption.length > 0?caption[0].offsetHeight:0),tablePos=domUtils.getXY(table),cellPos=domUtils.getXY(cell),css;switch(state){case \"h\":css = 'height:' + height + 'px;top:' + (tablePos.y + (caption.length > 0?caption[0].offsetHeight:0)) + 'px;left:' + (cellPos.x + cell.offsetWidth);dragLine.style.cssText = css + 'px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)';break;case \"v\":css = 'width:' + width + 'px;left:' + tablePos.x + 'px;top:' + (cellPos.y + cell.offsetHeight); //必须加上border:0和color:blue，否则低版ie不支持背景色显示\ndragLine.style.cssText = css + 'px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)';break;default:}} /**\r\n     * 当表格边框颜色为白色时设置为虚线,true为添加虚线\r\n     * @param editor\r\n     * @param flag\r\n     */function switchBorderColor(editor,flag){var tableArr=domUtils.getElementsByTagName(editor.body,\"table\"),color;for(var i=0,node;node = tableArr[i++];) {var td=domUtils.getElementsByTagName(node,\"td\");if(td[0]){if(flag){color = td[0].style.borderColor.replace(/\\s/g,\"\");if(/(#ffffff)|(rgb\\(255,255,255\\))/ig.test(color))domUtils.addClass(node,\"noBorderTable\");}else {domUtils.removeClasses(node,\"noBorderTable\");}}}}function getTableWidth(editor,needIEHack,defaultValue){var body=editor.body;return body.offsetWidth - (needIEHack?parseInt(domUtils.getComputedStyle(body,'margin-left'),10) * 2:0) - defaultValue.tableBorder * 2 - (editor.options.offsetWidth || 0);} /**\r\n     * 获取当前拖动的单元格\r\n     */function getTargetTd(editor,evt){var target=domUtils.findParentByTagName(evt.target || evt.srcElement,[\"td\",\"th\"],true),dir=null;if(!target){return null;}dir = getRelation(target,mouseCoords(evt)); //如果有前一个节点， 需要做一个修正， 否则可能会得到一个错误的td\nif(!target){return null;}if(dir === 'h1' && target.previousSibling){var position=domUtils.getXY(target),cellWidth=target.offsetWidth;if(Math.abs(position.x + cellWidth - evt.clientX) > cellWidth / 3){target = target.previousSibling;}}else if(dir === 'v1' && target.parentNode.previousSibling){var position=domUtils.getXY(target),cellHeight=target.offsetHeight;if(Math.abs(position.y + cellHeight - evt.clientY) > cellHeight / 3){target = target.parentNode.previousSibling.firstChild;}} //排除了非td内部以及用于代码高亮部分的td\nreturn target && !(editor.fireEvent(\"excludetable\",target) === true)?target:null;}}; // plugins/table.sort.js\n/**\r\n * Created with JetBrains PhpStorm.\r\n * User: Jinqn\r\n * Date: 13-10-12\r\n * Time: 上午10:20\r\n * To change this template use File | Settings | File Templates.\r\n */UE.UETable.prototype.sortTable = function(sortByCellIndex,compareFn){var table=this.table,rows=table.rows,trArray=[],flag=rows[0].cells[0].tagName === \"TH\",lastRowIndex=0;if(this.selectedTds.length){var range=this.cellsRange,len=range.endRowIndex + 1;for(var i=range.beginRowIndex;i < len;i++) {trArray[i] = rows[i];}trArray.splice(0,range.beginRowIndex);lastRowIndex = range.endRowIndex + 1 === this.rowsNum?0:range.endRowIndex + 1;}else {for(var i=0,len=rows.length;i < len;i++) {trArray[i] = rows[i];}}var Fn={'reversecurrent':function reversecurrent(td1,td2){return 1;},'orderbyasc':function orderbyasc(td1,td2){var value1=td1.innerText || td1.textContent,value2=td2.innerText || td2.textContent;return value1.localeCompare(value2);},'reversebyasc':function reversebyasc(td1,td2){var value1=td1.innerHTML,value2=td2.innerHTML;return value2.localeCompare(value1);},'orderbynum':function orderbynum(td1,td2){var value1=td1[browser.ie?'innerText':'textContent'].match(/\\d+/),value2=td2[browser.ie?'innerText':'textContent'].match(/\\d+/);if(value1)value1 = +value1[0];if(value2)value2 = +value2[0];return (value1 || 0) - (value2 || 0);},'reversebynum':function reversebynum(td1,td2){var value1=td1[browser.ie?'innerText':'textContent'].match(/\\d+/),value2=td2[browser.ie?'innerText':'textContent'].match(/\\d+/);if(value1)value1 = +value1[0];if(value2)value2 = +value2[0];return (value2 || 0) - (value1 || 0);}}; //对表格设置排序的标记data-sort-type\ntable.setAttribute('data-sort-type',compareFn && typeof compareFn === \"string\" && Fn[compareFn]?compareFn:''); //th不参与排序\nflag && trArray.splice(0,1);trArray = utils.sort(trArray,function(tr1,tr2){var result;if(compareFn && typeof compareFn === \"function\"){result = compareFn.call(this,tr1.cells[sortByCellIndex],tr2.cells[sortByCellIndex]);}else if(compareFn && typeof compareFn === \"number\"){result = 1;}else if(compareFn && typeof compareFn === \"string\" && Fn[compareFn]){result = Fn[compareFn].call(this,tr1.cells[sortByCellIndex],tr2.cells[sortByCellIndex]);}else {result = Fn['orderbyasc'].call(this,tr1.cells[sortByCellIndex],tr2.cells[sortByCellIndex]);}return result;});var fragment=table.ownerDocument.createDocumentFragment();for(var j=0,len=trArray.length;j < len;j++) {fragment.appendChild(trArray[j]);}var tbody=table.getElementsByTagName(\"tbody\")[0];if(!lastRowIndex){tbody.appendChild(fragment);}else {tbody.insertBefore(fragment,rows[lastRowIndex - range.endRowIndex + range.beginRowIndex - 1]);}};UE.plugins['tablesort'] = function(){var me=this,UT=UE.UETable,getUETable=function getUETable(tdOrTable){return UT.getUETable(tdOrTable);},getTableItemsByRange=function getTableItemsByRange(editor){return UT.getTableItemsByRange(editor);};me.ready(function(){ //添加表格可排序的样式\nutils.cssRule('tablesort','table.sortEnabled tr.firstRow th,table.sortEnabled tr.firstRow td{padding-right:20px;background-repeat: no-repeat;background-position: center right;' + '   background-image:url(' + me.options.themePath + me.options.theme + '/images/sortable.png);}',me.document); //做单元格合并操作时,清除可排序标识\nme.addListener(\"afterexeccommand\",function(type,cmd){if(cmd == 'mergeright' || cmd == 'mergedown' || cmd == 'mergecells'){this.execCommand('disablesort');}});}); //表格排序\nUE.commands['sorttable'] = {queryCommandState:function queryCommandState(){var me=this,tableItems=getTableItemsByRange(me);if(!tableItems.cell)return -1;var table=tableItems.table,cells=table.getElementsByTagName(\"td\");for(var i=0,cell;cell = cells[i++];) {if(cell.rowSpan != 1 || cell.colSpan != 1)return -1;}return 0;},execCommand:function execCommand(cmd,fn){var me=this,range=me.selection.getRange(),bk=range.createBookmark(true),tableItems=getTableItemsByRange(me),cell=tableItems.cell,ut=getUETable(tableItems.table),cellInfo=ut.getCellInfo(cell);ut.sortTable(cellInfo.cellIndex,fn);range.moveToBookmark(bk);try{range.select();}catch(e) {}}}; //设置表格可排序,清除表格可排序\nUE.commands[\"enablesort\"] = UE.commands[\"disablesort\"] = {queryCommandState:function queryCommandState(cmd){var table=getTableItemsByRange(this).table;if(table && cmd == 'enablesort'){var cells=domUtils.getElementsByTagName(table,'th td');for(var i=0;i < cells.length;i++) {if(cells[i].getAttribute('colspan') > 1 || cells[i].getAttribute('rowspan') > 1)return -1;}}return !table?-1:cmd == 'enablesort' ^ table.getAttribute('data-sort') != 'sortEnabled'?-1:0;},execCommand:function execCommand(cmd){var table=getTableItemsByRange(this).table;table.setAttribute(\"data-sort\",cmd == \"enablesort\"?\"sortEnabled\":\"sortDisabled\");cmd == \"enablesort\"?domUtils.addClass(table,\"sortEnabled\"):domUtils.removeClasses(table,\"sortEnabled\");}};}; // plugins/contextmenu.js\n///import core\n///commands 右键菜单\n///commandsName  ContextMenu\n///commandsTitle  右键菜单\n/**\r\n * 右键菜单\r\n * @function\r\n * @name baidu.editor.plugins.contextmenu\r\n * @author zhanyi\r\n */UE.plugins['contextmenu'] = function(){var me=this;me.setOpt('enableContextMenu',true);if(me.getOpt('enableContextMenu') === false){return;}var lang=me.getLang(\"contextMenu\"),menu,items=me.options.contextMenu || [{label:lang['selectall'],cmdName:'selectall'},{label:lang.cleardoc,cmdName:'cleardoc',exec:function exec(){if(confirm(lang.confirmclear)){this.execCommand('cleardoc');}}},'-',{label:lang.unlink,cmdName:'unlink'},'-',{group:lang.paragraph,icon:'justifyjustify',subMenu:[{label:lang.justifyleft,cmdName:'justify',value:'left'},{label:lang.justifyright,cmdName:'justify',value:'right'},{label:lang.justifycenter,cmdName:'justify',value:'center'},{label:lang.justifyjustify,cmdName:'justify',value:'justify'}]},'-',{group:lang.table,icon:'table',subMenu:[{label:lang.inserttable,cmdName:'inserttable'},{label:lang.deletetable,cmdName:'deletetable'},'-',{label:lang.deleterow,cmdName:'deleterow'},{label:lang.deletecol,cmdName:'deletecol'},{label:lang.insertcol,cmdName:'insertcol'},{label:lang.insertcolnext,cmdName:'insertcolnext'},{label:lang.insertrow,cmdName:'insertrow'},{label:lang.insertrownext,cmdName:'insertrownext'},'-',{label:lang.insertcaption,cmdName:'insertcaption'},{label:lang.deletecaption,cmdName:'deletecaption'},{label:lang.inserttitle,cmdName:'inserttitle'},{label:lang.deletetitle,cmdName:'deletetitle'},{label:lang.inserttitlecol,cmdName:'inserttitlecol'},{label:lang.deletetitlecol,cmdName:'deletetitlecol'},'-',{label:lang.mergecells,cmdName:'mergecells'},{label:lang.mergeright,cmdName:'mergeright'},{label:lang.mergedown,cmdName:'mergedown'},'-',{label:lang.splittorows,cmdName:'splittorows'},{label:lang.splittocols,cmdName:'splittocols'},{label:lang.splittocells,cmdName:'splittocells'},'-',{label:lang.averageDiseRow,cmdName:'averagedistributerow'},{label:lang.averageDisCol,cmdName:'averagedistributecol'},'-',{label:lang.edittd,cmdName:'edittd',exec:function exec(){if(UE.ui['edittd']){new UE.ui['edittd'](this);}this.getDialog('edittd').open();}},{label:lang.edittable,cmdName:'edittable',exec:function exec(){if(UE.ui['edittable']){new UE.ui['edittable'](this);}this.getDialog('edittable').open();}},{label:lang.setbordervisible,cmdName:'setbordervisible'}]},{group:lang.tablesort,icon:'tablesort',subMenu:[{label:lang.enablesort,cmdName:'enablesort'},{label:lang.disablesort,cmdName:'disablesort'},'-',{label:lang.reversecurrent,cmdName:'sorttable',value:'reversecurrent'},{label:lang.orderbyasc,cmdName:'sorttable',value:'orderbyasc'},{label:lang.reversebyasc,cmdName:'sorttable',value:'reversebyasc'},{label:lang.orderbynum,cmdName:'sorttable',value:'orderbynum'},{label:lang.reversebynum,cmdName:'sorttable',value:'reversebynum'}]},{group:lang.borderbk,icon:'borderBack',subMenu:[{label:lang.setcolor,cmdName:\"interlacetable\",exec:function exec(){this.execCommand(\"interlacetable\");}},{label:lang.unsetcolor,cmdName:\"uninterlacetable\",exec:function exec(){this.execCommand(\"uninterlacetable\");}},{label:lang.setbackground,cmdName:\"settablebackground\",exec:function exec(){this.execCommand(\"settablebackground\",{repeat:true,colorList:[\"#bbb\",\"#ccc\"]});}},{label:lang.unsetbackground,cmdName:\"cleartablebackground\",exec:function exec(){this.execCommand(\"cleartablebackground\");}},{label:lang.redandblue,cmdName:\"settablebackground\",exec:function exec(){this.execCommand(\"settablebackground\",{repeat:true,colorList:[\"red\",\"blue\"]});}},{label:lang.threecolorgradient,cmdName:\"settablebackground\",exec:function exec(){this.execCommand(\"settablebackground\",{repeat:true,colorList:[\"#aaa\",\"#bbb\",\"#ccc\"]});}}]},{group:lang.aligntd,icon:'aligntd',subMenu:[{cmdName:'cellalignment',value:{align:'left',vAlign:'top'}},{cmdName:'cellalignment',value:{align:'center',vAlign:'top'}},{cmdName:'cellalignment',value:{align:'right',vAlign:'top'}},{cmdName:'cellalignment',value:{align:'left',vAlign:'middle'}},{cmdName:'cellalignment',value:{align:'center',vAlign:'middle'}},{cmdName:'cellalignment',value:{align:'right',vAlign:'middle'}},{cmdName:'cellalignment',value:{align:'left',vAlign:'bottom'}},{cmdName:'cellalignment',value:{align:'center',vAlign:'bottom'}},{cmdName:'cellalignment',value:{align:'right',vAlign:'bottom'}}]},{group:lang.aligntable,icon:'aligntable',subMenu:[{cmdName:'tablealignment',className:'left',label:lang.tableleft,value:\"left\"},{cmdName:'tablealignment',className:'center',label:lang.tablecenter,value:\"center\"},{cmdName:'tablealignment',className:'right',label:lang.tableright,value:\"right\"}]},'-',{label:lang.insertparagraphbefore,cmdName:'insertparagraph',value:true},{label:lang.insertparagraphafter,cmdName:'insertparagraph'},{label:lang['copy'],cmdName:'copy'},{label:lang['paste'],cmdName:'paste'}];if(!items.length){return;}var uiUtils=UE.ui.uiUtils;me.addListener('contextmenu',function(type,evt){var offset=uiUtils.getViewportOffsetByEvent(evt);me.fireEvent('beforeselectionchange');if(menu){menu.destroy();}for(var i=0,ti,contextItems=[];ti = items[i];i++) {var last;(function(item){if(item == '-'){if((last = contextItems[contextItems.length - 1]) && last !== '-'){contextItems.push('-');}}else if(item.hasOwnProperty(\"group\")){for(var j=0,cj,subMenu=[];cj = item.subMenu[j];j++) {(function(subItem){if(subItem == '-'){if((last = subMenu[subMenu.length - 1]) && last !== '-'){subMenu.push('-');}else {subMenu.splice(subMenu.length - 1);}}else {if((me.commands[subItem.cmdName] || UE.commands[subItem.cmdName] || subItem.query) && (subItem.query?subItem.query():me.queryCommandState(subItem.cmdName)) > -1){subMenu.push({'label':subItem.label || me.getLang(\"contextMenu.\" + subItem.cmdName + (subItem.value || '')) || \"\",'className':'edui-for-' + subItem.cmdName + (subItem.className?' edui-for-' + subItem.cmdName + '-' + subItem.className:''),onclick:subItem.exec?function(){subItem.exec.call(me);}:function(){me.execCommand(subItem.cmdName,subItem.value);}});}}})(cj);}if(subMenu.length){var getLabel=function getLabel(){switch(item.icon){case \"table\":return me.getLang(\"contextMenu.table\");case \"justifyjustify\":return me.getLang(\"contextMenu.paragraph\");case \"aligntd\":return me.getLang(\"contextMenu.aligntd\");case \"aligntable\":return me.getLang(\"contextMenu.aligntable\");case \"tablesort\":return lang.tablesort;case \"borderBack\":return lang.borderbk;default:return '';}};contextItems.push({ //todo 修正成自动获取方式\n'label':getLabel(),className:'edui-for-' + item.icon,'subMenu':{items:subMenu,editor:me}});}}else { //有可能commmand没有加载右键不能出来，或者没有command也想能展示出来添加query方法\nif((me.commands[item.cmdName] || UE.commands[item.cmdName] || item.query) && (item.query?item.query.call(me):me.queryCommandState(item.cmdName)) > -1){contextItems.push({'label':item.label || me.getLang(\"contextMenu.\" + item.cmdName),className:'edui-for-' + (item.icon?item.icon:item.cmdName + (item.value || '')),onclick:item.exec?function(){item.exec.call(me);}:function(){me.execCommand(item.cmdName,item.value);}});}}})(ti);}if(contextItems[contextItems.length - 1] == '-'){contextItems.pop();}menu = new UE.ui.Menu({items:contextItems,className:\"edui-contextmenu\",editor:me});menu.render();menu.showAt(offset);me.fireEvent(\"aftershowcontextmenu\",menu);domUtils.preventDefault(evt);if(browser.ie){var ieRange;try{ieRange = me.selection.getNative().createRange();}catch(e) {return;}if(ieRange.item){var range=new dom.Range(me.document);range.selectNode(ieRange.item(0)).select(true,true);}}}); // 添加复制的flash按钮\nme.addListener('aftershowcontextmenu',function(type,menu){if(me.zeroclipboard){var items=menu.items;for(var key in items) {if(items[key].className == 'edui-for-copy'){me.zeroclipboard.clip(items[key].getDom());}}}});}; // plugins/shortcutmenu.js\n///import core\n///commands       弹出菜单\n// commandsName  popupmenu\n///commandsTitle  弹出菜单\n/**\r\n * 弹出菜单\r\n * @function\r\n * @name baidu.editor.plugins.popupmenu\r\n * @author xuheng\r\n */UE.plugins['shortcutmenu'] = function(){var me=this,menu,items=me.options.shortcutMenu || [];if(!items.length){return;}me.addListener('contextmenu mouseup',function(type,e){var me=this,customEvt={type:type,target:e.target || e.srcElement,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY};setTimeout(function(){var rng=me.selection.getRange();if(rng.collapsed === false || type == \"contextmenu\"){if(!menu){menu = new baidu.editor.ui.ShortCutMenu({editor:me,items:items,theme:me.options.theme,className:'edui-shortcutmenu'});menu.render();me.fireEvent(\"afterrendershortcutmenu\",menu);}menu.show(customEvt,!!UE.plugins['contextmenu']);}});if(type == 'contextmenu'){domUtils.preventDefault(e);if(browser.ie9below){var ieRange;try{ieRange = me.selection.getNative().createRange();}catch(e) {return;}if(ieRange.item){var range=new dom.Range(me.document);range.selectNode(ieRange.item(0)).select(true,true);}}}});me.addListener('keydown',function(type){if(type == \"keydown\"){menu && !menu.isHidden && menu.hide();}});}; // plugins/basestyle.js\n/**\r\n * B、I、sub、super命令支持\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugins['basestyle'] = function(){ /**\r\n     * 字体加粗\r\n     * @command bold\r\n     * @param { String } cmd 命令字符串\r\n     * @remind 对已加粗的文本内容执行该命令， 将取消加粗\r\n     * @method execCommand\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * //对当前选中的文本内容执行加粗操作\r\n     * //第一次执行， 文本内容加粗\r\n     * editor.execCommand( 'bold' );\r\n     *\r\n     * //第二次执行， 文本内容取消加粗\r\n     * editor.execCommand( 'bold' );\r\n     * ```\r\n     */ /**\r\n     * 字体倾斜\r\n     * @command italic\r\n     * @method execCommand\r\n     * @param { String } cmd 命令字符串\r\n     * @remind 对已倾斜的文本内容执行该命令， 将取消倾斜\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * //对当前选中的文本内容执行斜体操作\r\n     * //第一次操作， 文本内容将变成斜体\r\n     * editor.execCommand( 'italic' );\r\n     *\r\n     * //再次对同一文本内容执行， 则文本内容将恢复正常\r\n     * editor.execCommand( 'italic' );\r\n     * ```\r\n     */ /**\r\n     * 下标文本，与“superscript”命令互斥\r\n     * @command subscript\r\n     * @method execCommand\r\n     * @remind  把选中的文本内容切换成下标文本， 如果当前选中的文本已经是下标， 则该操作会把文本内容还原成正常文本\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * //对当前选中的文本内容执行下标操作\r\n     * //第一次操作， 文本内容将变成下标文本\r\n     * editor.execCommand( 'subscript' );\r\n     *\r\n     * //再次对同一文本内容执行， 则文本内容将恢复正常\r\n     * editor.execCommand( 'subscript' );\r\n     * ```\r\n     */ /**\r\n     * 上标文本，与“subscript”命令互斥\r\n     * @command superscript\r\n     * @method execCommand\r\n     * @remind 把选中的文本内容切换成上标文本， 如果当前选中的文本已经是上标， 则该操作会把文本内容还原成正常文本\r\n     * @param { String } cmd 命令字符串\r\n     * @example\r\n     * ```javascript\r\n     * //editor是编辑器实例\r\n     * //对当前选中的文本内容执行上标操作\r\n     * //第一次操作， 文本内容将变成上标文本\r\n     * editor.execCommand( 'superscript' );\r\n     *\r\n     * //再次对同一文本内容执行， 则文本内容将恢复正常\r\n     * editor.execCommand( 'superscript' );\r\n     * ```\r\n     */var basestyles={'bold':['strong','b'],'italic':['em','i'],'subscript':['sub'],'superscript':['sup']},getObj=function getObj(editor,tagNames){return domUtils.filterNodeList(editor.selection.getStartElementPath(),tagNames);},me=this; //添加快捷键\nme.addshortcutkey({\"Bold\":\"ctrl+66\", //^B\n\"Italic\":\"ctrl+73\", //^I\n\"Underline\":\"ctrl+85\" //^U\n});me.addInputRule(function(root){utils.each(root.getNodesByTagName('b i'),function(node){switch(node.tagName){case 'b':node.tagName = 'strong';break;case 'i':node.tagName = 'em';}});});for(var style in basestyles) {(function(cmd,tagNames){me.commands[cmd] = {execCommand:function execCommand(cmdName){var range=me.selection.getRange(),obj=getObj(this,tagNames);if(range.collapsed){if(obj){var tmpText=me.document.createTextNode('');range.insertNode(tmpText).removeInlineStyle(tagNames);range.setStartBefore(tmpText);domUtils.remove(tmpText);}else {var tmpNode=range.document.createElement(tagNames[0]);if(cmdName == 'superscript' || cmdName == 'subscript'){tmpText = me.document.createTextNode('');range.insertNode(tmpText).removeInlineStyle(['sub','sup']).setStartBefore(tmpText).collapse(true);}range.insertNode(tmpNode).setStart(tmpNode,0);}range.collapse(true);}else {if(cmdName == 'superscript' || cmdName == 'subscript'){if(!obj || obj.tagName.toLowerCase() != cmdName){range.removeInlineStyle(['sub','sup']);}}obj?range.removeInlineStyle(tagNames):range.applyInlineStyle(tagNames[0]);}range.select();},queryCommandState:function queryCommandState(){return getObj(this,tagNames)?1:0;}};})(style,basestyles[style]);}}; // plugins/elementpath.js\n/**\r\n * 选取路径命令\r\n * @file\r\n */UE.plugins['elementpath'] = function(){var currentLevel,tagNames,me=this;me.setOpt('elementPathEnabled',true);if(!me.options.elementPathEnabled){return;}me.commands['elementpath'] = {execCommand:function execCommand(cmdName,level){var start=tagNames[level],range=me.selection.getRange();currentLevel = level * 1;range.selectNode(start).select();},queryCommandValue:function queryCommandValue(){ //产生一个副本，不能修改原来的startElementPath;\nvar parents=[].concat(this.selection.getStartElementPath()).reverse(),names=[];tagNames = parents;for(var i=0,ci;ci = parents[i];i++) {if(ci.nodeType == 3){continue;}var name=ci.tagName.toLowerCase();if(name == 'img' && ci.getAttribute('anchorname')){name = 'anchor';}names[i] = name;if(currentLevel == i){currentLevel = -1;break;}}return names;}};}; // plugins/formatmatch.js\n/**\r\n * 格式刷，只格式inline的\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 格式刷\r\n * @command formatmatch\r\n * @method execCommand\r\n * @remind 该操作不能复制段落格式\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * //editor是编辑器实例\r\n * //获取格式刷\r\n * editor.execCommand( 'formatmatch' );\r\n * ```\r\n */UE.plugins['formatmatch'] = function(){var me=this,list=[],img,flag=0;me.addListener('reset',function(){list = [];flag = 0;});function addList(type,evt){if(browser.webkit){var target=evt.target.tagName == 'IMG'?evt.target:null;}function addFormat(range){if(text){range.selectNode(text);}return range.applyInlineStyle(list[list.length - 1].tagName,null,list);}me.undoManger && me.undoManger.save();var range=me.selection.getRange(),imgT=target || range.getClosedNode();if(img && imgT && imgT.tagName == 'IMG'){ //trace:964\nimgT.style.cssText += ';float:' + (img.style.cssFloat || img.style.styleFloat || 'none') + ';display:' + (img.style.display || 'inline');img = null;}else {if(!img){var collapsed=range.collapsed;if(collapsed){var text=me.document.createTextNode('match');range.insertNode(text).select();}me.__hasEnterExecCommand = true; //不能把block上的属性干掉\n//trace:1553\nvar removeFormatAttributes=me.options.removeFormatAttributes;me.options.removeFormatAttributes = '';me.execCommand('removeformat');me.options.removeFormatAttributes = removeFormatAttributes;me.__hasEnterExecCommand = false; //trace:969\nrange = me.selection.getRange();if(list.length){addFormat(range);}if(text){range.setStartBefore(text).collapse(true);}range.select();text && domUtils.remove(text);}}me.undoManger && me.undoManger.save();me.removeListener('mouseup',addList);flag = 0;}me.commands['formatmatch'] = {execCommand:function execCommand(cmdName){if(flag){flag = 0;list = [];me.removeListener('mouseup',addList);return;}var range=me.selection.getRange();img = range.getClosedNode();if(!img || img.tagName != 'IMG'){range.collapse(true).shrinkBoundary();var start=range.startContainer;list = domUtils.findParents(start,true,function(node){return !domUtils.isBlockElm(node) && node.nodeType == 1;}); //a不能加入格式刷, 并且克隆节点\nfor(var i=0,ci;ci = list[i];i++) {if(ci.tagName == 'A'){list.splice(i,1);break;}}}me.addListener('mouseup',addList);flag = 1;},queryCommandState:function queryCommandState(){return flag;},notNeedUndo:1};}; // plugins/searchreplace.js\n///import core\n///commands 查找替换\n///commandsName  SearchReplace\n///commandsTitle  查询替换\n///commandsDialog  dialogs\\searchreplace\n/**\r\n * @description 查找替换\r\n * @author zhanyi\r\n */UE.plugin.register('searchreplace',function(){var me=this;var _blockElm={'table':1,'tbody':1,'tr':1,'ol':1,'ul':1};function findTextInString(textContent,opt,currentIndex){var str=opt.searchStr;if(opt.dir == -1){textContent = textContent.split('').reverse().join('');str = str.split('').reverse().join('');currentIndex = textContent.length - currentIndex;}var reg=new RegExp(str,'g' + (opt.casesensitive?'':'i')),match;while(match = reg.exec(textContent)) {if(match.index >= currentIndex){return opt.dir == -1?textContent.length - match.index - opt.searchStr.length:match.index;}}return -1;}function findTextBlockElm(node,currentIndex,opt){var textContent,index,methodName=opt.all || opt.dir == 1?'getNextDomNode':'getPreDomNode';if(domUtils.isBody(node)){node = node.firstChild;}var first=1;while(node) {textContent = node.nodeType == 3?node.nodeValue:node[browser.ie?'innerText':'textContent'];index = findTextInString(textContent,opt,currentIndex);first = 0;if(index != -1){return {'node':node,'index':index};}node = domUtils[methodName](node);while(node && _blockElm[node.nodeName.toLowerCase()]) {node = domUtils[methodName](node,true);}if(node){currentIndex = opt.dir == -1?(node.nodeType == 3?node.nodeValue:node[browser.ie?'innerText':'textContent']).length:0;}}}function findNTextInBlockElm(node,index,str){var currentIndex=0,currentNode=node.firstChild,currentNodeLength=0,result;while(currentNode) {if(currentNode.nodeType == 3){currentNodeLength = currentNode.nodeValue.replace(/(^[\\t\\r\\n]+)|([\\t\\r\\n]+$)/,'').length;currentIndex += currentNodeLength;if(currentIndex >= index){return {'node':currentNode,'index':currentNodeLength - (currentIndex - index)};}}else if(!dtd.$empty[currentNode.tagName]){currentNodeLength = currentNode[browser.ie?'innerText':'textContent'].replace(/(^[\\t\\r\\n]+)|([\\t\\r\\n]+$)/,'').length;currentIndex += currentNodeLength;if(currentIndex >= index){result = findNTextInBlockElm(currentNode,currentNodeLength - (currentIndex - index),str);if(result){return result;}}}currentNode = domUtils.getNextDomNode(currentNode);}}function searchReplace(me,opt){var rng=me.selection.getRange(),startBlockNode,searchStr=opt.searchStr,span=me.document.createElement('span');span.innerHTML = '$$ueditor_searchreplace_key$$';rng.shrinkBoundary(true); //判断是不是第一次选中\nif(!rng.collapsed){rng.select();var rngText=me.selection.getText();if(new RegExp('^' + opt.searchStr + '$',opt.casesensitive?'':'i').test(rngText)){if(opt.replaceStr != undefined){replaceText(rng,opt.replaceStr);rng.select();return true;}else {rng.collapse(opt.dir == -1);}}}rng.insertNode(span);rng.enlargeToBlockElm(true);startBlockNode = rng.startContainer;var currentIndex=startBlockNode[browser.ie?'innerText':'textContent'].indexOf('$$ueditor_searchreplace_key$$');rng.setStartBefore(span);domUtils.remove(span);var result=findTextBlockElm(startBlockNode,currentIndex,opt);if(result){var rngStart=findNTextInBlockElm(result.node,result.index,searchStr);var rngEnd=findNTextInBlockElm(result.node,result.index + searchStr.length,searchStr);rng.setStart(rngStart.node,rngStart.index).setEnd(rngEnd.node,rngEnd.index);if(opt.replaceStr !== undefined){replaceText(rng,opt.replaceStr);}rng.select();return true;}else {rng.setCursor();}}function replaceText(rng,str){str = me.document.createTextNode(str);rng.deleteContents().insertNode(str);}return {commands:{'searchreplace':{execCommand:function execCommand(cmdName,opt){utils.extend(opt,{all:false,casesensitive:false,dir:1},true);var num=0;if(opt.all){var rng=me.selection.getRange(),first=me.body.firstChild;if(first && first.nodeType == 1){rng.setStart(first,0);rng.shrinkBoundary(true);}else if(first.nodeType == 3){rng.setStartBefore(first);}rng.collapse(true).select(true);if(opt.replaceStr !== undefined){me.fireEvent('saveScene');}while(searchReplace(this,opt)) {num++;}if(num){me.fireEvent('saveScene');}}else {if(opt.replaceStr !== undefined){me.fireEvent('saveScene');}if(searchReplace(this,opt)){num++;}if(num){me.fireEvent('saveScene');}}return num;},notNeedUndo:1}}};}); // plugins/customstyle.js\n/**\r\n * 自定义样式\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 根据config配置文件里“customstyle”选项的值对匹配的标签执行样式替换。\r\n * @command customstyle\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * editor.execCommand( 'customstyle' );\r\n * ```\r\n */UE.plugins['customstyle'] = function(){var me=this;me.setOpt({'customstyle':[{tag:'h1',name:'tc',style:'font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;'},{tag:'h1',name:'tl',style:'font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;'},{tag:'span',name:'im',style:'font-size:16px;font-style:italic;font-weight:bold;line-height:18px;'},{tag:'span',name:'hi',style:'font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;'}]});me.commands['customstyle'] = {execCommand:function execCommand(cmdName,obj){var me=this,tagName=obj.tag,node=domUtils.findParent(me.selection.getStart(),function(node){return node.getAttribute('label');},true),range,bk,tmpObj={};for(var p in obj) {if(obj[p] !== undefined)tmpObj[p] = obj[p];}delete tmpObj.tag;if(node && node.getAttribute('label') == obj.label){range = this.selection.getRange();bk = range.createBookmark();if(range.collapsed){ //trace:1732 删掉自定义标签，要有p来回填站位\nif(dtd.$block[node.tagName]){var fillNode=me.document.createElement('p');domUtils.moveChild(node,fillNode);node.parentNode.insertBefore(fillNode,node);domUtils.remove(node);}else {domUtils.remove(node,true);}}else {var common=domUtils.getCommonAncestor(bk.start,bk.end),nodes=domUtils.getElementsByTagName(common,tagName);if(new RegExp(tagName,'i').test(common.tagName)){nodes.push(common);}for(var i=0,ni;ni = nodes[i++];) {if(ni.getAttribute('label') == obj.label){var ps=domUtils.getPosition(ni,bk.start),pe=domUtils.getPosition(ni,bk.end);if((ps & domUtils.POSITION_FOLLOWING || ps & domUtils.POSITION_CONTAINS) && (pe & domUtils.POSITION_PRECEDING || pe & domUtils.POSITION_CONTAINS))if(dtd.$block[tagName]){var fillNode=me.document.createElement('p');domUtils.moveChild(ni,fillNode);ni.parentNode.insertBefore(fillNode,ni);}domUtils.remove(ni,true);}}node = domUtils.findParent(common,function(node){return node.getAttribute('label') == obj.label;},true);if(node){domUtils.remove(node,true);}}range.moveToBookmark(bk).select();}else {if(dtd.$block[tagName]){this.execCommand('paragraph',tagName,tmpObj,'customstyle');range = me.selection.getRange();if(!range.collapsed){range.collapse();node = domUtils.findParent(me.selection.getStart(),function(node){return node.getAttribute('label') == obj.label;},true);var pNode=me.document.createElement('p');domUtils.insertAfter(node,pNode);domUtils.fillNode(me.document,pNode);range.setStart(pNode,0).setCursor();}}else {range = me.selection.getRange();if(range.collapsed){node = me.document.createElement(tagName);domUtils.setAttributes(node,tmpObj);range.insertNode(node).setStart(node,0).setCursor();return;}bk = range.createBookmark();range.applyInlineStyle(tagName,tmpObj).moveToBookmark(bk).select();}}},queryCommandValue:function queryCommandValue(){var parent=domUtils.filterNodeList(this.selection.getStartElementPath(),function(node){return node.getAttribute('label');});return parent?parent.getAttribute('label'):'';}}; //当去掉customstyle是，如果是块元素，用p代替\nme.addListener('keyup',function(type,evt){var keyCode=evt.keyCode || evt.which;if(keyCode == 32 || keyCode == 13){var range=me.selection.getRange();if(range.collapsed){var node=domUtils.findParent(me.selection.getStart(),function(node){return node.getAttribute('label');},true);if(node && dtd.$block[node.tagName] && domUtils.isEmptyNode(node)){var p=me.document.createElement('p');domUtils.insertAfter(node,p);domUtils.fillNode(me.document,p);domUtils.remove(node);range.setStart(p,0).setCursor();}}}});}; // plugins/catchremoteimage.js\n///import core\n///commands 远程图片抓取\n///commandsName  catchRemoteImage,catchremoteimageenable\n///commandsTitle  远程图片抓取\n/**\r\n * 远程图片抓取,当开启本插件时所有不符合本地域名的图片都将被抓取成为本地服务器上的图片\r\n */UE.plugins['catchremoteimage'] = function(){var me=this,ajax=UE.ajax; /* 设置默认值 */if(me.options.catchRemoteImageEnable === false)return;me.setOpt({catchRemoteImageEnable:false});me.addListener(\"afterpaste\",function(){me.fireEvent(\"catchRemoteImage\");});me.addListener(\"catchRemoteImage\",function(){var catcherLocalDomain=me.getOpt('catcherLocalDomain'),catcherActionUrl=me.getActionUrl(me.getOpt('catcherActionName')),catcherUrlPrefix=me.getOpt('catcherUrlPrefix'),catcherFieldName=me.getOpt('catcherFieldName');var remoteImages=[],imgs=domUtils.getElementsByTagName(me.document,\"img\"),test=function test(src,urls){if(src.indexOf(location.host) != -1 || /(^\\.)|(^\\/)/.test(src)){return true;}if(urls){for(var j=0,url;url = urls[j++];) {if(src.indexOf(url) !== -1){return true;}}}return false;};for(var i=0,ci;ci = imgs[i++];) {if(ci.getAttribute(\"word_img\")){continue;}var src=ci.getAttribute(\"_src\") || ci.src || \"\";if(/^(https?|ftp):/i.test(src) && !test(src,catcherLocalDomain)){remoteImages.push(src);}}if(remoteImages.length){catchremoteimage(remoteImages,{ //成功抓取\nsuccess:function success(r){try{var info=r.state !== undefined?r:eval(\"(\" + r.responseText + \")\");}catch(e) {return;} /* 获取源路径和新路径 */var i,j,ci,cj,oldSrc,newSrc,list=info.list;for(i = 0;ci = imgs[i++];) {oldSrc = ci.getAttribute(\"_src\") || ci.src || \"\";for(j = 0;cj = list[j++];) {if(oldSrc == cj.source && cj.state == \"SUCCESS\"){ //抓取失败时不做替换处理\nnewSrc = catcherUrlPrefix + cj.url;domUtils.setAttributes(ci,{\"src\":newSrc,\"_src\":newSrc});break;}}}me.fireEvent('catchremotesuccess');}, //回调失败，本次请求超时\nerror:function error(){me.fireEvent(\"catchremoteerror\");}});}function catchremoteimage(imgs,callbacks){var params=utils.serializeParam(me.queryCommandValue('serverparam')) || '',url=utils.formatUrl(catcherActionUrl + (catcherActionUrl.indexOf('?') == -1?'?':'&') + params),isJsonp=utils.isCrossDomainUrl(url),opt={'method':'POST','dataType':isJsonp?'jsonp':'','timeout':60000, //单位：毫秒，回调请求超时设置。目标用户如果网速不是很快的话此处建议设置一个较大的数值\n'onsuccess':callbacks[\"success\"],'onerror':callbacks[\"error\"]};opt[catcherFieldName] = imgs;ajax.request(url,opt);}});}; // plugins/snapscreen.js\n/**\r\n * 截屏插件，为UEditor提供插入支持\r\n * @file\r\n * @since 1.4.2\r\n */UE.plugin.register('snapscreen',function(){var me=this;var snapplugin;function getLocation(url){var search,a=document.createElement('a'),params=utils.serializeParam(me.queryCommandValue('serverparam')) || '';a.href = url;if(browser.ie){a.href = a.href;}search = a.search;if(params){search = search + (search.indexOf('?') == -1?'?':'&') + params;search = search.replace(/[&]+/ig,'&');}return {'port':a.port,'hostname':a.hostname,'path':a.pathname + search || +a.hash};}return {commands:{ /**\r\n             * 字体背景颜色\r\n             * @command snapscreen\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand('snapscreen');\r\n             * ```\r\n             */'snapscreen':{execCommand:function execCommand(cmd){var url,local,res;var lang=me.getLang(\"snapScreen_plugin\");if(!snapplugin){var container=me.container;var doc=me.container.ownerDocument || me.container.document;snapplugin = doc.createElement(\"object\");try{snapplugin.type = \"application/x-pluginbaidusnap\";}catch(e) {return;}snapplugin.style.cssText = \"position:absolute;left:-9999px;width:0;height:0;\";snapplugin.setAttribute(\"width\",\"0\");snapplugin.setAttribute(\"height\",\"0\");container.appendChild(snapplugin);}function onSuccess(rs){try{rs = eval(\"(\" + rs + \")\");if(rs.state == 'SUCCESS'){var opt=me.options;me.execCommand('insertimage',{src:opt.snapscreenUrlPrefix + rs.url,_src:opt.snapscreenUrlPrefix + rs.url,alt:rs.title || '',floatStyle:opt.snapscreenImgAlign});}else {alert(rs.state);}}catch(e) {alert(lang.callBackErrorMsg);}}url = me.getActionUrl(me.getOpt('snapscreenActionName'));local = getLocation(url);setTimeout(function(){try{res = snapplugin.saveSnapshot(local.hostname,local.path,local.port);}catch(e) {me.ui._dialogs['snapscreenDialog'].open();return;}onSuccess(res);},50);},queryCommandState:function queryCommandState(){return navigator.userAgent.indexOf(\"Windows\",0) != -1?0:-1;}}}};}); // plugins/insertparagraph.js\n/**\r\n * 插入段落\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 插入段落\r\n * @command insertparagraph\r\n * @method execCommand\r\n * @param { String } cmd 命令字符串\r\n * @example\r\n * ```javascript\r\n * //editor是编辑器实例\r\n * editor.execCommand( 'insertparagraph' );\r\n * ```\r\n */UE.commands['insertparagraph'] = {execCommand:function execCommand(cmdName,front){var me=this,range=me.selection.getRange(),start=range.startContainer,tmpNode;while(start) {if(domUtils.isBody(start)){break;}tmpNode = start;start = start.parentNode;}if(tmpNode){var p=me.document.createElement('p');if(front){tmpNode.parentNode.insertBefore(p,tmpNode);}else {tmpNode.parentNode.insertBefore(p,tmpNode.nextSibling);}domUtils.fillNode(me.document,p);range.setStart(p,0).setCursor(false,true);}}}; // plugins/webapp.js\n/**\r\n * 百度应用\r\n * @file\r\n * @since 1.2.6.1\r\n */ /**\r\n * 插入百度应用\r\n * @command webapp\r\n * @method execCommand\r\n * @remind 需要百度APPKey\r\n * @remind 百度应用主页： <a href=\"http://app.baidu.com/\" target=\"_blank\">http://app.baidu.com/</a>\r\n * @param { Object } appOptions 应用所需的参数项， 支持的key有： title=>应用标题， width=>应用容器宽度，\r\n * height=>应用容器高度，logo=>应用logo，url=>应用地址\r\n * @example\r\n * ```javascript\r\n * //editor是编辑器实例\r\n * //在编辑器里插入一个“植物大战僵尸”的APP\r\n * editor.execCommand( 'webapp' , {\r\n *     title: '植物大战僵尸',\r\n *     width: 560,\r\n *     height: 465,\r\n *     logo: '应用展示的图片',\r\n *     url: '百度应用的地址'\r\n * } );\r\n * ```\r\n */ //UE.plugins['webapp'] = function () {\n//    var me = this;\n//    function createInsertStr( obj, toIframe, addParagraph ) {\n//        return !toIframe ?\n//                (addParagraph ? '<p>' : '') + '<img title=\"'+obj.title+'\" width=\"' + obj.width + '\" height=\"' + obj.height + '\"' +\n//                        ' src=\"' + me.options.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif\" style=\"background:url(' + obj.logo+') no-repeat center center; border:1px solid gray;\" class=\"edui-faked-webapp\" _url=\"' + obj.url + '\" />' +\n//                        (addParagraph ? '</p>' : '')\n//                :\n//                '<iframe class=\"edui-faked-webapp\" title=\"'+obj.title+'\" width=\"' + obj.width + '\" height=\"' + obj.height + '\"  scrolling=\"no\" frameborder=\"0\" src=\"' + obj.url + '\" logo_url = '+obj.logo+'></iframe>';\n//    }\n//\n//    function switchImgAndIframe( img2frame ) {\n//        var tmpdiv,\n//                nodes = domUtils.getElementsByTagName( me.document, !img2frame ? \"iframe\" : \"img\" );\n//        for ( var i = 0, node; node = nodes[i++]; ) {\n//            if ( node.className != \"edui-faked-webapp\" ){\n//                continue;\n//            }\n//            tmpdiv = me.document.createElement( \"div\" );\n//            tmpdiv.innerHTML = createInsertStr( img2frame ? {url:node.getAttribute( \"_url\" ), width:node.width, height:node.height,title:node.title,logo:node.style.backgroundImage.replace(\"url(\",\"\").replace(\")\",\"\")} : {url:node.getAttribute( \"src\", 2 ),title:node.title, width:node.width, height:node.height,logo:node.getAttribute(\"logo_url\")}, img2frame ? true : false,false );\n//            node.parentNode.replaceChild( tmpdiv.firstChild, node );\n//        }\n//    }\n//\n//    me.addListener( \"beforegetcontent\", function () {\n//        switchImgAndIframe( true );\n//    } );\n//    me.addListener( 'aftersetcontent', function () {\n//        switchImgAndIframe( false );\n//    } );\n//    me.addListener( 'aftergetcontent', function ( cmdName ) {\n//        if ( cmdName == 'aftergetcontent' && me.queryCommandState( 'source' ) ){\n//            return;\n//        }\n//        switchImgAndIframe( false );\n//    } );\n//\n//    me.commands['webapp'] = {\n//        execCommand:function ( cmd, obj ) {\n//            me.execCommand( \"inserthtml\", createInsertStr( obj, false,true ) );\n//        }\n//    };\n//};\nUE.plugin.register('webapp',function(){var me=this;function createInsertStr(obj,toEmbed){return !toEmbed?'<img title=\"' + obj.title + '\" width=\"' + obj.width + '\" height=\"' + obj.height + '\"' + ' src=\"' + me.options.UEDITOR_HOME_URL + 'themes/default/images/spacer.gif\" _logo_url=\"' + obj.logo + '\" style=\"background:url(' + obj.logo + ') no-repeat center center; border:1px solid gray;\" class=\"edui-faked-webapp\" _url=\"' + obj.url + '\" ' + (obj.align && !obj.cssfloat?'align=\"' + obj.align + '\"':'') + (obj.cssfloat?'style=\"float:' + obj.cssfloat + '\"':'') + '/>':'<iframe class=\"edui-faked-webapp\" title=\"' + obj.title + '\" ' + (obj.align && !obj.cssfloat?'align=\"' + obj.align + '\"':'') + (obj.cssfloat?'style=\"float:' + obj.cssfloat + '\"':'') + 'width=\"' + obj.width + '\" height=\"' + obj.height + '\"  scrolling=\"no\" frameborder=\"0\" src=\"' + obj.url + '\" logo_url = \"' + obj.logo + '\"></iframe>';}return {outputRule:function outputRule(root){utils.each(root.getNodesByTagName('img'),function(node){var html;if(node.getAttr('class') == 'edui-faked-webapp'){html = createInsertStr({title:node.getAttr('title'),'width':node.getAttr('width'),'height':node.getAttr('height'),'align':node.getAttr('align'),'cssfloat':node.getStyle('float'),'url':node.getAttr(\"_url\"),'logo':node.getAttr('_logo_url')},true);var embed=UE.uNode.createElement(html);node.parentNode.replaceChild(embed,node);}});},inputRule:function inputRule(root){utils.each(root.getNodesByTagName('iframe'),function(node){if(node.getAttr('class') == 'edui-faked-webapp'){var img=UE.uNode.createElement(createInsertStr({title:node.getAttr('title'),'width':node.getAttr('width'),'height':node.getAttr('height'),'align':node.getAttr('align'),'cssfloat':node.getStyle('float'),'url':node.getAttr(\"src\"),'logo':node.getAttr('logo_url')}));node.parentNode.replaceChild(img,node);}});},commands:{ /**\r\n             * 插入百度应用\r\n             * @command webapp\r\n             * @method execCommand\r\n             * @remind 需要百度APPKey\r\n             * @remind 百度应用主页： <a href=\"http://app.baidu.com/\" target=\"_blank\">http://app.baidu.com/</a>\r\n             * @param { Object } appOptions 应用所需的参数项， 支持的key有： title=>应用标题， width=>应用容器宽度，\r\n             * height=>应用容器高度，logo=>应用logo，url=>应用地址\r\n             * @example\r\n             * ```javascript\r\n             * //editor是编辑器实例\r\n             * //在编辑器里插入一个“植物大战僵尸”的APP\r\n             * editor.execCommand( 'webapp' , {\r\n             *     title: '植物大战僵尸',\r\n             *     width: 560,\r\n             *     height: 465,\r\n             *     logo: '应用展示的图片',\r\n             *     url: '百度应用的地址'\r\n             * } );\r\n             * ```\r\n             */'webapp':{execCommand:function execCommand(cmd,obj){var me=this,str=createInsertStr(utils.extend(obj,{align:'none'}),false);me.execCommand(\"inserthtml\",str);},queryCommandState:function queryCommandState(){var me=this,img=me.selection.getRange().getClosedNode(),flag=img && img.className == \"edui-faked-webapp\";return flag?1:0;}}}};}); // plugins/template.js\n///import core\n///import plugins\\inserthtml.js\n///import plugins\\cleardoc.js\n///commands 模板\n///commandsName  template\n///commandsTitle  模板\n///commandsDialog  dialogs\\template\nUE.plugins['template'] = function(){UE.commands['template'] = {execCommand:function execCommand(cmd,obj){obj.html && this.execCommand(\"inserthtml\",obj.html);}};this.addListener(\"click\",function(type,evt){var el=evt.target || evt.srcElement,range=this.selection.getRange();var tnode=domUtils.findParent(el,function(node){if(node.className && domUtils.hasClass(node,\"ue_t\")){return node;}},true);tnode && range.selectNode(tnode).shrinkBoundary().select();});this.addListener(\"keydown\",function(type,evt){var range=this.selection.getRange();if(!range.collapsed){if(!evt.ctrlKey && !evt.metaKey && !evt.shiftKey && !evt.altKey){var tnode=domUtils.findParent(range.startContainer,function(node){if(node.className && domUtils.hasClass(node,\"ue_t\")){return node;}},true);if(tnode){domUtils.removeClasses(tnode,[\"ue_t\"]);}}}});}; // plugins/music.js\n/**\r\n * 插入音乐命令\r\n * @file\r\n */UE.plugin.register('music',function(){var me=this;function creatInsertStr(url,width,height,align,cssfloat,toEmbed){return !toEmbed?'<img ' + (align && !cssfloat?'align=\"' + align + '\"':'') + (cssfloat?'style=\"float:' + cssfloat + '\"':'') + ' width=\"' + width + '\" height=\"' + height + '\" _url=\"' + url + '\" class=\"edui-faked-music\"' + ' src=\"' + me.options.langPath + me.options.lang + '/images/music.png\" />':'<embed type=\"application/x-shockwave-flash\" class=\"edui-faked-music\" pluginspage=\"http://www.macromedia.com/go/getflashplayer\"' + ' src=\"' + url + '\" width=\"' + width + '\" height=\"' + height + '\" ' + (align && !cssfloat?'align=\"' + align + '\"':'') + (cssfloat?'style=\"float:' + cssfloat + '\"':'') + ' wmode=\"transparent\" play=\"true\" loop=\"false\" menu=\"false\" allowscriptaccess=\"never\" allowfullscreen=\"true\" >';}return {outputRule:function outputRule(root){utils.each(root.getNodesByTagName('img'),function(node){var html;if(node.getAttr('class') == 'edui-faked-music'){var cssfloat=node.getStyle('float');var align=node.getAttr('align');html = creatInsertStr(node.getAttr(\"_url\"),node.getAttr('width'),node.getAttr('height'),align,cssfloat,true);var embed=UE.uNode.createElement(html);node.parentNode.replaceChild(embed,node);}});},inputRule:function inputRule(root){utils.each(root.getNodesByTagName('embed'),function(node){if(node.getAttr('class') == 'edui-faked-music'){var cssfloat=node.getStyle('float');var align=node.getAttr('align');html = creatInsertStr(node.getAttr(\"src\"),node.getAttr('width'),node.getAttr('height'),align,cssfloat,false);var img=UE.uNode.createElement(html);node.parentNode.replaceChild(img,node);}});},commands:{ /**\r\n             * 插入音乐\r\n             * @command music\r\n             * @method execCommand\r\n             * @param { Object } musicOptions 插入音乐的参数项， 支持的key有： url=>音乐地址；\r\n             * width=>音乐容器宽度；height=>音乐容器高度；align=>音乐文件的对齐方式， 可选值有: left, center, right, none\r\n             * @example\r\n             * ```javascript\r\n             * //editor是编辑器实例\r\n             * //在编辑器里插入一个“植物大战僵尸”的APP\r\n             * editor.execCommand( 'music' , {\r\n             *     width: 400,\r\n             *     height: 95,\r\n             *     align: \"center\",\r\n             *     url: \"音乐地址\"\r\n             * } );\r\n             * ```\r\n             */'music':{execCommand:function execCommand(cmd,musicObj){var me=this,str=creatInsertStr(musicObj.url,musicObj.width || 400,musicObj.height || 95,\"none\",false);me.execCommand(\"inserthtml\",str);},queryCommandState:function queryCommandState(){var me=this,img=me.selection.getRange().getClosedNode(),flag=img && img.className == \"edui-faked-music\";return flag?1:0;}}}};}); // plugins/autoupload.js\n/**\r\n * @description\r\n * 1.拖放文件到编辑区域，自动上传并插入到选区\r\n * 2.插入粘贴板的图片，自动上传并插入到选区\r\n * @author Jinqn\r\n * @date 2013-10-14\r\n */UE.plugin.register('autoupload',function(){function sendAndInsertFile(file,editor){var me=editor; //模拟数据\nvar fieldName,urlPrefix,maxSize,allowFiles,actionUrl,loadingHtml,errorHandler,successHandler,filetype=/image\\/\\w+/i.test(file.type)?'image':'file',loadingId='loading_' + (+new Date()).toString(36);fieldName = me.getOpt(filetype + 'FieldName');urlPrefix = me.getOpt(filetype + 'UrlPrefix');maxSize = me.getOpt(filetype + 'MaxSize');allowFiles = me.getOpt(filetype + 'AllowFiles');actionUrl = me.getActionUrl(me.getOpt(filetype + 'ActionName'));errorHandler = function(title){var loader=me.document.getElementById(loadingId);loader && domUtils.remove(loader);me.fireEvent('showmessage',{'id':loadingId,'content':title,'type':'error','timeout':4000});};if(filetype == 'image'){loadingHtml = '<img class=\"loadingclass\" id=\"' + loadingId + '\" src=\"' + me.options.themePath + me.options.theme + '/images/spacer.gif\" title=\"' + (me.getLang('autoupload.loading') || '') + '\" >';successHandler = function(data){var link=urlPrefix + data.url,loader=me.document.getElementById(loadingId);if(loader){loader.setAttribute('src',link);loader.setAttribute('_src',link);loader.setAttribute('title',data.title || '');loader.setAttribute('alt',data.original || '');loader.removeAttribute('id');domUtils.removeClasses(loader,'loadingclass');}};}else {loadingHtml = '<p>' + '<img class=\"loadingclass\" id=\"' + loadingId + '\" src=\"' + me.options.themePath + me.options.theme + '/images/spacer.gif\" title=\"' + (me.getLang('autoupload.loading') || '') + '\" >' + '</p>';successHandler = function(data){var link=urlPrefix + data.url,loader=me.document.getElementById(loadingId);var rng=me.selection.getRange(),bk=rng.createBookmark();rng.selectNode(loader).select();me.execCommand('insertfile',{'url':link});rng.moveToBookmark(bk).select();};} /* 插入loading的占位符 */me.execCommand('inserthtml',loadingHtml); /* 判断后端配置是否没有加载成功 */if(!me.getOpt(filetype + 'ActionName')){errorHandler(me.getLang('autoupload.errorLoadConfig'));return;} /* 判断文件大小是否超出限制 */if(file.size > maxSize){errorHandler(me.getLang('autoupload.exceedSizeError'));return;} /* 判断文件格式是否超出允许 */var fileext=file.name?file.name.substr(file.name.lastIndexOf('.')):'';if(fileext && filetype != 'image' || allowFiles && (allowFiles.join('') + '.').indexOf(fileext.toLowerCase() + '.') == -1){errorHandler(me.getLang('autoupload.exceedTypeError'));return;} /* 创建Ajax并提交 */var xhr=new XMLHttpRequest(),fd=new FormData(),params=utils.serializeParam(me.queryCommandValue('serverparam')) || '',url=utils.formatUrl(actionUrl + (actionUrl.indexOf('?') == -1?'?':'&') + params);fd.append(fieldName,file,file.name || 'blob.' + file.type.substr('image/'.length));fd.append('type','ajax');xhr.open(\"post\",url,true);xhr.setRequestHeader(\"X-Requested-With\",\"XMLHttpRequest\");xhr.addEventListener('load',function(e){try{var json=new Function(\"return \" + utils.trim(e.target.response))();if(json.state == 'SUCCESS' && json.url){successHandler(json);}else {errorHandler(json.state);}}catch(er) {errorHandler(me.getLang('autoupload.loadError'));}});xhr.send(fd);}function getPasteImage(e){return e.clipboardData && e.clipboardData.items && e.clipboardData.items.length == 1 && /^image\\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null;}function getDropImage(e){return e.dataTransfer && e.dataTransfer.files?e.dataTransfer.files:null;}return {outputRule:function outputRule(root){utils.each(root.getNodesByTagName('img'),function(n){if(/\\b(loaderrorclass)|(bloaderrorclass)\\b/.test(n.getAttr('class'))){n.parentNode.removeChild(n);}});utils.each(root.getNodesByTagName('p'),function(n){if(/\\bloadpara\\b/.test(n.getAttr('class'))){n.parentNode.removeChild(n);}});},bindEvents:{ //插入粘贴板的图片，拖放插入图片\n'ready':function ready(e){var me=this;if(window.FormData && window.FileReader){domUtils.on(me.body,'paste drop',function(e){var hasImg=false,items; //获取粘贴板文件列表或者拖放文件列表\nitems = e.type == 'paste'?getPasteImage(e):getDropImage(e);if(items){var len=items.length,file;while(len--) {file = items[len];if(file.getAsFile)file = file.getAsFile();if(file && file.size > 0){sendAndInsertFile(file,me);hasImg = true;}}hasImg && e.preventDefault();}}); //取消拖放图片时出现的文字光标位置提示\ndomUtils.on(me.body,'dragover',function(e){if(e.dataTransfer.types[0] == 'Files'){e.preventDefault();}}); //设置loading的样式\nutils.cssRule('loading','.loadingclass{display:inline-block;cursor:default;background: url(\\'' + this.options.themePath + this.options.theme + '/images/loading.gif\\') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\\n' + '.loaderrorclass{display:inline-block;cursor:default;background: url(\\'' + this.options.themePath + this.options.theme + '/images/loaderror.png\\') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;' + '}',this.document);}}}};}); // plugins/autosave.js\nUE.plugin.register('autosave',function(){var me=this, //无限循环保护\nlastSaveTime=new Date(), //最小保存间隔时间\nMIN_TIME=20, //auto save key\nsaveKey=null;function save(editor){var saveData;if(new Date() - lastSaveTime < MIN_TIME){return;}if(!editor.hasContents()){ //这里不能调用命令来删除， 会造成事件死循环\nsaveKey && me.removePreferences(saveKey);return;}lastSaveTime = new Date();editor._saveFlag = null;saveData = me.body.innerHTML;if(editor.fireEvent(\"beforeautosave\",{content:saveData}) === false){return;}me.setPreferences(saveKey,saveData);editor.fireEvent(\"afterautosave\",{content:saveData});}return {defaultOptions:{ //默认间隔时间\nsaveInterval:500},bindEvents:{'ready':function ready(){var _suffix=\"-drafts-data\",key=null;if(me.key){key = me.key + _suffix;}else {key = (me.container.parentNode.id || 'ue-common') + _suffix;} //页面地址+编辑器ID 保持唯一\nsaveKey = (location.protocol + location.host + location.pathname).replace(/[.:\\/]/g,'_') + key;},'contentchange':function contentchange(){if(!saveKey){return;}if(me._saveFlag){window.clearTimeout(me._saveFlag);}if(me.options.saveInterval > 0){me._saveFlag = window.setTimeout(function(){save(me);},me.options.saveInterval);}else {save(me);}}},commands:{'clearlocaldata':{execCommand:function execCommand(cmd,name){if(saveKey && me.getPreferences(saveKey)){me.removePreferences(saveKey);}},notNeedUndo:true,ignoreContentChange:true},'getlocaldata':{execCommand:function execCommand(cmd,name){return saveKey?me.getPreferences(saveKey) || '':'';},notNeedUndo:true,ignoreContentChange:true},'drafts':{execCommand:function execCommand(cmd,name){if(saveKey){me.body.innerHTML = me.getPreferences(saveKey) || '<p>' + domUtils.fillHtml + '</p>';me.focus(true);}},queryCommandState:function queryCommandState(){return saveKey?me.getPreferences(saveKey) === null?-1:0:-1;},notNeedUndo:true,ignoreContentChange:true}}};}); // plugins/charts.js\nUE.plugin.register('charts',function(){var me=this;return {bindEvents:{'chartserror':function chartserror(){}},commands:{'charts':{execCommand:function execCommand(cmd,data){var tableNode=domUtils.findParentByTagName(this.selection.getRange().startContainer,'table',true),flagText=[],config={};if(!tableNode){return false;}if(!validData(tableNode)){me.fireEvent(\"chartserror\");return false;}config.title = data.title || '';config.subTitle = data.subTitle || '';config.xTitle = data.xTitle || '';config.yTitle = data.yTitle || '';config.suffix = data.suffix || '';config.tip = data.tip || ''; //数据对齐方式\nconfig.dataFormat = data.tableDataFormat || ''; //图表类型\nconfig.chartType = data.chartType || 0;for(var key in config) {if(!config.hasOwnProperty(key)){continue;}flagText.push(key + \":\" + config[key]);}tableNode.setAttribute(\"data-chart\",flagText.join(\";\"));domUtils.addClass(tableNode,\"edui-charts-table\");},queryCommandState:function queryCommandState(cmd,name){var tableNode=domUtils.findParentByTagName(this.selection.getRange().startContainer,'table',true);return tableNode && validData(tableNode)?0:-1;}}},inputRule:function inputRule(root){utils.each(root.getNodesByTagName('table'),function(tableNode){if(tableNode.getAttr(\"data-chart\") !== undefined){tableNode.setAttr(\"style\");}});},outputRule:function outputRule(root){utils.each(root.getNodesByTagName('table'),function(tableNode){if(tableNode.getAttr(\"data-chart\") !== undefined){tableNode.setAttr(\"style\",\"display: none;\");}});}};function validData(table){var firstRows=null,cellCount=0; //行数不够\nif(table.rows.length < 2){return false;} //列数不够\nif(table.rows[0].cells.length < 2){return false;} //第一行所有cell必须是th\nfirstRows = table.rows[0].cells;cellCount = firstRows.length;for(var i=0,cell;cell = firstRows[i];i++) {if(cell.tagName.toLowerCase() !== 'th'){return false;}}for(var i=1,row;row = table.rows[i];i++) { //每行单元格数不匹配， 返回false\nif(row.cells.length != cellCount){return false;} //第一列不是th也返回false\nif(row.cells[0].tagName.toLowerCase() !== 'th'){return false;}for(var j=1,cell;cell = row.cells[j];j++) {var value=utils.trim(cell.innerText || cell.textContent || '');value = value.replace(new RegExp(UE.dom.domUtils.fillChar,'g'),'').replace(/^\\s+|\\s+$/g,''); //必须是数字\nif(!/^\\d*\\.?\\d+$/.test(value)){return false;}}}return true;}}); // plugins/section.js\n/**\r\n * 目录大纲支持插件\r\n * @file\r\n * @since 1.3.0\r\n */UE.plugin.register('section',function(){ /* 目录节点对象 */function Section(option){this.tag = '';this.level = -1,this.dom = null;this.nextSection = null;this.previousSection = null;this.parentSection = null;this.startAddress = [];this.endAddress = [];this.children = [];}function getSection(option){var section=new Section();return utils.extend(section,option);}function getNodeFromAddress(startAddress,root){var current=root;for(var i=0;i < startAddress.length;i++) {if(!current.childNodes)return null;current = current.childNodes[startAddress[i]];}return current;}var me=this;return {bindMultiEvents:{type:'aftersetcontent afterscencerestore',handler:function handler(){me.fireEvent('updateSections');}},bindEvents:{ /* 初始化、拖拽、粘贴、执行setcontent之后 */'ready':function ready(){me.fireEvent('updateSections');domUtils.on(me.body,'drop paste',function(){me.fireEvent('updateSections');});}, /* 执行paragraph命令之后 */'afterexeccommand':function afterexeccommand(type,cmd){if(cmd == 'paragraph'){me.fireEvent('updateSections');}}, /* 部分键盘操作，触发updateSections事件 */'keyup':function keyup(type,e){var me=this,range=me.selection.getRange();if(range.collapsed != true){me.fireEvent('updateSections');}else {var keyCode=e.keyCode || e.which;if(keyCode == 13 || keyCode == 8 || keyCode == 46){me.fireEvent('updateSections');}}}},commands:{'getsections':{execCommand:function execCommand(cmd,levels){var levelFn=levels || ['h1','h2','h3','h4','h5','h6'];for(var i=0;i < levelFn.length;i++) {if(typeof levelFn[i] == 'string'){levelFn[i] = (function(fn){return function(node){return node.tagName == fn.toUpperCase();};})(levelFn[i]);}else if(typeof levelFn[i] != 'function'){levelFn[i] = function(node){return null;};}}function getSectionLevel(node){for(var i=0;i < levelFn.length;i++) {if(levelFn[i](node))return i;}return -1;}var me=this,Directory=getSection({'level':-1,'title':'root'}),previous=Directory;function traversal(node,Directory){var level,tmpSection=null,parent,child,children=node.childNodes;for(var i=0,len=children.length;i < len;i++) {child = children[i];level = getSectionLevel(child);if(level >= 0){var address=me.selection.getRange().selectNode(child).createAddress(true).startAddress,current=getSection({'tag':child.tagName,'title':child.innerText || child.textContent || '','level':level,'dom':child,'startAddress':utils.clone(address,[]),'endAddress':utils.clone(address,[]),'children':[]});previous.nextSection = current;current.previousSection = previous;parent = previous;while(level <= parent.level) {parent = parent.parentSection;}current.parentSection = parent;parent.children.push(current);tmpSection = previous = current;}else {child.nodeType === 1 && traversal(child,Directory);tmpSection && tmpSection.endAddress[tmpSection.endAddress.length - 1]++;}}}traversal(me.body,Directory);return Directory;},notNeedUndo:true},'movesection':{execCommand:function execCommand(cmd,sourceSection,targetSection,isAfter){var me=this,targetAddress,target;if(!sourceSection || !targetSection || targetSection.level == -1)return;targetAddress = isAfter?targetSection.endAddress:targetSection.startAddress;target = getNodeFromAddress(targetAddress,me.body); /* 判断目标地址是否被源章节包含 */if(!targetAddress || !target || isContainsAddress(sourceSection.startAddress,sourceSection.endAddress,targetAddress))return;var startNode=getNodeFromAddress(sourceSection.startAddress,me.body),endNode=getNodeFromAddress(sourceSection.endAddress,me.body),current,nextNode;if(isAfter){current = endNode;while(current && !(domUtils.getPosition(startNode,current) & domUtils.POSITION_FOLLOWING)) {nextNode = current.previousSibling;domUtils.insertAfter(target,current);if(current == startNode)break;current = nextNode;}}else {current = startNode;while(current && !(domUtils.getPosition(current,endNode) & domUtils.POSITION_FOLLOWING)) {nextNode = current.nextSibling;target.parentNode.insertBefore(current,target);if(current == endNode)break;current = nextNode;}}me.fireEvent('updateSections'); /* 获取地址的包含关系 */function isContainsAddress(startAddress,endAddress,addressTarget){var isAfterStartAddress=false,isBeforeEndAddress=false;for(var i=0;i < startAddress.length;i++) {if(i >= addressTarget.length)break;if(addressTarget[i] > startAddress[i]){isAfterStartAddress = true;break;}else if(addressTarget[i] < startAddress[i]){break;}}for(var i=0;i < endAddress.length;i++) {if(i >= addressTarget.length)break;if(addressTarget[i] < startAddress[i]){isBeforeEndAddress = true;break;}else if(addressTarget[i] > startAddress[i]){break;}}return isAfterStartAddress && isBeforeEndAddress;}}},'deletesection':{execCommand:function execCommand(cmd,section,keepChildren){var me=this;if(!section)return;function getNodeFromAddress(startAddress){var current=me.body;for(var i=0;i < startAddress.length;i++) {if(!current.childNodes)return null;current = current.childNodes[startAddress[i]];}return current;}var startNode=getNodeFromAddress(section.startAddress),endNode=getNodeFromAddress(section.endAddress),current=startNode,nextNode;if(!keepChildren){while(current && domUtils.inDoc(endNode,me.document) && !(domUtils.getPosition(current,endNode) & domUtils.POSITION_FOLLOWING)) {nextNode = current.nextSibling;domUtils.remove(current);current = nextNode;}}else {domUtils.remove(current);}me.fireEvent('updateSections');}},'selectsection':{execCommand:function execCommand(cmd,section){if(!section && !section.dom)return false;var me=this,range=me.selection.getRange(),address={'startAddress':utils.clone(section.startAddress,[]),'endAddress':utils.clone(section.endAddress,[])};address.endAddress[address.endAddress.length - 1]++;range.moveToAddress(address).select().scrollToView();return true;},notNeedUndo:true},'scrolltosection':{execCommand:function execCommand(cmd,section){if(!section && !section.dom)return false;var me=this,range=me.selection.getRange(),address={'startAddress':section.startAddress,'endAddress':section.endAddress};address.endAddress[address.endAddress.length - 1]++;range.moveToAddress(address).scrollToView();return true;},notNeedUndo:true}}};}); // plugins/simpleupload.js\n/**\r\n * @description\r\n * 简单上传:点击按钮,直接选择文件上传\r\n * @author Jinqn\r\n * @date 2014-03-31\r\n */UE.plugin.register('simpleupload',function(){var me=this,isLoaded=false,containerBtn;function initUploadBtn(){var w=containerBtn.offsetWidth || 20,h=containerBtn.offsetHeight || 20,btnIframe=document.createElement('iframe'),btnStyle='display:block;width:' + w + 'px;height:' + h + 'px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;';domUtils.on(btnIframe,'load',function(){var timestrap=(+new Date()).toString(36),wrapper,btnIframeDoc,btnIframeBody;btnIframeDoc = btnIframe.contentDocument || btnIframe.contentWindow.document;btnIframeBody = btnIframeDoc.body;wrapper = btnIframeDoc.createElement('div');wrapper.innerHTML = '<form id=\"edui_form_' + timestrap + '\" target=\"edui_iframe_' + timestrap + '\" method=\"POST\" enctype=\"multipart/form-data\" action=\"' + me.getOpt('serverUrl') + '\" ' + 'style=\"' + btnStyle + '\">' + '<input id=\"edui_input_' + timestrap + '\" type=\"file\" accept=\"image/*\" name=\"' + me.options.imageFieldName + '\" ' + 'style=\"' + btnStyle + '\">' + '</form>' + '<iframe id=\"edui_iframe_' + timestrap + '\" name=\"edui_iframe_' + timestrap + '\" style=\"display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;\"></iframe>';wrapper.className = 'edui-' + me.options.theme;wrapper.id = me.ui.id + '_iframeupload';btnIframeBody.style.cssText = btnStyle;btnIframeBody.style.width = w + 'px';btnIframeBody.style.height = h + 'px';btnIframeBody.appendChild(wrapper);if(btnIframeBody.parentNode){btnIframeBody.parentNode.style.width = w + 'px';btnIframeBody.parentNode.style.height = w + 'px';}var form=btnIframeDoc.getElementById('edui_form_' + timestrap);var input=btnIframeDoc.getElementById('edui_input_' + timestrap);var iframe=btnIframeDoc.getElementById('edui_iframe_' + timestrap);domUtils.on(input,'change',function(){if(!input.value)return;var loadingId='loading_' + (+new Date()).toString(36);var params=utils.serializeParam(me.queryCommandValue('serverparam')) || '';var imageActionUrl=me.getActionUrl(me.getOpt('imageActionName'));var allowFiles=me.getOpt('imageAllowFiles');me.focus();me.execCommand('inserthtml','<img class=\"loadingclass\" id=\"' + loadingId + '\" src=\"' + me.options.themePath + me.options.theme + '/images/spacer.gif\" title=\"' + (me.getLang('simpleupload.loading') || '') + '\" >');function callback(){try{var link,json,loader,body=(iframe.contentDocument || iframe.contentWindow.document).body,result=body.innerText || body.textContent || '';json = new Function(\"return \" + result)();link = me.options.imageUrlPrefix + json.url;if(json.state == 'SUCCESS' && json.url){loader = me.document.getElementById(loadingId);loader.setAttribute('src',link);loader.setAttribute('_src',link);loader.setAttribute('title',json.title || '');loader.setAttribute('alt',json.original || '');loader.removeAttribute('id');domUtils.removeClasses(loader,'loadingclass');}else {showErrorLoader && showErrorLoader(json.state);}}catch(er) {showErrorLoader && showErrorLoader(me.getLang('simpleupload.loadError'));}form.reset();domUtils.un(iframe,'load',callback);}function showErrorLoader(title){if(loadingId){var loader=me.document.getElementById(loadingId);loader && domUtils.remove(loader);me.fireEvent('showmessage',{'id':loadingId,'content':title,'type':'error','timeout':4000});}} /* 判断后端配置是否没有加载成功 */if(!me.getOpt('imageActionName')){errorHandler(me.getLang('autoupload.errorLoadConfig'));return;} // 判断文件格式是否错误\nvar filename=input.value,fileext=filename?filename.substr(filename.lastIndexOf('.')):'';if(!fileext || allowFiles && (allowFiles.join('') + '.').indexOf(fileext.toLowerCase() + '.') == -1){showErrorLoader(me.getLang('simpleupload.exceedTypeError'));return;}domUtils.on(iframe,'load',callback);form.action = utils.formatUrl(imageActionUrl + (imageActionUrl.indexOf('?') == -1?'?':'&') + params);form.submit();});var stateTimer;me.addListener('selectionchange',function(){clearTimeout(stateTimer);stateTimer = setTimeout(function(){var state=me.queryCommandState('simpleupload');if(state == -1){input.disabled = 'disabled';}else {input.disabled = false;}},400);});isLoaded = true;});btnIframe.style.cssText = btnStyle;containerBtn.appendChild(btnIframe);}return {bindEvents:{'ready':function ready(){ //设置loading的样式\nutils.cssRule('loading','.loadingclass{display:inline-block;cursor:default;background: url(\\'' + this.options.themePath + this.options.theme + '/images/loading.gif\\') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\\n' + '.loaderrorclass{display:inline-block;cursor:default;background: url(\\'' + this.options.themePath + this.options.theme + '/images/loaderror.png\\') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;' + '}',this.document);}, /* 初始化简单上传按钮 */'simpleuploadbtnready':function simpleuploadbtnready(type,container){containerBtn = container;me.afterConfigReady(initUploadBtn);}},outputRule:function outputRule(root){utils.each(root.getNodesByTagName('img'),function(n){if(/\\b(loaderrorclass)|(bloaderrorclass)\\b/.test(n.getAttr('class'))){n.parentNode.removeChild(n);}});},commands:{'simpleupload':{queryCommandState:function queryCommandState(){return isLoaded?0:-1;}}}};}); // plugins/serverparam.js\n/**\r\n * 服务器提交的额外参数列表设置插件\r\n * @file\r\n * @since 1.2.6.1\r\n */UE.plugin.register('serverparam',function(){var me=this,serverParam={};return {commands:{ /**\r\n             * 修改服务器提交的额外参数列表,清除所有项\r\n             * @command serverparam\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand('serverparam');\r\n             * editor.queryCommandValue('serverparam'); //返回空\r\n             * ```\r\n             */ /**\r\n             * 修改服务器提交的额外参数列表,删除指定项\r\n             * @command serverparam\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @param { String } key 要清除的属性\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand('serverparam', 'name'); //删除属性name\r\n             * ```\r\n             */ /**\r\n             * 修改服务器提交的额外参数列表,使用键值添加项\r\n             * @command serverparam\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @param { String } key 要添加的属性\r\n             * @param { String } value 要添加属性的值\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand('serverparam', 'name', 'hello');\r\n             * editor.queryCommandValue('serverparam'); //返回对象 {'name': 'hello'}\r\n             * ```\r\n             */ /**\r\n             * 修改服务器提交的额外参数列表,传入键值对对象添加多项\r\n             * @command serverparam\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @param { Object } key 传入的键值对对象\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand('serverparam', {'name': 'hello'});\r\n             * editor.queryCommandValue('serverparam'); //返回对象 {'name': 'hello'}\r\n             * ```\r\n             */ /**\r\n             * 修改服务器提交的额外参数列表,使用自定义函数添加多项\r\n             * @command serverparam\r\n             * @method execCommand\r\n             * @param { String } cmd 命令字符串\r\n             * @param { Function } key 自定义获取参数的函数\r\n             * @example\r\n             * ```javascript\r\n             * editor.execCommand('serverparam', function(editor){\r\n             *     return {'key': 'value'};\r\n             * });\r\n             * editor.queryCommandValue('serverparam'); //返回对象 {'key': 'value'}\r\n             * ```\r\n             */ /**\r\n             * 获取服务器提交的额外参数列表\r\n             * @command serverparam\r\n             * @method queryCommandValue\r\n             * @param { String } cmd 命令字符串\r\n             * @example\r\n             * ```javascript\r\n             * editor.queryCommandValue( 'serverparam' ); //返回对象 {'key': 'value'}\r\n             * ```\r\n             */'serverparam':{execCommand:function execCommand(cmd,key,value){if(key === undefined || key === null){ //不传参数,清空列表\nserverParam = {};}else if(utils.isString(key)){ //传入键值\nif(value === undefined || value === null){delete serverParam[key];}else {serverParam[key] = value;}}else if(utils.isObject(key)){ //传入对象,覆盖列表项\nutils.extend(serverParam,key,true);}else if(utils.isFunction(key)){ //传入函数,添加列表项\nutils.extend(serverParam,key(),true);}},queryCommandValue:function queryCommandValue(){return serverParam || {};}}}};}); // plugins/insertfile.js\n/**\r\n * 插入附件\r\n */UE.plugin.register('insertfile',function(){var me=this;function getFileIcon(url){var ext=url.substr(url.lastIndexOf('.') + 1).toLowerCase(),maps={\"rar\":\"icon_rar.gif\",\"zip\":\"icon_rar.gif\",\"tar\":\"icon_rar.gif\",\"gz\":\"icon_rar.gif\",\"bz2\":\"icon_rar.gif\",\"doc\":\"icon_doc.gif\",\"docx\":\"icon_doc.gif\",\"pdf\":\"icon_pdf.gif\",\"mp3\":\"icon_mp3.gif\",\"xls\":\"icon_xls.gif\",\"chm\":\"icon_chm.gif\",\"ppt\":\"icon_ppt.gif\",\"pptx\":\"icon_ppt.gif\",\"avi\":\"icon_mv.gif\",\"rmvb\":\"icon_mv.gif\",\"wmv\":\"icon_mv.gif\",\"flv\":\"icon_mv.gif\",\"swf\":\"icon_mv.gif\",\"rm\":\"icon_mv.gif\",\"exe\":\"icon_exe.gif\",\"psd\":\"icon_psd.gif\",\"txt\":\"icon_txt.gif\",\"jpg\":\"icon_jpg.gif\",\"png\":\"icon_jpg.gif\",\"jpeg\":\"icon_jpg.gif\",\"gif\":\"icon_jpg.gif\",\"ico\":\"icon_jpg.gif\",\"bmp\":\"icon_jpg.gif\"};return maps[ext]?maps[ext]:maps['txt'];}return {commands:{'insertfile':{execCommand:function execCommand(command,filelist){filelist = utils.isArray(filelist)?filelist:[filelist];var i,item,icon,title,html='',URL=me.getOpt('UEDITOR_HOME_URL'),iconDir=URL + (URL.substr(URL.length - 1) == '/'?'':'/') + 'dialogs/attachment/fileTypeImages/';for(i = 0;i < filelist.length;i++) {item = filelist[i];icon = iconDir + getFileIcon(item.url);title = item.title || item.url.substr(item.url.lastIndexOf('/') + 1);html += '<p style=\"line-height: 16px;\">' + '<img style=\"vertical-align: middle; margin-right: 2px;\" src=\"' + icon + '\" _src=\"' + icon + '\" />' + '<a style=\"font-size:12px; color:#0066cc;\" href=\"' + item.url + '\" title=\"' + title + '\">' + title + '</a>' + '</p>';}me.execCommand('insertHtml',html);}}}};}); // ui/ui.js\nvar baidu=baidu || {};baidu.editor = baidu.editor || {};UE.ui = baidu.editor.ui = {}; // ui/uiutils.js\n(function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils;var magic='$EDITORUI';var root=window[magic] = {};var uidMagic='ID' + magic;var uidCount=0;var uiUtils=baidu.editor.ui.uiUtils = {uid:function uid(obj){return obj?obj[uidMagic] || (obj[uidMagic] = ++uidCount):++uidCount;},hook:function hook(fn,callback){var dg;if(fn && fn._callbacks){dg = fn;}else {dg = function(){var q;if(fn){q = fn.apply(this,arguments);}var callbacks=dg._callbacks;var k=callbacks.length;while(k--) {var r=callbacks[k].apply(this,arguments);if(q === undefined){q = r;}}return q;};dg._callbacks = [];}dg._callbacks.push(callback);return dg;},createElementByHtml:function createElementByHtml(html){var el=document.createElement('div');el.innerHTML = html;el = el.firstChild;el.parentNode.removeChild(el);return el;},getViewportElement:function getViewportElement(){return browser.ie && browser.quirks?document.body:document.documentElement;},getClientRect:function getClientRect(element){var bcr; //trace  IE6下在控制编辑器显隐时可能会报错，catch一下\ntry{bcr = element.getBoundingClientRect();}catch(e) {bcr = {left:0,top:0,height:0,width:0};}var rect={left:Math.round(bcr.left),top:Math.round(bcr.top),height:Math.round(bcr.bottom - bcr.top),width:Math.round(bcr.right - bcr.left)};var doc;while((doc = element.ownerDocument) !== document && (element = domUtils.getWindow(doc).frameElement)) {bcr = element.getBoundingClientRect();rect.left += bcr.left;rect.top += bcr.top;}rect.bottom = rect.top + rect.height;rect.right = rect.left + rect.width;return rect;},getViewportRect:function getViewportRect(){var viewportEl=uiUtils.getViewportElement();var width=(window.innerWidth || viewportEl.clientWidth) | 0;var height=(window.innerHeight || viewportEl.clientHeight) | 0;return {left:0,top:0,height:height,width:width,bottom:height,right:width};},setViewportOffset:function setViewportOffset(element,offset){var rect;var fixedLayer=uiUtils.getFixedLayer();if(element.parentNode === fixedLayer){element.style.left = offset.left + 'px';element.style.top = offset.top + 'px';}else {domUtils.setViewportOffset(element,offset);}},getEventOffset:function getEventOffset(evt){var el=evt.target || evt.srcElement;var rect=uiUtils.getClientRect(el);var offset=uiUtils.getViewportOffsetByEvent(evt);return {left:offset.left - rect.left,top:offset.top - rect.top};},getViewportOffsetByEvent:function getViewportOffsetByEvent(evt){var el=evt.target || evt.srcElement;var frameEl=domUtils.getWindow(el).frameElement;var offset={left:evt.clientX,top:evt.clientY};if(frameEl && el.ownerDocument !== document){var rect=uiUtils.getClientRect(frameEl);offset.left += rect.left;offset.top += rect.top;}return offset;},setGlobal:function setGlobal(id,obj){root[id] = obj;return magic + '[\"' + id + '\"]';},unsetGlobal:function unsetGlobal(id){delete root[id];},copyAttributes:function copyAttributes(tgt,src){var attributes=src.attributes;var k=attributes.length;while(k--) {var attrNode=attributes[k];if(attrNode.nodeName != 'style' && attrNode.nodeName != 'class' && (!browser.ie || attrNode.specified)){tgt.setAttribute(attrNode.nodeName,attrNode.nodeValue);}}if(src.className){domUtils.addClass(tgt,src.className);}if(src.style.cssText){tgt.style.cssText += ';' + src.style.cssText;}},removeStyle:function removeStyle(el,styleName){if(el.style.removeProperty){el.style.removeProperty(styleName);}else if(el.style.removeAttribute){el.style.removeAttribute(styleName);}else throw '';},contains:function contains(elA,elB){return elA && elB && (elA === elB?false:elA.contains?elA.contains(elB):elA.compareDocumentPosition(elB) & 16);},startDrag:function startDrag(evt,callbacks,doc){var doc=doc || document;var startX=evt.clientX;var startY=evt.clientY;function handleMouseMove(evt){var x=evt.clientX - startX;var y=evt.clientY - startY;callbacks.ondragmove(x,y,evt);if(evt.stopPropagation){evt.stopPropagation();}else {evt.cancelBubble = true;}}if(doc.addEventListener){(function(){var handleMouseUp=function handleMouseUp(evt){doc.removeEventListener('mousemove',handleMouseMove,true);doc.removeEventListener('mouseup',handleMouseUp,true);window.removeEventListener('mouseup',handleMouseUp,true);callbacks.ondragstop();};doc.addEventListener('mousemove',handleMouseMove,true);doc.addEventListener('mouseup',handleMouseUp,true);window.addEventListener('mouseup',handleMouseUp,true);evt.preventDefault();})();}else {var elm;(function(){var releaseCaptrue=function releaseCaptrue(){elm.releaseCapture();elm.detachEvent('onmousemove',handleMouseMove);elm.detachEvent('onmouseup',releaseCaptrue);elm.detachEvent('onlosecaptrue',releaseCaptrue);callbacks.ondragstop();};elm = evt.srcElement;elm.setCapture();elm.attachEvent('onmousemove',handleMouseMove);elm.attachEvent('onmouseup',releaseCaptrue);elm.attachEvent('onlosecaptrue',releaseCaptrue);evt.returnValue = false;})();}callbacks.ondragstart();},getFixedLayer:function getFixedLayer(){var layer=document.getElementById('edui_fixedlayer');if(layer == null){layer = document.createElement('div');layer.id = 'edui_fixedlayer';document.body.appendChild(layer);if(browser.ie && browser.version <= 8){layer.style.position = 'absolute';bindFixedLayer();setTimeout(updateFixedOffset);}else {layer.style.position = 'fixed';}layer.style.left = '0';layer.style.top = '0';layer.style.width = '0';layer.style.height = '0';}return layer;},makeUnselectable:function makeUnselectable(element){if(browser.opera || browser.ie && browser.version < 9){element.unselectable = 'on';if(element.hasChildNodes()){for(var i=0;i < element.childNodes.length;i++) {if(element.childNodes[i].nodeType == 1){uiUtils.makeUnselectable(element.childNodes[i]);}}}}else {if(element.style.MozUserSelect !== undefined){element.style.MozUserSelect = 'none';}else if(element.style.WebkitUserSelect !== undefined){element.style.WebkitUserSelect = 'none';}else if(element.style.KhtmlUserSelect !== undefined){element.style.KhtmlUserSelect = 'none';}}}};function updateFixedOffset(){var layer=document.getElementById('edui_fixedlayer');uiUtils.setViewportOffset(layer,{left:0,top:0}); //        layer.style.display = 'none';\n//        layer.style.display = 'block';\n//#trace: 1354\n//        setTimeout(updateFixedOffset);\n}function bindFixedLayer(adjOffset){domUtils.on(window,'scroll',updateFixedOffset);domUtils.on(window,'resize',baidu.editor.utils.defer(updateFixedOffset,0,true));}})(); // ui/uibase.js\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,EventBase=baidu.editor.EventBase,UIBase=baidu.editor.ui.UIBase = function(){};UIBase.prototype = {className:'',uiName:'',initOptions:function initOptions(options){var me=this;for(var k in options) {me[k] = options[k];}this.id = this.id || 'edui' + uiUtils.uid();},initUIBase:function initUIBase(){this._globalKey = utils.unhtml(uiUtils.setGlobal(this.id,this));},render:function render(holder){var html=this.renderHtml();var el=uiUtils.createElementByHtml(html); //by xuheng 给每个node添加class\nvar list=domUtils.getElementsByTagName(el,\"*\");var theme=\"edui-\" + (this.theme || this.editor.options.theme);var layer=document.getElementById('edui_fixedlayer');for(var i=0,node;node = list[i++];) {domUtils.addClass(node,theme);}domUtils.addClass(el,theme);if(layer){layer.className = \"\";domUtils.addClass(layer,theme);}var seatEl=this.getDom();if(seatEl != null){seatEl.parentNode.replaceChild(el,seatEl);uiUtils.copyAttributes(el,seatEl);}else {if(typeof holder == 'string'){holder = document.getElementById(holder);}holder = holder || uiUtils.getFixedLayer();domUtils.addClass(holder,theme);holder.appendChild(el);}this.postRender();},getDom:function getDom(name){if(!name){return document.getElementById(this.id);}else {return document.getElementById(this.id + '_' + name);}},postRender:function postRender(){this.fireEvent('postrender');},getHtmlTpl:function getHtmlTpl(){return '';},formatHtml:function formatHtml(tpl){var prefix='edui-' + this.uiName;return tpl.replace(/##/g,this.id).replace(/%%-/g,this.uiName?prefix + '-':'').replace(/%%/g,(this.uiName?prefix:'') + ' ' + this.className).replace(/\\$\\$/g,this._globalKey);},renderHtml:function renderHtml(){return this.formatHtml(this.getHtmlTpl());},dispose:function dispose(){var box=this.getDom();if(box)baidu.editor.dom.domUtils.remove(box);uiUtils.unsetGlobal(this.id);}};utils.inherits(UIBase,EventBase);})(); // ui/separator.js\n(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Separator=baidu.editor.ui.Separator = function(options){this.initOptions(options);this.initSeparator();};Separator.prototype = {uiName:'separator',initSeparator:function initSeparator(){this.initUIBase();},getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"edui-box %%\"></div>';}};utils.inherits(Separator,UIBase);})(); // ui/mask.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,uiUtils=baidu.editor.ui.uiUtils;var Mask=baidu.editor.ui.Mask = function(options){this.initOptions(options);this.initUIBase();};Mask.prototype = {getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"edui-mask %%\" onclick=\"return $$._onClick(event, this);\" onmousedown=\"return $$._onMouseDown(event, this);\"></div>';},postRender:function postRender(){var me=this;domUtils.on(window,'resize',function(){setTimeout(function(){if(!me.isHidden()){me._fill();}});});},show:function show(zIndex){this._fill();this.getDom().style.display = '';this.getDom().style.zIndex = zIndex;},hide:function hide(){this.getDom().style.display = 'none';this.getDom().style.zIndex = '';},isHidden:function isHidden(){return this.getDom().style.display == 'none';},_onMouseDown:function _onMouseDown(){return false;},_onClick:function _onClick(e,target){this.fireEvent('click',e,target);},_fill:function _fill(){var el=this.getDom();var vpRect=uiUtils.getViewportRect();el.style.width = vpRect.width + 'px';el.style.height = vpRect.height + 'px';}};utils.inherits(Mask,UIBase);})(); // ui/popup.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup = function(options){this.initOptions(options);this.initPopup();};var allPopups=[];function closeAllPopup(evt,el){for(var i=0;i < allPopups.length;i++) {var pop=allPopups[i];if(!pop.isHidden()){if(pop.queryAutoHide(el) !== false){if(evt && /scroll/ig.test(evt.type) && pop.className == \"edui-wordpastepop\")return;pop.hide();}}}if(allPopups.length)pop.editor.fireEvent(\"afterhidepop\");}Popup.postHide = closeAllPopup;var ANCHOR_CLASSES=['edui-anchor-topleft','edui-anchor-topright','edui-anchor-bottomleft','edui-anchor-bottomright'];Popup.prototype = {SHADOW_RADIUS:5,content:null,_hidden:false,autoRender:true,canSideLeft:true,canSideUp:true,initPopup:function initPopup(){this.initUIBase();allPopups.push(this);},getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"edui-popup %%\" onmousedown=\"return false;\">' + ' <div id=\"##_body\" class=\"edui-popup-body\">' + ' <iframe style=\"position:absolute;z-index:-1;left:0;top:0;background-color: transparent;\" frameborder=\"0\" width=\"100%\" height=\"100%\" src=\"about:blank\"></iframe>' + ' <div class=\"edui-shadow\"></div>' + ' <div id=\"##_content\" class=\"edui-popup-content\">' + this.getContentHtmlTpl() + '  </div>' + ' </div>' + '</div>';},getContentHtmlTpl:function getContentHtmlTpl(){if(this.content){if(typeof this.content == 'string'){return this.content;}return this.content.renderHtml();}else {return '';}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function postRender(){if(this.content instanceof UIBase){this.content.postRender();} //捕获鼠标滚轮\nif(this.captureWheel && !this.captured){this.captured = true;var winHeight=(document.documentElement.clientHeight || document.body.clientHeight) - 80,_height=this.getDom().offsetHeight,_top=uiUtils.getClientRect(this.combox.getDom()).top,content=this.getDom('content'),ifr=this.getDom('body').getElementsByTagName('iframe'),me=this;ifr.length && (ifr = ifr[0]);while(_top + _height > winHeight) {_height -= 30;}content.style.height = _height + 'px'; //同步更改iframe高度\nifr && (ifr.style.height = _height + 'px'); //阻止在combox上的鼠标滚轮事件, 防止用户的正常操作被误解\nif(window.XMLHttpRequest){domUtils.on(content,'onmousewheel' in document.body?'mousewheel':'DOMMouseScroll',function(e){if(e.preventDefault){e.preventDefault();}else {e.returnValue = false;}if(e.wheelDelta){content.scrollTop -= e.wheelDelta / 120 * 60;}else {content.scrollTop -= e.detail / -3 * 60;}});}else { //ie6\ndomUtils.on(this.getDom(),'mousewheel',function(e){e.returnValue = false;me.getDom('content').scrollTop -= e.wheelDelta / 120 * 60;});}}this.fireEvent('postRenderAfter');this.hide(true);this._UIBase_postRender();},_doAutoRender:function _doAutoRender(){if(!this.getDom() && this.autoRender){this.render();}},mesureSize:function mesureSize(){var box=this.getDom('content');return uiUtils.getClientRect(box);},fitSize:function fitSize(){if(this.captureWheel && this.sized){return this.__size;}this.sized = true;var popBodyEl=this.getDom('body');popBodyEl.style.width = '';popBodyEl.style.height = '';var size=this.mesureSize();if(this.captureWheel){popBodyEl.style.width = -(-20 - size.width) + 'px';var height=parseInt(this.getDom('content').style.height,10);!window.isNaN(height) && (size.height = height);}else {popBodyEl.style.width = size.width + 'px';}popBodyEl.style.height = size.height + 'px';this.__size = size;this.captureWheel && (this.getDom('content').style.overflow = 'auto');return size;},showAnchor:function showAnchor(element,hoz){this.showAnchorRect(uiUtils.getClientRect(element),hoz);},showAnchorRect:function showAnchorRect(rect,hoz,adj){this._doAutoRender();var vpRect=uiUtils.getViewportRect();this.getDom().style.visibility = 'hidden';this._show();var popSize=this.fitSize();var sideLeft,sideUp,left,top;if(hoz){sideLeft = this.canSideLeft && rect.right + popSize.width > vpRect.right && rect.left > popSize.width;sideUp = this.canSideUp && rect.top + popSize.height > vpRect.bottom && rect.bottom > popSize.height;left = sideLeft?rect.left - popSize.width:rect.right;top = sideUp?rect.bottom - popSize.height:rect.top;}else {sideLeft = this.canSideLeft && rect.right + popSize.width > vpRect.right && rect.left > popSize.width;sideUp = this.canSideUp && rect.top + popSize.height > vpRect.bottom && rect.bottom > popSize.height;left = sideLeft?rect.right - popSize.width:rect.left;top = sideUp?rect.top - popSize.height:rect.bottom;}var popEl=this.getDom();uiUtils.setViewportOffset(popEl,{left:left,top:top});domUtils.removeClasses(popEl,ANCHOR_CLASSES);popEl.className += ' ' + ANCHOR_CLASSES[(sideUp?1:0) * 2 + (sideLeft?1:0)];if(this.editor){popEl.style.zIndex = this.editor.container.style.zIndex * 1 + 10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex = popEl.style.zIndex - 1;}this.getDom().style.visibility = 'visible';},showAt:function showAt(offset){var left=offset.left;var top=offset.top;var rect={left:left,top:top,right:left,bottom:top,height:0,width:0};this.showAnchorRect(rect,false,true);},_show:function _show(){if(this._hidden){var box=this.getDom();box.style.display = '';this._hidden = false; //                if (box.setActive) {\n//                    box.setActive();\n//                }\nthis.fireEvent('show');}},isHidden:function isHidden(){return this._hidden;},show:function show(){this._doAutoRender();this._show();},hide:function hide(notNofity){if(!this._hidden && this.getDom()){this.getDom().style.display = 'none';this._hidden = true;if(!notNofity){this.fireEvent('hide');}}},queryAutoHide:function queryAutoHide(el){return !el || !uiUtils.contains(this.getDom(),el);}};utils.inherits(Popup,UIBase);domUtils.on(document,'mousedown',function(evt){var el=evt.target || evt.srcElement;closeAllPopup(evt,el);});domUtils.on(window,'scroll',function(evt,el){closeAllPopup(evt,el);});})(); // ui/colorpicker.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,ColorPicker=baidu.editor.ui.ColorPicker = function(options){this.initOptions(options);this.noColorText = this.noColorText || this.editor.getLang(\"clearColor\");this.initUIBase();};ColorPicker.prototype = {getHtmlTpl:function getHtmlTpl(){return genColorPicker(this.noColorText,this.editor);},_onTableClick:function _onTableClick(evt){var tgt=evt.target || evt.srcElement;var color=tgt.getAttribute('data-color');if(color){this.fireEvent('pickcolor',color);}},_onTableOver:function _onTableOver(evt){var tgt=evt.target || evt.srcElement;var color=tgt.getAttribute('data-color');if(color){this.getDom('preview').style.backgroundColor = color;}},_onTableOut:function _onTableOut(){this.getDom('preview').style.backgroundColor = '';},_onPickNoColor:function _onPickNoColor(){this.fireEvent('picknocolor');}};utils.inherits(ColorPicker,UIBase);var COLORS=('ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,' + 'f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,' + 'd8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,' + 'bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,' + 'a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,' + '7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,' + 'c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,').split(',');function genColorPicker(noColorText,editor){var html='<div id=\"##\" class=\"edui-colorpicker %%\">' + '<div class=\"edui-colorpicker-topbar edui-clearfix\">' + '<div unselectable=\"on\" id=\"##_preview\" class=\"edui-colorpicker-preview\"></div>' + '<div unselectable=\"on\" class=\"edui-colorpicker-nocolor\" onclick=\"$$._onPickNoColor(event, this);\">' + noColorText + '</div>' + '</div>' + '<table  class=\"edui-box\" style=\"border-collapse: collapse;\" onmouseover=\"$$._onTableOver(event, this);\" onmouseout=\"$$._onTableOut(event, this);\" onclick=\"return $$._onTableClick(event, this);\" cellspacing=\"0\" cellpadding=\"0\">' + '<tr style=\"border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px\"><td colspan=\"10\">' + editor.getLang(\"themeColor\") + '</td> </tr>' + '<tr class=\"edui-colorpicker-tablefirstrow\" >';for(var i=0;i < COLORS.length;i++) {if(i && i % 10 === 0){html += '</tr>' + (i == 60?'<tr style=\"border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;\"><td colspan=\"10\">' + editor.getLang(\"standardColor\") + '</td></tr>':'') + '<tr' + (i == 60?' class=\"edui-colorpicker-tablefirstrow\"':'') + '>';}html += i < 70?'<td style=\"padding: 0 2px;\"><a hidefocus title=\"' + COLORS[i] + '\" onclick=\"return false;\" href=\"javascript:\" unselectable=\"on\" class=\"edui-box edui-colorpicker-colorcell\"' + ' data-color=\"#' + COLORS[i] + '\"' + ' style=\"background-color:#' + COLORS[i] + ';border:solid #ccc;' + (i < 10 || i >= 60?'border-width:1px;':i >= 10 && i < 20?'border-width:1px 1px 0 1px;':'border-width:0 1px 0 1px;') + '\"' + '></a></td>':'';}html += '</tr></table></div>';return html;}})(); // ui/tablepicker.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase;var TablePicker=baidu.editor.ui.TablePicker = function(options){this.initOptions(options);this.initTablePicker();};TablePicker.prototype = {defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function initTablePicker(){this.initUIBase();},getHtmlTpl:function getHtmlTpl(){var me=this;return '<div id=\"##\" class=\"edui-tablepicker %%\">' + '<div class=\"edui-tablepicker-body\">' + '<div class=\"edui-infoarea\">' + '<span id=\"##_label\" class=\"edui-label\"></span>' + '</div>' + '<div class=\"edui-pickarea\"' + ' onmousemove=\"$$._onMouseMove(event, this);\"' + ' onmouseover=\"$$._onMouseOver(event, this);\"' + ' onmouseout=\"$$._onMouseOut(event, this);\"' + ' onclick=\"$$._onClick(event, this);\"' + '>' + '<div id=\"##_overlay\" class=\"edui-overlay\"></div>' + '</div>' + '</div>' + '</div>';},_UIBase_render:UIBase.prototype.render,render:function render(holder){this._UIBase_render(holder);this.getDom('label').innerHTML = '0' + this.editor.getLang(\"t_row\") + ' x 0' + this.editor.getLang(\"t_col\");},_track:function _track(numCols,numRows){var style=this.getDom('overlay').style;var sideLen=this.lengthOfCellSide;style.width = numCols * sideLen + 'px';style.height = numRows * sideLen + 'px';var label=this.getDom('label');label.innerHTML = numCols + this.editor.getLang(\"t_col\") + ' x ' + numRows + this.editor.getLang(\"t_row\");this.numCols = numCols;this.numRows = numRows;},_onMouseOver:function _onMouseOver(evt,el){var rel=evt.relatedTarget || evt.fromElement;if(!uiUtils.contains(el,rel) && el !== rel){this.getDom('label').innerHTML = '0' + this.editor.getLang(\"t_col\") + ' x 0' + this.editor.getLang(\"t_row\");this.getDom('overlay').style.visibility = '';}},_onMouseOut:function _onMouseOut(evt,el){var rel=evt.relatedTarget || evt.toElement;if(!uiUtils.contains(el,rel) && el !== rel){this.getDom('label').innerHTML = '0' + this.editor.getLang(\"t_col\") + ' x 0' + this.editor.getLang(\"t_row\");this.getDom('overlay').style.visibility = 'hidden';}},_onMouseMove:function _onMouseMove(evt,el){var style=this.getDom('overlay').style;var offset=uiUtils.getEventOffset(evt);var sideLen=this.lengthOfCellSide;var numCols=Math.ceil(offset.left / sideLen);var numRows=Math.ceil(offset.top / sideLen);this._track(numCols,numRows);},_onClick:function _onClick(){this.fireEvent('picktable',this.numCols,this.numRows);}};utils.inherits(TablePicker,UIBase);})(); // ui/stateful.js\n(function(){var browser=baidu.editor.browser,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils;var TPL_STATEFUL='onmousedown=\"$$.Stateful_onMouseDown(event, this);\"' + ' onmouseup=\"$$.Stateful_onMouseUp(event, this);\"' + (browser.ie?' onmouseenter=\"$$.Stateful_onMouseEnter(event, this);\"' + ' onmouseleave=\"$$.Stateful_onMouseLeave(event, this);\"':' onmouseover=\"$$.Stateful_onMouseOver(event, this);\"' + ' onmouseout=\"$$.Stateful_onMouseOut(event, this);\"');baidu.editor.ui.Stateful = {alwalysHoverable:false,target:null, //目标元素和this指向dom不一样\nStateful_init:function Stateful_init(){this._Stateful_dGetHtmlTpl = this.getHtmlTpl;this.getHtmlTpl = this.Stateful_getHtmlTpl;},Stateful_getHtmlTpl:function Stateful_getHtmlTpl(){var tpl=this._Stateful_dGetHtmlTpl(); // 使用function避免$转义\nreturn tpl.replace(/stateful/g,function(){return TPL_STATEFUL;});},Stateful_onMouseEnter:function Stateful_onMouseEnter(evt,el){this.target = el;if(!this.isDisabled() || this.alwalysHoverable){this.addState('hover');this.fireEvent('over');}},Stateful_onMouseLeave:function Stateful_onMouseLeave(evt,el){if(!this.isDisabled() || this.alwalysHoverable){this.removeState('hover');this.removeState('active');this.fireEvent('out');}},Stateful_onMouseOver:function Stateful_onMouseOver(evt,el){var rel=evt.relatedTarget;if(!uiUtils.contains(el,rel) && el !== rel){this.Stateful_onMouseEnter(evt,el);}},Stateful_onMouseOut:function Stateful_onMouseOut(evt,el){var rel=evt.relatedTarget;if(!uiUtils.contains(el,rel) && el !== rel){this.Stateful_onMouseLeave(evt,el);}},Stateful_onMouseDown:function Stateful_onMouseDown(evt,el){if(!this.isDisabled()){this.addState('active');}},Stateful_onMouseUp:function Stateful_onMouseUp(evt,el){if(!this.isDisabled()){this.removeState('active');}},Stateful_postRender:function Stateful_postRender(){if(this.disabled && !this.hasState('disabled')){this.addState('disabled');}},hasState:function hasState(state){return domUtils.hasClass(this.getStateDom(),'edui-state-' + state);},addState:function addState(state){if(!this.hasState(state)){this.getStateDom().className += ' edui-state-' + state;}},removeState:function removeState(state){if(this.hasState(state)){domUtils.removeClasses(this.getStateDom(),['edui-state-' + state]);}},getStateDom:function getStateDom(){return this.getDom('state');},isChecked:function isChecked(){return this.hasState('checked');},setChecked:function setChecked(checked){if(!this.isDisabled() && checked){this.addState('checked');}else {this.removeState('checked');}},isDisabled:function isDisabled(){return this.hasState('disabled');},setDisabled:function setDisabled(disabled){if(disabled){this.removeState('hover');this.removeState('checked');this.removeState('active');this.addState('disabled');}else {this.removeState('disabled');}}};})(); // ui/button.js\n///import core\n///import uicore\n///import ui/stateful.js\n(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,Button=baidu.editor.ui.Button = function(options){if(options.name){var btnName=options.name;var cssRules=options.cssRules;if(!options.className){options.className = 'edui-for-' + btnName;}options.cssRules = '.edui-default  .edui-for-' + btnName + ' .edui-icon {' + cssRules + '}';}this.initOptions(options);this.initButton();};Button.prototype = {uiName:'button',label:'',title:'',showIcon:true,showText:true,cssRules:'',initButton:function initButton(){this.initUIBase();this.Stateful_init();if(this.cssRules){utils.cssRule('edui-customize-' + this.name + '-style',this.cssRules);}},getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"edui-box %%\">' + '<div id=\"##_state\" stateful>' + '<div class=\"%%-wrap\"><div id=\"##_body\" unselectable=\"on\" ' + (this.title?'title=\"' + this.title + '\"':'') + ' class=\"%%-body\" onmousedown=\"return $$._onMouseDown(event, this);\" onclick=\"return $$._onClick(event, this);\">' + (this.showIcon?'<div class=\"edui-box edui-icon\"></div>':'') + (this.showText?'<div class=\"edui-box edui-label\">' + this.label + '</div>':'') + '</div>' + '</div>' + '</div></div>';},postRender:function postRender(){this.Stateful_postRender();this.setDisabled(this.disabled);},_onMouseDown:function _onMouseDown(e){var target=e.target || e.srcElement,tagName=target && target.tagName && target.tagName.toLowerCase();if(tagName == 'input' || tagName == 'object' || tagName == 'object'){return false;}},_onClick:function _onClick(){if(!this.isDisabled()){this.fireEvent('click');}},setTitle:function setTitle(text){var label=this.getDom('label');label.innerHTML = text;}};utils.inherits(Button,UIBase);utils.extend(Button.prototype,Stateful);})(); // ui/splitbutton.js\n///import core\n///import uicore\n///import ui/stateful.js\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Stateful=baidu.editor.ui.Stateful,SplitButton=baidu.editor.ui.SplitButton = function(options){this.initOptions(options);this.initSplitButton();};SplitButton.prototype = {popup:null,uiName:'splitbutton',title:'',initSplitButton:function initSplitButton(){this.initUIBase();this.Stateful_init();var me=this;if(this.popup != null){var popup=this.popup;this.popup = null;this.setPopup(popup);}},_UIBase_postRender:UIBase.prototype.postRender,postRender:function postRender(){this.Stateful_postRender();this._UIBase_postRender();},setPopup:function setPopup(popup){if(this.popup === popup)return;if(this.popup != null){this.popup.dispose();}popup.addListener('show',utils.bind(this._onPopupShow,this));popup.addListener('hide',utils.bind(this._onPopupHide,this));popup.addListener('postrender',utils.bind(function(){popup.getDom('body').appendChild(uiUtils.createElementByHtml('<div id=\"' + this.popup.id + '_bordereraser\" class=\"edui-bordereraser edui-background\" style=\"width:' + (uiUtils.getClientRect(this.getDom()).width + 20) + 'px\"></div>'));popup.getDom().className += ' ' + this.className;},this));this.popup = popup;},_onPopupShow:function _onPopupShow(){this.addState('opened');},_onPopupHide:function _onPopupHide(){this.removeState('opened');},getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"edui-box %%\">' + '<div ' + (this.title?'title=\"' + this.title + '\"':'') + ' id=\"##_state\" stateful><div class=\"%%-body\">' + '<div id=\"##_button_body\" class=\"edui-box edui-button-body\" onclick=\"$$._onButtonClick(event, this);\">' + '<div class=\"edui-box edui-icon\"></div>' + '</div>' + '<div class=\"edui-box edui-splitborder\"></div>' + '<div class=\"edui-box edui-arrow\" onclick=\"$$._onArrowClick();\"></div>' + '</div></div></div>';},showPopup:function showPopup(){ // 当popup往上弹出的时候，做特殊处理\nvar rect=uiUtils.getClientRect(this.getDom());rect.top -= this.popup.SHADOW_RADIUS;rect.height += this.popup.SHADOW_RADIUS;this.popup.showAnchorRect(rect);},_onArrowClick:function _onArrowClick(event,el){if(!this.isDisabled()){this.showPopup();}},_onButtonClick:function _onButtonClick(){if(!this.isDisabled()){this.fireEvent('buttonclick');}}};utils.inherits(SplitButton,UIBase);utils.extend(SplitButton.prototype,Stateful,true);})(); // ui/colorbutton.js\n///import core\n///import uicore\n///import ui/colorpicker.js\n///import ui/popup.js\n///import ui/splitbutton.js\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,ColorPicker=baidu.editor.ui.ColorPicker,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,ColorButton=baidu.editor.ui.ColorButton = function(options){this.initOptions(options);this.initColorButton();};ColorButton.prototype = {initColorButton:function initColorButton(){var me=this;this.popup = new Popup({content:new ColorPicker({noColorText:me.editor.getLang(\"clearColor\"),editor:me.editor,onpickcolor:function onpickcolor(t,color){me._onPickColor(color);},onpicknocolor:function onpicknocolor(t,color){me._onPickNoColor(color);}}),editor:me.editor});this.initSplitButton();},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function postRender(){this._SplitButton_postRender();this.getDom('button_body').appendChild(uiUtils.createElementByHtml('<div id=\"' + this.id + '_colorlump\" class=\"edui-colorlump\"></div>'));this.getDom().className += ' edui-colorbutton';},setColor:function setColor(color){this.getDom('colorlump').style.backgroundColor = color;this.color = color;},_onPickColor:function _onPickColor(color){if(this.fireEvent('pickcolor',color) !== false){this.setColor(color);this.popup.hide();}},_onPickNoColor:function _onPickNoColor(color){if(this.fireEvent('picknocolor') !== false){this.popup.hide();}}};utils.inherits(ColorButton,SplitButton);})(); // ui/tablebutton.js\n///import core\n///import uicore\n///import ui/popup.js\n///import ui/tablepicker.js\n///import ui/splitbutton.js\n(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,TablePicker=baidu.editor.ui.TablePicker,SplitButton=baidu.editor.ui.SplitButton,TableButton=baidu.editor.ui.TableButton = function(options){this.initOptions(options);this.initTableButton();};TableButton.prototype = {initTableButton:function initTableButton(){var me=this;this.popup = new Popup({content:new TablePicker({editor:me.editor,onpicktable:function onpicktable(t,numCols,numRows){me._onPickTable(numCols,numRows);}}),'editor':me.editor});this.initSplitButton();},_onPickTable:function _onPickTable(numCols,numRows){if(this.fireEvent('picktable',numCols,numRows) !== false){this.popup.hide();}}};utils.inherits(TableButton,SplitButton);})(); // ui/autotypesetpicker.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase;var AutoTypeSetPicker=baidu.editor.ui.AutoTypeSetPicker = function(options){this.initOptions(options);this.initAutoTypeSetPicker();};AutoTypeSetPicker.prototype = {initAutoTypeSetPicker:function initAutoTypeSetPicker(){this.initUIBase();},getHtmlTpl:function getHtmlTpl(){var me=this.editor,opt=me.options.autotypeset,lang=me.getLang(\"autoTypeSet\");var textAlignInputName='textAlignValue' + me.uid,imageBlockInputName='imageBlockLineValue' + me.uid,symbolConverInputName='symbolConverValue' + me.uid;return '<div id=\"##\" class=\"edui-autotypesetpicker %%\">' + '<div class=\"edui-autotypesetpicker-body\">' + '<table >' + '<tr><td nowrap><input type=\"checkbox\" name=\"mergeEmptyline\" ' + (opt[\"mergeEmptyline\"]?\"checked\":\"\") + '>' + lang.mergeLine + '</td><td colspan=\"2\"><input type=\"checkbox\" name=\"removeEmptyline\" ' + (opt[\"removeEmptyline\"]?\"checked\":\"\") + '>' + lang.delLine + '</td></tr>' + '<tr><td nowrap><input type=\"checkbox\" name=\"removeClass\" ' + (opt[\"removeClass\"]?\"checked\":\"\") + '>' + lang.removeFormat + '</td><td colspan=\"2\"><input type=\"checkbox\" name=\"indent\" ' + (opt[\"indent\"]?\"checked\":\"\") + '>' + lang.indent + '</td></tr>' + '<tr>' + '<td nowrap><input type=\"checkbox\" name=\"textAlign\" ' + (opt[\"textAlign\"]?\"checked\":\"\") + '>' + lang.alignment + '</td>' + '<td colspan=\"2\" id=\"' + textAlignInputName + '\">' + '<input type=\"radio\" name=\"' + textAlignInputName + '\" value=\"left\" ' + (opt[\"textAlign\"] && opt[\"textAlign\"] == \"left\"?\"checked\":\"\") + '>' + me.getLang(\"justifyleft\") + '<input type=\"radio\" name=\"' + textAlignInputName + '\" value=\"center\" ' + (opt[\"textAlign\"] && opt[\"textAlign\"] == \"center\"?\"checked\":\"\") + '>' + me.getLang(\"justifycenter\") + '<input type=\"radio\" name=\"' + textAlignInputName + '\" value=\"right\" ' + (opt[\"textAlign\"] && opt[\"textAlign\"] == \"right\"?\"checked\":\"\") + '>' + me.getLang(\"justifyright\") + '</td>' + '</tr>' + '<tr>' + '<td nowrap><input type=\"checkbox\" name=\"imageBlockLine\" ' + (opt[\"imageBlockLine\"]?\"checked\":\"\") + '>' + lang.imageFloat + '</td>' + '<td nowrap id=\"' + imageBlockInputName + '\">' + '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"none\" ' + (opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"none\"?\"checked\":\"\") + '>' + me.getLang(\"default\") + '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"left\" ' + (opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"left\"?\"checked\":\"\") + '>' + me.getLang(\"justifyleft\") + '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"center\" ' + (opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"center\"?\"checked\":\"\") + '>' + me.getLang(\"justifycenter\") + '<input type=\"radio\" name=\"' + imageBlockInputName + '\" value=\"right\" ' + (opt[\"imageBlockLine\"] && opt[\"imageBlockLine\"] == \"right\"?\"checked\":\"\") + '>' + me.getLang(\"justifyright\") + '</td>' + '</tr>' + '<tr><td nowrap><input type=\"checkbox\" name=\"clearFontSize\" ' + (opt[\"clearFontSize\"]?\"checked\":\"\") + '>' + lang.removeFontsize + '</td><td colspan=\"2\"><input type=\"checkbox\" name=\"clearFontFamily\" ' + (opt[\"clearFontFamily\"]?\"checked\":\"\") + '>' + lang.removeFontFamily + '</td></tr>' + '<tr><td nowrap colspan=\"3\"><input type=\"checkbox\" name=\"removeEmptyNode\" ' + (opt[\"removeEmptyNode\"]?\"checked\":\"\") + '>' + lang.removeHtml + '</td></tr>' + '<tr><td nowrap colspan=\"3\"><input type=\"checkbox\" name=\"pasteFilter\" ' + (opt[\"pasteFilter\"]?\"checked\":\"\") + '>' + lang.pasteFilter + '</td></tr>' + '<tr>' + '<td nowrap><input type=\"checkbox\" name=\"symbolConver\" ' + (opt[\"bdc2sb\"] || opt[\"tobdc\"]?\"checked\":\"\") + '>' + lang.symbol + '</td>' + '<td id=\"' + symbolConverInputName + '\">' + '<input type=\"radio\" name=\"bdc\" value=\"bdc2sb\" ' + (opt[\"bdc2sb\"]?\"checked\":\"\") + '>' + lang.bdc2sb + '<input type=\"radio\" name=\"bdc\" value=\"tobdc\" ' + (opt[\"tobdc\"]?\"checked\":\"\") + '>' + lang.tobdc + '' + '</td>' + '<td nowrap align=\"right\"><button >' + lang.run + '</button></td>' + '</tr>' + '</table>' + '</div>' + '</div>';},_UIBase_render:UIBase.prototype.render};utils.inherits(AutoTypeSetPicker,UIBase);})(); // ui/autotypesetbutton.js\n///import core\n///import uicore\n///import ui/popup.js\n///import ui/autotypesetpicker.js\n///import ui/splitbutton.js\n(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,AutoTypeSetPicker=baidu.editor.ui.AutoTypeSetPicker,SplitButton=baidu.editor.ui.SplitButton,AutoTypeSetButton=baidu.editor.ui.AutoTypeSetButton = function(options){this.initOptions(options);this.initAutoTypeSetButton();};function getPara(me){var opt={},cont=me.getDom(),editorId=me.editor.uid,inputType=null,attrName=null,ipts=domUtils.getElementsByTagName(cont,\"input\");for(var i=ipts.length - 1,ipt;ipt = ipts[i--];) {inputType = ipt.getAttribute(\"type\");if(inputType == \"checkbox\"){attrName = ipt.getAttribute(\"name\");opt[attrName] && delete opt[attrName];if(ipt.checked){var attrValue=document.getElementById(attrName + \"Value\" + editorId);if(attrValue){if(/input/ig.test(attrValue.tagName)){opt[attrName] = attrValue.value;}else {var iptChilds=attrValue.getElementsByTagName(\"input\");for(var j=iptChilds.length - 1,iptchild;iptchild = iptChilds[j--];) {if(iptchild.checked){opt[attrName] = iptchild.value;break;}}}}else {opt[attrName] = true;}}else {opt[attrName] = false;}}else {opt[ipt.getAttribute(\"value\")] = ipt.checked;}}var selects=domUtils.getElementsByTagName(cont,\"select\");for(var i=0,si;si = selects[i++];) {var attr=si.getAttribute('name');opt[attr] = opt[attr]?si.value:'';}utils.extend(me.editor.options.autotypeset,opt);me.editor.setPreferences('autotypeset',opt);}AutoTypeSetButton.prototype = {initAutoTypeSetButton:function initAutoTypeSetButton(){var me=this;this.popup = new Popup({ //传入配置参数\ncontent:new AutoTypeSetPicker({editor:me.editor}),'editor':me.editor,hide:function hide(){if(!this._hidden && this.getDom()){getPara(this);this.getDom().style.display = 'none';this._hidden = true;this.fireEvent('hide');}}});var flag=0;this.popup.addListener('postRenderAfter',function(){var popupUI=this;if(flag)return;var cont=this.getDom(),btn=cont.getElementsByTagName('button')[0];btn.onclick = function(){getPara(popupUI);me.editor.execCommand('autotypeset');popupUI.hide();};domUtils.on(cont,'click',function(e){var target=e.target || e.srcElement,editorId=me.editor.uid;if(target && target.tagName == 'INPUT'){ // 点击图片浮动的checkbox,去除对应的radio\nif(target.name == 'imageBlockLine' || target.name == 'textAlign' || target.name == 'symbolConver'){var checked=target.checked,radioTd=document.getElementById(target.name + 'Value' + editorId),radios=radioTd.getElementsByTagName('input'),defalutSelect={'imageBlockLine':'none','textAlign':'left','symbolConver':'tobdc'};for(var i=0;i < radios.length;i++) {if(checked){if(radios[i].value == defalutSelect[target.name]){radios[i].checked = 'checked';}}else {radios[i].checked = false;}}} // 点击radio,选中对应的checkbox\nif(target.name == 'imageBlockLineValue' + editorId || target.name == 'textAlignValue' + editorId || target.name == 'bdc'){var checkboxs=target.parentNode.previousSibling.getElementsByTagName('input');checkboxs && (checkboxs[0].checked = true);}getPara(popupUI);}});flag = 1;});this.initSplitButton();}};utils.inherits(AutoTypeSetButton,SplitButton);})(); // ui/cellalignpicker.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,UIBase=baidu.editor.ui.UIBase; /**\r\n     * 该参数将新增一个参数： selected， 参数类型为一个Object， 形如{ 'align': 'center', 'valign': 'top' }， 表示单元格的初始\r\n     * 对齐状态为： 竖直居上，水平居中; 其中 align的取值为：'center', 'left', 'right'; valign的取值为: 'top', 'middle', 'bottom'\r\n     * @update 2013/4/2 hancong03@baidu.com\r\n     */var CellAlignPicker=baidu.editor.ui.CellAlignPicker = function(options){this.initOptions(options);this.initSelected();this.initCellAlignPicker();};CellAlignPicker.prototype = { //初始化选中状态， 该方法将根据传递进来的参数获取到应该选中的对齐方式图标的索引\ninitSelected:function initSelected(){var status={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3},result=-1;if(this.selected){this.selectedIndex = status.valign[this.selected.valign] * status.count + status.align[this.selected.align];}},initCellAlignPicker:function initCellAlignPicker(){this.initUIBase();this.Stateful_init();},getHtmlTpl:function getHtmlTpl(){var alignType=['left','center','right'],COUNT=9,tempClassName=null,tempIndex=-1,tmpl=[];for(var i=0;i < COUNT;i++) {tempClassName = this.selectedIndex === i?' class=\"edui-cellalign-selected\" ':'';tempIndex = i % 3;tempIndex === 0 && tmpl.push('<tr>');tmpl.push('<td index=\"' + i + '\" ' + tempClassName + ' stateful><div class=\"edui-icon edui-' + alignType[tempIndex] + '\"></div></td>');tempIndex === 2 && tmpl.push('</tr>');}return '<div id=\"##\" class=\"edui-cellalignpicker %%\">' + '<div class=\"edui-cellalignpicker-body\">' + '<table onclick=\"$$._onClick(event);\">' + tmpl.join('') + '</table>' + '</div>' + '</div>';},getStateDom:function getStateDom(){return this.target;},_onClick:function _onClick(evt){var target=evt.target || evt.srcElement;if(/icon/.test(target.className)){this.items[target.parentNode.getAttribute(\"index\")].onclick();Popup.postHide(evt);}},_UIBase_render:UIBase.prototype.render};utils.inherits(CellAlignPicker,UIBase);utils.extend(CellAlignPicker.prototype,Stateful,true);})(); // ui/pastepicker.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,Stateful=baidu.editor.ui.Stateful,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase;var PastePicker=baidu.editor.ui.PastePicker = function(options){this.initOptions(options);this.initPastePicker();};PastePicker.prototype = {initPastePicker:function initPastePicker(){this.initUIBase();this.Stateful_init();},getHtmlTpl:function getHtmlTpl(){return '<div class=\"edui-pasteicon\" onclick=\"$$._onClick(this)\"></div>' + '<div class=\"edui-pastecontainer\">' + '<div class=\"edui-title\">' + this.editor.getLang(\"pasteOpt\") + '</div>' + '<div class=\"edui-button\">' + '<div title=\"' + this.editor.getLang(\"pasteSourceFormat\") + '\" onclick=\"$$.format(false)\" stateful>' + '<div class=\"edui-richtxticon\"></div></div>' + '<div title=\"' + this.editor.getLang(\"tagFormat\") + '\" onclick=\"$$.format(2)\" stateful>' + '<div class=\"edui-tagicon\"></div></div>' + '<div title=\"' + this.editor.getLang(\"pasteTextFormat\") + '\" onclick=\"$$.format(true)\" stateful>' + '<div class=\"edui-plaintxticon\"></div></div>' + '</div>' + '</div>' + '</div>';},getStateDom:function getStateDom(){return this.target;},format:function format(param){this.editor.ui._isTransfer = true;this.editor.fireEvent('pasteTransfer',param);},_onClick:function _onClick(cur){var node=domUtils.getNextDomNode(cur),screenHt=uiUtils.getViewportRect().height,subPop=uiUtils.getClientRect(node);if(subPop.top + subPop.height > screenHt)node.style.top = -subPop.height - cur.offsetHeight + \"px\";else node.style.top = \"\";if(/hidden/ig.test(domUtils.getComputedStyle(node,\"visibility\"))){node.style.visibility = \"visible\";domUtils.addClass(cur,\"edui-state-opened\");}else {node.style.visibility = \"hidden\";domUtils.removeClasses(cur,\"edui-state-opened\");}},_UIBase_render:UIBase.prototype.render};utils.inherits(PastePicker,UIBase);utils.extend(PastePicker.prototype,Stateful,true);})(); // ui/toolbar.js\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Toolbar=baidu.editor.ui.Toolbar = function(options){this.initOptions(options);this.initToolbar();};Toolbar.prototype = {items:null,initToolbar:function initToolbar(){this.items = this.items || [];this.initUIBase();},add:function add(item,index){if(index === undefined){this.items.push(item);}else {this.items.splice(index,0,item);}},getHtmlTpl:function getHtmlTpl(){var buff=[];for(var i=0;i < this.items.length;i++) {buff[i] = this.items[i].renderHtml();}return '<div id=\"##\" class=\"edui-toolbar %%\" onselectstart=\"return false;\" onmousedown=\"return $$._onMouseDown(event, this);\">' + buff.join('') + '</div>';},postRender:function postRender(){var box=this.getDom();for(var i=0;i < this.items.length;i++) {this.items[i].postRender();}uiUtils.makeUnselectable(box);},_onMouseDown:function _onMouseDown(e){var target=e.target || e.srcElement,tagName=target && target.tagName && target.tagName.toLowerCase();if(tagName == 'input' || tagName == 'object' || tagName == 'object'){return false;}}};utils.inherits(Toolbar,UIBase);})(); // ui/menu.js\n///import core\n///import uicore\n///import ui\\popup.js\n///import ui\\stateful.js\n(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,Popup=baidu.editor.ui.Popup,Stateful=baidu.editor.ui.Stateful,CellAlignPicker=baidu.editor.ui.CellAlignPicker,Menu=baidu.editor.ui.Menu = function(options){this.initOptions(options);this.initMenu();};var menuSeparator={renderHtml:function renderHtml(){return '<div class=\"edui-menuitem edui-menuseparator\"><div class=\"edui-menuseparator-inner\"></div></div>';},postRender:function postRender(){},queryAutoHide:function queryAutoHide(){return true;}};Menu.prototype = {items:null,uiName:'menu',initMenu:function initMenu(){this.items = this.items || [];this.initPopup();this.initItems();},initItems:function initItems(){for(var i=0;i < this.items.length;i++) {var item=this.items[i];if(item == '-'){this.items[i] = this.getSeparator();}else if(!(item instanceof MenuItem)){item.editor = this.editor;item.theme = this.editor.options.theme;this.items[i] = this.createItem(item);}}},getSeparator:function getSeparator(){return menuSeparator;},createItem:function createItem(item){ //新增一个参数menu, 该参数存储了menuItem所对应的menu引用\nitem.menu = this;return new MenuItem(item);},_Popup_getContentHtmlTpl:Popup.prototype.getContentHtmlTpl,getContentHtmlTpl:function getContentHtmlTpl(){if(this.items.length == 0){return this._Popup_getContentHtmlTpl();}var buff=[];for(var i=0;i < this.items.length;i++) {var item=this.items[i];buff[i] = item.renderHtml();}return '<div class=\"%%-body\">' + buff.join('') + '</div>';},_Popup_postRender:Popup.prototype.postRender,postRender:function postRender(){var me=this;for(var i=0;i < this.items.length;i++) {var item=this.items[i];item.ownerMenu = this;item.postRender();}domUtils.on(this.getDom(),'mouseover',function(evt){evt = evt || event;var rel=evt.relatedTarget || evt.fromElement;var el=me.getDom();if(!uiUtils.contains(el,rel) && el !== rel){me.fireEvent('over');}});this._Popup_postRender();},queryAutoHide:function queryAutoHide(el){if(el){if(uiUtils.contains(this.getDom(),el)){return false;}for(var i=0;i < this.items.length;i++) {var item=this.items[i];if(item.queryAutoHide(el) === false){return false;}}}},clearItems:function clearItems(){for(var i=0;i < this.items.length;i++) {var item=this.items[i];clearTimeout(item._showingTimer);clearTimeout(item._closingTimer);if(item.subMenu){item.subMenu.destroy();}}this.items = [];},destroy:function destroy(){if(this.getDom()){domUtils.remove(this.getDom());}this.clearItems();},dispose:function dispose(){this.destroy();}};utils.inherits(Menu,Popup); /**\r\n     * @update 2013/04/03 hancong03 新增一个参数menu, 该参数存储了menuItem所对应的menu引用\r\n     * @type {Function}\r\n     */var MenuItem=baidu.editor.ui.MenuItem = function(options){this.initOptions(options);this.initUIBase();this.Stateful_init();if(this.subMenu && !(this.subMenu instanceof Menu)){if(options.className && options.className.indexOf(\"aligntd\") != -1){var me=this; //获取单元格对齐初始状态\nthis.subMenu.selected = this.editor.queryCommandValue('cellalignment');this.subMenu = new Popup({content:new CellAlignPicker(this.subMenu),parentMenu:me,editor:me.editor,destroy:function destroy(){if(this.getDom()){domUtils.remove(this.getDom());}}});this.subMenu.addListener(\"postRenderAfter\",function(){domUtils.on(this.getDom(),\"mouseover\",function(){me.addState('opened');});});}else {this.subMenu = new Menu(this.subMenu);}}};MenuItem.prototype = {label:'',subMenu:null,ownerMenu:null,uiName:'menuitem',alwalysHoverable:true,getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"%%\" stateful onclick=\"$$._onClick(event, this);\">' + '<div class=\"%%-body\">' + this.renderLabelHtml() + '</div>' + '</div>';},postRender:function postRender(){var me=this;this.addListener('over',function(){me.ownerMenu.fireEvent('submenuover',me);if(me.subMenu){me.delayShowSubMenu();}});if(this.subMenu){this.getDom().className += ' edui-hassubmenu';this.subMenu.render();this.addListener('out',function(){me.delayHideSubMenu();});this.subMenu.addListener('over',function(){clearTimeout(me._closingTimer);me._closingTimer = null;me.addState('opened');});this.ownerMenu.addListener('hide',function(){me.hideSubMenu();});this.ownerMenu.addListener('submenuover',function(t,subMenu){if(subMenu !== me){me.delayHideSubMenu();}});this.subMenu._bakQueryAutoHide = this.subMenu.queryAutoHide;this.subMenu.queryAutoHide = function(el){if(el && uiUtils.contains(me.getDom(),el)){return false;}return this._bakQueryAutoHide(el);};}this.getDom().style.tabIndex = '-1';uiUtils.makeUnselectable(this.getDom());this.Stateful_postRender();},delayShowSubMenu:function delayShowSubMenu(){var me=this;if(!me.isDisabled()){me.addState('opened');clearTimeout(me._showingTimer);clearTimeout(me._closingTimer);me._closingTimer = null;me._showingTimer = setTimeout(function(){me.showSubMenu();},250);}},delayHideSubMenu:function delayHideSubMenu(){var me=this;if(!me.isDisabled()){me.removeState('opened');clearTimeout(me._showingTimer);if(!me._closingTimer){me._closingTimer = setTimeout(function(){if(!me.hasState('opened')){me.hideSubMenu();}me._closingTimer = null;},400);}}},renderLabelHtml:function renderLabelHtml(){return '<div class=\"edui-arrow\"></div>' + '<div class=\"edui-box edui-icon\"></div>' + '<div class=\"edui-box edui-label %%-label\">' + (this.label || '') + '</div>';},getStateDom:function getStateDom(){return this.getDom();},queryAutoHide:function queryAutoHide(el){if(this.subMenu && this.hasState('opened')){return this.subMenu.queryAutoHide(el);}},_onClick:function _onClick(event,this_){if(this.hasState('disabled'))return;if(this.fireEvent('click',event,this_) !== false){if(this.subMenu){this.showSubMenu();}else {Popup.postHide(event);}}},showSubMenu:function showSubMenu(){var rect=uiUtils.getClientRect(this.getDom());rect.right -= 5;rect.left += 2;rect.width -= 7;rect.top -= 4;rect.bottom += 4;rect.height += 8;this.subMenu.showAnchorRect(rect,true,true);},hideSubMenu:function hideSubMenu(){this.subMenu.hide();}};utils.inherits(MenuItem,UIBase);utils.extend(MenuItem.prototype,Stateful,true);})(); // ui/combox.js\n///import core\n///import uicore\n///import ui/menu.js\n///import ui/splitbutton.js\n(function(){ // todo: menu和item提成通用list\nvar utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,Combox=baidu.editor.ui.Combox = function(options){this.initOptions(options);this.initCombox();};Combox.prototype = {uiName:'combox',onbuttonclick:function onbuttonclick(){this.showPopup();},initCombox:function initCombox(){var me=this;this.items = this.items || [];for(var i=0;i < this.items.length;i++) {var item=this.items[i];item.uiName = 'listitem';item.index = i;item.onclick = function(){me.selectByIndex(this.index);};}this.popup = new Menu({items:this.items,uiName:'list',editor:this.editor,captureWheel:true,combox:this});this.initSplitButton();},_SplitButton_postRender:SplitButton.prototype.postRender,postRender:function postRender(){this._SplitButton_postRender();this.setLabel(this.label || '');this.setValue(this.initValue || '');},showPopup:function showPopup(){var rect=uiUtils.getClientRect(this.getDom());rect.top += 1;rect.bottom -= 1;rect.height -= 2;this.popup.showAnchorRect(rect);},getValue:function getValue(){return this.value;},setValue:function setValue(value){var index=this.indexByValue(value);if(index != -1){this.selectedIndex = index;this.setLabel(this.items[index].label);this.value = this.items[index].value;}else {this.selectedIndex = -1;this.setLabel(this.getLabelForUnknowValue(value));this.value = value;}},setLabel:function setLabel(label){this.getDom('button_body').innerHTML = label;this.label = label;},getLabelForUnknowValue:function getLabelForUnknowValue(value){return value;},indexByValue:function indexByValue(value){for(var i=0;i < this.items.length;i++) {if(value == this.items[i].value){return i;}}return -1;},getItem:function getItem(index){return this.items[index];},selectByIndex:function selectByIndex(index){if(index < this.items.length && this.fireEvent('select',index) !== false){this.selectedIndex = index;this.value = this.items[index].value;this.setLabel(this.items[index].label);}}};utils.inherits(Combox,SplitButton);})(); // ui/dialog.js\n///import core\n///import uicore\n///import ui/mask.js\n///import ui/button.js\n(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,uiUtils=baidu.editor.ui.uiUtils,Mask=baidu.editor.ui.Mask,UIBase=baidu.editor.ui.UIBase,Button=baidu.editor.ui.Button,Dialog=baidu.editor.ui.Dialog = function(options){if(options.name){var name=options.name;var cssRules=options.cssRules;if(!options.className){options.className = 'edui-for-' + name;}if(cssRules){options.cssRules = '.edui-default .edui-for-' + name + ' .edui-dialog-content  {' + cssRules + '}';}}this.initOptions(utils.extend({autoReset:true,draggable:true,onok:function onok(){},oncancel:function oncancel(){},onclose:function onclose(t,ok){return ok?this.onok():this.oncancel();}, //是否控制dialog中的scroll事件， 默认为不阻止\nholdScroll:false},options));this.initDialog();};var modalMask;var dragMask;var activeDialog;Dialog.prototype = {draggable:false,uiName:'dialog',initDialog:function initDialog(){var me=this,theme=this.editor.options.theme;if(this.cssRules){utils.cssRule('edui-customize-' + this.name + '-style',this.cssRules);}this.initUIBase();this.modalMask = modalMask || (modalMask = new Mask({className:'edui-dialog-modalmask',theme:theme,onclick:function onclick(){activeDialog && activeDialog.close(false);}}));this.dragMask = dragMask || (dragMask = new Mask({className:'edui-dialog-dragmask',theme:theme}));this.closeButton = new Button({className:'edui-dialog-closebutton',title:me.closeDialog,theme:theme,onclick:function onclick(){me.close(false);}});this.fullscreen && this.initResizeEvent();if(this.buttons){for(var i=0;i < this.buttons.length;i++) {if(!(this.buttons[i] instanceof Button)){this.buttons[i] = new Button(utils.extend(this.buttons[i],{editor:this.editor},true));}}}},initResizeEvent:function initResizeEvent(){var me=this;domUtils.on(window,\"resize\",function(){if(me._hidden || me._hidden === undefined){return;}if(me.__resizeTimer){window.clearTimeout(me.__resizeTimer);}me.__resizeTimer = window.setTimeout(function(){me.__resizeTimer = null;var dialogWrapNode=me.getDom(),contentNode=me.getDom('content'),wrapRect=UE.ui.uiUtils.getClientRect(dialogWrapNode),contentRect=UE.ui.uiUtils.getClientRect(contentNode),vpRect=uiUtils.getViewportRect();contentNode.style.width = vpRect.width - wrapRect.width + contentRect.width + \"px\";contentNode.style.height = vpRect.height - wrapRect.height + contentRect.height + \"px\";dialogWrapNode.style.width = vpRect.width + \"px\";dialogWrapNode.style.height = vpRect.height + \"px\";me.fireEvent(\"resize\");},100);});},fitSize:function fitSize(){var popBodyEl=this.getDom('body'); //            if (!(baidu.editor.browser.ie && baidu.editor.browser.version == 7)) {\n//                uiUtils.removeStyle(popBodyEl, 'width');\n//                uiUtils.removeStyle(popBodyEl, 'height');\n//            }\nvar size=this.mesureSize();popBodyEl.style.width = size.width + 'px';popBodyEl.style.height = size.height + 'px';return size;},safeSetOffset:function safeSetOffset(offset){var me=this;var el=me.getDom();var vpRect=uiUtils.getViewportRect();var rect=uiUtils.getClientRect(el);var left=offset.left;if(left + rect.width > vpRect.right){left = vpRect.right - rect.width;}var top=offset.top;if(top + rect.height > vpRect.bottom){top = vpRect.bottom - rect.height;}el.style.left = Math.max(left,0) + 'px';el.style.top = Math.max(top,0) + 'px';},showAtCenter:function showAtCenter(){var vpRect=uiUtils.getViewportRect();if(!this.fullscreen){this.getDom().style.display = '';var popSize=this.fitSize();var titleHeight=this.getDom('titlebar').offsetHeight | 0;var left=vpRect.width / 2 - popSize.width / 2;var top=vpRect.height / 2 - (popSize.height - titleHeight) / 2 - titleHeight;var popEl=this.getDom();this.safeSetOffset({left:Math.max(left | 0,0),top:Math.max(top | 0,0)});if(!domUtils.hasClass(popEl,'edui-state-centered')){popEl.className += ' edui-state-centered';}}else {var dialogWrapNode=this.getDom(),contentNode=this.getDom('content');dialogWrapNode.style.display = \"block\";var wrapRect=UE.ui.uiUtils.getClientRect(dialogWrapNode),contentRect=UE.ui.uiUtils.getClientRect(contentNode);dialogWrapNode.style.left = \"-100000px\";contentNode.style.width = vpRect.width - wrapRect.width + contentRect.width + \"px\";contentNode.style.height = vpRect.height - wrapRect.height + contentRect.height + \"px\";dialogWrapNode.style.width = vpRect.width + \"px\";dialogWrapNode.style.height = vpRect.height + \"px\";dialogWrapNode.style.left = 0; //保存环境的overflow值\nthis._originalContext = {html:{overflowX:document.documentElement.style.overflowX,overflowY:document.documentElement.style.overflowY},body:{overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY}};document.documentElement.style.overflowX = 'hidden';document.documentElement.style.overflowY = 'hidden';document.body.style.overflowX = 'hidden';document.body.style.overflowY = 'hidden';}this._show();},getContentHtml:function getContentHtml(){var contentHtml='';if(typeof this.content == 'string'){contentHtml = this.content;}else if(this.iframeUrl){contentHtml = '<span id=\"' + this.id + '_contmask\" class=\"dialogcontmask\"></span><iframe id=\"' + this.id + '_iframe\" class=\"%%-iframe\" height=\"100%\" width=\"100%\" frameborder=\"0\" src=\"' + this.iframeUrl + '\"></iframe>';}return contentHtml;},getHtmlTpl:function getHtmlTpl(){var footHtml='';if(this.buttons){var buff=[];for(var i=0;i < this.buttons.length;i++) {buff[i] = this.buttons[i].renderHtml();}footHtml = '<div class=\"%%-foot\">' + '<div id=\"##_buttons\" class=\"%%-buttons\">' + buff.join('') + '</div>' + '</div>';}return '<div id=\"##\" class=\"%%\"><div ' + (!this.fullscreen?'class=\"%%\"':'class=\"%%-wrap edui-dialog-fullscreen-flag\"') + '><div id=\"##_body\" class=\"%%-body\">' + '<div class=\"%%-shadow\"></div>' + '<div id=\"##_titlebar\" class=\"%%-titlebar\">' + '<div class=\"%%-draghandle\" onmousedown=\"$$._onTitlebarMouseDown(event, this);\">' + '<span class=\"%%-caption\">' + (this.title || '') + '</span>' + '</div>' + this.closeButton.renderHtml() + '</div>' + '<div id=\"##_content\" class=\"%%-content\">' + (this.autoReset?'':this.getContentHtml()) + '</div>' + footHtml + '</div></div></div>';},postRender:function postRender(){ // todo: 保持居中/记住上次关闭位置选项\nif(!this.modalMask.getDom()){this.modalMask.render();this.modalMask.hide();}if(!this.dragMask.getDom()){this.dragMask.render();this.dragMask.hide();}var me=this;this.addListener('show',function(){me.modalMask.show(this.getDom().style.zIndex - 2);});this.addListener('hide',function(){me.modalMask.hide();});if(this.buttons){for(var i=0;i < this.buttons.length;i++) {this.buttons[i].postRender();}}domUtils.on(window,'resize',function(){setTimeout(function(){if(!me.isHidden()){me.safeSetOffset(uiUtils.getClientRect(me.getDom()));}});}); //hold住scroll事件，防止dialog的滚动影响页面\n//            if( this.holdScroll ) {\n//\n//                if( !me.iframeUrl ) {\n//                    domUtils.on( document.getElementById( me.id + \"_iframe\"), !browser.gecko ? \"mousewheel\" : \"DOMMouseScroll\", function(e){\n//                        domUtils.preventDefault(e);\n//                    } );\n//                } else {\n//                    me.addListener('dialogafterreset', function(){\n//                        window.setTimeout(function(){\n//                            var iframeWindow = document.getElementById( me.id + \"_iframe\").contentWindow;\n//\n//                            if( browser.ie ) {\n//\n//                                var timer = window.setInterval(function(){\n//\n//                                    if( iframeWindow.document && iframeWindow.document.body ) {\n//                                        window.clearInterval( timer );\n//                                        timer = null;\n//                                        domUtils.on( iframeWindow.document.body, !browser.gecko ? \"mousewheel\" : \"DOMMouseScroll\", function(e){\n//                                            domUtils.preventDefault(e);\n//                                        } );\n//                                    }\n//\n//                                }, 100);\n//\n//                            } else {\n//                                domUtils.on( iframeWindow, !browser.gecko ? \"mousewheel\" : \"DOMMouseScroll\", function(e){\n//                                    domUtils.preventDefault(e);\n//                                } );\n//                            }\n//\n//                        }, 1);\n//                    });\n//                }\n//\n//            }\nthis._hide();},mesureSize:function mesureSize(){var body=this.getDom('body');var width=uiUtils.getClientRect(this.getDom('content')).width;var dialogBodyStyle=body.style;dialogBodyStyle.width = width;return uiUtils.getClientRect(body);},_onTitlebarMouseDown:function _onTitlebarMouseDown(evt,el){if(this.draggable){var rect;var vpRect=uiUtils.getViewportRect();var me=this;uiUtils.startDrag(evt,{ondragstart:function ondragstart(){rect = uiUtils.getClientRect(me.getDom());me.getDom('contmask').style.visibility = 'visible';me.dragMask.show(me.getDom().style.zIndex - 1);},ondragmove:function ondragmove(x,y){var left=rect.left + x;var top=rect.top + y;me.safeSetOffset({left:left,top:top});},ondragstop:function ondragstop(){me.getDom('contmask').style.visibility = 'hidden';domUtils.removeClasses(me.getDom(),['edui-state-centered']);me.dragMask.hide();}});}},reset:function reset(){this.getDom('content').innerHTML = this.getContentHtml();this.fireEvent('dialogafterreset');},_show:function _show(){if(this._hidden){this.getDom().style.display = ''; //要高过编辑器的zindxe\nthis.editor.container.style.zIndex && (this.getDom().style.zIndex = this.editor.container.style.zIndex * 1 + 10);this._hidden = false;this.fireEvent('show');baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex = this.getDom().style.zIndex - 4;}},isHidden:function isHidden(){return this._hidden;},_hide:function _hide(){if(!this._hidden){var wrapNode=this.getDom();wrapNode.style.display = 'none';wrapNode.style.zIndex = '';wrapNode.style.width = '';wrapNode.style.height = '';this._hidden = true;this.fireEvent('hide');}},open:function open(){if(this.autoReset){ //有可能还没有渲染\ntry{this.reset();}catch(e) {this.render();this.open();}}this.showAtCenter();if(this.iframeUrl){try{this.getDom('iframe').focus();}catch(ex) {}}activeDialog = this;},_onCloseButtonClick:function _onCloseButtonClick(evt,el){this.close(false);},close:function close(ok){if(this.fireEvent('close',ok) !== false){ //还原环境\nif(this.fullscreen){document.documentElement.style.overflowX = this._originalContext.html.overflowX;document.documentElement.style.overflowY = this._originalContext.html.overflowY;document.body.style.overflowX = this._originalContext.body.overflowX;document.body.style.overflowY = this._originalContext.body.overflowY;delete this._originalContext;}this._hide(); //销毁content\nvar content=this.getDom('content');var iframe=this.getDom('iframe');if(content && iframe){var doc=iframe.contentDocument || iframe.contentWindow.document;doc && (doc.body.innerHTML = '');domUtils.remove(content);}}}};utils.inherits(Dialog,UIBase);})(); // ui/menubutton.js\n///import core\n///import uicore\n///import ui/menu.js\n///import ui/splitbutton.js\n(function(){var utils=baidu.editor.utils,Menu=baidu.editor.ui.Menu,SplitButton=baidu.editor.ui.SplitButton,MenuButton=baidu.editor.ui.MenuButton = function(options){this.initOptions(options);this.initMenuButton();};MenuButton.prototype = {initMenuButton:function initMenuButton(){var me=this;this.uiName = \"menubutton\";this.popup = new Menu({items:me.items,className:me.className,editor:me.editor});this.popup.addListener('show',function(){var list=this;for(var i=0;i < list.items.length;i++) {list.items[i].removeState('checked');if(list.items[i].value == me._value){list.items[i].addState('checked');this.value = me._value;}}});this.initSplitButton();},setValue:function setValue(value){this._value = value;}};utils.inherits(MenuButton,SplitButton);})(); // ui/multiMenu.js\n///import core\n///import uicore\n///commands 表情\n(function(){var utils=baidu.editor.utils,Popup=baidu.editor.ui.Popup,SplitButton=baidu.editor.ui.SplitButton,MultiMenuPop=baidu.editor.ui.MultiMenuPop = function(options){this.initOptions(options);this.initMultiMenu();};MultiMenuPop.prototype = {initMultiMenu:function initMultiMenu(){var me=this;this.popup = new Popup({content:'',editor:me.editor,iframe_rendered:false,onshow:function onshow(){if(!this.iframe_rendered){this.iframe_rendered = true;this.getDom('content').innerHTML = '<iframe id=\"' + me.id + '_iframe\" src=\"' + me.iframeUrl + '\" frameborder=\"0\"></iframe>';me.editor.container.style.zIndex && (this.getDom().style.zIndex = me.editor.container.style.zIndex * 1 + 1);}} // canSideUp:false,\n// canSideLeft:false\n});this.onbuttonclick = function(){this.showPopup();};this.initSplitButton();}};utils.inherits(MultiMenuPop,SplitButton);})(); // ui/shortcutmenu.js\n(function(){var UI=baidu.editor.ui,UIBase=UI.UIBase,uiUtils=UI.uiUtils,utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils;var allMenus=[], //存储所有快捷菜单\ntimeID,isSubMenuShow=false; //是否有子pop显示\nvar ShortCutMenu=UI.ShortCutMenu = function(options){this.initOptions(options);this.initShortCutMenu();};ShortCutMenu.postHide = hideAllMenu;ShortCutMenu.prototype = {isHidden:true,SPACE:5,initShortCutMenu:function initShortCutMenu(){this.items = this.items || [];this.initUIBase();this.initItems();this.initEvent();allMenus.push(this);},initEvent:function initEvent(){var me=this,doc=me.editor.document;domUtils.on(doc,\"mousemove\",function(e){if(me.isHidden === false){ //有pop显示就不隐藏快捷菜单\nif(me.getSubMenuMark() || me.eventType == \"contextmenu\")return;var flag=true,el=me.getDom(),wt=el.offsetWidth,ht=el.offsetHeight,distanceX=wt / 2 + me.SPACE, //距离中心X标准\ndistanceY=ht / 2, //距离中心Y标准\nx=Math.abs(e.screenX - me.left), //离中心距离横坐标\ny=Math.abs(e.screenY - me.top); //离中心距离纵坐标\nclearTimeout(timeID);timeID = setTimeout(function(){if(y > 0 && y < distanceY){me.setOpacity(el,\"1\");}else if(y > distanceY && y < distanceY + 70){me.setOpacity(el,\"0.5\");flag = false;}else if(y > distanceY + 70 && y < distanceY + 140){me.hide();}if(flag && x > 0 && x < distanceX){me.setOpacity(el,\"1\");}else if(x > distanceX && x < distanceX + 70){me.setOpacity(el,\"0.5\");}else if(x > distanceX + 70 && x < distanceX + 140){me.hide();}});}}); //ie\\ff下 mouseout不准\nif(browser.chrome){domUtils.on(doc,\"mouseout\",function(e){var relatedTgt=e.relatedTarget || e.toElement;if(relatedTgt == null || relatedTgt.tagName == \"HTML\"){me.hide();}});}me.editor.addListener(\"afterhidepop\",function(){if(!me.isHidden){isSubMenuShow = true;}});},initItems:function initItems(){if(utils.isArray(this.items)){for(var i=0,len=this.items.length;i < len;i++) {var item=this.items[i].toLowerCase();if(UI[item]){this.items[i] = new UI[item](this.editor);this.items[i].className += \" edui-shortcutsubmenu \";}}}},setOpacity:function setOpacity(el,value){if(browser.ie && browser.version < 9){el.style.filter = \"alpha(opacity = \" + parseFloat(value) * 100 + \");\";}else {el.style.opacity = value;}},getSubMenuMark:function getSubMenuMark(){isSubMenuShow = false;var layerEle=uiUtils.getFixedLayer();var list=domUtils.getElementsByTagName(layerEle,\"div\",function(node){return domUtils.hasClass(node,\"edui-shortcutsubmenu edui-popup\");});for(var i=0,node;node = list[i++];) {if(node.style.display != \"none\"){isSubMenuShow = true;}}return isSubMenuShow;},show:function show(e,hasContextmenu){var me=this,offset={},el=this.getDom(),fixedlayer=uiUtils.getFixedLayer();function setPos(offset){if(offset.left < 0){offset.left = 0;}if(offset.top < 0){offset.top = 0;}el.style.cssText = \"position:absolute;left:\" + offset.left + \"px;top:\" + offset.top + \"px;\";}function setPosByCxtMenu(menu){if(!menu.tagName){menu = menu.getDom();}offset.left = parseInt(menu.style.left);offset.top = parseInt(menu.style.top);offset.top -= el.offsetHeight + 15;setPos(offset);}me.eventType = e.type;el.style.cssText = \"display:block;left:-9999px\";if(e.type == \"contextmenu\" && hasContextmenu){var menu=domUtils.getElementsByTagName(fixedlayer,\"div\",\"edui-contextmenu\")[0];if(menu){setPosByCxtMenu(menu);}else {me.editor.addListener(\"aftershowcontextmenu\",function(type,menu){setPosByCxtMenu(menu);});}}else {offset = uiUtils.getViewportOffsetByEvent(e);offset.top -= el.offsetHeight + me.SPACE;offset.left += me.SPACE + 20;setPos(offset);me.setOpacity(el,0.2);}me.isHidden = false;me.left = e.screenX + el.offsetWidth / 2 - me.SPACE;me.top = e.screenY - el.offsetHeight / 2 - me.SPACE;if(me.editor){el.style.zIndex = me.editor.container.style.zIndex * 1 + 10;fixedlayer.style.zIndex = el.style.zIndex - 1;}},hide:function hide(){if(this.getDom()){this.getDom().style.display = \"none\";}this.isHidden = true;},postRender:function postRender(){if(utils.isArray(this.items)){for(var i=0,item;item = this.items[i++];) {item.postRender();}}},getHtmlTpl:function getHtmlTpl(){var buff;if(utils.isArray(this.items)){buff = [];for(var i=0;i < this.items.length;i++) {buff[i] = this.items[i].renderHtml();}buff = buff.join(\"\");}else {buff = this.items;}return '<div id=\"##\" class=\"%% edui-toolbar\" data-src=\"shortcutmenu\" onmousedown=\"return false;\" onselectstart=\"return false;\" >' + buff + '</div>';}};utils.inherits(ShortCutMenu,UIBase);function hideAllMenu(e){var tgt=e.target || e.srcElement,cur=domUtils.findParent(tgt,function(node){return domUtils.hasClass(node,\"edui-shortcutmenu\") || domUtils.hasClass(node,\"edui-popup\");},true);if(!cur){for(var i=0,menu;menu = allMenus[i++];) {menu.hide();}}}domUtils.on(document,'mousedown',function(e){hideAllMenu(e);});domUtils.on(window,'scroll',function(e){hideAllMenu(e);});})(); // ui/breakline.js\n(function(){var utils=baidu.editor.utils,UIBase=baidu.editor.ui.UIBase,Breakline=baidu.editor.ui.Breakline = function(options){this.initOptions(options);this.initSeparator();};Breakline.prototype = {uiName:'Breakline',initSeparator:function initSeparator(){this.initUIBase();},getHtmlTpl:function getHtmlTpl(){return '<br/>';}};utils.inherits(Breakline,UIBase);})(); // ui/message.js\n///import core\n///import uicore\n(function(){var utils=baidu.editor.utils,domUtils=baidu.editor.dom.domUtils,UIBase=baidu.editor.ui.UIBase,Message=baidu.editor.ui.Message = function(options){this.initOptions(options);this.initMessage();};Message.prototype = {initMessage:function initMessage(){this.initUIBase();},getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"edui-message %%\">' + ' <div id=\"##_closer\" class=\"edui-message-closer\">×</div>' + ' <div id=\"##_body\" class=\"edui-message-body edui-message-type-info\">' + ' <iframe style=\"position:absolute;z-index:-1;left:0;top:0;background-color: transparent;\" frameborder=\"0\" width=\"100%\" height=\"100%\" src=\"about:blank\"></iframe>' + ' <div class=\"edui-shadow\"></div>' + ' <div id=\"##_content\" class=\"edui-message-content\">' + '  </div>' + ' </div>' + '</div>';},reset:function reset(opt){var me=this;if(!opt.keepshow){clearTimeout(this.timer);me.timer = setTimeout(function(){me.hide();},opt.timeout || 4000);}opt.content !== undefined && me.setContent(opt.content);opt.type !== undefined && me.setType(opt.type);me.show();},postRender:function postRender(){var me=this,closer=this.getDom('closer');closer && domUtils.on(closer,'click',function(){me.hide();});},setContent:function setContent(content){this.getDom('content').innerHTML = content;},setType:function setType(type){type = type || 'info';var body=this.getDom('body');body.className = body.className.replace(/edui-message-type-[\\w-]+/,'edui-message-type-' + type);},getContent:function getContent(){return this.getDom('content').innerHTML;},getType:function getType(){var arr=this.getDom('body').match(/edui-message-type-([\\w-]+)/);return arr?arr[1]:'';},show:function show(){this.getDom().style.display = 'block';},hide:function hide(){var dom=this.getDom();if(dom){dom.style.display = 'none';dom.parentNode && dom.parentNode.removeChild(dom);}}};utils.inherits(Message,UIBase);})(); // adapter/editorui.js\n//ui跟编辑器的适配層\n//那个按钮弹出是dialog，是下拉筐等都是在这个js中配置\n//自己写的ui也要在这里配置，放到baidu.editor.ui下边，当编辑器实例化的时候会根据ueditor.config中的toolbars找到相应的进行实例化\n(function(){var utils=baidu.editor.utils;var editorui=baidu.editor.ui;var _Dialog=editorui.Dialog;editorui.buttons = {};editorui.Dialog = function(options){var dialog=new _Dialog(options);dialog.addListener('hide',function(){if(dialog.editor){var editor=dialog.editor;try{if(browser.gecko){var y=editor.window.scrollY,x=editor.window.scrollX;editor.body.focus();editor.window.scrollTo(x,y);}else {editor.focus();}}catch(ex) {}}});return dialog;};var iframeUrlMap={'anchor':'~/dialogs/anchor/anchor.html','insertimage':'~/dialogs/image/image.html','link':'~/dialogs/link/link.html','spechars':'~/dialogs/spechars/spechars.html','searchreplace':'~/dialogs/searchreplace/searchreplace.html','map':'~/dialogs/map/map.html','gmap':'~/dialogs/gmap/gmap.html','insertvideo':'~/dialogs/video/video.html','help':'~/dialogs/help/help.html','preview':'~/dialogs/preview/preview.html','emotion':'~/dialogs/emotion/emotion.html','wordimage':'~/dialogs/wordimage/wordimage.html','attachment':'~/dialogs/attachment/attachment.html','insertframe':'~/dialogs/insertframe/insertframe.html','edittip':'~/dialogs/table/edittip.html','edittable':'~/dialogs/table/edittable.html','edittd':'~/dialogs/table/edittd.html','webapp':'~/dialogs/webapp/webapp.html','snapscreen':'~/dialogs/snapscreen/snapscreen.html','scrawl':'~/dialogs/scrawl/scrawl.html','music':'~/dialogs/music/music.html','template':'~/dialogs/template/template.html','background':'~/dialogs/background/background.html','charts':'~/dialogs/charts/charts.html'}; //为工具栏添加按钮，以下都是统一的按钮触发命令，所以写在一起\nvar btnCmds=['undo','redo','formatmatch','bold','italic','underline','fontborder','touppercase','tolowercase','strikethrough','subscript','superscript','source','indent','outdent','blockquote','pasteplain','pagebreak','selectall','print','horizontal','removeformat','time','date','unlink','insertparagraphbeforetable','insertrow','insertcol','mergeright','mergedown','deleterow','deletecol','splittorows','splittocols','splittocells','mergecells','deletetable','drafts'];for(var i=0,ci;ci = btnCmds[i++];) {ci = ci.toLowerCase();editorui[ci] = (function(cmd){return function(editor){var ui=new editorui.Button({className:'edui-for-' + cmd,title:editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd) || '',onclick:function onclick(){editor.execCommand(cmd);},theme:editor.options.theme,showText:false});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){var state=editor.queryCommandState(cmd);if(state == -1){ui.setDisabled(true);ui.setChecked(false);}else {if(!uiReady){ui.setDisabled(false);ui.setChecked(state);}}});return ui;};})(ci);} //清除文档\neditorui.cleardoc = function(editor){var ui=new editorui.Button({className:'edui-for-cleardoc',title:editor.options.labelMap.cleardoc || editor.getLang(\"labelMap.cleardoc\") || '',theme:editor.options.theme,onclick:function onclick(){if(confirm(editor.getLang(\"confirmClear\"))){editor.execCommand('cleardoc');}}});editorui.buttons[\"cleardoc\"] = ui;editor.addListener('selectionchange',function(){ui.setDisabled(editor.queryCommandState('cleardoc') == -1);});return ui;}; //排版，图片排版，文字方向\nvar typeset={'justify':['left','right','center','justify'],'imagefloat':['none','left','center','right'],'directionality':['ltr','rtl']};for(var p in typeset) {(function(cmd,val){for(var i=0,ci;ci = val[i++];) {(function(cmd2){editorui[cmd.replace('float','') + cmd2] = function(editor){var ui=new editorui.Button({className:'edui-for-' + cmd.replace('float','') + cmd2,title:editor.options.labelMap[cmd.replace('float','') + cmd2] || editor.getLang(\"labelMap.\" + cmd.replace('float','') + cmd2) || '',theme:editor.options.theme,onclick:function onclick(){editor.execCommand(cmd,cmd2);}});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){ui.setDisabled(editor.queryCommandState(cmd) == -1);ui.setChecked(editor.queryCommandValue(cmd) == cmd2 && !uiReady);});return ui;};})(ci);}})(p,typeset[p]);} //字体颜色和背景颜色\nfor(var i=0,ci;ci = ['backcolor','forecolor'][i++];) {editorui[ci] = (function(cmd){return function(editor){var ui=new editorui.ColorButton({className:'edui-for-' + cmd,color:'default',title:editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd) || '',editor:editor,onpickcolor:function onpickcolor(t,color){editor.execCommand(cmd,color);},onpicknocolor:function onpicknocolor(){editor.execCommand(cmd,'default');this.setColor('transparent');this.color = 'default';},onbuttonclick:function onbuttonclick(){editor.execCommand(cmd,this.color);}});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(){ui.setDisabled(editor.queryCommandState(cmd) == -1);});return ui;};})(ci);}var dialogBtns={noOk:['searchreplace','help','spechars','webapp','preview'],ok:['attachment','anchor','link','insertimage','map','gmap','insertframe','wordimage','insertvideo','insertframe','edittip','edittable','edittd','scrawl','template','music','background','charts']};for(var p in dialogBtns) {(function(type,vals){for(var i=0,ci;ci = vals[i++];) { //todo opera下存在问题\nif(browser.opera && ci === \"searchreplace\"){continue;}(function(cmd){editorui[cmd] = function(editor,iframeUrl,title){iframeUrl = iframeUrl || (editor.options.iframeUrlMap || {})[cmd] || iframeUrlMap[cmd];title = editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd) || '';var dialog; //没有iframeUrl不创建dialog\nif(iframeUrl){dialog = new editorui.Dialog(utils.extend({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:'edui-for-' + cmd,title:title,holdScroll:cmd === 'insertimage',fullscreen:/charts|preview/.test(cmd),closeDialog:editor.getLang(\"closeDialog\")},type == 'ok'?{buttons:[{className:'edui-okbutton',label:editor.getLang(\"ok\"),editor:editor,onclick:function onclick(){dialog.close(true);}},{className:'edui-cancelbutton',label:editor.getLang(\"cancel\"),editor:editor,onclick:function onclick(){dialog.close(false);}}]}:{}));editor.ui._dialogs[cmd + \"Dialog\"] = dialog;}var ui=new editorui.Button({className:'edui-for-' + cmd,title:title,onclick:function onclick(){if(dialog){switch(cmd){case \"wordimage\":var images=editor.execCommand(\"wordimage\");if(images && images.length){dialog.render();dialog.open();}break;case \"scrawl\":if(editor.queryCommandState(\"scrawl\") != -1){dialog.render();dialog.open();}break;default:dialog.render();dialog.open();}}},theme:editor.options.theme,disabled:cmd == 'scrawl' && editor.queryCommandState(\"scrawl\") == -1 || cmd == 'charts'});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(){ //只存在于右键菜单而无工具栏按钮的ui不需要检测状态\nvar unNeedCheckState={'edittable':1};if(cmd in unNeedCheckState)return;var state=editor.queryCommandState(cmd);if(ui.getDom()){ui.setDisabled(state == -1);ui.setChecked(state);}});return ui;};})(ci.toLowerCase());}})(p,dialogBtns[p]);}editorui.snapscreen = function(editor,iframeUrl,title){title = editor.options.labelMap['snapscreen'] || editor.getLang(\"labelMap.snapscreen\") || '';var ui=new editorui.Button({className:'edui-for-snapscreen',title:title,onclick:function onclick(){editor.execCommand(\"snapscreen\");},theme:editor.options.theme});editorui.buttons['snapscreen'] = ui;iframeUrl = iframeUrl || (editor.options.iframeUrlMap || {})[\"snapscreen\"] || iframeUrlMap[\"snapscreen\"];if(iframeUrl){var dialog=new editorui.Dialog({iframeUrl:editor.ui.mapUrl(iframeUrl),editor:editor,className:'edui-for-snapscreen',title:title,buttons:[{className:'edui-okbutton',label:editor.getLang(\"ok\"),editor:editor,onclick:function onclick(){dialog.close(true);}},{className:'edui-cancelbutton',label:editor.getLang(\"cancel\"),editor:editor,onclick:function onclick(){dialog.close(false);}}]});dialog.render();editor.ui._dialogs[\"snapscreenDialog\"] = dialog;}editor.addListener('selectionchange',function(){ui.setDisabled(editor.queryCommandState('snapscreen') == -1);});return ui;};editorui.insertcode = function(editor,list,title){list = editor.options['insertcode'] || [];title = editor.options.labelMap['insertcode'] || editor.getLang(\"labelMap.insertcode\") || ''; // if (!list.length) return;\nvar items=[];utils.each(list,function(key,val){items.push({label:key,value:val,theme:editor.options.theme,renderLabelHtml:function renderLabelHtml(){return '<div class=\"edui-label %%-label\" >' + (this.label || '') + '</div>';}});});var ui=new editorui.Combox({editor:editor,items:items,onselect:function onselect(t,index){editor.execCommand('insertcode',this.items[index].value);},onbuttonclick:function onbuttonclick(){this.showPopup();},title:title,initValue:title,className:'edui-for-insertcode',indexByValue:function indexByValue(value){if(value){for(var i=0,ci;ci = this.items[i];i++) {if(ci.value.indexOf(value) != -1)return i;}}return -1;}});editorui.buttons['insertcode'] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState('insertcode');if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue('insertcode');if(!value){ui.setValue(title);return;} //trace:1871 ie下从源码模式切换回来时，字体会带单引号，而且会有逗号\nvalue && (value = value.replace(/['\"]/g,'').split(',')[0]);ui.setValue(value);}}});return ui;};editorui.fontfamily = function(editor,list,title){list = editor.options['fontfamily'] || [];title = editor.options.labelMap['fontfamily'] || editor.getLang(\"labelMap.fontfamily\") || '';if(!list.length)return;for(var i=0,ci,items=[];ci = list[i];i++) {var langLabel=editor.getLang('fontfamily')[ci.name] || \"\";(function(key,val){items.push({label:key,value:val,theme:editor.options.theme,renderLabelHtml:function renderLabelHtml(){return '<div class=\"edui-label %%-label\" style=\"font-family:' + utils.unhtml(this.value) + '\">' + (this.label || '') + '</div>';}});})(ci.label || langLabel,ci.val);}var ui=new editorui.Combox({editor:editor,items:items,onselect:function onselect(t,index){editor.execCommand('FontFamily',this.items[index].value);},onbuttonclick:function onbuttonclick(){this.showPopup();},title:title,initValue:title,className:'edui-for-fontfamily',indexByValue:function indexByValue(value){if(value){for(var i=0,ci;ci = this.items[i];i++) {if(ci.value.indexOf(value) != -1)return i;}}return -1;}});editorui.buttons['fontfamily'] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState('FontFamily');if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue('FontFamily'); //trace:1871 ie下从源码模式切换回来时，字体会带单引号，而且会有逗号\nvalue && (value = value.replace(/['\"]/g,'').split(',')[0]);ui.setValue(value);}}});return ui;};editorui.fontsize = function(editor,list,title){title = editor.options.labelMap['fontsize'] || editor.getLang(\"labelMap.fontsize\") || '';list = list || editor.options['fontsize'] || [];if(!list.length)return;var items=[];for(var i=0;i < list.length;i++) {var size=list[i] + 'px';items.push({label:size,value:size,theme:editor.options.theme,renderLabelHtml:function renderLabelHtml(){return '<div class=\"edui-label %%-label\" style=\"line-height:1;font-size:' + this.value + '\">' + (this.label || '') + '</div>';}});}var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,onselect:function onselect(t,index){editor.execCommand('FontSize',this.items[index].value);},onbuttonclick:function onbuttonclick(){this.showPopup();},className:'edui-for-fontsize'});editorui.buttons['fontsize'] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState('FontSize');if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);ui.setValue(editor.queryCommandValue('FontSize'));}}});return ui;};editorui.paragraph = function(editor,list,title){title = editor.options.labelMap['paragraph'] || editor.getLang(\"labelMap.paragraph\") || '';list = editor.options['paragraph'] || [];if(utils.isEmptyObject(list))return;var items=[];for(var i in list) {items.push({value:i,label:list[i] || editor.getLang(\"paragraph\")[i],theme:editor.options.theme,renderLabelHtml:function renderLabelHtml(){return '<div class=\"edui-label %%-label\"><span class=\"edui-for-' + this.value + '\">' + (this.label || '') + '</span></div>';}});}var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,className:'edui-for-paragraph',onselect:function onselect(t,index){editor.execCommand('Paragraph',this.items[index].value);},onbuttonclick:function onbuttonclick(){this.showPopup();}});editorui.buttons['paragraph'] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState('Paragraph');if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue('Paragraph');var index=ui.indexByValue(value);if(index != -1){ui.setValue(value);}else {ui.setValue(ui.initValue);}}}});return ui;}; //自定义标题\neditorui.customstyle = function(editor){var list=editor.options['customstyle'] || [],title=editor.options.labelMap['customstyle'] || editor.getLang(\"labelMap.customstyle\") || '';if(!list.length)return;var langCs=editor.getLang('customstyle');for(var i=0,items=[],t;t = list[i++];) {(function(t){var ck={};ck.label = t.label?t.label:langCs[t.name];ck.style = t.style;ck.className = t.className;ck.tag = t.tag;items.push({label:ck.label,value:ck,theme:editor.options.theme,renderLabelHtml:function renderLabelHtml(){return '<div class=\"edui-label %%-label\">' + '<' + ck.tag + ' ' + (ck.className?' class=\"' + ck.className + '\"':\"\") + (ck.style?' style=\"' + ck.style + '\"':\"\") + '>' + ck.label + \"<\\/\" + ck.tag + \">\" + '</div>';}});})(t);}var ui=new editorui.Combox({editor:editor,items:items,title:title,initValue:title,className:'edui-for-customstyle',onselect:function onselect(t,index){editor.execCommand('customstyle',this.items[index].value);},onbuttonclick:function onbuttonclick(){this.showPopup();},indexByValue:function indexByValue(value){for(var i=0,ti;ti = this.items[i++];) {if(ti.label == value){return i - 1;}}return -1;}});editorui.buttons['customstyle'] = ui;editor.addListener('selectionchange',function(type,causeByUi,uiReady){if(!uiReady){var state=editor.queryCommandState('customstyle');if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue('customstyle');var index=ui.indexByValue(value);if(index != -1){ui.setValue(value);}else {ui.setValue(ui.initValue);}}}});return ui;};editorui.inserttable = function(editor,iframeUrl,title){title = editor.options.labelMap['inserttable'] || editor.getLang(\"labelMap.inserttable\") || '';var ui=new editorui.TableButton({editor:editor,title:title,className:'edui-for-inserttable',onpicktable:function onpicktable(t,numCols,numRows){editor.execCommand('InsertTable',{numRows:numRows,numCols:numCols,border:1});},onbuttonclick:function onbuttonclick(){this.showPopup();}});editorui.buttons['inserttable'] = ui;editor.addListener('selectionchange',function(){ui.setDisabled(editor.queryCommandState('inserttable') == -1);});return ui;};editorui.lineheight = function(editor){var val=editor.options.lineheight || [];if(!val.length)return;for(var i=0,ci,items=[];ci = val[i++];) {items.push({ //todo:写死了\nlabel:ci,value:ci,theme:editor.options.theme,onclick:function onclick(){editor.execCommand(\"lineheight\",this.value);}});}var ui=new editorui.MenuButton({editor:editor,className:'edui-for-lineheight',title:editor.options.labelMap['lineheight'] || editor.getLang(\"labelMap.lineheight\") || '',items:items,onbuttonclick:function onbuttonclick(){var value=editor.queryCommandValue('LineHeight') || this.value;editor.execCommand(\"LineHeight\",value);}});editorui.buttons['lineheight'] = ui;editor.addListener('selectionchange',function(){var state=editor.queryCommandState('LineHeight');if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue('LineHeight');value && ui.setValue((value + '').replace(/cm/,''));ui.setChecked(state);}});return ui;};var rowspacings=['top','bottom'];for(var r=0,ri;ri = rowspacings[r++];) {(function(cmd){editorui['rowspacing' + cmd] = function(editor){var val=editor.options['rowspacing' + cmd] || [];if(!val.length)return null;for(var i=0,ci,items=[];ci = val[i++];) {items.push({label:ci,value:ci,theme:editor.options.theme,onclick:function onclick(){editor.execCommand(\"rowspacing\",this.value,cmd);}});}var ui=new editorui.MenuButton({editor:editor,className:'edui-for-rowspacing' + cmd,title:editor.options.labelMap['rowspacing' + cmd] || editor.getLang(\"labelMap.rowspacing\" + cmd) || '',items:items,onbuttonclick:function onbuttonclick(){var value=editor.queryCommandValue('rowspacing',cmd) || this.value;editor.execCommand(\"rowspacing\",value,cmd);}});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(){var state=editor.queryCommandState('rowspacing',cmd);if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue('rowspacing',cmd);value && ui.setValue((value + '').replace(/%/,''));ui.setChecked(state);}});return ui;};})(ri);} //有序，无序列表\nvar lists=['insertorderedlist','insertunorderedlist'];for(var l=0,cl;cl = lists[l++];) {(function(cmd){editorui[cmd] = function(editor){var vals=editor.options[cmd],_onMenuClick=function _onMenuClick(){editor.execCommand(cmd,this.value);},items=[];for(var i in vals) {items.push({label:vals[i] || editor.getLang()[cmd][i] || \"\",value:i,theme:editor.options.theme,onclick:_onMenuClick});}var ui=new editorui.MenuButton({editor:editor,className:'edui-for-' + cmd,title:editor.getLang(\"labelMap.\" + cmd) || '','items':items,onbuttonclick:function onbuttonclick(){var value=editor.queryCommandValue(cmd) || this.value;editor.execCommand(cmd,value);}});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(){var state=editor.queryCommandState(cmd);if(state == -1){ui.setDisabled(true);}else {ui.setDisabled(false);var value=editor.queryCommandValue(cmd);ui.setValue(value);ui.setChecked(state);}});return ui;};})(cl);}editorui.fullscreen = function(editor,title){title = editor.options.labelMap['fullscreen'] || editor.getLang(\"labelMap.fullscreen\") || '';var ui=new editorui.Button({className:'edui-for-fullscreen',title:title,theme:editor.options.theme,onclick:function onclick(){if(editor.ui){editor.ui.setFullScreen(!editor.ui.isFullScreen());}this.setChecked(editor.ui.isFullScreen());}});editorui.buttons['fullscreen'] = ui;editor.addListener('selectionchange',function(){var state=editor.queryCommandState('fullscreen');ui.setDisabled(state == -1);ui.setChecked(editor.ui.isFullScreen());});return ui;}; // 表情\neditorui[\"emotion\"] = function(editor,iframeUrl){var cmd=\"emotion\";var ui=new editorui.MultiMenuPop({title:editor.options.labelMap[cmd] || editor.getLang(\"labelMap.\" + cmd + \"\") || '',editor:editor,className:'edui-for-' + cmd,iframeUrl:editor.ui.mapUrl(iframeUrl || (editor.options.iframeUrlMap || {})[cmd] || iframeUrlMap[cmd])});editorui.buttons[cmd] = ui;editor.addListener('selectionchange',function(){ui.setDisabled(editor.queryCommandState(cmd) == -1);});return ui;};editorui.autotypeset = function(editor){var ui=new editorui.AutoTypeSetButton({editor:editor,title:editor.options.labelMap['autotypeset'] || editor.getLang(\"labelMap.autotypeset\") || '',className:'edui-for-autotypeset',onbuttonclick:function onbuttonclick(){editor.execCommand('autotypeset');}});editorui.buttons['autotypeset'] = ui;editor.addListener('selectionchange',function(){ui.setDisabled(editor.queryCommandState('autotypeset') == -1);});return ui;}; /* 简单上传插件 */editorui[\"simpleupload\"] = function(editor){var name='simpleupload',ui=new editorui.Button({className:'edui-for-' + name,title:editor.options.labelMap[name] || editor.getLang(\"labelMap.\" + name) || '',onclick:function onclick(){},theme:editor.options.theme,showText:false});editorui.buttons[name] = ui;editor.addListener('ready',function(){var b=ui.getDom('body'),iconSpan=b.children[0];editor.fireEvent('simpleuploadbtnready',iconSpan);});editor.addListener('selectionchange',function(type,causeByUi,uiReady){var state=editor.queryCommandState(name);if(state == -1){ui.setDisabled(true);ui.setChecked(false);}else {if(!uiReady){ui.setDisabled(false);ui.setChecked(state);}}});return ui;};})(); // adapter/editor.js\n///import core\n///commands 全屏\n///commandsName FullScreen\n///commandsTitle  全屏\n(function(){var utils=baidu.editor.utils,uiUtils=baidu.editor.ui.uiUtils,UIBase=baidu.editor.ui.UIBase,domUtils=baidu.editor.dom.domUtils;var nodeStack=[];function EditorUI(options){this.initOptions(options);this.initEditorUI();}EditorUI.prototype = {uiName:'editor',initEditorUI:function initEditorUI(){this.editor.ui = this;this._dialogs = {};this.initUIBase();this._initToolbars();var editor=this.editor,me=this;editor.addListener('ready',function(){ //提供getDialog方法\neditor.getDialog = function(name){return editor.ui._dialogs[name + \"Dialog\"];};domUtils.on(editor.window,'scroll',function(evt){baidu.editor.ui.Popup.postHide(evt);}); //提供编辑器实时宽高(全屏时宽高不变化)\neditor.ui._actualFrameWidth = editor.options.initialFrameWidth;UE.browser.ie && UE.browser.version === 6 && editor.container.ownerDocument.execCommand(\"BackgroundImageCache\",false,true); //display bottom-bar label based on config\nif(editor.options.elementPathEnabled){editor.ui.getDom('elementpath').innerHTML = '<div class=\"edui-editor-breadcrumb\">' + editor.getLang(\"elementPathTip\") + ':</div>';}if(editor.options.wordCount){(function(){var countFn=function countFn(){setCount(editor,me);domUtils.un(editor.document,\"click\",countFn);};domUtils.on(editor.document,\"click\",countFn);editor.ui.getDom('wordcount').innerHTML = editor.getLang(\"wordCountTip\");})();}editor.ui._scale();if(editor.options.scaleEnabled){if(editor.autoHeightEnabled){editor.disableAutoHeight();}me.enableScale();}else {me.disableScale();}if(!editor.options.elementPathEnabled && !editor.options.wordCount && !editor.options.scaleEnabled){editor.ui.getDom('elementpath').style.display = \"none\";editor.ui.getDom('wordcount').style.display = \"none\";editor.ui.getDom('scale').style.display = \"none\";}if(!editor.selection.isFocus())return;editor.fireEvent('selectionchange',false,true);});editor.addListener('mousedown',function(t,evt){var el=evt.target || evt.srcElement;baidu.editor.ui.Popup.postHide(evt,el);baidu.editor.ui.ShortCutMenu.postHide(evt);});editor.addListener(\"delcells\",function(){if(UE.ui['edittip']){new UE.ui['edittip'](editor);}editor.getDialog('edittip').open();});var pastePop,isPaste=false,timer;editor.addListener(\"afterpaste\",function(){if(editor.queryCommandState('pasteplain'))return;if(baidu.editor.ui.PastePicker){pastePop = new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:editor}),editor:editor,className:'edui-wordpastepop'});pastePop.render();}isPaste = true;});editor.addListener(\"afterinserthtml\",function(){clearTimeout(timer);timer = setTimeout(function(){if(pastePop && (isPaste || editor.ui._isTransfer)){if(pastePop.isHidden()){var span=domUtils.createElement(editor.document,'span',{'style':\"line-height:0px;\",'innerHTML':'\ufeff'}),range=editor.selection.getRange();range.insertNode(span);var tmp=getDomNode(span,'firstChild','previousSibling');tmp && pastePop.showAnchor(tmp.nodeType == 3?tmp.parentNode:tmp);domUtils.remove(span);}else {pastePop.show();}delete editor.ui._isTransfer;isPaste = false;}},200);});editor.addListener('contextmenu',function(t,evt){baidu.editor.ui.Popup.postHide(evt);});editor.addListener('keydown',function(t,evt){if(pastePop)pastePop.dispose(evt);var keyCode=evt.keyCode || evt.which;if(evt.altKey && keyCode == 90){UE.ui.buttons['fullscreen'].onclick();}});editor.addListener('wordcount',function(type){setCount(this,me);});function setCount(editor,ui){editor.setOpt({wordCount:true,maximumWords:10000,wordCountMsg:editor.options.wordCountMsg || editor.getLang(\"wordCountMsg\"),wordOverFlowMsg:editor.options.wordOverFlowMsg || editor.getLang(\"wordOverFlowMsg\")});var opt=editor.options,max=opt.maximumWords,msg=opt.wordCountMsg,errMsg=opt.wordOverFlowMsg,countDom=ui.getDom('wordcount');if(!opt.wordCount){return;}var count=editor.getContentLength(true);if(count > max){countDom.innerHTML = errMsg;editor.fireEvent(\"wordcountoverflow\");}else {countDom.innerHTML = msg.replace(\"{#leave}\",max - count).replace(\"{#count}\",count);}}editor.addListener('selectionchange',function(){if(editor.options.elementPathEnabled){me[(editor.queryCommandState('elementpath') == -1?'dis':'en') + 'ableElementPath']();}if(editor.options.scaleEnabled){me[(editor.queryCommandState('scale') == -1?'dis':'en') + 'ableScale']();}});var popup=new baidu.editor.ui.Popup({editor:editor,content:'',className:'edui-bubble',_onEditButtonClick:function _onEditButtonClick(){this.hide();editor.ui._dialogs.linkDialog.open();},_onImgEditButtonClick:function _onImgEditButtonClick(name){this.hide();editor.ui._dialogs[name] && editor.ui._dialogs[name].open();},_onImgSetFloat:function _onImgSetFloat(value){this.hide();editor.execCommand(\"imagefloat\",value);},_setIframeAlign:function _setIframeAlign(value){var frame=popup.anchorEl;var newFrame=frame.cloneNode(true);switch(value){case -2:newFrame.setAttribute(\"align\",\"\");break;case -1:newFrame.setAttribute(\"align\",\"left\");break;case 1:newFrame.setAttribute(\"align\",\"right\");break;}frame.parentNode.insertBefore(newFrame,frame);domUtils.remove(frame);popup.anchorEl = newFrame;popup.showAnchor(popup.anchorEl);},_updateIframe:function _updateIframe(){var frame=editor._iframe = popup.anchorEl;if(domUtils.hasClass(frame,'ueditor_baidumap')){editor.selection.getRange().selectNode(frame).select();editor.ui._dialogs.mapDialog.open();popup.hide();}else {editor.ui._dialogs.insertframeDialog.open();popup.hide();}},_onRemoveButtonClick:function _onRemoveButtonClick(cmdName){editor.execCommand(cmdName);this.hide();},queryAutoHide:function queryAutoHide(el){if(el && el.ownerDocument == editor.document){if(el.tagName.toLowerCase() == 'img' || domUtils.findParentByTagName(el,'a',true)){return el !== popup.anchorEl;}}return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,el);}});popup.render();if(editor.options.imagePopup){editor.addListener('mouseover',function(t,evt){evt = evt || window.event;var el=evt.target || evt.srcElement;if(editor.ui._dialogs.insertframeDialog && /iframe/ig.test(el.tagName)){var html=popup.formatHtml('<nobr>' + editor.getLang(\"property\") + ': <span onclick=$$._setIframeAlign(-2) class=\"edui-clickable\">' + editor.getLang(\"default\") + '</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class=\"edui-clickable\">' + editor.getLang(\"justifyleft\") + '</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class=\"edui-clickable\">' + editor.getLang(\"justifyright\") + '</span>&nbsp;&nbsp;' + ' <span onclick=\"$$._updateIframe( this);\" class=\"edui-clickable\">' + editor.getLang(\"modify\") + '</span></nobr>');if(html){popup.getDom('content').innerHTML = html;popup.anchorEl = el;popup.showAnchor(popup.anchorEl);}else {popup.hide();}}});editor.addListener('selectionchange',function(t,causeByUi){if(!causeByUi)return;var html='',str=\"\",img=editor.selection.getRange().getClosedNode(),dialogs=editor.ui._dialogs;if(img && img.tagName == 'IMG'){var dialogName='insertimageDialog';if(img.className.indexOf(\"edui-faked-video\") != -1 || img.className.indexOf(\"edui-upload-video\") != -1){dialogName = \"insertvideoDialog\";}if(img.className.indexOf(\"edui-faked-webapp\") != -1){dialogName = \"webappDialog\";}if(img.src.indexOf(\"http://api.map.baidu.com\") != -1){dialogName = \"mapDialog\";}if(img.className.indexOf(\"edui-faked-music\") != -1){dialogName = \"musicDialog\";}if(img.src.indexOf(\"http://maps.google.com/maps/api/staticmap\") != -1){dialogName = \"gmapDialog\";}if(img.getAttribute(\"anchorname\")){dialogName = \"anchorDialog\";html = popup.formatHtml('<nobr>' + editor.getLang(\"property\") + ': <span onclick=$$._onImgEditButtonClick(\"anchorDialog\") class=\"edui-clickable\">' + editor.getLang(\"modify\") + '</span>&nbsp;&nbsp;' + '<span onclick=$$._onRemoveButtonClick(\\'anchor\\') class=\"edui-clickable\">' + editor.getLang(\"delete\") + '</span></nobr>');}if(img.getAttribute(\"word_img\")){ //todo 放到dialog去做查询\neditor.word_img = [img.getAttribute(\"word_img\")];dialogName = \"wordimageDialog\";}if(domUtils.hasClass(img,'loadingclass') || domUtils.hasClass(img,'loaderrorclass')){dialogName = \"\";}if(!dialogs[dialogName]){return;}str = '<nobr>' + editor.getLang(\"property\") + ': ' + '<span onclick=$$._onImgSetFloat(\"none\") class=\"edui-clickable\">' + editor.getLang(\"default\") + '</span>&nbsp;&nbsp;' + '<span onclick=$$._onImgSetFloat(\"left\") class=\"edui-clickable\">' + editor.getLang(\"justifyleft\") + '</span>&nbsp;&nbsp;' + '<span onclick=$$._onImgSetFloat(\"right\") class=\"edui-clickable\">' + editor.getLang(\"justifyright\") + '</span>&nbsp;&nbsp;' + '<span onclick=$$._onImgSetFloat(\"center\") class=\"edui-clickable\">' + editor.getLang(\"justifycenter\") + '</span>&nbsp;&nbsp;' + '<span onclick=\"$$._onImgEditButtonClick(\\'' + dialogName + '\\');\" class=\"edui-clickable\">' + editor.getLang(\"modify\") + '</span></nobr>';!html && (html = popup.formatHtml(str));}if(editor.ui._dialogs.linkDialog){var link=editor.queryCommandValue('link');var url;if(link && (url = link.getAttribute('_href') || link.getAttribute('href',2))){var txt=url;if(url.length > 30){txt = url.substring(0,20) + \"...\";}if(html){html += '<div style=\"height:5px;\"></div>';}html += popup.formatHtml('<nobr>' + editor.getLang(\"anthorMsg\") + ': <a target=\"_blank\" href=\"' + url + '\" title=\"' + url + '\" >' + txt + '</a>' + ' <span class=\"edui-clickable\" onclick=\"$$._onEditButtonClick();\">' + editor.getLang(\"modify\") + '</span>' + ' <span class=\"edui-clickable\" onclick=\"$$._onRemoveButtonClick(\\'unlink\\');\"> ' + editor.getLang(\"clear\") + '</span></nobr>');popup.showAnchor(link);}}if(html){popup.getDom('content').innerHTML = html;popup.anchorEl = img || link;popup.showAnchor(popup.anchorEl);}else {popup.hide();}});}},_initToolbars:function _initToolbars(){var editor=this.editor;var toolbars=this.toolbars || [];var toolbarUis=[];for(var i=0;i < toolbars.length;i++) {var toolbar=toolbars[i];var toolbarUi=new baidu.editor.ui.Toolbar({theme:editor.options.theme});for(var j=0;j < toolbar.length;j++) {var toolbarItem=toolbar[j];var toolbarItemUi=null;if(typeof toolbarItem == 'string'){toolbarItem = toolbarItem.toLowerCase();if(toolbarItem == '|'){toolbarItem = 'Separator';}if(toolbarItem == '||'){toolbarItem = 'Breakline';}if(baidu.editor.ui[toolbarItem]){toolbarItemUi = new baidu.editor.ui[toolbarItem](editor);} //fullscreen这里单独处理一下，放到首行去\nif(toolbarItem == 'fullscreen'){if(toolbarUis && toolbarUis[0]){toolbarUis[0].items.splice(0,0,toolbarItemUi);}else {toolbarItemUi && toolbarUi.items.splice(0,0,toolbarItemUi);}continue;}}else {toolbarItemUi = toolbarItem;}if(toolbarItemUi && toolbarItemUi.id){toolbarUi.add(toolbarItemUi);}}toolbarUis[i] = toolbarUi;} //接受外部定制的UI\nutils.each(UE._customizeUI,function(obj,key){var itemUI,index;if(obj.id && obj.id != editor.key){return false;}itemUI = obj.execFn.call(editor,editor,key);if(itemUI){index = obj.index;if(index === undefined){index = toolbarUi.items.length;}toolbarUi.add(itemUI,index);}});this.toolbars = toolbarUis;},getHtmlTpl:function getHtmlTpl(){return '<div id=\"##\" class=\"%%\">' + '<div id=\"##_toolbarbox\" class=\"%%-toolbarbox\">' + (this.toolbars.length?'<div id=\"##_toolbarboxouter\" class=\"%%-toolbarboxouter\"><div class=\"%%-toolbarboxinner\">' + this.renderToolbarBoxHtml() + '</div></div>':'') + '<div id=\"##_toolbarmsg\" class=\"%%-toolbarmsg\" style=\"display:none;\">' + '<div id = \"##_upload_dialog\" class=\"%%-toolbarmsg-upload\" onclick=\"$$.showWordImageDialog();\">' + this.editor.getLang(\"clickToUpload\") + '</div>' + '<div class=\"%%-toolbarmsg-close\" onclick=\"$$.hideToolbarMsg();\">x</div>' + '<div id=\"##_toolbarmsg_label\" class=\"%%-toolbarmsg-label\"></div>' + '<div style=\"height:0;overflow:hidden;clear:both;\"></div>' + '</div>' + '<div id=\"##_message_holder\" class=\"%%-messageholder\"></div>' + '</div>' + '<div id=\"##_iframeholder\" class=\"%%-iframeholder\">' + '</div>' +  //modify wdcount by matao\n'<div id=\"##_bottombar\" class=\"%%-bottomContainer\"><table><tr>' + '<td id=\"##_elementpath\" class=\"%%-bottombar\"></td>' + '<td id=\"##_wordcount\" class=\"%%-wordcount\"></td>' + '<td id=\"##_scale\" class=\"%%-scale\"><div class=\"%%-icon\"></div></td>' + '</tr></table></div>' + '<div id=\"##_scalelayer\"></div>' + '</div>';},showWordImageDialog:function showWordImageDialog(){this._dialogs['wordimageDialog'].open();},renderToolbarBoxHtml:function renderToolbarBoxHtml(){var buff=[];for(var i=0;i < this.toolbars.length;i++) {buff.push(this.toolbars[i].renderHtml());}return buff.join('');},setFullScreen:function setFullScreen(fullscreen){var editor=this.editor,container=editor.container.parentNode.parentNode;if(this._fullscreen != fullscreen){this._fullscreen = fullscreen;this.editor.fireEvent('beforefullscreenchange',fullscreen);if(baidu.editor.browser.gecko){var bk=editor.selection.getRange().createBookmark();}if(fullscreen){while(container.tagName != \"BODY\") {var position=baidu.editor.dom.domUtils.getComputedStyle(container,\"position\");nodeStack.push(position);container.style.position = \"static\";container = container.parentNode;}this._bakHtmlOverflow = document.documentElement.style.overflow;this._bakBodyOverflow = document.body.style.overflow;this._bakAutoHeight = this.editor.autoHeightEnabled;this._bakScrollTop = Math.max(document.documentElement.scrollTop,document.body.scrollTop);this._bakEditorContaninerWidth = editor.iframe.parentNode.offsetWidth;if(this._bakAutoHeight){ //当全屏时不能执行自动长高\neditor.autoHeightEnabled = false;this.editor.disableAutoHeight();}document.documentElement.style.overflow = 'hidden'; //修复，滚动条不收起的问题\nwindow.scrollTo(0,window.scrollY);this._bakCssText = this.getDom().style.cssText;this._bakCssText1 = this.getDom('iframeholder').style.cssText;editor.iframe.parentNode.style.width = '';this._updateFullScreen();}else {while(container.tagName != \"BODY\") {container.style.position = nodeStack.shift();container = container.parentNode;}this.getDom().style.cssText = this._bakCssText;this.getDom('iframeholder').style.cssText = this._bakCssText1;if(this._bakAutoHeight){editor.autoHeightEnabled = true;this.editor.enableAutoHeight();}document.documentElement.style.overflow = this._bakHtmlOverflow;document.body.style.overflow = this._bakBodyOverflow;editor.iframe.parentNode.style.width = this._bakEditorContaninerWidth + 'px';window.scrollTo(0,this._bakScrollTop);}if(browser.gecko && editor.body.contentEditable === 'true'){var input=document.createElement('input');document.body.appendChild(input);editor.body.contentEditable = false;setTimeout(function(){input.focus();setTimeout(function(){editor.body.contentEditable = true;editor.fireEvent('fullscreenchanged',fullscreen);editor.selection.getRange().moveToBookmark(bk).select(true);baidu.editor.dom.domUtils.remove(input);fullscreen && window.scroll(0,0);},0);},0);}if(editor.body.contentEditable === 'true'){this.editor.fireEvent('fullscreenchanged',fullscreen);this.triggerLayout();}}},_updateFullScreen:function _updateFullScreen(){if(this._fullscreen){var vpRect=uiUtils.getViewportRect();this.getDom().style.cssText = 'border:0;position:absolute;left:0;top:' + (this.editor.options.topOffset || 0) + 'px;width:' + vpRect.width + 'px;height:' + vpRect.height + 'px;z-index:' + (this.getDom().style.zIndex * 1 + 100);uiUtils.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset || 0});this.editor.setHeight(vpRect.height - this.getDom('toolbarbox').offsetHeight - this.getDom('bottombar').offsetHeight - (this.editor.options.topOffset || 0),true); //不手动调一下，会导致全屏失效\nif(browser.gecko){try{window.onresize();}catch(e) {}}}},_updateElementPath:function _updateElementPath(){var bottom=this.getDom('elementpath'),list;if(this.elementPathEnabled && (list = this.editor.queryCommandValue('elementpath'))){var buff=[];for(var i=0,ci;ci = list[i];i++) {buff[i] = this.formatHtml('<span unselectable=\"on\" onclick=\"$$.editor.execCommand(&quot;elementpath&quot;, &quot;' + i + '&quot;);\">' + ci + '</span>');}bottom.innerHTML = '<div class=\"edui-editor-breadcrumb\" onmousedown=\"return false;\">' + this.editor.getLang(\"elementPathTip\") + ': ' + buff.join(' &gt; ') + '</div>';}else {bottom.style.display = 'none';}},disableElementPath:function disableElementPath(){var bottom=this.getDom('elementpath');bottom.innerHTML = '';bottom.style.display = 'none';this.elementPathEnabled = false;},enableElementPath:function enableElementPath(){var bottom=this.getDom('elementpath');bottom.style.display = '';this.elementPathEnabled = true;this._updateElementPath();},_scale:function _scale(){var doc=document,editor=this.editor,editorHolder=editor.container,editorDocument=editor.document,toolbarBox=this.getDom(\"toolbarbox\"),bottombar=this.getDom(\"bottombar\"),scale=this.getDom(\"scale\"),scalelayer=this.getDom(\"scalelayer\");var isMouseMove=false,position=null,minEditorHeight=0,minEditorWidth=editor.options.minFrameWidth,pageX=0,pageY=0,scaleWidth=0,scaleHeight=0;function down(){position = domUtils.getXY(editorHolder);if(!minEditorHeight){minEditorHeight = editor.options.minFrameHeight + toolbarBox.offsetHeight + bottombar.offsetHeight;}scalelayer.style.cssText = \"position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:\" + editorHolder.offsetWidth + \"px;height:\" + editorHolder.offsetHeight + \"px;z-index:\" + (editor.options.zIndex + 1);domUtils.on(doc,\"mousemove\",move);domUtils.on(editorDocument,\"mouseup\",up);domUtils.on(doc,\"mouseup\",up);}var me=this; //by xuheng 全屏时关掉缩放\nthis.editor.addListener('fullscreenchanged',function(e,fullScreen){if(fullScreen){me.disableScale();}else {if(me.editor.options.scaleEnabled){me.enableScale();var tmpNode=me.editor.document.createElement('span');me.editor.body.appendChild(tmpNode);me.editor.body.style.height = Math.max(domUtils.getXY(tmpNode).y,me.editor.iframe.offsetHeight - 20) + 'px';domUtils.remove(tmpNode);}}});function move(event){clearSelection();var e=event || window.event;pageX = e.pageX || doc.documentElement.scrollLeft + e.clientX;pageY = e.pageY || doc.documentElement.scrollTop + e.clientY;scaleWidth = pageX - position.x;scaleHeight = pageY - position.y;if(scaleWidth >= minEditorWidth){isMouseMove = true;scalelayer.style.width = scaleWidth + 'px';}if(scaleHeight >= minEditorHeight){isMouseMove = true;scalelayer.style.height = scaleHeight + \"px\";}}function up(){if(isMouseMove){isMouseMove = false;editor.ui._actualFrameWidth = scalelayer.offsetWidth - 2;editorHolder.style.width = editor.ui._actualFrameWidth + 'px';editor.setHeight(scalelayer.offsetHeight - bottombar.offsetHeight - toolbarBox.offsetHeight - 2,true);}if(scalelayer){scalelayer.style.display = \"none\";}clearSelection();domUtils.un(doc,\"mousemove\",move);domUtils.un(editorDocument,\"mouseup\",up);domUtils.un(doc,\"mouseup\",up);}function clearSelection(){if(browser.ie)doc.selection.clear();else window.getSelection().removeAllRanges();}this.enableScale = function(){ //trace:2868\nif(editor.queryCommandState(\"source\") == 1)return;scale.style.display = \"\";this.scaleEnabled = true;domUtils.on(scale,\"mousedown\",down);};this.disableScale = function(){scale.style.display = \"none\";this.scaleEnabled = false;domUtils.un(scale,\"mousedown\",down);};},isFullScreen:function isFullScreen(){return this._fullscreen;},postRender:function postRender(){UIBase.prototype.postRender.call(this);for(var i=0;i < this.toolbars.length;i++) {this.toolbars[i].postRender();}var me=this;var timerId,domUtils=baidu.editor.dom.domUtils,updateFullScreenTime=function updateFullScreenTime(){clearTimeout(timerId);timerId = setTimeout(function(){me._updateFullScreen();});};domUtils.on(window,'resize',updateFullScreenTime);me.addListener('destroy',function(){domUtils.un(window,'resize',updateFullScreenTime);clearTimeout(timerId);});},showToolbarMsg:function showToolbarMsg(msg,flag){this.getDom('toolbarmsg_label').innerHTML = msg;this.getDom('toolbarmsg').style.display = ''; //\nif(!flag){var w=this.getDom('upload_dialog');w.style.display = 'none';}},hideToolbarMsg:function hideToolbarMsg(){this.getDom('toolbarmsg').style.display = 'none';},mapUrl:function mapUrl(url){return url?url.replace('~/',this.editor.options.UEDITOR_HOME_URL || ''):'';},triggerLayout:function triggerLayout(){var dom=this.getDom();if(dom.style.zoom == '1'){dom.style.zoom = '100%';}else {dom.style.zoom = '1';}}};utils.inherits(EditorUI,baidu.editor.ui.UIBase);var instances={};UE.ui.Editor = function(options){var editor=new UE.Editor(options);editor.options.editor = editor;utils.loadFile(document,{href:editor.options.themePath + editor.options.theme + \"/css/ueditor.css\",tag:\"link\",type:\"text/css\",rel:\"stylesheet\"});var oldRender=editor.render;editor.render = function(holder){if(holder.constructor === String){editor.key = holder;instances[holder] = editor;}utils.domReady(function(){editor.langIsReady?renderUI():editor.addListener(\"langReady\",renderUI);function renderUI(){editor.setOpt({labelMap:editor.options.labelMap || editor.getLang('labelMap')});new EditorUI(editor.options);if(holder){if(holder.constructor === String){holder = document.getElementById(holder);}holder && holder.getAttribute('name') && (editor.options.textarea = holder.getAttribute('name'));if(holder && /script|textarea/ig.test(holder.tagName)){var newDiv=document.createElement('div');holder.parentNode.insertBefore(newDiv,holder);var cont=holder.value || holder.innerHTML;editor.options.initialContent = /^[\\t\\r\\n ]*$/.test(cont)?editor.options.initialContent:cont.replace(/>[\\n\\r\\t]+([ ]{4})+/g,'>').replace(/[\\n\\r\\t]+([ ]{4})+</g,'<').replace(/>[\\n\\r\\t]+</g,'><');holder.className && (newDiv.className = holder.className);holder.style.cssText && (newDiv.style.cssText = holder.style.cssText);if(/textarea/i.test(holder.tagName)){editor.textarea = holder;editor.textarea.style.display = 'none';}else {holder.parentNode.removeChild(holder);}if(holder.id){newDiv.id = holder.id;domUtils.removeAttributes(holder,'id');}holder = newDiv;holder.innerHTML = '';}}domUtils.addClass(holder,\"edui-\" + editor.options.theme);editor.ui.render(holder);var opt=editor.options; //给实例添加一个编辑器的容器引用\neditor.container = editor.ui.getDom();var parents=domUtils.findParents(holder,true);var displays=[];for(var i=0,ci;ci = parents[i];i++) {displays[i] = ci.style.display;ci.style.display = 'block';}if(opt.initialFrameWidth){opt.minFrameWidth = opt.initialFrameWidth;}else {opt.minFrameWidth = opt.initialFrameWidth = holder.offsetWidth;var styleWidth=holder.style.width;if(/%$/.test(styleWidth)){opt.initialFrameWidth = styleWidth;}}if(opt.initialFrameHeight){opt.minFrameHeight = opt.initialFrameHeight;}else {opt.initialFrameHeight = opt.minFrameHeight = holder.offsetHeight;}for(var i=0,ci;ci = parents[i];i++) {ci.style.display = displays[i];} //编辑器最外容器设置了高度，会导致，编辑器不占位\n//todo 先去掉，没有找到原因\nif(holder.style.height){holder.style.height = '';}editor.container.style.width = opt.initialFrameWidth + (/%$/.test(opt.initialFrameWidth)?'':'px');editor.container.style.zIndex = opt.zIndex;oldRender.call(editor,editor.ui.getDom('iframeholder'));editor.fireEvent(\"afteruiready\");}});};return editor;}; /**\r\n     * @file\r\n     * @name UE\r\n     * @short UE\r\n     * @desc UEditor的顶部命名空间\r\n     */ /**\r\n     * @name getEditor\r\n     * @since 1.2.4+\r\n     * @grammar UE.getEditor(id,[opt])  =>  Editor实例\r\n     * @desc 提供一个全局的方法得到编辑器实例\r\n     *\r\n     * * ''id''  放置编辑器的容器id, 如果容器下的编辑器已经存在，就直接返回\r\n     * * ''opt'' 编辑器的可选参数\r\n     * @example\r\n     *  UE.getEditor('containerId',{onready:function(){//创建一个编辑器实例\r\n     *      this.setContent('hello')\r\n     *  }});\r\n     *  UE.getEditor('containerId'); //返回刚创建的实例\r\n     *\r\n     */UE.getEditor = function(id,opt){var editor=instances[id];if(!editor){editor = instances[id] = new UE.ui.Editor(opt);editor.render(id);}return editor;};UE.delEditor = function(id){var editor;if(editor = instances[id]){editor.key && editor.destroy();delete instances[id];}};UE.registerUI = function(uiName,fn,index,editorId){utils.each(uiName.split(/\\s+/),function(name){UE._customizeUI[name] = {id:editorId,execFn:fn,index:index};});};})(); // adapter/message.js\nUE.registerUI('message',function(editor){var editorui=baidu.editor.ui;var Message=editorui.Message;var holder;var _messageItems=[];var me=editor;me.addListener('ready',function(){holder = document.getElementById(me.ui.id + '_message_holder');updateHolderPos();setTimeout(function(){updateHolderPos();},500);});me.addListener('showmessage',function(type,opt){opt = utils.isString(opt)?{'content':opt}:opt;var message=new Message({'timeout':opt.timeout,'type':opt.type,'content':opt.content,'keepshow':opt.keepshow,'editor':me}),mid=opt.id || 'msg_' + (+new Date()).toString(36);message.render(holder);_messageItems[mid] = message;message.reset(opt);updateHolderPos();return mid;});me.addListener('updatemessage',function(type,id,opt){opt = utils.isString(opt)?{'content':opt}:opt;var message=_messageItems[id];message.render(holder);message && message.reset(opt);});me.addListener('hidemessage',function(type,id){var message=_messageItems[id];message && message.hide();});function updateHolderPos(){var toolbarbox=me.ui.getDom('toolbarbox');if(toolbarbox){holder.style.top = toolbarbox.offsetHeight + 3 + 'px';}holder.style.zIndex = Math.max(me.options.zIndex,me.iframe.style.zIndex) + 1;}}); // adapter/autosave.js\nUE.registerUI('autosave',function(editor){var timer=null,uid=null;editor.on('afterautosave',function(){clearTimeout(timer);timer = setTimeout(function(){if(uid){editor.trigger('hidemessage',uid);}uid = editor.trigger('showmessage',{content:editor.getLang('autosave.success'),timeout:2000});},2000);});});})();";
},function(e,t){e.exports="/**\r\n * ueditor完整配置项\r\n * 可以在这里配置整个编辑器的特性\r\n */\n/**************************提示********************************\r\n * 所有被注释的配置项均为UEditor默认值。\r\n * 修改默认配置请首先确保已经完全明确该参数的真实用途。\r\n * 主要有两种修改方案，一种是取消此处注释，然后修改成对应参数；另一种是在实例化编辑器时传入对应参数。\r\n * 当升级编辑器时，可直接使用旧版配置文件替换新版配置文件,不用担心旧版配置文件中因缺少新功能所需的参数而导致脚本报错。\r\n **************************提示********************************/\n\n'use strict';\n\n(function () {\n\n        /**\r\n         * 编辑器资源文件根路径。它所表示的含义是：以编辑器实例化页面为当前路径，指向编辑器资源文件（即dialog等文件夹）的路径。\r\n         * 鉴于很多同学在使用编辑器的时候出现的种种路径问题，此处强烈建议大家使用\"相对于网站根目录的相对路径\"进行配置。\r\n         * \"相对于网站根目录的相对路径\"也就是以斜杠开头的形如\"/myProject/ueditor/\"这样的路径。\r\n         * 如果站点中有多个不在同一层级的页面需要实例化编辑器，且引用了同一UEditor的时候，此处的URL可能不适用于每个页面的编辑器。\r\n         * 因此，UEditor提供了针对不同页面的编辑器可单独配置的根路径，具体来说，在需要实例化编辑器的页面最顶部写上如下代码即可。当然，需要令此处的URL等于对应的配置。\r\n         * window.UEDITOR_HOME_URL = \"/xxxx/xxxx/\";\r\n         */\n        //var URL = window.UEDITOR_HOME_URL || getUEBasePath();\n        var URL = '/dist/ueditor/';\n\n        /**\r\n         * 配置项主体。注意，此处所有涉及到路径的配置别遗漏URL变量。\r\n         */\n        window.UEDITOR_CONFIG = {\n\n                //为编辑器实例添加一个路径，这个不能被注释\n                UEDITOR_HOME_URL: URL,\n\n                // 服务器统一请求接口路径\n                //, serverUrl: URL + \"php/controller.php\"\n\n                //工具栏上的所有的功能按钮和下拉框，可以在new编辑器的实例时选择自己需要的从新定义\n                toolbars: [['fullscreen', 'bold', 'italic', 'underline', 'strikethrough', 'forecolor', 'backcolor', 'removeformat', 'fontsize', '|', 'blockquote', 'insertorderedlist', 'insertunorderedlist', 'justifyleft', 'justifycenter', 'justifyright', '|']],\n                //当鼠标放在工具栏上时显示的tooltip提示,留空支持自动多语言配置，否则以配置值为准\n                //,labelMap:{\n                //    'anchor':'', 'undo':''\n                //}\n\n                //语言配置项,默认是zh-cn。有需要的话也可以使用如下这样的方式来自动多语言切换，当然，前提条件是lang文件夹下存在对应的语言文件：\n                //lang值也可以通过自动获取 (navigator.language||navigator.browserLanguage ||navigator.userLanguage).toLowerCase()\n                //,lang:\"zh-cn\"\n                //,langPath:URL +\"lang/\"\n\n                //主题配置项,默认是default。有需要的话也可以使用如下这样的方式来自动多主题切换，当然，前提条件是themes文件夹下存在对应的主题文件：\n                //现有如下皮肤:default\n                //,theme:'default'\n                //,themePath:URL +\"themes/\"\n\n                //,zIndex : 900     //编辑器层级的基数,默认是900\n\n                //针对getAllHtml方法，会在对应的head标签中增加该编码设置。\n                //,charset:\"utf-8\"\n\n                //若实例化编辑器的页面手动修改的domain，此处需要设置为true\n                //,customDomain:false\n\n                //常用配置项目\n                //,isShow : true    //默认显示编辑器\n\n                //,textarea:'editorValue' // 提交表单时，服务器获取编辑器提交内容的所用的参数，多实例时可以给容器name属性，会将name给定的值最为每个实例的键值，不用每次实例化的时候都设置这个值\n\n                //,initialContent:'欢迎使用ueditor!'    //初始化编辑器的内容,也可以通过textarea/script给值，看官网例子\n\n                //,autoClearinitialContent:true //是否自动清除编辑器初始内容，注意：如果focus属性设置为true,这个也为真，那么编辑器一上来就会触发导致初始化的内容看不到了\n\n                //,focus:false //初始化时，是否让编辑器获得焦点true或false\n\n                //如果自定义，最好给p标签如下的行高，要不输入中文时，会有跳动感\n                //,initialStyle:'p{line-height:1em}'//编辑器层级的基数,可以用来改变字体等\n\n                //,iframeCssUrl: URL + '/themes/iframe.css' //给编辑器内部引入一个css文件\n\n                //indentValue\n                //首行缩进距离,默认是2em\n                //,indentValue:'2em'\n\n                //,initialFrameWidth:1000  //初始化编辑器宽度,默认1000\n                //,initialFrameHeight:320  //初始化编辑器高度,默认320\n\n                //,readonly : false //编辑器初始化结束后,编辑区域是否是只读的，默认是false\n\n                //,autoClearEmptyNode : true //getContent时，是否删除空的inlineElement节点（包括嵌套的情况）\n\n                //启用自动保存\n                //,enableAutoSave: false\n                //自动保存间隔时间， 单位ms\n                saveInterval: 5000000000,\n\n                //,fullscreen : false //是否开启初始化时即全屏，默认关闭\n\n                //,imagePopup:true      //图片操作的浮层开关，默认打开\n\n                //,autoSyncData:true //自动同步编辑器要提交的数据\n                //,emotionLocalization:false //是否开启表情本地化，默认关闭。若要开启请确保emotion文件夹下包含官网提供的images表情文件夹\n\n                //粘贴只保留标签，去除标签所有属性\n                //,retainOnlyLabelPasted: false\n\n                //,pasteplain:false  //是否默认为纯文本粘贴。false为不使用纯文本粘贴，true为使用纯文本粘贴\n                //纯文本粘贴模式下的过滤规则\n                //'filterTxtRules' : function(){\n                //    function transP(node){\n                //        node.tagName = 'p';\n                //        node.setStyle();\n                //    }\n                //    return {\n                //        //直接删除及其字节点内容\n                //        '-' : 'script style object iframe embed input select',\n                //        'p': {$:{}},\n                //        'br':{$:{}},\n                //        'div':{'$':{}},\n                //        'li':{'$':{}},\n                //        'caption':transP,\n                //        'th':transP,\n                //        'tr':transP,\n                //        'h1':transP,'h2':transP,'h3':transP,'h4':transP,'h5':transP,'h6':transP,\n                //        'td':function(node){\n                //            //没有内容的td直接删掉\n                //            var txt = !!node.innerText();\n                //            if(txt){\n                //                node.parentNode.insertAfter(UE.uNode.createText(' &nbsp; &nbsp;'),node);\n                //            }\n                //            node.parentNode.removeChild(node,node.innerText())\n                //        }\n                //    }\n                //}()\n\n                //,allHtmlEnabled:false //提交到后台的数据是否包含整个html字符串\n\n                //insertorderedlist\n                //有序列表的下拉配置,值留空时支持多语言自动识别，若配置值，则以此值为准\n                //,'insertorderedlist':{\n                //      //自定的样式\n                //        'num':'1,2,3...',\n                //        'num1':'1),2),3)...',\n                //        'num2':'(1),(2),(3)...',\n                //        'cn':'一,二,三....',\n                //        'cn1':'一),二),三)....',\n                //        'cn2':'(一),(二),(三)....',\n                //     //系统自带\n                //     'decimal' : '' ,         //'1,2,3...'\n                //     'lower-alpha' : '' ,    // 'a,b,c...'\n                //     'lower-roman' : '' ,    //'i,ii,iii...'\n                //     'upper-alpha' : '' , lang   //'A,B,C'\n                //     'upper-roman' : ''      //'I,II,III...'\n                //}\n\n                //insertunorderedlist\n                //无序列表的下拉配置，值留空时支持多语言自动识别，若配置值，则以此值为准\n                //,insertunorderedlist : { //自定的样式\n                //    'dash' :'— 破折号', //-破折号\n                //    'dot':' 。 小圆圈', //系统自带\n                //    'circle' : '',  // '○ 小圆圈'\n                //    'disc' : '',    // '● 小圆点'\n                //    'square' : ''   //'■ 小方块'\n                //}\n                //,listDefaultPaddingLeft : '30'//默认的左边缩进的基数倍\n                //,listiconpath : 'http://bs.baidu.com/listicon/'//自定义标号的路径\n                //,maxListLevel : 3 //限制可以tab的级数, 设置-1为不限制\n\n                //,autoTransWordToList:false  //禁止word中粘贴进来的列表自动变成列表标签\n\n                //fontfamily\n                //字体设置 label留空支持多语言自动切换，若配置，则以配置值为准\n                //,'fontfamily':[\n                //    { label:'',name:'songti',val:'宋体,SimSun'},\n                //    { label:'',name:'kaiti',val:'楷体,楷体_GB2312, SimKai'},\n                //    { label:'',name:'yahei',val:'微软雅黑,Microsoft YaHei'},\n                //    { label:'',name:'heiti',val:'黑体, SimHei'},\n                //    { label:'',name:'lishu',val:'隶书, SimLi'},\n                //    { label:'',name:'andaleMono',val:'andale mono'},\n                //    { label:'',name:'arial',val:'arial, helvetica,sans-serif'},\n                //    { label:'',name:'arialBlack',val:'arial black,avant garde'},\n                //    { label:'',name:'comicSansMs',val:'comic sans ms'},\n                //    { label:'',name:'impact',val:'impact,chicago'},\n                //    { label:'',name:'timesNewRoman',val:'times new roman'}\n                //]\n\n                //fontsize\n                //字号\n                //,'fontsize':[10, 11, 12, 14, 16, 18, 20, 24, 36]\n\n                //paragraph\n                //段落格式 值留空时支持多语言自动识别，若配置，则以配置值为准\n                //,'paragraph':{'p':'', 'h1':'', 'h2':'', 'h3':'', 'h4':'', 'h5':'', 'h6':''}\n\n                //rowspacingtop\n                //段间距 值和显示的名字相同\n                //,'rowspacingtop':['5', '10', '15', '20', '25']\n\n                //rowspacingBottom\n                //段间距 值和显示的名字相同\n                //,'rowspacingbottom':['5', '10', '15', '20', '25']\n\n                //lineheight\n                //行内间距 值和显示的名字相同\n                //,'lineheight':['1', '1.5','1.75','2', '3', '4', '5']\n\n                //customstyle\n                //自定义样式，不支持国际化，此处配置值即可最后显示值\n                //block的元素是依据设置段落的逻辑设置的，inline的元素依据BIU的逻辑设置\n                //尽量使用一些常用的标签\n                //参数说明\n                //tag 使用的标签名字\n                //label 显示的名字也是用来标识不同类型的标识符，注意这个值每个要不同，\n                //style 添加的样式\n                //每一个对象就是一个自定义的样式\n                //,'customstyle':[\n                //    {tag:'h1', name:'tc', label:'', style:'border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;'},\n                //    {tag:'h1', name:'tl',label:'', style:'border-bottom:#ccc 2px solid;padding:0 4px 0 0;margin:0 0 10px 0;'},\n                //    {tag:'span',name:'im', label:'', style:'font-style:italic;font-weight:bold'},\n                //    {tag:'span',name:'hi', label:'', style:'font-style:italic;font-weight:bold;color:rgb(51, 153, 204)'}\n                //]\n\n                //打开右键菜单功能\n                enableContextMenu: false,\n                //右键菜单的内容，可以参考plugins/contextmenu.js里边的默认菜单的例子，label留空支持国际化，否则以此配置为准\n                //,contextMenu:[\n                //    {\n                //        label:'',       //显示的名称\n                //        cmdName:'selectall',//执行的command命令，当点击这个右键菜单时\n                //        //exec可选，有了exec就会在点击时执行这个function，优先级高于cmdName\n                //        exec:function () {\n                //            //this是当前编辑器的实例\n                //            //this.ui._dialogs['inserttableDialog'].open();\n                //        }\n                //    }\n                //]\n\n                //快捷菜单\n                //,shortcutMenu:[\"fontfamily\", \"fontsize\", \"bold\", \"italic\", \"underline\", \"forecolor\", \"backcolor\", \"insertorderedlist\", \"insertunorderedlist\"]\n\n                //elementPathEnabled\n                //是否启用元素路径，默认是显示\n                elementPathEnabled: false,\n\n                //wordCount\n                wordCount: false, //是否开启字数统计\n                //,maximumWords:10000       //允许的最大字符数\n                //字数统计提示，{#count}代表当前字数，{#leave}代表还可以输入多少字符数,留空支持多语言自动切换，否则按此配置显示\n                //,wordCountMsg:''   //当前已输入 {#count} 个字符，您还可以输入{#leave} 个字符\n                //超出字数限制提示  留空支持多语言自动切换，否则按此配置显示\n                //,wordOverFlowMsg:''    //<span style=\"color:red;\">你输入的字符个数已经超出最大允许值，服务器可能会拒绝保存！</span>\n\n                //tab\n                //点击tab键时移动的距离,tabSize倍数，tabNode什么字符做为单位\n                //,tabSize:4\n                //,tabNode:'&nbsp;'\n\n                //removeFormat\n                //清除格式时可以删除的标签和属性\n                //removeForamtTags标签\n                //,removeFormatTags:'b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var'\n                //removeFormatAttributes属性\n                //,removeFormatAttributes:'class,style,lang,width,height,align,hspace,valign'\n\n                //undo\n                //可以最多回退的次数,默认20\n                //,maxUndoCount:20\n                //当输入的字符数超过该值时，保存一次现场\n                //,maxInputCount:1\n\n                //autoHeightEnabled\n                // 是否自动长高,默认true\n                //,autoHeightEnabled:true\n\n                //scaleEnabled\n                //是否可以拉伸长高,默认true(当开启时，自动长高失效)\n                //,scaleEnabled:false\n                //,minFrameWidth:800    //编辑器拖动时最小宽度,默认800\n                //,minFrameHeight:220  //编辑器拖动时最小高度,默认220\n\n                //autoFloatEnabled\n                //是否保持toolbar的位置不动,默认true\n                //,autoFloatEnabled:true\n                //浮动时工具栏距离浏览器顶部的高度，用于某些具有固定头部的页面\n                //,topOffset:30\n                //编辑器底部距离工具栏高度(如果参数大于等于编辑器高度，则设置无效)\n                //,toolbarTopOffset:400\n\n                //pageBreakTag\n                //分页标识符,默认是_ueditor_page_break_tag_\n                //,pageBreakTag:'_ueditor_page_break_tag_'\n\n                //autotypeset\n                //自动排版参数\n                //,autotypeset: {\n                //    mergeEmptyline: true,           //合并空行\n                //    removeClass: true,              //去掉冗余的class\n                //    removeEmptyline: false,         //去掉空行\n                //    textAlign:\"left\",               //段落的排版方式，可以是 left,right,center,justify 去掉这个属性表示不执行排版\n                //    imageBlockLine: 'center',       //图片的浮动方式，独占一行剧中,左右浮动，默认: center,left,right,none 去掉这个属性表示不执行排版\n                //    pasteFilter: false,             //根据规则过滤没事粘贴进来的内容\n                //    clearFontSize: false,           //去掉所有的内嵌字号，使用编辑器默认的字号\n                //    clearFontFamily: false,         //去掉所有的内嵌字体，使用编辑器默认的字体\n                //    removeEmptyNode: false,         // 去掉空节点\n                //    //可以去掉的标签\n                //    removeTagNames: {标签名字:1},\n                //    indent: false,                  // 行首缩进\n                //    indentValue : '2em',            //行首缩进的大小\n                //    bdc2sb: false,\n                //    tobdc: false\n                //}\n\n                //tableDragable\n                //表格是否可以拖拽\n                //,tableDragable: true\n\n                //,disabledTableInTable:true  //禁止表格嵌套\n\n                //sourceEditor\n                //源码的查看方式,codemirror 是代码高亮，textarea是文本框,默认是codemirror\n                //注意默认codemirror只能在ie8+和非ie中使用\n                sourceEditor: \"textarea\"\n                //如果sourceEditor是codemirror，还用配置一下两个参数\n                //codeMirrorJsUrl js加载的路径，默认是 URL + \"third-party/codemirror/codemirror.js\"\n                //,codeMirrorJsUrl:URL + \"third-party/codemirror/codemirror.js\"\n                //codeMirrorCssUrl css加载的路径，默认是 URL + \"third-party/codemirror/codemirror.css\"\n                //,codeMirrorCssUrl:URL + \"third-party/codemirror/codemirror.css\"\n                //编辑器初始化完成后是否进入源码模式，默认为否。\n                //,sourceEditorFirst:false\n\n                //iframeUrlMap\n                //dialog内容的路径 ～会被替换成URL,垓属性一旦打开，将覆盖所有的dialog的默认路径\n                //,iframeUrlMap:{\n                //    'anchor':'~/dialogs/anchor/anchor.html',\n                //}\n\n                //webAppKey 百度应用的APIkey，每个站长必须首先去百度官网注册一个key后方能正常使用app功能，注册介绍，http://app.baidu.com/static/cms/getapikey.html\n                //, webAppKey: \"\"\n        };\n\n        function getUEBasePath(docUrl, confUrl) {\n\n                return getBasePath(docUrl || self.document.URL || self.location.href, confUrl || getConfigFilePath());\n        }\n\n        function getConfigFilePath() {\n\n                var configPath = document.getElementsByTagName('script');\n\n                return configPath[configPath.length - 1].src;\n        }\n\n        function getBasePath(docUrl, confUrl) {\n\n                var basePath = confUrl;\n\n                if (/^(\\/|\\\\\\\\)/.test(confUrl)) {\n\n                        basePath = /^.+?\\w(\\/|\\\\\\\\)/.exec(docUrl)[0] + confUrl.replace(/^(\\/|\\\\\\\\)/, '');\n                } else if (!/^[a-z]+:/i.test(confUrl)) {\n\n                        docUrl = docUrl.split(\"#\")[0].split(\"?\")[0].replace(/[^\\\\\\/]+$/, '');\n\n                        basePath = docUrl + \"\" + confUrl;\n                }\n\n                return optimizationPath(basePath);\n        }\n\n        function optimizationPath(path) {\n\n                var protocol = /^[a-z]+:\\/\\//.exec(path)[0],\n                    tmp = null,\n                    res = [];\n\n                path = path.replace(protocol, \"\").split(\"?\")[0].split(\"#\")[0];\n\n                path = path.replace(/\\\\/g, '/').split(/\\//);\n\n                path[path.length - 1] = \"\";\n\n                while (path.length) {\n\n                        if ((tmp = path.shift()) === \"..\") {\n                                res.pop();\n                        } else if (tmp !== \".\") {\n                                res.push(tmp);\n                        }\n                }\n\n                return protocol + res.join(\"/\");\n        }\n\n        window.UE = {\n                getUEBasePath: getUEBasePath\n        };\n})();"},function(e,t,n){var r=n(86);"string"==typeof r&&(r=[[e.id,r,""]]);n(50)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){var r=n(87);"string"==typeof r&&(r=[[e.id,r,""]]);n(50)(r,{});r.locals&&(e.exports=r.locals)},function(e,t,n){var r=n(88);"string"==typeof r&&(r=[[e.id,r,""]]);n(50)(r,{});r.locals&&(e.exports=r.locals)}]);